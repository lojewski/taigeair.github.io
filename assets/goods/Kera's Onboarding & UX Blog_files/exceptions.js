/*! scripts/tumblr/utils/exceptions.js */
(function(A,F){var y=A.document;var a=A.encodeURIComponent;var e=A.navigator;var t=A.parseInt;var s=A.performance;var n=A.window;var f=A.Date;var E=A.Error;var o=A.Math;var w=A.XMLHttpRequest;var g=[];var q=[];var j=false;function x(I,H,J,G){I.addEventListener?I.addEventListener(H,J,!!G):I.attachEvent&&I.attachEvent("on"+H,J,!!G)}function c(H,G){return(typeof H==="string")&&(H.length>G)?[H.slice(0,G/2),"...",H.length-G,"...",H.slice(-G/2)].join(""):H}function p(K,I){var L=[];for(var J in K){if(!K.hasOwnProperty(J)){continue}var H=I?(I+"["+J+"]"):J,G=K[J];L.push(typeof G==="object"?p(G,H):a(H)+"="+a(G))}return L.join("&")}var u=(function(G){return(G&&G.keys)||function(K){var H=[];var J=G.prototype.hasOwnProperty;for(var I in K){J.call(K,I)&&H.push(I)}return H}})(A.Object);var D=function(H,K,I){if(typeof K!=="function"){return}var G=(H&&H.length)>>>0;for(var J=0;J<G;J++){K.call(I,H[J],J,H)}};var z=(function(G){return(G&&G.stringify&&function(I){try{return G.stringify(I)}catch(H){C(H);return'"FAILED_JSON_STRINGIFY"'}})||function(){return'"NO_JSON_STRINGIFY"'}})(A.JSON);var i=(function(G){return(G&&G.Features)||(function(){C(new E("Missing Tumblr.Features in exceptions.js"));var H={enable_js_errors_log:true,enable_js_ephemeral_log:true};function I(J,K){return(typeof J==="function")?J.call(this,K):J}return function(K){var J=!!(H[K]);return function L(N,O){var M=I.call(this,(J?N:O),J);return(M!==void 0)?M:L}}})()})(A.Tumblr);function C(H,G){if(typeof G==="number"&&o.random()>G){return}if(H instanceof E){H.url||(H.url="//www.tumblr.com/");k(H.message,H.url,H.ln,H.col,H)}else{g.push(z(H))}}var v=/https?:\/\//;var m=/https?:\/\/[^/]*tumblr[^/]*/;function k(K,H,J,G,I){try{H=c(H,300)||"";if(v.test(H)&&!m.test(H)){return}I=z(c(I&&I.stack,1000)||"");if(v.test(I)&&!m.test(I)){return}q.push({path:(y.location||{}).pathname||"NO_LOCATION_OR_PATHNAME",msg:c(K,200)||"",url:H,ln:t(J,10)||-1,col:t(G,10)||-1,err:I,group:i("js_errors_a")("A",i("js_errors_b")("B","*"))})}catch(I){}}function b(){return((y.head||{}).innerHTML||"").indexOf("#missinge_button")!==-1}var h=C.debugDump=function(){var G=[];D(y.getElementsByTagName("script"),function(H){G.push(H.src)});return{timestamp:+new f(),path:(y.location||{}).href||"NO_HREF",lang:(e||{}).userLanguage||(e||{}).language||"NO_LANG",referrer:y.referrer||"NO_REFERRER",ua:(e||{}).userAgent||"NO_UA",timing:(s||{}).timing||"NO_TIMING",scripts:G,globals:u(A),cookie:y.cookie,ephemeral:g,errors:q,document:(y.documentElement||{}).innerHTML||"NO_DOCUMENT"}};function r(G){var H=h();H.name=G;return z(H)}function l(){try{if(!j){q.length=0;C(new E("PAGE_DID_NOT_LOAD"))}var G;!b()&&i("enable_js_errors_log")(function(){q.length&&((G||(G={})).errors=q)});i("enable_js_ephemeral_log")(function(){g.length&&((G||(G={})).ephemeral=g)});i("js_debugger_1")(function(){(G||(G={})).ephemeral=[r("js_debugger_1")]});i("js_debugger_2")(function(){(G||(G={})).ephemeral=[r("js_debugger_2")]});if(!G){return}var I=new w();I.open("POST","/svc/log/capture/exceptions",false);I.setRequestHeader("Content-type","application/x-www-form-urlencoded");I.onreadystatechange=function(){if(I.readyState!==4){return}q.length=g.length=0};I.send(p({form_key:(y.getElementById("tumblr_form_key")||y.body).getAttribute("content"),log:G}))}catch(H){if(!A.jQuery){return}C(H);(G||(G={})).errors||(G.errors=q);A.jQuery.ajax({async:false,type:"POST",data:{form_key:A.jQuery("#tumblr_form_key").attr("content"),log:G},url:"/svc/log/capture/exceptions",with_form_key:true})}}(function B(){x(n,"beforeunload",l);n.onerror=k})();(F.Utils||(F.Utils={})).exceptions=C;function d(){j=true}x(n,"load",d)})(this,this.Tumblr||(this.Tumblr={}));