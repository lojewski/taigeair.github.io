window.Box=window.Box||{},Box.Timing=Box.Timing||{execution:[],scripts:{}},Box.Timing.scripts.lightbox_preview=(new Date).getTime(),Box.Timing.execution.push({name:"js/menus/box_lightbox_file_info_layer.js",time:(new Date).getTime()});var Lightbox_File_Info_Layer=Abstract_Menu.extend({show:function(e){e=e||{},this.item=e.item||null,this.$layer=$("#file_info_layer");var t=$("#preview_file_title");this.$layer.on("click",$.proxy(this.event_click,this)),this._e_menu=this.$layer[0],this._j_target_element=t,this.base(e);var n=$(this._j_target_element).position(),r,i;n&&(i=n.top+$(this._j_target_element).outerHeight(),r=n.left),$(this._e_menu).css({top:i,left:r})},hide:function(){this.$layer.off("click",$.proxy(this.event_click,this)),this.base()},event_click:function(e){var t=Box.Application.getService("dom"),n=t.getNearestTypeElement(e.target);if(!n)return;var r=n.getAttribute("data-type");switch(r){case"version-history-btn":this.item.version_history(),this.hide();break;case"parent-folder-btn":this.hide();var i=n.href;Box.Application.navigate(i),e.preventDefault()}}},{});Box.Timing.execution.push({name:"js/menus/box_lightbox_item_menu.js",time:(new Date).getTime()});var Lightbox_Item_Menu=Abstract_Menu_With_Submenus.extend({_prevent_rendering_offscreen:!1,MAX_RETRY:10,show:function(e){e=e||{};var t=Box.Application.getService("v5"),n=$("#lightbox_item_menu"),r=$("#unlock_file_btn").hide(),i=$("#lock_file_btn").hide(),s=$("#free_user_lock_btn").hide(),o=$("#request_unlock_btn").hide(),u=Box.Application.getService("nav-state");this.item=e.item;var a=this.item.lock;if(!u.isSharedFilePage()&&!u.isSharedFolderPage())if(a)a.can_unlock?r.show():this.item.permissions.view&&o.show();else if(this.item.is_manually_lockable()&&this.item.permissions.upload&&this.item.permissions.download)if(this.item.owner_is_free){var f=t.get("Canvas");f.user.is_free_user&&s.show()}else i.show();var l=n.find("[data-type=download-btn]").show();u.isEmbedWidget()&&this.item.permissions.download&&!this.item.is_boxnote()?l.removeClass("hidden"):l.addClass("hidden"),(this.item.is_quarantined||!u.isShowingFiles())&&n.find("[data-type=move-copy-btn]").hide(),(this.item.is_app_folder||!u.isShowingFiles()||!this.item.user_is_owner&&this.item.collaborated)&&n.find("[data-type=delete-btn]").hide(),n.off("click.menu").on("click.menu",$.proxy(this.event_click,this)),this._e_menu=n[0],this._j_target_element=$(e.target),this.base(e);var c=$(this._j_target_element).position(),h,p;c&&(p=c.top+$(this._j_target_element).outerHeight()-5,h=$(window).width()-c.left-$(this._j_target_element).outerWidth()-5),$(this._e_menu).css({top:p,right:h,left:"auto"}),Box.Application.getService("upload-process").disableUploadElementForAjaxEol($('[data-type="upload-new-version-btn"]')[0],!0)},hide:function(){$("#lightbox_item_menu").off("click"),this.base()},print_mouseover:function(e){var t=$(e.delegateTarget);t.attr("data-ready")||t.addClass("disabled ignore_mouseover pending")},event_click:function(e){var t=$j(e.target).closest("li")[0],n=t.getAttribute("data-type"),r=Box.Application.getService("v5popups"),i=Box.Application.getService("v5popups-postload"),s=Box.Application.getService("v5"),o=s.get("Upload_Process"),u=$(t).hasClass("disabled");if(!u){switch(n){case"print-btn":Box.Application.broadcast("previewprint");break;case"share-btn":Box.Application.broadcast("previewshare");break;case"comment-btn":Box.Application.broadcast("previewcomment");break;case"edit-btn":Box.Application.broadcast("previewedit");break;case"download-btn":Box.Application.broadcast("previewdownload");break;case"upload-new-version-btn":o.get_type()==="ajax"?Box.Application.getService("upload-process").showAjaxEolMessage():o.show_upload_new_version_popup({file:this.item,show_toaster:!0});break;case"lock-file-btn":this.item.lock_file({callback:function(){Box.Application.broadcast("previewlock")}});break;case"unlock-file-btn":this.item.unlock_file({callback:function(){Box.Application.broadcast("previewunlock")}});break;case"request-unlock-btn":i.showUnlockRequestPopup(this.item.lock);break;case"free-user-lock-btn":r.showUpgradePopup("file_lock");break;case"move-copy-btn":this.item.move({create_new_action_instance:!0});break;case"delete-btn":this.item.delete_me();break;case"file-properties-btn":this.item.edit_properties({after_close_callback:function(){Box.Application.getService("lightbox").focus()}});break;case"custom-details-btn":Box.Application.broadcast("previewcustomdetails")}this.hide()}e.preventDefault(),e.stopPropagation()}},{});Box.Timing.execution.push({name:"js/plugins/crocodoc.viewer.js",time:(new Date).getTime()});var Crocodoc=function(e){var t=function(){"use strict";function r(t,n,i){var s;i=i||t;for(s=0;s<n.length;++s){if(t===n[s])throw new Error("Circular dependency detected: "+i+"->"+n[s]);e[n[s]]&&r(t,e[n[s]].mixins,i+"->"+n[s])}}var e={},n={};return{ZOOM_FIT_WIDTH:"fitwidth",ZOOM_FIT_HEIGHT:"fitheight",ZOOM_AUTO:"auto",ZOOM_IN:"in",ZOOM_OUT:"out",SCROLL_PREVIOUS:"previous",SCROLL_NEXT:"next",LAYOUT_VERTICAL:"vertical",LAYOUT_VERTICAL_SINGLE_COLUMN:"vertical-single-column",LAYOUT_HORIZONTAL:"horizontal",LAYOUT_PRESENTATION:"presentation",LAYOUT_PRESENTATION_TWO_PAGE:"presentation-two-page",PAGE_STATUS_CONVERTING:"converting",PAGE_STATUS_NOT_LOADED:"not loaded",PAGE_STATUS_LOADING:"loading",PAGE_STATUS_LOADED:"loaded",PAGE_STATUS_ERROR:"error",components:e,utilities:n,createViewer:function(e,n){return new t.Viewer(e,n)},addComponent:function(t,n,i){n instanceof Function&&(i=n,n=[]),r(t,n),e[t]={mixins:n,creator:i}},createComponent:function(t,n){var r=e[t];if(r){var i=[];for(var s=0;s<r.mixins.length;++s)i.push(this.createComponent(r.mixins[s],n));return i.unshift(n),r.creator.apply(r.creator,i)}return null},addPlugin:function(e,t){this.addComponent("plugin-"+e,t)},addUtility:function(e,t){n[e]={creator:t,instance:null}},getUtility:function(e){var t=n[e];return t?(t.instance||(t.instance=t.creator(this)),t.instance):null}}}();return function(){"use strict";t.Scope=function(n){var r=t.getUtility("common"),i=[];this.createComponent=function(e){var n=t.createComponent(e,this);return n&&(n.componentName=e,i.push(n)),n},this.destroyComponent=function(e){var t,n;for(t=0,n=i.length;t<n;++t)if(e===i[t]){typeof e.destroy=="function"&&e.destroy(),i.splice(t,1);break}},this.destroy=function(){var e,t,n;for(e=0,t=i.length;e<t;++e)n=i[e],typeof n.destroy=="function"&&n.destroy();i=[]},this.broadcast=function(e,t){var n,s,o,u;for(n=0,s=i.length;n<s;++n){o=i[n];if(!o)continue;u=o.messages||[],r.inArray(e,u)!==-1&&typeof o.onmessage=="function"&&o.onmessage.call(o,e,t)}},this.getUtility=function(e){return t.getUtility(e)},this.getConfig=function(){return n}}}(),function(){"use strict";t.EventTarget=function(){this._handlers={}},t.EventTarget.prototype={constructor:t.EventTarget,on:function(e,t){typeof this._handlers[e]=="undefined"&&(this._handlers[e]=[]),this._handlers[e].push(t)},fire:function(e,t){var n,r,i,s={type:e,data:t};n=this._handlers[s.type];if(n instanceof Array){n=n.concat();for(r=0,i=n.length;r<i;r++)n[r]&&n[r].call(this,s)}n=this._handlers.all;if(n instanceof Array){n=n.concat();for(r=0,i=n.length;r<i;r++)n[r]&&n[r].call(this,s)}},off:function(e,t){var n=this._handlers[e],r,i;if(n instanceof Array){if(!t){n.length=0;return}for(r=0,i=n.length;r<i;r++)if(n[r]===t||n[r].handler===t){n.splice(r,1);break}}},one:function(e,t){var n=this,r=function(i){n.off(e,r),t.call(n,i)};r.handler=t,this.on(e,r)}}}(),function(){"use strict";var n="crocodoc-text-disabled",r="crocodoc-links-disabled",i=0;t.Viewer=function(s,o){function v(e,t){l?p.broadcast(e,t):c.push({name:e,data:t})}function m(){var e;while(c.length)e=c.shift(),p.broadcast(e.name,e.data)}function g(){l=!0,m()}t.EventTarget.call(this);var u=t.getUtility("common"),a,f=e(s),l=!1,c=[],h=u.extend(!0,{},t.Viewer.defaults,o),p=new t.Scope(h),d=p.createComponent("viewer-base");if(f.length===0)throw new Error("Invalid container element");h.id=++i,h.api=this,h.$el=f,d.init(),this.destroy=function(){p.broadcast("destroy"),p.destroy()},this.load=function(){if(!h.url){p.broadcast("fail",{error:"no URL given for assets"});return}/\/$/.test(h.url)||(h.url+="/"),d.loadAssets()},this.setLayout=function(e){a=d.setLayout(e)},this.zoom=function(e){var t=parseFloat(e);a&&(t&&(e=t/(h.pageScale||1)),a.setZoom(e))},this.scrollTo=function(e){a&&a.scrollTo(e)},this.scrollBy=function(e,t){a&&a.scrollBy(e,t)},this.focus=function(){a&&a.focus()},this.enableTextSelection=function(){h.enableTextSelection||(f.removeClass(n),h.enableTextSelection=!0,p.broadcast("textenabledchange",{enabled:!0}))},this.disableTextSelection=function(){h.enableTextSelection&&(f.addClass(n),h.enableTextSelection=!1,p.broadcast("textenabledchange",{enabled:!1}))},this.enableLinks=function(){h.enableLinks||(f.removeClass(r),h.enableLinks=!0)},this.disableLinks=function(){h.enableLinks&&(f.addClass(r),h.enableLinks=!1)},this.updateLayout=function(){a&&(a.updatePageStates(!0),a.setZoom())},this.setPageAvailable=function(e){v("pageavailable",{page:e})},this.setPagesAvailableUpTo=function(e){v("pageavailable",{upto:e})},this.setAllPagesAvailable=function(){l?p.broadcast("pageavailable",{upto:h.numPages}):h.conversionIsComplete=!0},this.one("ready",g)},t.Viewer.prototype=new t.EventTarget,t.Viewer.prototype.constructor=t.Viewer,t.Viewer.defaults={url:null,layout:t.LAYOUT_VERTICAL,zoom:t.ZOOM_AUTO,page:1,enableTextSelection:!0,enableLinks:!0,queryParams:null,plugins:{},enableDragging:!1,conversionIsComplete:!0,template:{svg:"page-{{page}}.svg",img:"page-{{page}}.png",html:"text-{{page}}.html",css:"stylesheet.css",json:"info.json"},pageStart:null,pageEnd:null,zoomLevels:[.25,.5,.75,1,1.25,1.5,2,3]}}(),t.addUtility("ajax",function(e){"use strict";function n(e){var t,n,r;try{t=e.status,n=e.statusText,r=e.responseText}catch(i){t=0,n="",r=null}return{status:t,statusText:n,responseText:r}}var t=e.getUtility("common");return{request:function(e,r){function o(){t.isFn(r.success)&&r.success.call(n(s))}function u(){t.isFn(r.fail)&&r.fail.call(n(s))}r=r||{};var i=r.method||"GET",s=new window.XMLHttpRequest;if(!t.isCrossDomain(e)||"withCredentials"in s)s.open(i,e,!0),s.onreadystatechange=function(){if(this.readyState===4){s.onreadystatechange=null;try{this.status===200?o():u()}catch(e){u()}}},s.send();else if("XDomainRequest"in window){s=new window.XDomainRequest;try{s.open(i,e),s.onload=o,s.onerror=u,s.ontimeout=u,s.onprogress=function(){},s.send()}catch(a){s={status:0,statusText:a.message},u()}}else s={status:0,statusText:"CORS not supported"},u();return s}}}),t.addUtility("browser",function(){"use strict";var e=navigator.userAgent,t={},n,r,i,s,o,u;return n=/iphone|ipod|ipad/i.test(e),r=/android/i.test(e),s=/webos/i.test(e),i=/blackberry/i.test(e),o=/blackberry/i.test(e),u=/MSIE/i.test(e),u&&(t.ie=!0,t.version=parseFloat(/MSIE\s+(\d+\.\d+)/i.exec(e)[1]),t.ielt9=t.version<9,t.ielt10=t.version<10),n&&(t.ios=!0),t.mobile=/mobile/i.test(e)||n||r||i||s||o,t.firefox=/firefox/i.test(e),/safari/i.test(e)&&(t.chrome=/chrome/i.test(e),t.safari=!t.chrome),t}),t.addUtility("common",function(){"use strict";var t={};return t.extend=e.extend,t.each=e.each,t.map=e.map,t.parseJSON=e.parseJSON,e.extend(t,{bisectLeft:function(e,t,n){var r,i,s=0,o=e.length;while(s<o)i=Math.floor((s+o)/2),r=n?e[i][n]:e[i],r<t?s=i+1:o=i;return s},bisectRight:function(e,t,n){var r,i,s=0,o=e.length;while(s<o)i=Math.floor((s+o)/2),r=n?e[i][n]:e[i],t<r?o=i:s=i+1;return s},clamp:function(e,t,n){return e<t?t:e>n?n:e},sign:function(e){var t=parseInt(e,10);return t?t<0?-1:1:t},isFn:function(e){return typeof e=="function"},inArray:function(n,r){return t.isFn(r.indexOf)?r.indexOf(n):e.inArray(n,r)},constrainRange:function(e,n,r){var i=n-e;return e=t.clamp(e,0,r),n=t.clamp(e+i,0,r),n-e<i&&(e=t.clamp(n-i,0,r)),{min:e,max:n}},makeAbsolute:function(e){var t=window.location,n=t.pathname;return/^http|^\/\//i.test(e)?e:(e.charAt(0)!=="/"&&(n.lastIndexOf("/")!==n.length-1&&(n=n.substring(0,n.lastIndexOf("/")+1)),e=n+e),t.protocol+"//"+t.host+e)},now:function(){return(new Date).getTime()},throttle:function(e,n){function a(){u=t.now(),s=null,o=n.apply(r,i)}var r,i,s,o,u=0;return function(){var l=t.now(),c=e-(l-u);return r=this,i=arguments,c<=0?(clearTimeout(s),s=null,u=l,o=n.apply(r,i)):s||(s=setTimeout(a,c)),o}},debounce:function(e,n){function a(){var f=t.now()-o;f<e?s=setTimeout(a,e-f):(s=null,u=n.apply(r,i),r=i=null)}var r,i,s,o,u;return function(){return r=this,i=arguments,o=t.now(),s||(s=setTimeout(a,e)),u}},insertCSS:function(e){var t=document.createElement("style"),n=document.createTextNode(e);try{t.setAttribute("type","text/css"),t.appendChild(n)}catch(r){}return document.getElementsByTagName("head")[0].appendChild(t),t},appendCSSRule:function(e,t,n){var r;return e.insertRule?e.insertRule(t+"{"+n+"}",e.cssRules.length):(r=e.addRule(t,n,e.rules.length),r<0&&(r=e.rules.length-1),r)},deleteCSSRule:function(e,t){e.deleteRule?e.deleteRule(t):e.removeRule(t)},getSelectedNode:function(){var e,t,n;return window.getSelection?(t=window.getSelection(),t.rangeCount&&(n=t.getRangeAt(0),n.collapsed||(e=t.anchorNode.parentNode))):document.selection&&(e=document.selection.createRange().parentElement()),e},getComputedStyle:function(e){return"getComputedStyle"in window?window.getComputedStyle(e):e.currentStyle},calculatePtSize:function(){var e,n,r=1e4,i=document.createElement("div");return i.style.display="block",i.style.position="absolute",i.style.width=r+"pt",document.body.appendChild(i),e=t.getComputedStyle(i).width,n=parseFloat(e)/r,document.body.removeChild(i),n},countInStr:function(e,t){var n=0,r;while(r=e.indexOf(t,r)+1)n++;return n},template:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e=e.replace(new RegExp("\\{\\{"+n+"\\}\\}","g"),t[n]));return e},isCrossDomain:function(e){function n(e){return e.replace(t,"").split("/")[0]}var t=/^(http(s)?|file)+:\/\//;return t.test(e)&&n(location.href)!==n(e)}})}),t.addUtility("subpx",function(t){"use strict";function s(){if(!e.support.leadingWhitespace)return!1;var t=e(i.template(r,{size:12.5})).appendTo(document.documentElement).get(0),n=e(t).css("font-size"),s=e(t).width();e(t).remove(),t=e(i.template(r,{size:12.6})).appendTo(document.documentElement).get(0);var o=e(t).css("font-size"),u=e(t).width();e(t).remove();if(!("ontouchstart"in window)){if(n===o)return!1;if(s===u)return!1}return!0}var n="crocodoc-subpx-fix",r='<span style="font:{{size}}px serif; color:transparent; white-space:nowrap;">'+(new Array(100)).join("A")+"</span>",i=t.getUtility("common"),o=s();return{fix:function(t){if(!o&&document.body.style.zoom!==undefined){var r=e("<div>").addClass(n);e(t).children().wrapAll(r)}return t},isSubpxSupported:function(){return o}}}),t.addUtility("support",function(){"use strict";function t(t){var r=document.createElement("div"),i,s,o;if(t in r.style)return t;i=t.charAt(0).toUpperCase()+t.substr(1);if(t in r.style)return t;for(s=0;s<e.length;++s){o=e[s]+i;if(o in r.style)return o.indexOf("ms")===0&&(o="-"+o),n(o)}return!1}function n(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}var e=["Moz","Webkit","O","ms"],r,i;return function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!r;++n)r=window[t[n]+"RequestAnimationFrame"],i=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];r||(r=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i}),i||(i=function(e){clearTimeout(e)})}(),{svg:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),csstransform:t("transform"),csstransition:t("transition"),csszoom:t("zoom"),requestAnimationFrame:function(){return r.apply(window,arguments)},cancelAnimationFrame:function(){i.apply(window,arguments)}}}),t.addComponent("dragger",function(t){"use strict";function o(e){n.scrollTop(i.top-(e.clientY-s.y)),n.scrollLeft(i.left-(e.clientX-s.x)),e.preventDefault()}function u(e){t.broadcast("dragend"),r.off("mousemove",o),r.off("mouseup",u),e.preventDefault()}function a(e){t.broadcast("dragstart"),i={top:n.scrollTop(),left:n.scrollLeft()},s={x:e.clientX,y:e.clientY},r.on("mousemove",o),r.on("mouseup",u),e.preventDefault()}var n,r=e(window),i,s;return{init:function(t){n=e(t),n.on("mousedown",a)},destroy:function(){n.off("mousedown",a),n.off("mousemove",o),r.off("mouseup",u)}}}),t.addComponent("layout-base",function(e){"use strict";function d(e,t){var n,r,i,s,u=e.state,a="."+e.config.namespace+" ."+o,f=e.config.stylesheet,l=u.pages,c=t*e.config.pageScale,d=100/c;p.csstransform?s=p.csstransform+":scale("+c+");"+"width:"+d+"%;"+"height:"+d+"%;":p.csszoom?s="zoom:"+c:s="",u.previousStyleIndex&&h.deleteCSSRule(f,u.previousStyleIndex),u.previousStyleIndex=h.appendCSSRule(f,a,s);for(n=0,r=l.length;n<r;++n)i=l[n],e.$pages.eq(n).css({width:i.actualWidth*t,height:i.actualHeight*t,paddingTop:i.paddingTop*t,paddingRight:i.paddingRight*t,paddingBottom:i.paddingBottom*t,paddingLeft:i.paddingLeft*t})}function v(e,t){if(!t||t.length===0)return Infinity;var n=h.map(t,function(t){return e[t].y1});return Math.max.apply(Math,n)}var n="crocodoc-layout-",r="crocodoc-current-page",i="crocodoc-page-",s=i+"visible",o=i+"overlay",u="padding-",a=u+"top",f=u+"right",l=u+"left",c=u+"bottom",h=e.getUtility("common"),p=e.getUtility("support");return{messages:["resize","scroll","scrollend"],onmessage:function(e,t){switch(e){case"resize":this.handleResize(t);break;case"scroll":this.handleScroll(t);break;case"scrollend":this.handleScrollEnd(t)}},init:function(){var t=e.getConfig();this.config=t,this.$el=t.$el,this.$doc=t.$doc,this.$viewport=t.$viewport,this.$pages=t.$pages,this.$pagesWrapper=t.$pagesWrapper,this.numPages=t.numPages,this.layoutClass=n+t.layout,this.$el.addClass(this.layoutClass),this.initState(),this.initZoomLevels(),this.updatePageStates()},initState:function(){var e=this.$viewport[0];this.state={pages:[],widestPage:{index:0,actualWidth:0},tallestPage:{index:0,actualHeight:0},sumWidths:0,sumHeights:0,rows:[],scrollTop:e.scrollTop,scrollLeft:e.scrollLeft,viewportDimensions:{clientWidth:e.clientWidth,clientHeight:e.clientHeight,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight},zoomState:{zoom:1,prevZoom:0,zoomMode:null},currentPage:null,visiblePages:[],fullyVisiblePages:[],initialWidth:0,initialHeight:0},this.zoomLevels=[]},destroy:function(){this.$pagesWrapper.add(this.$doc).removeAttr("style"),this.$pages.css("padding",""),this.$el.removeClass(this.layoutClass)},setZoom:function(n){var r=this.state,i=this.parseZoomValue(n),s=r.zoomState,o=s.zoom,u,a;u=this.calculateZoomMode(n,i),i=h.clamp(i,r.minZoom,r.maxZoom),e.broadcast("beforezoom",h.extend({page:r.currentPage,visiblePages:h.extend([],r.visiblePages),fullyVisiblePages:h.extend([],r.fullyVisiblePages)},s)),s.prevZoom=o,s.zoom=i,s.zoomMode=u,this.applyZoom(i),s.canZoomIn=this.calculateNextZoomLevel(t.ZOOM_IN)!==!1,s.canZoomOut=this.calculateNextZoomLevel(t.ZOOM_OUT)!==!1,this.updatePageStates(),this.updateLayout(),a=n===t.ZOOM_AUTO||n===t.ZOOM_FIT_WIDTH||n===t.ZOOM_FIT_HEIGHT,this.updateScrollPosition(a),this.updatePageStates(),this.updateVisiblePages(!0),e.broadcast("zoom",h.extend({page:r.currentPage,visiblePages:h.extend([],r.visiblePages),fullyVisiblePages:h.extend([],r.fullyVisiblePages),isDraggable:this.isDraggable()},s))},isDraggable:function(){var e=this.state;return e.viewportDimensions.clientHeight<e.totalHeight||e.viewportDimensions.clientWidth<e.totalWidth},parseZoomValue:function(e){var n=parseFloat(e),r=this.state,i=r.zoomState,s=i.zoom,o=s;if(n)o=n;else switch(e){case t.ZOOM_FIT_WIDTH:case t.ZOOM_FIT_HEIGHT:case t.ZOOM_AUTO:o=this.calculateZoomValue(e);break;case t.ZOOM_IN:case t.ZOOM_OUT:o=this.calculateNextZoomLevel(e)||s;break;default:s?i.zoomMode?o=this.calculateZoomValue(i.zoomMode):o=s:o=this.calculateZoomValue(this.config.zoom||t.ZOOM_AUTO)}return o},calculateZoomMode:function(e,n){switch(n){case this.calculateZoomValue(t.ZOOM_AUTO):if(typeof e=="string"&&(e===t.ZOOM_FIT_WIDTH||e===t.ZOOM_FIT_HEIGHT))return e;return t.ZOOM_AUTO;case this.calculateZoomValue(t.ZOOM_FIT_WIDTH):return t.ZOOM_FIT_WIDTH;case this.calculateZoomValue(t.ZOOM_FIT_HEIGHT):return t.ZOOM_FIT_HEIGHT;default:return null}},calculateNextZoomLevel:function(e){var n,r=!1,i=this.state.zoomState.zoom,s=this.zoomLevels.slice(),o=this.calculateZoomValue(t.ZOOM_AUTO),u=this.calculateZoomValue(t.ZOOM_FIT_WIDTH),a=this.calculateZoomValue(t.ZOOM_FIT_HEIGHT),f=[u,a];o!==u&&o!==a&&f.push(o),s=s.concat(f),s.sort(function(t,n){return t-n});if(e===t.ZOOM_IN){for(n=0;n<s.length;++n)if(s[n]>i){r=s[n];break}}else if(e===t.ZOOM_OUT)for(n=s.length-1;n>=0;--n)if(s[n]<i){r=s[n];break}return r},calculateZoomValue:function(e){var n=this.state,r=parseFloat(e);return r?r:e===t.ZOOM_FIT_WIDTH?n.viewportDimensions.clientWidth/n.widestPage.totalActualWidth:e===t.ZOOM_FIT_HEIGHT?n.viewportDimensions.clientHeight/n.tallestPage.totalActualHeight:e===t.ZOOM_AUTO?this.calculateZoomAutoValue():n.zoomState.zoom},applyZoom:function(e){d(this,e)},scrollTo:function(e){var n=this.state,r=parseInt(e,10);if(typeof e=="string"){if(e===t.SCROLL_PREVIOUS&&n.currentPage>1)r=this.calculatePreviousPage();else if(e===t.SCROLL_NEXT&&n.currentPage<this.numPages)r=this.calculateNextPage();else if(!r)return}else if(!r&&r!==0)return;r=h.clamp(r,1,this.numPages),this.scrollToPage(r)},scrollBy:function(e,t){e=parseInt(e,10)||0,t=parseInt(t,10)||0,this.scrollToOffset(e+this.state.scrollLeft,t+this.state.scrollTop)},scrollToPage:function(e){var t=this.calculateScrollPositionForPage(e);this.scrollToOffset(t.left,t.top)},calculateCurrentPage:function(){return this.state.currentPage},calculateScrollPositionForPage:function(e){var t=h.clamp(e-1,0,this.numPages-1),n=this.state.pages[t];return{top:n.y0,left:n.x0}},calculateVisibleRange:function(){var e=this.state,t=e.scrollTop,n=t+e.viewportDimensions.clientHeight,r=e.scrollLeft,i=r+e.viewportDimensions.clientWidth,s=h.bisectLeft(e.pages,t,"y1"),o=h.bisectRight(e.pages,n,"y0")-1,u=h.bisectLeft(e.pages,r,"x1"),a=h.bisectRight(e.pages,i,"x0")-1,f=Math.max(u,s),l=Math.min(a,o);return h.constrainRange(f,l,this.numPages-1)},calculateFullyVisibleRange:function(){var e=this.state,t=e.scrollTop,n=t+e.viewportDimensions.clientHeight,r=e.scrollLeft,i=r+e.viewportDimensions.clientWidth,s=h.bisectLeft(e.pages,t,"y0"),o=h.bisectRight(e.pages,n,"y1")-1,u=h.bisectLeft(e.pages,r,"x0"),a=h.bisectRight(e.pages,i,"x1")-1,f=Math.max(u,s),l=Math.min(a,o);return h.constrainRange(f,l,this.numPages-1)},scrollToOffset:function(e,t){this.$viewport.scrollLeft(e),this.$viewport.scrollTop(t)},setCurrentPage:function(t){var n=this.state;n.currentPage!==t?(n.currentPage=t,this.updateVisiblePages(),e.broadcast("pagefocus",{page:n.currentPage,numPages:this.numPages,visiblePages:h.extend([],n.visiblePages),fullyVisiblePages:h.extend([],n.fullyVisiblePages)})):this.updateVisiblePages()},updateVisiblePages:function(e){var t,n,r,i=this.state,o=this.calculateVisibleRange(),u=this.calculateFullyVisibleRange();i.visiblePages.length=0,i.fullyVisiblePages.length=0;for(t=0,n=this.$pages.length;t<n;++t)r=this.$pages.eq(t),t<o.min||t>o.max?e&&r.hasClass(s)&&r.removeClass(s):(e&&!r.hasClass(s)&&r.addClass(s),i.visiblePages.push(t+1)),t>=u.min&&t<=u.max&&i.fullyVisiblePages.push(t+1)},updatePageStates:function(e){var t=this.state,n=t.pages,r=t.rows,i=this.$viewport.scrollTop(),s=this.$viewport.scrollLeft(),o=0,u=0,h=0,p=0,d,m,g,y,b;r.length=t.sumWidths=t.sumHeights=t.totalWidth=t.totalHeight=0,t.widestPage.totalActualWidth=t.tallestPage.totalActualHeight=0;for(d=0,m=this.$pages.length;d<m;++d){b=this.$pages.eq(d),y=b[0],g=n[d];if(!g||e)b.css("padding",""),g={index:d,paddingLeft:parseFloat(b.css(l)),paddingRight:parseFloat(b.css(f)),paddingTop:parseFloat(b.css(a)),paddingBottom:parseFloat(b.css(c))};g.actualWidth||(g.actualWidth=parseFloat(y.getAttribute("data-width"))),g.actualHeight||(g.actualHeight=parseFloat(y.getAttribute("data-height"))),g.totalActualWidth=g.actualWidth+g.paddingLeft+g.paddingRight,g.totalActualHeight=g.actualHeight+g.paddingTop+g.paddingBottom,g.width=y.offsetWidth,g.height=y.offsetHeight,g.x0=y.offsetLeft,g.y0=y.offsetTop,g.x1=g.width+g.x0,g.y1=g.height+g.y0,u&&v(n,r[o])<=g.y0+2&&o++,u=g.y1,r[o]||(r[o]=[]),g.totalActualWidth>t.widestPage.totalActualWidth&&(t.widestPage=g),g.totalActualHeight>t.tallestPage.totalActualHeight&&(t.tallestPage=g),t.sumWidths+=g.width,t.sumHeights+=g.height,g.rowIndex=o,n[d]=g,r[o].push(d),n[h].x0+n[h].width<g.x0+g.width&&(h=d),n[p].y0+n[p].height<g.y0+g.height&&(p=d)}t.totalWidth=n[h].x0+n[h].width,t.totalHeight=n[p].y0+n[p].height,t.scrollTop=i,t.scrollLeft=s,this.setCurrentPage(this.calculateCurrentPage())},initZoomLevels:function(){this.zoomLevels=this.config.zoomLevels||[1],this.state.minZoom=this.config.minZoom||this.zoomLevels[0],this.state.maxZoom=this.config.maxZoom||this.zoomLevels[this.zoomLevels.length-1]},updateCurrentPage:function(){var e=this.calculateCurrentPage();this.setCurrentPage(e)},handleResize:function(e){var t=this.state.zoomState.zoomMode;this.state.viewportDimensions=e,this.setZoom(t)},handleScroll:function(e){this.state.scrollTop=e.scrollTop,this.state.scrollLeft=e.scrollLeft},handleScrollEnd:function(e){this.$pagesWrapper.find("."+r).removeClass(r),this.$pages.eq(this.state.currentPage-1).addClass(r),this.updateVisiblePages(!0),this.handleScroll(e)},updateScrollPosition:function(e){var t=this.state,n=t.zoomState,r=n.zoom/n.prevZoom,i,s;i=t.scrollLeft*r,s=t.scrollTop*r,e!==!0&&(s+=t.viewportDimensions.offsetHeight*(r-1)/2,i+=t.viewportDimensions.offsetWidth*(r-1)/2),this.scrollToOffset(i,s)},focus:function(){this.$viewport.focus()},updateLayout:function(){},calculateZoomAutoValue:function(){return 1},calculateNextPage:function(){return 1},calculatePreviousPage:function(){return 1}}}),t.addComponent("layout-"+t.LAYOUT_HORIZONTAL,["layout-base"],function(e,n){"use strict";var r=e.getUtility("common"),i=e.getUtility("browser");return r.extend({},n,{calculateZoomAutoValue:function(){var e=this.state,n=this.calculateZoomValue(t.ZOOM_FIT_WIDTH),r=this.calculateZoomValue(t.ZOOM_FIT_HEIGHT);return e.widestPage.actualWidth>e.tallestPage.actualHeight?Math.min(n,r):i.mobile?r:Math.min(1,r)},calculateCurrentPage:function(){var e,t,n=this.state,i=n.pages;return e=r.bisectRight(i,n.scrollLeft,"x0")-1,t=r.bisectRight(i,n.scrollLeft+i[e].width/2,"x0")-1,1+t},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},handleResize:function(e){n.handleResize.call(this,e),this.updateCurrentPage()},handleScroll:function(e){n.handleScroll.call(this,e),this.updateCurrentPage()},updateLayout:function(){var e=this.state,t=e.zoomState,n=t.zoom,r=e.sumWidths,i=Math.floor(e.tallestPage.totalActualHeight*n),s=Math.max(r,e.viewportDimensions.clientWidth),o=Math.max(i,e.viewportDimensions.clientHeight);this.$pagesWrapper.css({height:o,lineHeight:o+"px",width:s}),this.$doc.css({height:o,width:s})}})}),t.addComponent("layout-"+t.LAYOUT_PRESENTATION_TWO_PAGE,["layout-"+t.LAYOUT_PRESENTATION],function(e,n){"use strict";var r=e.getUtility("common");return r.extend({},n,{init:function(){var r=e.getConfig();r.layout=t.LAYOUT_PRESENTATION_TWO_PAGE,this.twoPageMode=!0,n.init.call(this)},calculateNextPage:function(){return this.state.currentPage+2},calculatePreviousPage:function(){return this.state.currentPage-2},calculateZoomValue:function(e){var r=n.calculateZoomValue.call(this,e);return e===t.ZOOM_FIT_WIDTH&&(r/=2),r},scrollToPage:function(e){n.scrollToPage.call(this,e-(e+1)%2)},calculateVisibleRange:function(){var e=this.state.currentPage-1,t=e+1;return r.constrainRange(e,t,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()}})}),t.addComponent("layout-"+t.LAYOUT_PRESENTATION,["layout-base"],function(e,n){"use strict";var r="crocodoc-page-",i=r+"prev",s=r+"next",o=r+"before",u=r+"after",a=r+"before-buffer",f=r+"after-buffer",l="crocodoc-current-page",c=[s,u,i,o,a,f].join(" "),h=e.getUtility("common");return h.extend({},n,{init:function(){n.init.call(this),this.updatePageMargins(),this.updatePageClasses()},destroy:function(){n.destroy.call(this),this.$pages.css({margin:"",left:""}).removeClass(c)},calculateZoomAutoValue:function(){var e=this.calculateZoomValue(t.ZOOM_FIT_WIDTH),n=this.calculateZoomValue(t.ZOOM_FIT_HEIGHT);return Math.min(e,n)},calculateCurrentPage:function(){return this.state.currentPage},calculateNextPage:function(){return this.state.currentPage+1},calculatePreviousPage:function(){return this.state.currentPage-1},calculateVisibleRange:function(){var e=this.state.currentPage-1;return h.constrainRange(e,e,this.numPages)},calculateFullyVisibleRange:function(){return this.calculateVisibleRange()},setCurrentPage:function(e){var t=h.clamp(e-1,0,this.numPages);n.setCurrentPage.call(this,e),this.$pagesWrapper.find("."+l).removeClass(l),this.$pages.eq(this.state.currentPage-1).addClass(l),this.updateVisiblePages(!0),this.updatePageClasses(t)},scrollToPage:function(e){this.setCurrentPage(e)},updateLayout:function(){var e=this.state,t=e.zoomState,n=t.zoom,r=this.currentPage||1,i=e.pages[r-1],s=this.twoPageMode?e.pages[r]:i,o=e.viewportDimensions.clientWidth,u=e.viewportDimensions.clientHeight,a,f,l,c,h,p,d;a=s.actualWidth,f=i.actualWidth+(this.twoPageMode?a:0),l=i.actualHeight,c=Math.floor((f+i.paddingLeft+s.paddingRight)*n),h=Math.floor(i.totalActualHeight*n),p=Math.max(c,o),d=Math.max(h,u),this.$pagesWrapper.add(this.$doc).css({width:p,height:d}),this.updatePageMargins(),p>o||d>u?this.$el.addClass("crocodoc-scrollable"):this.$el.removeClass("crocodoc-scrollable")},updatePageMargins:function(){var e,t,n,r,i,s,o,u,a,f=this.state,l=f.viewportDimensions.clientWidth,c=f.viewportDimensions.clientHeight;for(e=0,t=this.$pages.length;e<t;++e)r=this.$pages.eq(e),n=f.pages[e],this.twoPageMode?a=e%2===1?n.paddingRight:n.paddingLeft:a=n.paddingRight+n.paddingLeft,i=(n.actualWidth+a)*f.zoomState.zoom,s=(n.actualHeight+n.paddingTop+n.paddingBottom)*f.zoomState.zoom,this.twoPageMode?(o=Math.max(0,(l-i*2)/2),e%2===1&&(o+=i)):o=(l-i)/2,u=(c-s)/2,o=Math.max(o,0),u=Math.max(u,0),r.css({marginLeft:o,marginTop:u})},updatePageClasses:function(){var e=this.$pages,t=this.state.currentPage-1,n=t+1,r=t-1,l=20;e.removeClass(c),this.twoPageMode?(n=t+2,r=t-2,e.slice(Math.max(r,0),t).addClass(i),e.slice(n,n+2).addClass(s)):(r>=0&&e.eq(r).addClass(i),n<this.numPages&&e.eq(n).addClass(s)),e.slice(0,t).addClass(o),e.slice(Math.max(0,t-l),t).addClass(a),e.slice(n).addClass(u),e.slice(n,Math.min(this.numPages,n+l)).addClass(f)}})}),t.addComponent("layout-"+t.LAYOUT_VERTICAL_SINGLE_COLUMN,["layout-"+t.LAYOUT_VERTICAL],function(e,n){"use strict";var r=e.getUtility("common");return r.extend({},n,{init:function(){var r=e.getConfig();r.layout=t.LAYOUT_VERTICAL_SINGLE_COLUMN,n.init.call(this)}})}),t.addComponent("layout-"+t.LAYOUT_VERTICAL,["layout-base"],function(e,n){"use strict";var r=e.getUtility("common"),i=e.getUtility("browser");return r.extend({},n,{calculateZoomAutoValue:function(){var e=this.state,n=this.calculateZoomValue(t.ZOOM_FIT_WIDTH),r=this.calculateZoomValue(t.ZOOM_FIT_HEIGHT);return e.widestPage.actualWidth>e.tallestPage.actualHeight?Math.min(1,n,r):i.mobile?n:Math.min(1,n)},calculateCurrentPage:function(){var e,t,n,i,s,o=this.state,u=o.pages;return e=r.bisectRight(u,o.scrollTop,"y0")-1,e<0?1:(s=o.scrollTop+u[e].height/2,t=r.bisectRight(u,s,"y0")-1,n=u[t].rowIndex,i=o.rows[n],1+i[0])},calculateNextPage:function(){var e=this.state,t=e.pages[e.currentPage-1],n=t.rowIndex,r=e.rows[n+1];return r&&r[0]+1||e.currentPage},calculatePreviousPage:function(){var e=this.state,t=e.pages[e.currentPage-1],n=t.rowIndex,r=e.rows[n-1];return r&&r[0]+1||e.currentPage},handleResize:function(e){n.handleResize.call(this,e),this.updateCurrentPage()},handleScroll:function(e){n.handleScroll.call(this,e),this.updateCurrentPage()},updateLayout:function(){var e=this.state,t=e.zoomState.zoom,n,r,i,s,o;n=Math.floor(e.widestPage.totalActualWidth*t),s=Math.max(n,e.viewportDimensions.clientWidth),o=this.$pagesWrapper.height(),this.$pagesWrapper.css({height:"auto",width:s}),o=this.$pagesWrapper.height(),n<=e.viewportDimensions.clientWidth?r="auto":r=n,i=o,this.$doc.css({height:i,width:r})}})}),t.addComponent("lazy-loader",function(t){"use strict";function g(e){e=e||l;var t=p.page-1,r=t-e,i=t+e;return n.constrainRange(r,i,o-1)}function y(){var e;clearTimeout(a),f.length>0?(e=f.shift(),s[e]&&s[e].errorCount<=d?i.loadPage(e,function(t){t===!1?y():a=setTimeout(y,v)}):y()):w()}function b(){clearTimeout(a),c=!1,a=setTimeout(y,v)}function w(){clearTimeout(a),c=!0}function E(e){f.push(e),c&&b()}function S(){f.length=0,w()}function x(e,t){var n=g(t);return e>=n.min&&e<=n.max?!0:!1}function T(e){var t=s[e];if(
t){if(x(e))return!0;if(C(e))return!0}return!1}function N(e,t){return x(e,t)?!1:C(e)?!1:!0}function C(e){return n.inArray(e+1,p.visiblePages)>-1}function k(e,t){var r=n.sign(t-e);while(e!==t)i.queuePageToLoad(e),e+=r;i.queuePageToLoad(e)}var n=t.getUtility("common"),r=t.getUtility("browser"),i={},s,o,u,a,f=[],l=1,c=!0,h=1,p={page:1,visiblePages:[1]},d=1,v=r.mobile||r.ielt10?100:50,m=r.mobile||r.ielt10?8:32;return n.extend(i,{messages:["beforezoom","pageavailable","pagefocus","scroll","scrollend","zoom"],onmessage:function(e,t){switch(e){case"beforezoom":this.handleBeforeZoom(t);break;case"pageavailable":this.handlePageAvailable(t);break;case"pagefocus":this.handlePageFocus(t);break;case"scroll":this.handleScroll(t);break;case"scrollend":this.handleScrollEnd(t);break;case"zoom":this.handleZoom(t)}},init:function(e){s=e,o=s.length,l=Math.min(m,o)},destroy:function(){this.cancelAllLoading()},updateLayoutState:function(e){h=n.sign(e.page-p.page),p=e},loadNecessaryPages:n.debounce(100,function(){this.cancelAllLoading(),this.queuePageToLoad(p.page-1),this.loadVisiblePages(),this.loadPagesInRange(l)}),loadPagesInRange:function(e){var t=p.page-1;e>0&&(e=g(e),h>=0?(k(t+1,e.max),k(t-1,e.min)):(k(t-1,e.min),k(t+1,e.max)))},loadVisiblePages:function(){var e,t;for(e=0,t=p.visiblePages.length;e<t;++e)this.queuePageToLoad(p.visiblePages[e]-1)},queuePageToLoad:function(e){T(e)&&(s[e].preload(),E(e))},cancelAllLoading:function(){clearTimeout(u),S()},loadPage:function(t,n){e.when(s[t]&&s[t].load()).fail(function(n){s[t].errorCount=s[t].errorCount||0,s[t].errorCount<d?f.unshift(t):s[t].fail(n),s[t].errorCount++}).always(n)},unloadPage:function(e){var t=s[e];t&&t.unload()},unloadUnnecessaryPages:function(e){var t,n;for(t=0,n=s.length;t<n;++t)N(t,e)&&this.unloadPage(t)},handlePageAvailable:function(e){var t;if(e.page)this.queuePageToLoad(e.page-1);else if(e.upto)for(t=0;t<e.upto;++t)this.queuePageToLoad(t)},handlePageFocus:function(e){this.updateLayoutState(e),this.cancelAllLoading(),u=setTimeout(function(){i.loadNecessaryPages()},200)},handleBeforeZoom:function(e){this.cancelAllLoading(),this.unloadUnnecessaryPages(e.visiblePages.length*2)},handleZoom:function(e){this.updateLayoutState(e),this.loadNecessaryPages()},handleScroll:function(){this.cancelAllLoading()},handleScrollEnd:function(){this.loadNecessaryPages(),this.unloadUnnecessaryPages(l)}})}),t.addComponent("page-img",function(t){"use strict";var n=t.getUtility("browser"),r,i,s,o=!1,u=n.mobile;return{init:function(t,n){i=e(t),s=n.imgSrc+(n.queryString||"")},destroy:function(){i.empty()},preload:function(){},load:function(){var t=e.Deferred();if(!r){var n=new window.Image;o=!0,n.onload=function(){o=!1,t.resolve()},n.onerror=function(){r=null,t.reject({error:"failed to load image"})},n.src=s,r=e(n),i.html(r)}else o||t.resolve();return r.show(),t},unload:function(){o=!1,u?(r.remove(),r=null):r&&r.hide()}}}),t.addComponent("page-links",function(t){"use strict";function i(t){var i=e("<a>").addClass(n),s=t.bbox[0],o=t.bbox[1],u={};i.css({left:s+"pt",top:o+"pt",width:t.bbox[2]-s+"pt",height:t.bbox[3]-o+"pt"});if(t.uri){if(!/^http|^mailto/.test(t.uri))return;u.href=encodeURI(t.uri),u.target="_blank"}else t.destination&&(u.href="#page-"+t.destination.pagenum);i.attr(u),i.data("link",t),i.appendTo(r)}function s(n){var r=e(n.target),i=r.data("link");i&&t.broadcast("linkclicked",i),n.preventDefault()}var n="crocodoc-page-link",r;return{init:function(t,i){r=e(t),this.createLinks(i),r.on("click","."+n,s)},destroy:function(){r.empty().off("click")},createLinks:function(e){var t,n;for(t=0,n=e.length;t<n;++t)i(e[t])}}}),t.addComponent("page-svg",function(t){"use strict";function H(){switch(P){case u:case p:return e("<iframe>");case h:case a:return e("<object>").attr({type:r,data:"data:"+r+";base64,"+window.btoa(o)});case f:return e('<div style="width:100%; height:100%;">');case l:return e("<object>");case c:case d:return e("<img>")}}function B(){if(!w||w.length===0)M=!1,w=H();w.parent().length===0&&w.appendTo(E)}function j(e){var t=C.replace("&","&#38;"),r,i;return r=v.countInStr(e,'xlink:href="data:image'),r>n&&(e=e.replace(/<image[\s\w-_="]*xlink:href="data:image\/[^"]{0,5120}"[^>]*>/ig,"")),e=e.replace(/href="([^"#:]*)"/g,function(e,n){return'href="'+N+n+t+'"'}),i="<style>"+_.cssText+"</style>",g.firefox&&!y.isSubpxSupported()&&(i+="<style>text { text-rendering: geometricPrecision; }</style>"),e=e.replace(/<xhtml:link[^>]*>/,i),e}function F(){if(S)return S;var t=k+C,n=e.Deferred();if(!w){n.reject({error:"Error creating SVG element",status:200,resource:t});return}return x=m.request(t,{success:function(){if(A)return;var e=this.responseText;if(!e){n.reject({error:"Response was empty",status:200,resource:t});return}e=j(e),L=e,n.resolve()},fail:function(){if(A)return;L=null,n.reject({error:this.statusText,status:this.status,resource:t})}}),S=n.promise(),S}function I(){var e,t,n,o,m,y=w[0].contentDocument,E=w[0].contentWindow||y&&y.defaultView;switch(P){case u:g.ie&&g.version<10&&(L=L.replace(/<xhtml:link.*/,"")),o=i+L,y.open(),y.write(o),y.close(),n=y.getElementsByTagName("svg")[0];break;case p:o=i+v.template(s,{encodedScript:window.btoa("("+q+")()")}),y.open(),y.write(o),y.close(),y.readyState==="complete"?(E.loadSVG(L),D||(L=null)):E.onload=function(){this.loadSVG(L),D||(L=null)};return;case a:e=new b,t=e.parseFromString(L,r),n=y.importNode(t.documentElement,!0),y.documentElement.appendChild(n);break;case h:E.loadSVG(L),n=y.querySelector("svg");break;case f:e=new b,t=e.parseFromString(L,r),n=document.importNode(t.documentElement,!0),w.append(n);break;case l:w.attr({type:r,data:k+C}),n=w[0];break;case c:n=w[0],n.src=k+C;break;case d:n=w[0],m="data:"+r,!g.ie&&window.btoa?n.src=m+";base64,"+window.btoa(L):n.src=m+","+encodeURIComponent(L)}D||(L=null),n.setAttribute("width","100%"),n.setAttribute("height","100%")}function q(){window.loadSVG=function(e){var t=new window.DOMParser,n=t.parseFromString(e,"image/svg+xml"),r=document.importNode(n.documentElement,!0);r.setAttribute("width","100%"),r.setAttribute("height","100%"),document.body?document.body.appendChild(r):document.documentElement.appendChild(r)}}function R(e){e?(t.broadcast("asseterror",e),M=!1,S=null):(w.parent().length===0&&w.appendTo(E),w.show(),M=!0)}var n=1e3,r="image/svg+xml",i="<style>html, body { width:100%; height: 100%; margin: 0; overflow: hidden; }</style>",s='<script type="text/javascript" src="data:text/javascript;base64,{{encodedScript}}"></script>',o='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"><script><![CDATA[('+q+")()]]></script></svg>",u=1,a=2,f=3,l=4,c=5,h=6,p=7,d=8,v=t.getUtility("common"),m=t.getUtility("ajax"),g=t.getUtility("browser"),y=t.getUtility("subpx"),b=window.DOMParser,w,E,S,x,T,N,C,k,L,A=!1,O=!1,M=!1,_=t.getConfig(),D=g.mobile||g.ielt10,P=g.ie?d:g.firefox?d:g.safari?p:u;return{init:function(e,t){E=e,T=t,N=T.url,k=T.svgSrc,C=T.queryString||"",P=_.embedStrategy||P},destroy:function(){A=!0,this.unload(),E.empty()},preload:function(){B(),F()},load:function(){O=!1;var t=e.Deferred();return M?(R(),t.resolve()):(B(),P===l||P===c?(I(),R(),t.resolve()):F().then(function(){if(A||O)return;I(),R(),t.resolve()}).fail(function(n){R(n),t.reject(n)}).always(function(){x=null})),t},unload:function(){O=!0,x&&x.abort&&(x.abort(),x=null,S=null),D?(w&&(w.remove(),w=null),M=!1):M&&w.hide()}}}),t.addComponent("page-text",function(t){"use strict";function v(){return d.enableTextSelection&&!i.ielt9}function m(e){var t,i;if(!e||f)return;f=!0;var o=u.countInStr(e,"<div");if(o>r)return;e=e.replace(/<link rel="stylesheet".*/,""),t=document.implementation.createHTMLDocument(""),t.getElementsByTagName("body")[0].innerHTML=e,e=null,i=document.importNode(t.querySelector("."+n),!0),l.attr("class",i.getAttribute("class")),l.html(i.innerHTML),s.fix(l)}function g(e){t.broadcast("asseterror",e)}function y(){if(h)return h;var t=e.Deferred();return c=o.request(p,{success:function(){if(a)return;c=null,this.responseText.length===0&&g({error:"empty response",status:this.status,resource:p}),t.resolve(this.responseText)},fail:function(){if(a)return;c=null,g({error:this.statusText,status:this.status,resource:p}),t.resolve()}}),h=t.promise(),h}var n="crocodoc-page-text",r=256,i=t.getUtility("browser"),s=t.getUtility("subpx"),o=t.getUtility("ajax"),u=t.getUtility("common"),a=!1,f=!1,l,c,h,p,d=t.getConfig();return{init:function(e,t){l=e,p=t.textSrc+t.queryString},destroy:function(){a=!0,l.empty()},preload:function(){v()&&y()},load:function(){return v()?y().then(m):!1},unload:function(){c&&c.abort&&(c.abort(),c=null,h=null)},enable:function(){l.css("display","")},disable:function(){l.css("display","none")}}}),t.addComponent("page",function(n){"use strict";var r="crocodoc-page-",i=r+"inner",s=r+"loading",o=r+"error",u=r+"text",a=r+"svg",f=r+"links",l=n.getUtility("support"),c=n.getUtility("common"),h,p,d,v,m,g,y,b,w=!1;return{errorCount:0,messages:["pageavailable","textenabledchange","pagefocus","zoom"],onmessage:function(e,n){switch(e){case"pageavailable":(n.page===g+1||n.upto>g)&&b===t.PAGE_STATUS_CONVERTING&&(b=t.PAGE_STATUS_NOT_LOADED);break;case"textenabledchange":n.enabled===!0?this.enableTextSelection():this.disableTextSelection();break;case"pagefocus":case"zoom":y=m===n.page||c.inArray(m,n.visiblePages)>-1}},init:function(e,r){var s,o,c,y;h=e,c=h.find("."+i),o=c.find("."+a),s=c.find("."+u),y=c.find("."+f),r.url=r.url||"",p=n.createComponent("page-text"),d=l.svg?n.createComponent("page-svg"):n.createComponent("page-img"),p.init(s,r),d.init(o,r),r.enableLinks&&r.links.length&&(v=n.createComponent("page-links"),v.init(y,r.links)),b=r.status||t.PAGE_STATUS_NOT_LOADED,g=r.index,m=g+1,this.config=r},destroy:function(){this.unload()},preload:function(){b===t.PAGE_STATUS_NOT_LOADED&&(d.preload(),p.preload())},load:function(){var r=this,i;return w=!0,b===t.PAGE_STATUS_LOADED||b===t.PAGE_STATUS_LOADING?(i=p.load(),i&&i.state()!=="pending"?!1:i):b===t.PAGE_STATUS_CONVERTING?!1:(h.removeClass(o),b=t.PAGE_STATUS_LOADING,e.when(d.load(),p.load()).done(function(){w?(b=t.PAGE_STATUS_LOADED,h.removeClass(s),n.broadcast("pageload",{page:m})):r.unload()}).fail(function(){b=t.PAGE_STATUS_NOT_LOADED,h.removeClass(s)}))},fail:function(e){b=t.PAGE_STATUS_ERROR,h.addClass(o),n.broadcast("pagefail",{page:g+1,error:e})},unload:function(){w=!1,d.unload(),p.unload(),b===t.PAGE_STATUS_LOADED&&(b=t.PAGE_STATUS_NOT_LOADED,h.addClass(s),h.removeClass(o),n.broadcast("pageunload",{page:m}))},enableTextSelection:function(){p.enable(),y&&p.load()},disableTextSelection:function(){p.disable()}}}),t.addComponent("resizer",function(t){"use strict";function l(){t.broadcast("resize",{width:u,height:a,clientWidth:s,clientHeight:o,offsetWidth:u,offsetHeight:a})}function c(){n.cancelAnimationFrame(f),h(),f=n.requestAnimationFrame(c,i)}function h(){var e=i.offsetHeight,t=i.offsetWidth;e&&(e!==a||t!==u)&&(a=e,u=t,o=i.clientHeight,s=i.clientWidth,l())}var n=t.getUtility("support"),r=["webkit"," moz"," ms"," ",""].join("fullscreenchange"),i,s,o,u,a,f;return{init:function(t){i=e(t).get(0),e(document).on(r,l),c()},destroy:function(){e(document).off(r,l),n.cancelAnimationFrame(f)}}}),t.addComponent("scroller",function(t){"use strict";function m(){return{scrollTop:a.scrollTop(),scrollLeft:a.scrollLeft()}}function y(){l=!1,v=null,clearTimeout(f),t.broadcast("scrollend",m())}function b(){l||(l=!0,t.broadcast("scrollstart",m())),clearTimeout(f),f=setTimeout(y,u),g()}function w(){c=!0,h=!1,p=!1,b()}function E(){p=!0,b()}function S(){c=!1,h=!0,d=(new Date).getTime(),p&&x()}function x(){clearTimeout(f),v===null&&(v=(new Date).getTime());if((new Date).getTime()-v>i){y();return}g(),f=setTimeout(x,s)}var n=t.getUtility("common"),r=t.getUtility("browser"),i=3e3,s=30,o=200,u=r.mobile?500:250,a,f,l=!1,c=!1,h=!1,p=!1,d=0,v=null,g=n.throttle(o,function(){t.broadcast("scroll",m())});return{init:function(t){a=e(t),a.on("scroll",b),a.on("touchstart",w),a.on("touchmove",E),a.on("touchend",S)},destroy:function(){clearTimeout(f),a.off("scroll",b),a.off("touchstart",w),a.off("touchmove",E),a.off("touchend",S)}}}),t.addComponent("viewer-base",function(n){"use strict";function F(){O.attr(i,A.metadata.version||"0.0.0"),C.mobile&&O.addClass(h),C.ielt9&&O.addClass(p),k.svg&&O.addClass(d)}function I(){var e=A.metadata;A.numPages=e.numpages,A.pageStart?A.pageStart<0&&(A.pageStart=e.numpages+A.pageStart):A.pageStart=1,A.pageStart=T.clamp(A.pageStart,1,e.numpages),A.pageEnd?A.pageEnd<0&&(A.pageEnd=e.numpages+A.pageEnd):A.pageEnd=e.numpages,A.pageEnd=T.clamp(A.pageEnd,A.pageStart,e.numpages),A.numPages=A.pageEnd-A.pageStart+1}function q(){A.$viewport=e('<div tabindex="-1">').addClass(a),A.$doc=e("<div>").addClass(o),A.$pagesWrapper=e("<div>").addClass(u),A.$doc.append(A.$pagesWrapper),A.$viewport.append(A.$doc),O.html(A.$viewport)}function R(){var t,n,r,i,s,o,u,a,f=T.calculatePtSize(),l=A.metadata.dimensions,c="";A.pageScale=x/(l.width*f),r=A.zoomLevels[A.zoomLevels.length-1],i=3/A.pageScale;while(r<i)r+=r/2,A.zoomLevels.push(r);l.exceptions=l.exceptions||{};for(t=A.pageStart-1;t<A.pageEnd;t++)n=t+1,n in l.exceptions?(s=l.exceptions[n].width,o=l.exceptions[n].height):(s=l.width,o=l.height),u=s*f,a=o*f,u*=A.pageScale,a*=A.pageScale,c+=T.template(S,{w:u,h:a});A.$pages=e(c).appendTo(A.$pagesWrapper)}function U(){var e,t,r=A.plugins||{};for(e in r)t=n.createComponent("plugin-"+e),t&&T.isFn(t.init)&&t.init(A.plugins[e])}function z(){F(),R(),W(),V(),_=n.createComponent("lazy-loader"),_.init(A.pages),P=n.createComponent("scroller"),P.init(A.$viewport),H=n.createComponent("resizer"),H.init(A.$viewport),(!A.enableLinks||C.ielt9)&&L.disableLinks(),L.setLayout(A.layout),n.broadcast("ready",{page:A.page||1,numPages:A.numPages})}function W(){var e,r=[],i,s,o,u,a,f=A.pageStart-1,l=A.pageEnd,c=T.makeAbsolute(A.url),h=A.conversionIsComplete?t.PAGE_STATUS_NOT_LOADED:t.PAGE_STATUS_CONVERTING,p=X();for(e=f;e<l;e++)s=c+T.template(A.template.svg,{page:e+1}),u=c+T.template(A.template.html,{page:e+1}),o=c+T.template(A.template.img,{page:e+1}),a=c+A.template.css,i=n.createComponent("page"),i.init(A.$pages.eq(e-f),{index:e,url:c,imgSrc:o,svgSrc:s,textSrc:u,cssSrc:a,status:h,queryString:A.queryString,enableLinks:A.enableLinks,links:p[e],pageScale:A.pageScale}),r.push(i);A.pages=r}function X(){var e,t,n,r=A.metadata.links||[],i=[];for(e=0,t=A.metadata.numpages;e<t;++e)i[e]=[];for(e=0,t=r.length;e<t;++e)n=r[e],i[n.pagenum-1].push(n);return i}function V(){e(document).on("mouseup",K)}function J(e){e.uri?window.open(e.uri):e.destination&&L.scrollTo(e.destination.pagenum)}function K(){G()}function Q(t,r){function s(e){n.broadcast("asseterror",e),r?Q(t,!1).then(function(e){i.resolve(e)}).fail(function(e){i.reject(e)}):i.reject(e)}var i=e.Deferred();return N.request(t,{success:function(){if(j)return;if(!this.responseText){s({error:"empty response",status:this.status,resource:t});return}i.resolve(this.responseText)},fail:function(){if(j)return;s({error:this.statusText,status:this.status,resource:t})}}),i.promise()}function G(){var t=T.getSelectedNode(),n=e(t).closest("."+v);O.find("."+c).removeClass(c),t&&O.has(t)&&n.addClass(c)}function Y(e){e?B||(O.addClass(f),B=n.createComponent("dragger"),B.init(A.$viewport)):B&&(O.removeClass(f),n.destroyComponent(B),B=null)}function Z(){var t;A.queryParams&&(typeof A.queryParams=="string"?t=A.queryParams.replace(/^\?/,""):t=e.param(A.queryParams)),A.queryString=t?"?"+t:""}var r="crocodoc-",i="data-svg-version",s=r+"viewer",o=r+"doc",u=r+"pages",a=r+"viewport",f=r+"draggable",l=r+"dragging",c=r+"text-selected",h=r+"mobile",p=r+"ielt9",d=r+"supports-svg",v=r+"page",m=v+"-inner",g=v+"-svg",y=v+"-text",b=v+"-links",w=v+"-overlay",E=v+"-loading",S='<div class="'+v+" "+E+'" '+'style="width:{{w}}px; height:{{h}}px;" data-width="{{w}}" data-height="{{h}}">'+'<div class="'+m+'">'+'<div class="'+g+'"></div>'+'<div class="'+w+'">'+'<div class="'+y+'"></div>'+'<div class="'+b+'"></div>'+"</div>"+"</div>"+"</div>",x=1024,T=n.getUtility("common"),N=n.getUtility("ajax"),C=n.getUtility("browser"),k=n.getUtility("support"),L,A,O,M,_,D,P,H,B,j=!1;return{messages:["asseterror","destroy","dragend","dragstart","fail","linkclicked","pagefail","pagefocus","pageload","pageunload","ready","resize","scrollstart","scrollend","zoom"],onmessage:function(e,t){switch(e){case"linkclicked":J(t);break;case"zoom":t.zoom*=A.pageScale,t.prevZoom*=A.pageScale,A.enableDragging&&Y(t.isDraggable),L.fire(e,t);break;case"dragstart":O.hasClass(l)||O.addClass(l),L.fire(e,t);break;case"dragend":O.hasClass(l)&&O.removeClass(l),L.fire(e,t);break;default:L.fire(e,t)}},init:function(){A=n.getConfig(),L=A.api,A.namespace=s+"-"+A.id,O=A.$el,O.addClass(s),O.addClass(A.namespace),q(),U()},destroy:function(){e(document).off("mouseup",K),O.empty().removeClass(function(e,t){var n=t.match(new RegExp("crocodoc\\S+","g"));return n&&n.join(" ")}),e(M).remove(),j=!0},setLayout:function(e){var t=A.page,r=A.zoom||1,i;if(D){if(e===A.layout)return D;t=D.state.currentPage,r=D.state.zoomState}i=n.createComponent("layout-"+e);if(!i)throw new Error("Invalid layout "+e);return D&&n.destroyComponent(D),A.layout=e,D=i,D.init(),D.setZoom(r.zoomMode||r.zoom||r),D.scrollTo(t),A.currentLayout=D,D},loadAssets:function(){var t=T.makeAbsolute(A.url),r=t+A.template.css,i=t+A.template.json,s,o;Z(),r+=A.queryString,i+=A.queryString,o=Q(i,!0),o.then(function(n){A.metadata=e.parseJSON(n),I()}),C.ielt9?(M=T.insertCSS(""),A.stylesheet=M.styleSheet,s=e.when()):(s=Q(r,!0),s.then(function(t){A.cssText=t,M=T.insertCSS(t),A.stylesheet=M.sheet})),e.when(o,s).fail(function(e){n.broadcast("fail",e)}).then(z)}}}),t}(jQuery);Box.Timing.execution.push({name:"js/services/crocodoc-viewer.js",time:(new Date).getTime()}),Box.Application.addService("crocodoc-viewer",function(e){"use strict";var t=e.getService("v5"),n=t.get("Crocodoc");return{create:function(e,t){return n.createViewer(e,t)}}}),Box.Timing.execution.push({name:"js/services/scrollbar.js",time:(new Date).getTime()}),Box.Application.addService("scrollbar",function(e){"use strict";function t(e){this._$element=$(e)}return t.prototype={start:function(){this._resetHeight(),this._$element.perfectScrollbar(),this._$element.scrollTop(0)},reset:function(){this._resetHeight(),this._$element.perfectScrollbar("update"),this._$element.scrollTop(0)},update:function(){this._resetHeight(),this._$element.perfectScrollbar("update")},_resetHeight:function(){var e=0;try{e=this._$element.position().top}catch(t){}var n=$(window).height()-e;this._$element.height(n)}},{create:function(e){return new t(e)}}}),Box.Timing.execution.push({name:"js/services/preview-controls.js",time:(new Date).getTime()}),Box.Application.addService("preview-controls",function(e){"use strict";function O(){var e=r.find(".page_number_input");y.removeClass(r[0],"show_page_number_input"),e.off("blur").off("keydown")}function M(e){var n=y.getNearest(e,".preview_paging"),i=r.find(".current_page").text(),s=$(n).find(".page_number_input");y.addClass(r[0],"show_page_number_input"),s.val(i),s.focus().selectText(0,i.length);var o=function(e){if(s.is(":visible")){var n=e.target,r=parseInt(n.value,10);isNaN(r)||(t.fire("setpagenumber",r),t.fire("focuscontent"))}O()};s.off("blur").on("blur",o),s.off("keydown").on("keydown",function(e){e.which==13?o(e):e.which==27&&(O(),e.preventDefault(),e.stopPropagation())})}function _(){O();var e=r.find(".preview_page_selector_button");e.length&&(s=e,o=s.contents(),o.unwrap())}function D(){if(s){var e=o.parent();s.append(o),e.prepend(s),s=null,o=null}}function P(){var t=e.getService("tours");return t&&t.getCurrentTourName()==="preview-tour"}function H(){r.removeClass("timedout")}function B(){r.addClass("timedout").removeClass("show_page_number_input")}function j(){v&&window.clearInterval(v)}function F(){n&&window.clearTimeout(n)}function I(){if(U())return;H(),F(),n=window.setTimeout(function(){r.length&&!r.hasClass("hover")&&!r.hasClass("show_page_number_input")&&!P()&&B()},b)}function q(){if(U())return;l=(new Date).getTime(),c=h,p=d,v=window.setInterval(function(){var e=(new Date).getTime();e-l>w?r.length&&!r.hasClass("hover")&&(B(),l=e,c=h,p=d):Math.sqrt(Math.pow(h-c,2)+Math.pow(d-p,2))>S&&(H(),l=e,c=h,p=d)},E)}function R(e){h=e.data.pageX,d=e.data.pageY,f.isFullScreen()?r.length&&r.hasClass("hover")&&H():I()}function U(){var e=!1;return i==="audio"&&(e=!0),e&&(F(),j()),e}function z(e){var t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%3600%60);return(t>0?t.toString()+":":"")+(n<10?"0"+n.toString():n.toString())+":"+(r<10?"0"+r.toString():r.toString())}function W(){var e=$(".noUiSlider_video");e.noUiSlider({handles:1,range:[0,1],start:0,step:.01,connect:"upper",slide:function(){var e=$(this);e.val()>u&&e.val(u-u*.1),t.fire("seek",e.val())}}),e.append('<a class="loaded"></a>')}function X(e,n){if(n===a)return;e===x?n=0:e===T&&(n=a),n===0?y.addClass(r[0],k):(y.removeClass(r[0],k),a=n),$(".noUiSlider_volume").val(1-n),t.fire(N,n)}function V(){$(".noUiSlider_volume").noUiSlider({handles:1,range:[0,1],start:1-a,step:.1,connect:"upper",orientation:"vertical",slide:function(){var e=$(this);X(null,1-e.val())}})}function J(){q(),_()}function K(){j(),D()}function Q(){var e=window.self!==window.top;return(!e||f.isSupported())&&r.find(".fullscreen_button").length}function G(){m?y.addClass(r[0],A):y.removeClass(r[0],A)}function Y(e){var n=e.target,r=y.getNearest(n,"button");if(r){var i=r.getAttribute("data-event"),s=r.getAttribute("data-type");if(i===C)m=!m,G();else if(i===x||i===T)X(i,null);else if(i)t.fire(i),t.fire("focuscontent");else if(s)switch(s){case"show-page-num-input":M(r)}}return!1}var t={},n,r,i,s=null,o=null,u=0,a=.7,f,l,c,h,p,d,v,m=!1,g,y=e.getService("dom"),b=1e3,w=1e3,E=300,S=75,x="mute",T="unmute",N="volume",C="autoplay",k="is-muted",L="is-playing",A="is-auto-playing";return t=$.extend(t,new Box.EventTarget),$.extend(t,{init:function(){var t=e.getService("browser"),n=e.getService("lightbox");r=$(".preview-controls"),i=r.attr("data-preview-type"),f=e.getService("fullscreen"),r.off("click").on("click",$.proxy(Y,this)),r.show();if(i==="audio"||i==="video")g=y.query(".playback-rate-button",r[0]),W(),V(),g&&G();Q()||r.addClass("fullscreen-not-supported"),t.isTransformSupported()||r.find(".rotate_button").addClass("disabled").attr({"aria-label":$t("Your browser does not support rotation","preview_rotate_not_supported")}),U()||(n.on("lightboxactivity",R),t.isHtml5EnabledIE()||(r.off("mouseenter"),r.off("mouseleave"),r.hover(function(){r.addClass("hover")},function(){r.removeClass("hover")}))),f.on("enter",J),f.on("exit",K)},destroy:function(){f.off("enter",J),f.off("exit",K),r.off("mouseenter"),r.off("mouseleave"),r.hide()},updateScrubber:function(e,t){u=Math.max(.04,t),$(".noUiSlider_video .loaded").css("left",Math.floor(100*u)+"%"),$(".noUiSlider_video").val(e)},setDuration:function(e){$(".duration").text(z(e))},setTimecode:function(e){$(".timecode").text(z(e))},startPlaying:function(){r.addClass(L)},stopPlaying:function(){r.removeClass(L)},updateCurrentPage:function(e){r.find(".current_page").text(e)},updateTotalPages:function(e){e===1&&(_(),r.find(".preview_controls_previous,.preview_controls_next").addClass("disabled")),r.find(".total_pages").text(e)},updateSlideArrows:function(e,t){var n=r.find(".preview_controls_previous").removeClass("disabled"),i=r.find(".preview_controls_next").removeClass("disabled");e===1&&n.addClass("disabled"),e===t&&i.addClass("disabled")},isFullScreenAvailable:function(){return Q()},getCurrentVolume:function(){return 1-$(".noUiSlider_volume").val()},shouldPlayTheNextFile:function(){return m},setPlaybackRate:function(e){g&&(g.textContent="x "+e)}})}),Box.Timing.execution.push({name:"js/modules/preview/item-feed.js",time:(new Date).getTime()}),Box.Application.addModule("item-feed",function(e){"use strict";function c(e,t){var n=[];if(!e||!e.message||!e.message.length){var r=$t("Please enter comment.","comments_js_message_error_2");t==="task"&&(r=$t("Please enter a task description.","tasks_js_message_error_no_description")),n.push({errorText:r})}return n}function h(t){t.result?(n.setHTML(f[0],t.html),d(t.tasks),w(),E(),p()):(t.error&&$.throw_error(t.error),e.getService("popups").alert($t("There was an error saving this form. Please try again","create_item_feed_object_general_error")))}function p(){var n=e.getService("nav-state");if(!n.isSharedPageOrEmbedWidget()){var r=g(),i=t.get("Item");if(i){var s=i.find(r);s&&s.refresh()}}}function d(e){l=e}function v(e){var t=e.find(".task_due_date_input").val();if(t){var n=$.datepicker.parseDate("@",$.trim(t));return n=o.setTimeToEOD(n),o.formatDateToUnixTime(n)}return 0}function m(e){return $(n.getNearest(e,".item_feed_comment_container"))}function g(){return f.attr("data-item_typed_id")}function y(){return"d_"+f.attr("data-parent_id")}function b(e,t,n){var r={message:t,yesButtonDataType:n+"-yes-btn",noButtonDataType:n+"-no-btn"},i=$(s.getTemplateFragment("item_feed_generic_prompt_template",r)),o=e.innerHeight();i.css({height:o+"px"}),e.addClass("prompting"),e.append(i),i.show()}function w(){try{var e=f.position().top,t}catch(n){}e>0&&(t=$(window).height()-e,f.height()>=t?(f.height(t).css({position:"relative",overflow:"hidden"}),u=!0):(f.height(t),u=!1))}function E(){f.perfectScrollbar!==undefined&&u&&(f.perfectScrollbar("destroy"),f.perfectScrollbar())}function S(e){if(!e)return;var t=e.value,n=function(){w(),E()};"onpropertychange"in e?"oninput"in e?$(e).off("input.textarearesize keyup.textarearesize").on("input.textarearesize keyup.textarearesize",n):$(e).off("propertychange.textarearesize").on("propertychange.textarearesize",n):($(e).off("input.textarearesize").on("input.textarearesize",n),e.value="",e.value=t)}function x(e,t,n,r){r=r||{};var i=$(s.getTemplateHTML("item_feed_task_edit_template",{submitButtonDataType:t,submitButtonLabel:n,cancelButtonDataType:"cancel-edit-task-btn"}));r.taskId&&i.attr("data-task_id",r.taskId),e.append(i);var o=y();return T(i,o,r.description),N(i,o,r.assignees),C(i,r.dueDate),i}function T(e,t,n){n=n||"";var r=e.find(".task_entry_textarea");r.val(n).autosize(),S(r[0]),i.bind({inputElement:r,itemTypedID:t}),r.placeholderize({forceBlock:!0,extraMarginTopIE:"5"})}function N(e,n,r){r=r||[];var i=e.find(".task_assignees"),s=t.get("Box_Item_Contact_Selector");a=new s({width:"240px",z_index:3,j_component:i,item_typed_id:n,default_selections:r,no_results_label:$t("No matching collaborators in this folder","no_results_label_contact_selector_task_folder"),allow_empty_query:!1,allow_not_selectable_items:!0,allow_item_not_in_list:!1})}function C(e,t){t=t||0;var n=t?(new Date(parseInt(t,10)*1e3)).getTime():"",r=e.find(".task_due_date_input").val(n),i=e.find(".task_due_date_btn .preview_icon");t?i.removeClass("sprite_preview_20x20_calendar").addClass("sprite_preview_20x20_calendar_checked"):i.addClass("sprite_preview_20x20_calendar").removeClass("sprite_preview_20x20_calendar_checked");var s=$.DATEPICKER_DEFAULTS;r.datepicker($.extend({},s,{dateFormat:"@",minDate:new Date,onClose:function(e,t){e?i.addClass("sprite_preview_20x20_calendar_checked").removeClass("sprite_preview_20x20_calendar"):i.addClass("sprite_preview_20x20_calendar").removeClass("sprite_preview_20x20_calendar_checked")}}))}function k(e){var t=l[e],n=t.assignments,r={};for(var i=0,s=n.length;i<s;i++){var o=n[i];r[o.user_id]={name:o.name,email:o.email,feedback:o.feedback}}return t.assignmentsMap=r,t}function L(e,t){var n=k(e);if(n){var r=n.assignmentsMap[t];if(r)return r.feedback||""}return""}var t,n,r,i,s,o,u=!1,a=null,f,l;return{messages:["pageresizecomplete"],init:function(){f=$(e.getElement()),t=e.getService("v5"),n=e.getService("dom"),r=e.getService("url"),i=e.getService("at-mention"),s=e.getService("templates"),o=e.getService("datetime"),d(e.getConfig()),w(),f.scrollTop(f[0].scrollHeight),E()},onmessage:function(e,t){e==="pageresizecomplete"&&(w(),E())},onclick:function(e,t,i){if(t&&!n.hasClass(t,"disabled"))switch(i){case"at-mention-link":r.goToUrl(t.href),e.preventDefault(),e.stopPropagation();break;case"add-reply-link":this.showReplyComment(t);break;case"add-comment-link":this.showAddComment(t);break;case"cancel-new-comment-btn":this.cancelNewComment(t);break;case"submit-comment-btn":case"submit-comment-reply-btn":case"submit-task-reply-btn":case"submit-edit-task-reply-btn":this.submitComment(t);break;case"cancel-reply-comment-btn":this.cancelReplyComment(t);break;case"add-task-textarea":case"add-comment-textarea":t.focus();break;case"delete-comment":this.showDeleteCommentPrompt(t);break;case"add-task-link":this.showAddTask(t);break;case"edit-task-link":this.showEditTask(t);break;case"edit-task-reply":this.showEditTaskReply(t);break;case"set-task-due-date-btn":this.showTaskDueDatePicker(t);break;case"submit-edit-task-btn":case"submit-task-btn":this.submitTask(t);break;case"cancel-new-task-btn":case"cancel-edit-task-btn":this.cancelTaskEdit(t);break;case"cancel-edit-task-reply-btn":this.cancelEditTaskReply(t);break;case"task-complete-checkbox":this.showCompleteTaskPrompt(t);break;case"complete-task-yes-btn":this.submitTaskComplete(t);break;case"delete-task-yes-btn":this.submitDeleteTask(t);break;case"delete-comment-yes-btn":this.deleteComment(t);break;case"complete-task-no-btn":this.cancelCompleteTask(t);break;case"reject-task-no-btn":case"delete-task-no-btn":case"delete-comment-no-btn":this.hideItemPrompt(t);break;case"expand-task-assignees-btn":this.toggleTaskAssigneesTray(t);break;case"delete-task-link":this.showDeleteTaskPrompt(t);break;case"reject-task-link":this.showRejectTaskPrompt(t);break;case"reply-task-link":this.showReplyTask(t);break;case"reject-task-yes-btn":this.submitRejectTask(t)}},showTaskDueDatePicker:function(e){var t=m(e),n=t.find(".task_due_date_input");n.datepicker("show")},showCompleteTaskPrompt:function(e){var t=m(e);b(t,$t("Complete this task?","complete_this_task_prompt"),"complete-task")},cancelCompleteTask:function(e){var t=m(e);t.find(".task_completed_checkbox").prop("checked",!1),this.hideItemPrompt(e)},hideItemPrompt:function(e){var t=m(e);t.removeClass("prompting").find(".item_feed_prompt").remove()},showRejectTaskPrompt:function(e){var t=m(e);b(t,$t("Reject this task?","reject_this_task_prompt"),"reject-task")},showDeleteTaskPrompt:function(e){var t=m(e);b(t,$t("Delete this task?","delete_this_task_prompt"),"delete-task")},showDeleteCommentPrompt:function(e){var t=m(e);b(t,$t("Delete this comment?","delete_this_comment_prompt"),"delete-comment")},toggleTaskAssigneesTray:function(e){var t=m(e),n=t.find(".assignees_tray"),r=$(e).find(".button_icon");n.hasClass("tray_open")?(r.addClass("sprite_preview_20x20_down_chevron").removeClass("sprite_preview_20x20_up_chevron"),n.removeClass("tray_open")):(r.addClass("sprite_preview_20x20_up_chevron").removeClass("sprite_preview_20x20_down_chevron"),n.addClass("tray_open")),n.slideToggle(200)},showAddTask:function(e){var t=$("#new_task_entry_area"),n=x(t,"submit-task-btn",$t("Assign Task","js_assign_task"));t.append(n);var r=m(e);r.find(".new_item_feed_prompt").hide(),t.show(),n.find(".task_assignees input").focus()},showEditTask:function(e){var t=m(e),r=t.find(".task_content_cell");n.addClass(t[0],"editing_task");var i=t.attr("data-task_id"),s=k(i),o={assignees:s.assignmentsMap,description:s.description,dueDate:s.due,taskId:i};x(r,"submit-edit-task-btn",$t("Edit Task","js_edit_task"),o)},showReplyTask:function(e){var t=m(e),n=t.next("li");if(n.hasClass("item_feed_comment_reply")){n.remove();return}var r=$(s.getTemplateHTML("item_feed_comment_reply_template",{submitButtonDataType:"submit-task-reply-btn",cancelButtonDataType:"cancel-reply-comment-btn"})),o=t.attr("data-task_assignment_id");r.attr("data-reply_to_task_assignment_id",o),r.insertAfter(t).show();var u=r.find("textarea");i.bind({inputElement:u,itemTypedID:y(),initialMessage:""}),u.focus()},showEditTaskReply:function(e){var t=m(e),n=$(s.getTemplateHTML("item_feed_comment_reply_template",{submitButtonDataType:"submit-edit-task-reply-btn",cancelButtonDataType:"cancel-edit-task-reply-btn"})),r=t.attr("data-task_assignment_id");n.attr("data-reply_to_task_assignment_id",r),n.insertAfter(t.hide()).show();var o=t.attr("data-assignee-user-id"),u=t.attr("data-task-id"),a=L(u,o)||"",f=n.find("textarea");f.val(a).autosize(),i.bind({inputElement:f,itemTypedID:y(),initialMessage:a}),f.focus()},cancelEditTaskReply:function(e){var t=m(e),n=t.attr("data-reply_to_task_assignment_id");t.remove(),$("#task_reply_"+n).show()},submitTaskComplete:function(e){var t=m(e),n=t.attr("data-task_assignment_id"),r=this;t.find(".input_button").disable();var i={complete:"complete",task_assignment_id:n,is_from_sidebar:!0};$.postJSON("/index.php?rm=box_tasks_complete_task_assignment",i,function(t){h(t),r.hideItemPrompt(e)})},submitRejectTask:function(e){var t=m(e),n=this,r={item_typed_id:g(),task_assignment_id:t.attr("data-task_assignment_id"
),is_from_sidebar:!0};$.postJSON("/index.php?rm=box_tasks_delete_task_assignment",r,function(t){h(t),n.hideItemPrompt(e)})},submitDeleteTask:function(e){var t=m(e),n=this,r={task_id:t.attr("data-task_id"),is_from_sidebar:!0};$.postJSON("/index.php?rm=box_tasks_delete_task",r,function(t){h(t),n.hideItemPrompt(e)})},submitTask:function(e){var t,r=$(n.getNearest(e,".item_feed_task_edit")),s,o,u,f;r.find(".input_button").disable(),t=r.find(".task_entry_textarea"),s=i.getMessage(t),o=a.get_selected_options();var l=v(r);u=c(s,"task"),(!o||o.length===0)&&u.push({errorText:$t("Please enter one or more task recipients","create_item_feed_object_no_recipients_error")});if(u.length>0){$.popup.alert($t("Error","create_item_feed_object_error_title"),u[0].errorText,function(){t.focus(),r.find(".input_button").enable()});return}var p=r.attr("data-task_id");f={task_id:p||null,item_typed_id:g(),is_from_sidebar:1,description:s.message,message_mentioned:s.messageMentioned,assignment_emails:o.join(","),due:l||0,action:"review"};var d=p?"/index.php?rm=box_tasks_edit_task":"/index.php?rm=box_tasks_create_task";$.postJSON(d,f,h)},cancelTaskEdit:function(e){var t=$(n.getNearest(e,"#new_task_entry_area"));if(t.length){var r=m(e);t.hide().empty(),r.find(".new_item_feed_prompt").show()}else{var i=$(n.getNearest(e,".task_item"));i.find(".item_feed_task_edit").remove(),n.removeClass(i[0],"editing_task")}},showAddComment:function(e){var t=m(e);t.find(".new_item_feed_prompt").hide(),t.find(".new_comment_entry_area").show();var n=t.find(".comment_entry_textarea");n.autosize(),S(n[0]),n.val(""),i.bind({inputElement:n,itemTypedID:y()}),n.focus()},showReplyComment:function(e){var t=m(e),n=t.next("li");if(n.hasClass("item_feed_comment_reply")){n.remove();return}var r=$(s.getTemplateHTML("item_feed_comment_reply_template",{submitButtonDataType:"submit-comment-reply-btn",cancelButtonDataType:"cancel-reply-comment-btn"}));r.attr("data-reply_to_comment_id",t.attr("data-comment_id")),r.insertAfter(t).show();var o=t.attr("data-comment_author_name"),u=t.attr("data-comment_author_id"),a=r.find("textarea");i.bind({inputElement:a,itemTypedID:y(),initialMessage:"@["+u+":"+o+"] "}),a.focus().val("@"+o+" ")},submitComment:function(e){var t,n=m(e),r,s,o,u;t=n.find(".comment_entry_textarea"),r=i.getMessage(t),s=c(r,"comment");if(s.length>0){$.popup.alert($t("Error","create_item_feed_object_error_title"),s[0].errorText,function(){t.focus()});return}n.find(".input_button").disable();var a=n.attr("data-reply_to_task_assignment_id");if(a)u={task_assignment_id:a,feedback:r.message,message_mentioned:r.messageMentioned,is_from_sidebar:!0},o="/index.php?rm=box_tasks_complete_task_assignment";else{u={commentable_item_typed_id:g(),message:r.message,message_mentioned:r.messageMentioned,get_updated_list:!0,show_all:!1,exclude_tasks:!1,is_from_sidebar:!0};var f=n.attr("data-reply_to_comment_id");f&&(u.parent_comment_id=f),o="/index.php?rm=box_comments_create"}$.postJSON(o,u,h)},deleteComment:function(e){var t=m(e),n=t.attr("data-comment_id"),r;r={comment_id:n,commentable_item_typed_id:g(),is_from_sidebar:!0},$.postJSON("/index.php?rm=box_comments_delete",r,h)},cancelNewComment:function(e){var t=m(e);t.find(".new_comment_entry_area").hide(),t.find(".new_item_feed_prompt").show()},cancelReplyComment:function(e){$(n.getNearest(e,".item_feed_comment_reply")).remove()}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-error.js",time:(new Date).getTime()}),Box.Application.addModule("preview-error",function(e){"use strict";function t(){var t=$(e.getElement()),n=e.getService("nav-state"),r=n.galleryItem();if(r)r.download({no_confirmation:!0});else{var i=t.attr("data-sharedname"),s=t.attr("data-file_id"),o="/index.php?rm=box_download_shared_file&shared_name="+i+"&file_id=f_"+s,u=e.getService("download");u.downloadViaGet(o)}}return{onclick:function(e,n,r){if(n)switch(r){case"download-btn":t()}}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-filmstrip.js",time:(new Date).getTime()}),Box.Application.addModule("preview-filmstrip",function(e){"use strict";function d(e){var t=n.parent().width();a=Math.floor(t/p),a===0&&(a=1),f=p*a,l=Math.floor((u-1)/a);if(e==="initial")c=Math.floor(o/a);else if(e==="resized"){var r=-1*parseInt(n.css("left"));c=Math.floor(r/f),c===l?$(".filmstrip_next_arrow").hide():$(".filmstrip_next_arrow").show(),c===0?$(".filmstrip_previous_arrow").hide():$(".filmstrip_previous_arrow").show()}}function v(){var e=-c*f;n.css("left",e+"px");var t=$(".filmstrip_previous_arrow");t.show(),c===0&&t.hide();var r=$(".filmstrip_next_arrow");r.show(),c===l&&r.hide()}function m(){$(".filmstrip_item").removeClass("strong");var e=$(t).find('[data-item_typed_id="'+s+'"]');e.addClass("strong");var n=Math.floor(o/a);n!==c&&(c=n,v())}var t,n,r,i,s,o,u,a,f,l,c,h,p;return{messages:["showpreviewfilmstrip","closepreviewfilmstrip","previewfileupdated","previewsidebartoggled","pageresizecomplete"],init:function(){t=e.getElement(),n=$(t).find(".filmstrip_list"),r=e.getService("dom"),i=e.getService("lightbox");var a=e.getConfig();s=a.current_typed_id,o=parseInt(a.current_item_position),u=r.queryAll(".filmstrip_item").length,p=$(".filmstrip_item").outerWidth(!0),d("initial"),v()},onclick:function(e,t,n){switch(n){case"previous-arrow":c--,v();break;case"next-arrow":c++,v();break;case"item":this.handleItemClick(t)}e.stopPropagation(),e.preventDefault()},onmessage:function(e,n){e==="showpreviewfilmstrip"?(clearTimeout(h),r.removeClass(t,"hidden"),d("resized"),m(),i.openFilmstrip()):e==="closepreviewfilmstrip"?(i.closeFilmstrip(),h=setTimeout(function(){r.addClass(t,"hidden")},500)):e==="previewfileupdated"?(s=n.typedId,o=n.currentItemPosition,r.hasClass(t,"hidden")||m()):(e==="previewsidebartoggled"||e==="pageresizecomplete")&&d("resized")},handleItemClick:function(t){var n=$(t).attr("data-item_typed_id");n!==s&&e.broadcast("previewfilmstripselect",{typedId:n})}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-flash.js",time:(new Date).getTime()}),Box.Application.addModule("preview-flash",function(e){"use strict";function b(){var t=e.getService("v5"),n=e.getService("browser"),r=t.get("swfobject"),i=t.get("swfmacmousewheel");if(typeof r!="undefined"){var s={backgroundColor:"#ffffff",conversion_on_realtime:!0,lightbox_preview:!0},o={allowfullscreen:"true",allowscriptaccess:"always",wmode:"transparent"},a=e.getService("assets").getFlashAssetURL(),f=e.getService("assets").getAssetURL(a,"preview.swf");r.embedSWF(f,"flash-player","2","2",n.getMinimumFlashVersion(),null,s,o,{"class":u+" preview-content"}),typeof i!="undefined"&&i.registerObject("flash-player")}else $.error(new Error("swf object undefined"))}function w(){a=!1;var n=r.getAttribute("data-typed-id");t=p.query("object"),o=e.getService("templates");var i=o.getTemplateHTML("flash_xml"),s=[];s[0]={identifier:n,xml:i},t.updateFiles(s,n)}function E(e){e.width&&$(t).css({width:e.width,"max-width":"100%","max-height":"100%"}),$(t).removeAttr("width").removeAttr("height"),$(t).removeClass(u)}function S(e){n?a?n.pause():n.play():t.fire(a?"pause":"play",null)}function x(){clearTimeout(l),l=setTimeout(function(){p.addClass(f,g)},v)}function T(){a&&(p.removeClass(f,g),x())}function N(){a=!0,s.startPlaying(),f&&(i.on("lightboxactivity",T),p.addClass(f,m),x())}function C(){a=!1,s.stopPlaying(),f&&(i.off("lightboxactivity",T),clearTimeout(l),p.removeClass(f,m),p.removeClass(f,g))}function k(){n&&n.tagName==="VIDEO"&&(n.style.width=n.videoWidth+"px",n.style.height=n.videoHeight+"px")}function L(){if(d)return;k(),n.volume=s.getCurrentVolume()||.7,e.broadcast("previewloaded"),s.shouldPlayTheNextFile()&&n.play(),d=!0}function A(){s.shouldPlayTheNextFile()?e.broadcast("previewthenextfile"):(C(),s.setTimecode(0),s.updateScrubber(0,1))}function O(e){var t,r,i,s,o=n.parentNode.getBoundingClientRect(),u=o.width,a=n.getBoundingClientRect(),f=a.width,l=a.height,c=f/l;e==="in"?t=f+100:t=f-100,t>u?s=i="100%":t<n.videoWidth?(i=n.videoWidth+"px",s=n.videoHeight+"px"):(r=Math.floor(t*100/u),i=r+"%",s=t/c+"px"),n.style.width=i,n.style.height=s}function M(e){e.type==="fullscreen"||e.type==="enter"?(n.style.width="100%",n.style.height="100%"):(e.type==="exitfullscreen"||e.type==="exit")&&k()}function _(){var e=n.currentTime,t=n.duration,r=n.buffered,i=r.length?r.end(r.length-1):0,o=t?i/t:0,u=t?e/t:0;o=o.toFixed(2)-0,u=u.toFixed(2)-0,s.setTimecode(e),s.updateScrubber(u,o)}function D(){h=(h+1)%c.length,n.playbackRate=c[h],s.setPlaybackRate(c[h])}function P(t){var r=t.type;switch(r){case"playing":N();break;case"pause":C();break;case"durationchange":s.setDuration(n.duration);break;case"canplay":L();break;case"progress":case"timeupdate":_();break;case"ended":A();break;case"error":e.broadcast("previewexpired",{useFlash:!0})}}function H(e){if(!n)return t.fire(e.type,e.data);var r;switch(e.type){case"play":n.play();break;case"pause":n.pause();break;case"volume":n.volume=e.data;break;case"playbackrate":D();break;case"zoomin":O("in");break;case"zoomout":O("out");break;case"seek":r=n.paused||n.ended,n.currentTime=e.data*n.duration,r&&n.pause()}}function B(t,n){if(t==="flashevent")switch(n.type){case"previewer_loaded":w();break;case"previewer_pagecount_determined":case"previewer_first_page_shown":n.duration&&s.setDuration(n.duration),E(n),e.broadcast("previewloaded");break;case"previewer_scrubber_update":s.setTimecode(n.timecode),s.updateScrubber(n.handle,n.loaded);break;case"previewer_media_state_changed":n.state==="playing"?N():C()}}var t,n,r,i,s,o,u="hidden_flash",a=!1,f,l,c=[.5,1,1.5,2],h=1,p=e.getService("dom"),d=!1,v=2e3,m="is-playing",g="is-timed-out",y=["progress","durationchange","timeupdate","playing","pause","ended","canplay","error"];return{init:function(){var t,o,u=e.getService("fullscreen");r=e.getElement(),f=p.query(".preview-icon-play-pause",r),n=p.query("audio",r)||p.query("video",r)||null,i=e.getService("lightbox"),s=e.getService("preview-controls");if(n){for(t=0,o=y.length;t<o;t++)n.addEventListener(y[t],P,!1);n.oncontextmenu=function(){return!1},u.on("enter",M),u.on("exit",M),s.on("fullscreen",M),s.on("exitfullscreen",M),s.on("playbackrate",H)}else b();s.on("zoomin",H),s.on("zoomout",H),s.on("rotateleft",H),s.on("zoomtofit",H),s.on("nextpage",H),s.on("previouspage",H),s.on("play",H),s.on("pause",H),s.on("seek",H),s.on("volume",H),i.on("toggleplay",S),i.setType("flash")},destroy:function(){var t,r,o=e.getService("fullscreen");s.off("zoomin",H),s.off("zoomout",H),s.off("rotateleft",H),s.off("zoomtofit",H),s.off("nextpage",H),s.off("previouspage",H),s.off("play",H),s.off("pause",H),s.off("seek",H),s.off("volume",H),i.off("toggleplay",S),f&&(clearTimeout(l),i.off("lightboxactivity",T));if(n){for(t=0,r=y.length;t<r;t++)n.removeEventListener(y[t],P,!1);o.off("enter",M),o.off("exit",M),s.off("fullscreen",M),s.off("exitfullscreen",M),s.off("playbackrate",H)}},messages:["flashevent"],onmessage:B,startPlaying:N,stopPlaying:C,onclick:function(e,t,n){t&&t.tagName==="BUTTON"&&(n==="play"||n==="pause")&&(e.preventDefault(),e.stopPropagation(),H({type:n}))}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-header.js",time:(new Date).getTime()}),Box.Application.addModule("preview-header",function(e){"use strict";function C(e,t,n){var r;return function(){function u(){r=null,n||e.apply(i,s)}var i=this,s=arguments,o;o=n&&!r,clearTimeout(r),r=setTimeout(u,t),o&&e.apply(i,s)}}function k(){if(l){l.execute();return}c.isBoxEditInstalled()&&c.isBoxEditFullyEnabled(a)?(i.disable(),setTimeout(function(){i.enable()},3e3),c.executeBoxEdit(a.id,a.typed_id)):e.getService("popups").open("box_edit_download",{data:{action:"edit",typed_id:a.typed_id,extension:a.extension}})}function L(e,t){var n=$(e);n.addClass("disabled"),t&&n.removeAttr("data-hover aria-label").attr("data-htmltooltip",t)}function A(e,t){var n=$(e);n.enable(),t&&n.attr("data-htmltooltip",t)}function O(){var t=e.getService("browser");a.permissions.rename?c.isBoxEditDisabledByAdmin()?L(i,E):!t.isBrowserPluginsSupported()&&!l?L(i,w):c.isBoxEditInstalled()&&!c.getNativeApplicationName(a.extension)&&!l?L(i,b):A(i,g):L(i,a.locked?a.generate_lock_info_html():y),a.permissions.download?a.is_webdoc()?L(s,x):a.is_boxnote()?L(s,T):A(s,$t("Download","download")):L(s,S)}function M(e){l=null,f=null;if(a.type=="file")for(var t in e){if(!l&&a.permissions.rename&&a.can_edit_on_gallery_using(e[t].action)){l=e[t];continue}!f&&a.permissions.download&&a.can_view_on_gallery_using(e[t].action)&&(f=e[t])}}function _(){r.addClass("file_locked"),O(),$("#preview_header_file_lock_icon").removeAttr("data-hover aria-label").attr("data-htmltooltip",a.generate_lock_info_html())}function D(){r.removeClass("file_locked"),O(),$("#preview_header_file_lock_icon").removeAttr("data-hover aria-label data-htmltooltip")}function P(){var t=e.getService("nav-state"),n=t.get(),r=n.sharedName||"",i=N+"/"+a.typed_id+"/"+a.extension;return r&&(i=i+"/"+r),i}function H(n){switch(n){case"share":var r=function(){a.sharebar({selected_tab:"link"})},i=e.getService("nav-state");i.isGcm()?r():a.get_shared_info(r);break;case"comment":t.toggleSidebarWithModule("item-feed");break;case"edit":k();break;case"download":a.download({no_confirmation:!0});break;case"lock":_();break;case"unlock":D();break;case"close":t.userClose();break;case"print":window.open(P());break;case"backToPreview":t.hideSidebar()}}function B(){a.show_menu_in_lightbox({target:o.get(0)})}function j(){o.mouseenter(function(){h=setTimeout(function(){B()},200)}),o.mouseleave(function(){clearTimeout(h)})}function F(){u.mouseenter(function(){var e=n.get("Box_Menus");e.lightbox_file_info_layer.show({item:a})})}function I(){var e=r.find(".edit_in_place");e.data("callback",function(){a.refresh(),document.title=r.find(".preview_file_title").text()+" - Box"})}function q(t){m+=t,m&&(e.broadcast(m>0?"previewnextfile":"previewpreviousfile",{fileIdOfLastFileOnPreviousPage:d.file_id_of_last_file_on_previous_page,fileIdOfFirstFileOnNextPage:d.file_id_of_first_file_on_next_page,totalNumFiles:d.total_num_files,fileOffset:m,currentFileNumber:d.current_file_number}),m=0)}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m=0,g=$t("Edit this file","edit_file_preview_button_label"),y=$t("You do not have permission to edit this file","files_page_edit_button_disabled_tip"),b=$t("This file type cannot be edited","files_page_edit_button_uneditable_filetype_tip"),w=$t("Your current browser mode does not support Box Edit","files_page_edit_button_plugin_not_supported_tip"),E=$t("The Edit App has been disabled by you or your administrator","files_page_edit_button_admin_disabled_tip"),S=$t("You do not have permission to download this file","files_page_download_button_disabled_permissions_tip"),x=$t("You cannot download a Web Document","files_page_download_webdoc_button_disabled_tip"),T=$t("You cannot download a Box Note yet, but it will be coming soon.","box_notes_files_page_download_button_disabled_tip"),N="/print";return{messages:["previewshare","previewcomment","previewedit","previewdownload","previewlock","previewunlock","previewsharedinfofetched","previewprint","previewthenextfile"],init:function(){t=e.getService("lightbox"),n=e.getService("v5"),c=e.getService("box-edit"),r=$(e.getElement()),i=r.find("[data-type=edit-btn]"),s=r.find("[data-type=download-btn]"),o=r.find("[data-type=more-btn]"),u=r.find("[data-type=file-title]"),d=e.getConfig(),v=C(q,1e3,!0),j(),F();var f=e.getService("nav-state"),l=f.get();if(l.type!=="f"&&l.type!=="s"){var h=e.getService("dom");h.addClass(r.find(".filmstrip_button")[0],"disabled")}var m=r.attr("data-file_typed_id");a=n.get("Item").find(m);if(!a)throw new Error("PreviewHeader: Item not found with typed_id "+m);a.locked&&_(),p=document.title,document.title=r.find(".preview_file_title").text()+" - Box";var g=e.getService("openbox-service-actions"),y=g.getActions(a,{type:"openbox"});M(y),O(),I()},destroy:function(){document.title=p},onclick:function(e,n,r){if(n){if($(n).hasClass("disabled"))return;switch(r){case"previous-file-btn":v(-1);break;case"next-file-btn":v(1);break;case"filmstrip-btn":t.toggleFilmstrip();break;case"share-btn":H("share");break;case"comment-btn":H("comment");break;case"edit-btn":H("edit");break;case"download-btn":H("download");break;case"more-btn":B();break;case"close-btn":H("close");break;case"back-to-preview-btn":H("backToPreview")}}},onmessage:function(e){switch(e){case"previewshare":H("share");break;case"previewcomment":H("comment");break;case"previewedit":H("edit");break;case"previewdownload":H("download");break;case"previewlock":H("lock");break;case"previewunlock":H("unlock");break;case"previewprint":H("print");break;case"previewsharedinfofetched":this.updateButtons();break;case"previewthenextfile":q(1)}},updateButtons:O}}),Box.Timing.execution.push({name:"js/modules/preview/preview-iframe.js",time:(new Date).getTime()}),Box.Application.addModule("preview-iframe",function(e){"use strict";var t,n,r;return{init:function(){t=e.getConfig(),n=$(e.getElement()),r=n.find(".preview-iframe"),t.add_class&&r.addClass(t.add_class),r[0].setAttribute("src",t.note_url)}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-image.js",time:(new Date).getTime()}),Box.Application.addModule("preview-image",function(e){"use strict";function H(){var e,o,u=Math.min(O,t),a=Math.min(M,n),f=Math.max(O,r),l=Math.max(M,i);L=Math.max(u/O,a/M),A=Math.min(f/O,l/M,s),e=L,o=e;do o>1&&e<1&&(o=1),e=o,x.push(e),o=e+e/2;while(e<A);L=x[0],A=x[x.length-1]}function B(){var e=($(v).width()-w*2)/O,t=($(v).height()-w*2)/M;return Math.max(L,Math.min(e,t,1))}function j(){var e=x.slice();return e.push(B()),e.sort(function(t,n){return t-n}),e}function F(){var e,t=j();for(e=t.length-1;e>=0;--e)if(t[e]<_)return t[e];return _}function I(){var e,t,n=j();for(e=0,t=n.length;e<t;++e)if(n[e]>_)return n[e];return _}function q(e){var t=B();e=e||_;if(e<L||e>A)return;S?e=t:S=e===t,_=e}function R(){return v.scrollWidth>v.clientWidth||v.scrollHeight>v.clientHeight}function U(){R()?c.addClass(g,u):c.removeClass(g,u),S&&_<1?c.addClass(g,o):c.removeClass(g,o)}function z(){if(S){var e=O*_,t=M*_,n=e/$(m).width()*100,r=t/$(m).height()*100,i=(100-r)/2,s=(100-n)/2;$(g).css({width:n+"%",height:r+"%",top:i+"0%",left:s+"0%"})}else $(g).css({width:"100%",height:"100%",top:0,left:0})}var t=200,n=200,r=5e3,i=5e3,s=5,o="zoomable",u="pannable",a="panning",f=e.getService("lightbox"),l=e.getService("preview-controls"),c=e.getService("dom"),h=e.getService("browser"),p={},d,v,m,g,y,b=0,w=0,E=!1,S=!0,x=[],T,N,C,k,L,A,O,M,_=1,D=!1,P=!1;return $.extend(p,{messages:["pageresizecomplete"],onmessage:function(e,t){switch(e){case"pageresizecomplete":this.handleResize()}},init:function(){d=e.getElement(),v=c.query(".preview-image-container",d),m=c.query(".preview-image-content",d),g=c.query(".preview-image-click-target",d),y=c.query(".preview-image-wrapper-inner",d),P=h.isIE()&&parseFloat(h.getVersion())<9;var t=c.query("img",v);t.complete?this.handleImageLoad():t.onload=this.handleImageLoad;try{v.focus()}catch(n){}l.on("zoomin",this.handleZoomIn),l.on("zoomout",this.handleZoomOut),l.on("rotateleft",this.handleRotateLeft),l.on("focuscontent",this.handleContentFocus),f.on("zoomin",this.handleZoomIn),f.on("zoomout",this.handleZoomOut),f.setType("image")},destroy:function(){l.off("zoomin",this.handleZoomIn),l.off("zoomout",this.handleZoomOut),l.off("focuscontent",this.handleContentFocus),f.off("zoomin",this.handleZoomIn),f.off("zoomout",this.handleZoomOut)},onmousedown:function(e,t,n){n==="preview-image"&&(p.startPanning(e.clientX,e.clientY),e.preventDefault())},onclick:function(e,t,n){if(n==="preview-image"){if(D){D=!1;return}S?p.zoomToActual():R()&&!S&&p.zoomToFit()}},oncontextmenu:function(e,t,n){t===m&&c.hasClass(d,"is-read-only")&&e.preventDefault()},startPanning:function(e,t){if(!c.hasClass(g,u))return;T=e,N=t,C=$(v).scrollLeft(),k=$(v).scrollTop(),E=!0,$(document).on("mousemove",this.handleMouseMove),$(document).on("mouseup",this.handleMouseUp),c.addClass(g,a)},stopPanning:function(){E=!1,$(document).off("mousemove",this.handleMouseMove),$(document).off("mouseup",this.handleMouseUp),c.removeClass(g,a)},pan:function(e,t){if(!E)return;var n=$(v),r=e-T,i=t-N;n.scrollLeft(C-r),n.scrollTop(k-i),D=!0},zoomTo:function(e){var t=$(v).height(),n=$(v).width(),r,i,s=v.scrollTop,o=v.scrollLeft,u=.5,a=.5,f,l;R()&&(u=(s+t/2)/(M*_),a=(o+n/2)/(O*_)),q(e),i=O*_,r=M*_,$(m).css("visibility","hidden"),!P&&S?$(m).css({width:"100%",height:"100%",maxWidth:O,maxHeight:M}):$(m).css({width:i,height:r,maxWidth:"none",maxHeight:"none"}),f=M*_*u-t/2,l=O*_*a-n/2,v.scrollTop=f,v.scrollLeft=l,$(m).css("visibility","visible"),z(),U()},zoomIn:function(){q(),S=!1,this.zoomTo(I())},zoomOut:function(){q(),S=!1,this.zoomTo(F())},zoomToActual:function(){q(),S=!1,this.zoomTo(1)},zoomToFit:function(){q(),S=!0,this.zoomTo(B())},focus:function(){v.focus()},handleImageLoad:function(){var t=c.query("img",d);if(d.parentNode===null||!t)return;O=t.naturalWidth||t.width,M=t.naturalHeight||t.height,P?$(m).css("filter","progid:DXImageTransform.Microsoft.AlphaImageLoader( src='"+t.src+"', sizingMethod='scale')"):$(m).css("background-image","url("+t.src+")"),$(t).remove(),w=($(y).outerWidth()-$(y).width())/2,H(),p.zoomToFit(),c.removeClass(v,"loading"),e.broadcast("previewloaded")},handleRotateLeft:function(){var e=b-90;b=e===-3600?0:e,$(m).css("transform","rotate("+b+"deg)")},handleZoomIn:function(){p.zoomIn()},handleZoomOut:function(){p.zoomOut()},handleContentFocus:function(){p.focus()},handleMouseUp:function(){p.stopPanning()},handleMouseMove:function(e){p.pan(e.clientX,e.clientY)},handleResize:function(){q(),U(),z()}})}),Box.Timing.execution.push({name:"js/modules/preview/preview-progress.js",time:(new Date).getTime()}),Box.Application.addModule("preview-progress",function(e){"use strict";function o(){clearTimeout(n),n=setTimeout(u,t)}function u(){e.broadcast("previewexpired")}var t=1e4,n,r=0,i,s;return{messages:["previewprogress"],onmessage:function(e,t){e==="previewprogress"&&(o(),t.percent_done&&this.updateConvertingIndicator(t.percent_done),t.status==="success"&&this.completeConversion())},init:function(){var t=$(e.getElement()),n=e.getConfig(),r=e.getService("nav-state");i=t.find(".lightbox_progress_bar"),o(),this.updateConvertingIndicator(n.percent_done),s=r.galleryItem()},completeConversion:function(){this.updateConvertingIndicator(100),setTimeout(function(){i.addClass("progress-bar-hidden")},200),u()},destroy:function(){i.remove(),clearTimeout(n)},updateConvertingIndicator:function(e){e>r&&(i.find(".lightbox_progress_indicator").css("width",e+"%"),r=e)},onclick:function(e,t,n){switch(n){case"download-btn":if(s){s.download({no_confirmation:!0});break}}}}}),Box.Timing.execution.push({name:"js/modules/preview/preview-svg.js",time:(new Date).getTime()}),Box.Application.addModule("preview-svg",function(e){"use strict";function k(){if(!b)return;if(b<10)return;var e=Math.round(100*g/b)+"%",t=r.find(".page-progress-indicator-bar"),n=r.find(".page-progress-indicator");t.css("width",e),e==="100%"?n.delay(2e3).fadeOut("fast"):n.show()}function L(e){v?o.setPageAvailable(e):m.push(function(){o.setPageAvailable(e)})}function A(e){v?o.setPagesAvailableUpTo(e):m.push(function(){o.setPagesAvailableUpTo(e)})}function O(e){var n,r,i,s,u,a,f=0,c=!1,h=!1,p=!1;if(!T){e.json.status=="success"&&(h=!0),e.json.status=="success"&&e.image.status=="success"&&(c=!0);if(e.json.status=="error"||e.image.status=="error")p=!0}else{e.json.status=="success"&&e.css.status=="success"&&(h=!0),e.css.status=="success"&&e.json.status=="success"&&e.html.status=="success"&&e.svg.status=="success"&&(c=!0);if(e.css.status=="error"||e.json.status=="error"||e.html.status=="error"||e.svg.status=="error")p=!0}!o&&h&&(c&&(l.done=!0),t.initViewer());if(c)d=!0,g=b,l.done||A(b);else if(p)j(e.json.message);else{if(!T)a=e.image.files_generated&&e.image.files_generated.split("");else{s=e.svg.files_generated&&e.svg.files_generated.split(""),u=e.html.files_generated&&e.html.files_generated.split("");if(s&&u){a=[];for(n=0,r=s.length;n<r;++n)a.push(s[n]==="1"&&u[n]==="1"?"1":"0")}}if(a){for(n=0,r=a.length;n<r;++n)a[n]==="1"&&(i=n+1,f++,L(i));g=f}D()}k()}function M(){var e=$.getJSON(w,$.extend({file_id:h},l.query_params));e.done(O),e.fail(D)}function _(){clearTimeout(p)}function D(){_(),p=setTimeout(M,N)}function P(){var e=0,t=15;S=r.find(".svg-conversion-progress-overlay").show(),x=setInterval(function(){e<75?e+=100/(t*10):e+=(100-e)/(t*10),e=Math.min(e,100),S.find(".progress_bar").width(e+"%")},100)}function H(e){if(e&&S){S.remove();return}S&&(clearInterval(x),S.find(".progress_bar").width("100%"),setTimeout(function(){S.find(".lightbox_progress_bar").addClass("progress-bar-hidden"),setTimeout(function(){S.remove()},200)},200))}function B(n){f.removeClass(r,C),H(),v=!0,b=n.data.numPages,t.updateControls(n.data.page,b),e.broadcast("previewloaded"),o.focus();for(var i=0;i<m.length;i++){var s=m[i];s()}d?(_(),g=b,A(b)):(D(),k())}function j(e){d=!0,_(),f.removeClass(r,C),H(!0),a.destroy(),o&&o.destroy(),e||(e=$t("We're sorry, the server encountered an error while processing your document.","preview-svg-server-error-message")),$("#preview-error-message").text(e),$(".svg-converting-error-overlay").show()}function F(e){if(e.kind==="crocodoc"){if("f_"+e.file_id!==h)return;if(d)return;if(e.status==="error"){j(e.message);return}D(),o||(e.status==="success"?(l.done=!0,t.initViewer()):e.crocodoc_json&&e.crocodoc_css&&t.initViewer()),e.status==="success"?(d=!0,_(),l.done||(g=b,A(g),k())):e.last_page&&(g=Math.max(g,parseInt(e.last_page,10)||0),A(g),k())}}function I(t){var n=e.getService("logger");n&&n.sendLog("preview","svg-error",t,null,{splunk:1})}var t={},n,r,i,s,o,u,a,f,l,c,h,p,d=!1,v=!1,m=[],g=0,y=0,b=null,w="/index.php?rm=controller_preview_get_status",E={},S,x,T,N=5e3,C="svg-preview-waiting";return $.extend(t,{messages:["previewprogress"],onmessage:function(e,t){e==="previewprogress"&&T&&F(t)},onclick:function(e,t,r){switch(r){case"previouspage":o.scrollTo("previous");break;case"nextpage":o.scrollTo("next");break;case"download-btn":n&&n.download({no_confirmation:!0})}},init:function(){var t=e.getService("nav-state");u=e.getService("browser"),l=e.getConfig(),d=l.done,h=l.file_id,r=$(e.getElement()),i=r.find(".preview-svg"),s=!1,a=e.getService("preview-controls"),c=e.getService("lightbox"),f=e.getService("dom"),T=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),t.isGcm()&&(w="/index.php?rm=box_master_controller_preview_get_status"),n=t.galleryItem(),T||(w+="&client_supports_svg=false",N=1e3),d?this.initViewer():(f.addClass(r,C),P(),M()),a.on("zoomin",this.zoominHandler),a.on("zoomout",this.zoomoutHandler),a.on("zoomtofit",this.zoomtofitHandler),a.on("nextpage",this.nextpageHandler),a.on("previouspage",this.previouspageHandler),a.on("fullscreen",this.enterFullscreenHandler),a.on("exitfullscreen",this.exitFullscreenHandler),a.on("setpagenumber",this.setpagenumberHandler),a.on("focuscontent",this.focusContentHandler),c.on("nextpage",this.nextpageHandler),c.on("previouspage",this.previouspageHandler),c.on("pageup",this.pageupHandler),c.on("pagedown",this.pagedownHandler),c.on("zoomin",this.zoominHandler),c.on("zoomout",this.zoomoutHandler)},destroy:function(){s=!0,o&&o.destroy(),_(),a.off("zoomin",this.zoominHandler),a.off("zoomout",this.zoomoutHandler),a.off("zoomtofit",this.zoomtofitHandler),a.off("nextpage",this.nextpageHandler),a.off("previouspage",this.previouspageHandler),a.off("fullscreen",this.enterFullscreenHandler),a.off("exitfullscreen",this.exitFullscreenHandler),a.off("setpagenumber",this.setpagenumberHandler),a.off("focuscontent",this.focusContentHandler),c.off("nextpage",this.nextpageHandler),c.off("previouspage",this.previouspageHandler),c.off("pageup",this.pageupHandler),c.off("pagedown",this.pagedownHandler),c.off("zoomin",this.zoominHandler),c.off("zoomout",this.zoomoutHandler)},initViewer:function(){var t=e.getService("crocodoc-viewer");E.url=l.base_url,d=l.done,E.url+="crocodoc/",E.queryParams=l.query_params,E.enableTextSelection=!l.read_only,l.preview_type==="presentation"?(E.layout="presentation",f.addClass(r,"preview-svg-presentation"),c.setType("presentation")):(E.layout="vertical-single-column",c.setType("document")),E.conversionIsComplete=d,o=t.create(i,E),o.load(),o.on("ready",B),o.on("pagefocus",this.pagefocusHandler),o.on("asseterror",this.asseterrorHandler),o.on("pagefail",this.pagefailHandler),o.on("fail",this.failHandler)},updateChevrons:function(e,t){if(l.preview_type==="presentation"){var n=r.find(".preview_previous_arrow").hide(),i=r.find(".preview_next_arrow").hide();e>1&&n.show(),e<t&&i.show()}},enterFullscreenHandler:function(){l.preview_type==="presentation"&&o.disableTextSelection()},exitFullscreenHandler:function(){l.preview_type==="presentation"&&o.enableTextSelection()},setpagenumberHandler:function(e){o.scrollTo(e.data)},zoominHandler:function(){o.zoom("in")},zoomoutHandler:function(){o.zoom("out")},zoomtofitHandler:function(){o.zoom("fitwidth")},nextpageHandler:function(){o.scrollTo("next")},previouspageHandler:function(){o.scrollTo("previous")},pagefocusHandler:function(e){t.updateControls(e.data.page,e.data.numPages)},asseterrorHandler:function(e){I(e.data)},pagefailHandler:function(){y++,y===b&&j()},failHandler:function(e){I(e.data),j()},pageupHandler:function(){o.scrollBy(-r.get(0).clientHeight)},pagedownHandler:function(){o.scrollBy(r.get(0).clientHeight)},focusContentHandler:function(){o.focus()},updateControls:function(e,n){a.updateCurrentPage(e),a.updateTotalPages(n),a.updateSlideArrows(e,n),t.updateChevrons(e,n)}})}),Box.Timing.execution.push({name:"done",time:(new Date).getTime()});