
(function($,undefined){var mouseHandled=false;$(document).mouseup(function(){mouseHandled=false;});$.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind("mousedown."+this.widgetName,function(event){return that._mouseDown(event);}).bind("click."+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+".preventClickEvent")){$.removeData(event.target,that.widgetName+".preventClickEvent");event.stopImmediatePropagation();return false;}});this.started=false;},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);if(this._mouseMoveDelegate){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);}},_mouseDown:function(event){if(mouseHandled){return;}
(this._mouseStarted&&this._mouseUp(event));this._mouseDownEvent=event;var that=this,btnIsLeft=(event.which===1),elIsCancel=(typeof this.options.cancel==="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false);if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true;}
this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true;},this.options.delay);}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(event)!==false);if(!this._mouseStarted){event.preventDefault();return true;}}
if(true===$.data(event.target,this.widgetName+".preventClickEvent")){$.removeData(event.target,this.widgetName+".preventClickEvent");}
this._mouseMoveDelegate=function(event){return that._mouseMove(event);};this._mouseUpDelegate=function(event){return that._mouseUp(event);};$(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true;},_mouseMove:function(event){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button){return this._mouseUp(event);}
if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault();}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,event)!==false);(this._mouseStarted?this._mouseDrag(event):this._mouseUp(event));}
return!this._mouseStarted;},_mouseUp:function(event){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+".preventClickEvent",true);}
this._mouseStop(event);}
return false;},_mouseDistanceMet:function(event){return(Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance);},_mouseDelayMet:function(){return this.mouseDelayMet;},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true;}});})(jQuery);(function($,undefined){$.widget("ui.draggable",$.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false,drag:null,start:null,stop:null},_create:function(){if(this.options.helper==="original"&&!(/^(?:r|a|f)/).test(this.element.css("position"))){this.element[0].style.position="relative";}
if(this.options.addClasses){this.element.addClass("ui-draggable");}
if(this.options.disabled){this.element.addClass("ui-draggable-disabled");}
this._mouseInit();},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();},_mouseCapture:function(event){var o=this.options;if(this.helper||o.disabled||$(event.target).closest(".ui-resizable-handle").length>0){return false;}
this.handle=this._getHandle(event);if(!this.handle){return false;}
$(o.iframeFix===true?"iframe":o.iframeFix).each(function(){$("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css($(this).offset()).appendTo("body");});return true;},_mouseStart:function(event){var o=this.options;this.helper=this._createHelper(event);this.helper.addClass("ui-draggable-dragging");this._cacheHelperProportions();if($.ui.ddmanager){$.ui.ddmanager.current=this;}
this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offsetParent=this.helper.offsetParent();this.offsetParentCssPosition=this.offsetParent.css("position");this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};this.offset.scroll=false;$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));this._setContainment();if(this._trigger("start",event)===false){this._clear();return false;}
this._cacheHelperProportions();if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event);}
this._mouseDrag(event,true);if($.ui.ddmanager){$.ui.ddmanager.dragStart(this,event);}
return true;},_mouseDrag:function(event,noPropagation){if(this.offsetParentCssPosition==="fixed"){this.offset.parent=this._getParentOffset();}
this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger("drag",event,ui)===false){this._mouseUp({});return false;}
this.position=ui.position;}
if(!this.options.axis||this.options.axis!=="y"){this.helper[0].style.left=this.position.left+"px";}
if(!this.options.axis||this.options.axis!=="x"){this.helper[0].style.top=this.position.top+"px";}
if($.ui.ddmanager){$.ui.ddmanager.drag(this,event);}
return false;},_mouseStop:function(event){var that=this,dropped=false;if($.ui.ddmanager&&!this.options.dropBehaviour){dropped=$.ui.ddmanager.drop(this,event);}
if(this.dropped){dropped=this.dropped;this.dropped=false;}
if(this.options.helper==="original"&&!$.contains(this.element[0].ownerDocument,this.element[0])){return false;}
if((this.options.revert==="invalid"&&!dropped)||(this.options.revert==="valid"&&dropped)||this.options.revert===true||($.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped))){$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(that._trigger("stop",event)!==false){that._clear();}});}else{if(this._trigger("stop",event)!==false){this._clear();}}
return false;},_mouseUp:function(event){$("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this);});if($.ui.ddmanager){$.ui.ddmanager.dragStop(this,event);}
return $.ui.mouse.prototype._mouseUp.call(this,event);},cancel:function(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp({});}else{this._clear();}
return this;},_getHandle:function(event){return this.options.handle?!!$(event.target).closest(this.element.find(this.options.handle)).length:true;},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):(o.helper==="clone"?this.element.clone().removeAttr("id"):this.element);if(!helper.parents("body").length){helper.appendTo((o.appendTo==="parent"?this.element[0].parentNode:o.appendTo));}
if(helper[0]!==this.element[0]&&!(/(fixed|absolute)/).test(helper.css("position"))){helper.css("position","absolute");}
return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj==="string"){obj=obj.split(" ");}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if("left"in obj){this.offset.click.left=obj.left+this.margins.left;}
if("right"in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if("top"in obj){this.offset.click.top=obj.top+this.margins.top;}
if("bottom"in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){var po=this.offsetParent.offset();if(this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if((this.offsetParent[0]===document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&$.ui.ie)){po={top:0,left:0};}
return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var p=this.element.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.element.css("marginLeft"),10)||0),top:(parseInt(this.element.css("marginTop"),10)||0),right:(parseInt(this.element.css("marginRight"),10)||0),bottom:(parseInt(this.element.css("marginBottom"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var over,c,ce,o=this.options;if(!o.containment){this.containment=null;return;}
if(o.containment==="window"){this.containment=[$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,$(window).scrollLeft()+$(window).width()-this.helperProportions.width-this.margins.left,$(window).scrollTop()+($(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return;}
if(o.containment==="document"){this.containment=[0,0,$(document).width()-this.helperProportions.width-this.margins.left,($(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return;}
if(o.containment.constructor===Array){this.containment=o.containment;return;}
if(o.containment==="parent"){o.containment=this.helper[0].parentNode;}
c=$(o.containment);ce=c[0];if(!ce){return;}
over=c.css("overflow")!=="hidden";this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=c;},_convertPositionTo:function(d,pos){if(!pos){pos=this.position;}
var mod=d==="absolute"?1:-1,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent;if(!this.offset.scroll){this.offset.scroll={top:scroll.scrollTop(),left:scroll.scrollLeft()};}
return{top:(pos.top+
this.offset.relative.top*mod+
this.offset.parent.top*mod-
((this.cssPosition==="fixed"?-this.scrollParent.scrollTop():this.offset.scroll.top)*mod)),left:(pos.left+
this.offset.relative.left*mod+
this.offset.parent.left*mod-
((this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():this.offset.scroll.left)*mod))};},_generatePosition:function(event){var containment,co,top,left,o=this.options,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,pageX=event.pageX,pageY=event.pageY;if(!this.offset.scroll){this.offset.scroll={top:scroll.scrollTop(),left:scroll.scrollLeft()};}
if(this.originalPosition){if(this.containment){if(this.relative_container){co=this.relative_container.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top];}
else{containment=this.containment;}
if(event.pageX-this.offset.click.left<containment[0]){pageX=containment[0]+this.offset.click.left;}
if(event.pageY-this.offset.click.top<containment[1]){pageY=containment[1]+this.offset.click.top;}
if(event.pageX-this.offset.click.left>containment[2]){pageX=containment[2]+this.offset.click.left;}
if(event.pageY-this.offset.click.top>containment[3]){pageY=containment[3]+this.offset.click.top;}}
if(o.grid){top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?((top-this.offset.click.top>=containment[1]||top-this.offset.click.top>containment[3])?top:((top-this.offset.click.top>=containment[1])?top-o.grid[1]:top+o.grid[1])):top;left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?((left-this.offset.click.left>=containment[0]||left-this.offset.click.left>containment[2])?left:((left-this.offset.click.left>=containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY-
this.offset.click.top-
this.offset.relative.top-
this.offset.parent.top+
(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():this.offset.scroll.top)),left:(pageX-
this.offset.click.left-
this.offset.relative.left-
this.offset.parent.left+
(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():this.offset.scroll.left))};},_clear:function(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval){this.helper.remove();}
this.helper=null;this.cancelHelperRemoval=false;},_trigger:function(type,event,ui){ui=ui||this._uiHash();$.ui.plugin.call(this,type,[event,ui]);if(type==="drag"){this.positionAbs=this._convertPositionTo("absolute");}
return $.Widget.prototype._trigger.call(this,type,event,ui);},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs};}});$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui){var inst=$(this).data("ui-draggable"),o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[];$(o.connectToSortable).each(function(){var sortable=$.data(this,"ui-sortable");if(sortable&&!sortable.options.disabled){inst.sortables.push({instance:sortable,shouldRevert:sortable.options.revert});sortable.refreshPositions();sortable._trigger("activate",event,uiSortable);}});},stop:function(event,ui){var inst=$(this).data("ui-draggable"),uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;inst.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert){this.instance.options.revert=this.shouldRevert;}
this.instance._mouseStop(event);this.instance.options.helper=this.instance.options._helper;if(inst.options.helper==="original"){this.instance.currentItem.css({top:"auto",left:"auto"});}}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",event,uiSortable);}});},drag:function(event,ui){var inst=$(this).data("ui-draggable"),that=this;$.each(inst.sortables,function(){var innermostIntersecting=false,thisSortable=this;this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){innermostIntersecting=true;$.each(inst.sortables,function(){this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this!==thisSortable&&this.instance._intersectsWith(this.instance.containerCache)&&$.contains(thisSortable.instance.element[0],this.instance.element[0])){innermostIntersecting=false;}
return innermostIntersecting;});}
if(innermostIntersecting){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=$(that).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return ui.helper[0];};event.target=this.instance.currentItem[0];this.instance._mouseCapture(event,true);this.instance._mouseStart(event,true,true);this.instance.offset.click.top=inst.offset.click.top;this.instance.offset.click.left=inst.offset.click.left;this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset.parent.top;inst._trigger("toSortable",event);inst.dropped=this.instance.element;inst.currentItem=inst.element;this.instance.fromOutside=inst;}
if(this.instance.currentItem){this.instance._mouseDrag(event);}}else{if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",event,this.instance._uiHash(this.instance));this.instance._mouseStop(event,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();if(this.instance.placeholder){this.instance.placeholder.remove();}
inst._trigger("fromSortable",event);inst.dropped=false;}}});}});$.ui.plugin.add("draggable","cursor",{start:function(){var t=$("body"),o=$(this).data("ui-draggable").options;if(t.css("cursor")){o._cursor=t.css("cursor");}
t.css("cursor",o.cursor);},stop:function(){var o=$(this).data("ui-draggable").options;if(o._cursor){$("body").css("cursor",o._cursor);}}});$.ui.plugin.add("draggable","opacity",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("ui-draggable").options;if(t.css("opacity")){o._opacity=t.css("opacity");}
t.css("opacity",o.opacity);},stop:function(event,ui){var o=$(this).data("ui-draggable").options;if(o._opacity){$(ui.helper).css("opacity",o._opacity);}}});$.ui.plugin.add("draggable","scroll",{start:function(){var i=$(this).data("ui-draggable");if(i.scrollParent[0]!==document&&i.scrollParent[0].tagName!=="HTML"){i.overflowOffset=i.scrollParent.offset();}},drag:function(event){var i=$(this).data("ui-draggable"),o=i.options,scrolled=false;if(i.scrollParent[0]!==document&&i.scrollParent[0].tagName!=="HTML"){if(!o.axis||o.axis!=="x"){if((i.overflowOffset.top+i.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity){i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop+o.scrollSpeed;}else if(event.pageY-i.overflowOffset.top<o.scrollSensitivity){i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop-o.scrollSpeed;}}
if(!o.axis||o.axis!=="y"){if((i.overflowOffset.left+i.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity){i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft+o.scrollSpeed;}else if(event.pageX-i.overflowOffset.left<o.scrollSensitivity){i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft-o.scrollSpeed;}}}else{if(!o.axis||o.axis!=="x"){if(event.pageY-$(document).scrollTop()<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);}else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);}}
if(!o.axis||o.axis!=="y"){if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);}else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}}}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(i,event);}}});$.ui.plugin.add("draggable","snap",{start:function(){var i=$(this).data("ui-draggable"),o=i.options;i.snapElements=[];$(o.snap.constructor!==String?(o.snap.items||":data(ui-draggable)"):o.snap).each(function(){var $t=$(this),$o=$t.offset();if(this!==i.element[0]){i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left});}});},drag:function(event,ui){var ts,bs,ls,rs,l,r,t,b,i,first,inst=$(this).data("ui-draggable"),o=inst.options,d=o.snapTolerance,x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(i=inst.snapElements.length-1;i>=0;i--){l=inst.snapElements[i].left;r=l+inst.snapElements[i].width;t=inst.snapElements[i].top;b=t+inst.snapElements[i].height;if(x2<l-d||x1>r+d||y2<t-d||y1>b+d||!$.contains(inst.snapElements[i].item.ownerDocument,inst.snapElements[i].item)){if(inst.snapElements[i].snapping){(inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));}
inst.snapElements[i].snapping=false;continue;}
if(o.snapMode!=="inner"){ts=Math.abs(t-y2)<=d;bs=Math.abs(b-y1)<=d;ls=Math.abs(l-x2)<=d;rs=Math.abs(r-x1)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top;}
if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top-inst.margins.top;}
if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left;}
if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left-inst.margins.left;}}
first=(ts||bs||ls||rs);if(o.snapMode!=="outer"){ts=Math.abs(t-y1)<=d;bs=Math.abs(b-y2)<=d;ls=Math.abs(l-x1)<=d;rs=Math.abs(r-x2)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top-inst.margins.top;}
if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top;}
if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left-inst.margins.left;}
if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left;}}
if(!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)){(inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));}
inst.snapElements[i].snapping=(ts||bs||ls||rs||first);}}});$.ui.plugin.add("draggable","stack",{start:function(){var min,o=this.data("ui-draggable").options,group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0);});if(!group.length){return;}
min=parseInt($(group[0]).css("zIndex"),10)||0;$(group).each(function(i){$(this).css("zIndex",min+i);});this.css("zIndex",(min+group.length));}});$.ui.plugin.add("draggable","zIndex",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("ui-draggable").options;if(t.css("zIndex")){o._zIndex=t.css("zIndex");}
t.css("zIndex",o.zIndex);},stop:function(event,ui){var o=$(this).data("ui-draggable").options;if(o._zIndex){$(ui.helper).css("zIndex",o._zIndex);}}});})(jQuery);(function($){$.support.touch='ontouchend'in document;if(!$.support.touch){return;}
var mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,touchHandled;function simulateMouseEvent(event,simulatedType){if(event.originalEvent.touches.length>1){return;}
event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent('MouseEvents');simulatedEvent.initMouseEvent(simulatedType,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);event.target.dispatchEvent(simulatedEvent);}
mouseProto._touchStart=function(event){var self=this;if(touchHandled||!self._mouseCapture(event.originalEvent.changedTouches[0])){return;}
touchHandled=true;self._touchMoved=false;simulateMouseEvent(event,'mouseover');simulateMouseEvent(event,'mousemove');simulateMouseEvent(event,'mousedown');};mouseProto._touchMove=function(event){if(!touchHandled){return;}
this._touchMoved=true;simulateMouseEvent(event,'mousemove');};mouseProto._touchEnd=function(event){if(!touchHandled){return;}
simulateMouseEvent(event,'mouseup');simulateMouseEvent(event,'mouseout');if(!this._touchMoved){simulateMouseEvent(event,'click');}
touchHandled=false;};mouseProto._mouseInit=function(){var self=this;self.element.bind('touchstart',$.proxy(self,'_touchStart')).bind('touchmove',$.proxy(self,'_touchMove')).bind('touchend',$.proxy(self,'_touchEnd'));_mouseInit.call(self);};})(jQuery);(function($,window,undefined){'$:nomunge';var elems=$([]),jq_resize=$.resize=$.extend($.resize,{}),timeout_id,str_setTimeout='setTimeout',str_resize='resize',str_data=str_resize+'-special-event',str_delay='delay',str_throttle='throttleWindow';jq_resize[str_delay]=250;jq_resize[str_throttle]=true;$.event.special[str_resize]={setup:function(){if(!jq_resize[str_throttle]&&this[str_setTimeout]){return false;}
var elem=$(this);elems=elems.add(elem);$.data(this,str_data,{w:elem.width(),h:elem.height()});if(elems.length===1){loopy();}},teardown:function(){if(!jq_resize[str_throttle]&&this[str_setTimeout]){return false;}
var elem=$(this);elems=elems.not(elem);elem.removeData(str_data);if(!elems.length){clearTimeout(timeout_id);}},add:function(handleObj){if(!jq_resize[str_throttle]&&this[str_setTimeout]){return false;}
var old_handler;function new_handler(e,w,h){var elem=$(this),data=$.data(this,str_data);data.w=w!==undefined?w:elem.width();data.h=h!==undefined?h:elem.height();old_handler.apply(this,arguments);};if($.isFunction(handleObj)){old_handler=handleObj;return new_handler;}else{old_handler=handleObj.handler;handleObj.handler=new_handler;}}};function loopy(){timeout_id=window[str_setTimeout](function(){elems.each(function(){var elem=$(this),width=elem.width(),height=elem.height(),data=$.data(this,str_data);if(width!==data.w||height!==data.h){elem.trigger(str_resize,[data.w=width,data.h=height]);}});loopy();},jq_resize[str_delay]);};})(jQuery,this);Box.Application.addModule('header-embed-widget',function(context){'use strict';var RIGHT_TAB_BUTTON_WIDTH=48,SEARCH_WIDTH_ADDITIONAL_PADDING=5;var v5,dom,$element;return{messages:['x-searchbefore','x-folderchangeafter','x-previeweropen','x-previewerdetailsrefresh','x-previewerclose'],init:function(){v5=context.getService('v5');dom=context.getService('dom');$element=$(context.getElement());},onmessage:function(name,data){var navState=context.getService('nav-state');switch(name){case'x-searchbefore':this.hideHeaderNavigationElements();break;case'x-previeweropen':this.toggleSearch(false);this.configureHeader();break;case'x-folderchangeafter':case'x-previewerdetailsrefresh':this.replaceHeader(data.json);this.configureHeader();this.initializeSearch();break;case'x-previewerclose':if(navState.isSearch()){this.toggleSearch(true);}
this.configureHeader();break;default:}},onclick:function(event,element,elementType){if(element){switch(elementType){case'user-menu-btn':this.toggleUserMenu(event.target);var imageLoader=context.getService('imageloader');imageLoader.loadImages($('#current_user_menu')[0],true);break;case'open-search-btn':this.toggleSearch(true);break;case'cancel-search-btn':this.toggleSearch(false);break;case'clear-search-btn':this.clearSearch();break;case'path-link':context.navigate($(element).attr('href'));break;default:}
event.preventDefault();event.stopPropagation();}},onkeyup:function(event,element,elementType){if(element){if(elementType==='search-form'){if(event.which==13){$element.find('.search_form').submit();event.preventDefault();event.stopPropagation();}}}},onsubmit:function(event,element,elementType){if(element){if(elementType==='search-form'){this.performSearch();event.preventDefault();event.stopPropagation();}}},toggleUserMenu:function(target){var boxMenus=v5.get('Box_Menus'),currentUserMenu=boxMenus.current_user_menu;if(currentUserMenu.visible){currentUserMenu.hide();}else{currentUserMenu.show({target:target});}},clearSearch:function(){var $searchBox=$element.find('#search');$searchBox.val('');setTimeout(function(){$searchBox.focus();},0);},toggleSearch:function(forcedState){var $searchBox=$element.find('#search');if(!$searchBox.length){return false;}
if(($element.hasClass('searching')&&forcedState!==true)||forcedState===false){$element.removeClass('searching');}else{$element.addClass('searching');this.resizeSearchContainer();$searchBox.focus();}},replaceHeader:function(data){var headerHtml;if(data.header_html){headerHtml=$(data.header_html).html();$element.html(headerHtml);}},hideHeaderNavigationElements:function(){$element.find('#header_mast, #header_breadcrumbs').hide();},configureHeader:function(){var navState=context.getService('nav-state');if(navState.isPreviewerOpen()||$element.find('ul.breadcrumb li').length>1){$element.removeClass('at_root_level');}else{$element.addClass('at_root_level');}},resizeSearchContainer:function(){var $searchContainer=$element.find('#search_container'),$searchInputWrap=$element.find('.search_input_wrap'),$searchCancelWrap=$element.find('.search_cancel_wrap'),$searchBox=$element.find('#search'),$otherTabs=$element.find('.nav_button_right_container').filter(':visible').not('#search_tab'),$window=$(v5.get('window')),widthOffset=0;$otherTabs.each(function(){widthOffset+=RIGHT_TAB_BUTTON_WIDTH;});widthOffset+=$searchCancelWrap.outerWidth(true);widthOffset+=$searchInputWrap.outerWidth(true)-$searchBox.width();widthOffset+=$searchContainer.outerWidth(true)-$searchContainer.width();widthOffset+=SEARCH_WIDTH_ADDITIONAL_PADDING;$searchBox.width($window.width()-widthOffset);},initializeSearch:function(){var $searchBox=$element.find('#search'),navState=context.getService('nav-state'),state=navState.get();if(!$searchBox.length){return false;}
if(navState.isSearch()){$searchBox.val(state.searchString);if(!state.isGallery){this.toggleSearch(true);}}else{this.toggleSearch(false);}
this.resizeSearchContainer();},performSearch:function(){var query=$element.find('#search').val(),searchUrl;var navUrl=context.getService('nav-url');query=$.trim(query);if(query.length){searchUrl=navUrl.getSearchUrl(query);context.navigate(searchUrl);}}};});Box.Application.addModule('footer-embed-widget',function(context){'use strict';var LEGAL_POPUP_WIDTH=500,LEGAL_POPUP_HEIGHT=400;var v5,dom,$element;return{init:function(){v5=context.getService('v5');dom=context.getService('dom');$element=$(context.getElement());},onclick:function(event,element,elementType){if(element){if(elementType==='legal-popup-btn'){this.showLegalPopup(element);}
event.preventDefault();event.stopPropagation();}},showLegalPopup:function(element){var url=dom.getData(element,'url'),windowPopup=context.getService('window-popup'),legalPopup;if(url){legalPopup=windowPopup.create(url,{width:LEGAL_POPUP_WIDTH,height:LEGAL_POPUP_HEIGHT});legalPopup.show();}}};});Box.Application.addModule('subheader-embed-widget',function(context){'use strict';var SUBHEADER_TITLE_PADDING=20,TOP_DISABLED_NEW_ITEM_BUTTON_TIP=$t('You do not have permission to create new items in this folder','files_page_new_items_button_disabled_tip'),TOP_DISABLED_UPLOAD_BUTTON_TIP=$t('You do not have permission to upload to this folder','files_page_upload_button_disabled_tip');var v5,dom,$element,openBoxServiceActions;return{messages:['x-folderchangebefore','x-folderchangeafter','x-searchbefore','x-previeweropen','x-previewerclose'],init:function(){v5=context.getService('v5');dom=context.getService('dom');$element=$(context.getElement());openBoxServiceActions=context.getService('openbox-service-actions');openBoxServiceActions.init();},onmessage:function(name,data){switch(name){case'x-folderchangebefore':this.configureSubheader();break;case'x-folderchangeafter':this.handleFolderChangeAfter(data.json);break;case'x-searchbefore':this.updateButtons();this.updateTitleWidth();break;case'x-previeweropen':$element.hide();break;case'x-previewerclose':$element.show();break;}},onclick:function(event,element,elementType){var isDisabled=dom.getNearest(element,'.disabled'),canvas=v5.get('Canvas'),boxMenus=v5.get('Box_Menus');if(element&&!isDisabled){switch(elementType){case'folder-options-btn':canvas.current_folder.show_menu({target:element,type:'containing_folder'});break;case'upload-menu-btn':boxMenus.upload_menu.show({target:element});break;case'create-item-menu-btn':boxMenus.create_item_menu.show({target:element});break;}
event.preventDefault();event.stopPropagation();}},handleFolderChangeAfter:function(data){if(data.current_page_title_html){this.setPageTitleHTML(data.current_page_title_html);}
if(data.paging_html){this.setPagingHTML(data.paging_html);}
this.updateButtons();this.updateNavigation();this.updateTitleWidth();this.setEditableHeader();},configureSubheader:function(){var navState=context.getService('nav-state');var $navOptions=$element.find('#top_corner_folder_options, #nav_upload_item, #create_item_button');if(navState.isSearch()||navState.isTrash()){$navOptions.hide();}else{$navOptions.show();}},setPageTitleHTML:function(pageTitleHTML){$element.find('.title_container').replaceWith(pageTitleHTML);},setPagingHTML:function(pagingHTML){if(pagingHTML.indexOf('paging_menu')!==-1){$element.find('#paging_menu').remove();}
$element.find('#top_pages').html(pagingHTML);},setEditableHeader:function(){var canvas=v5.get('Canvas'),currentFolder=canvas.current_folder,navState=context.getService('nav-state');if(navState.isFiles()&&!navState.isRootFolder()&&(!$.browser.msie||(parseInt($.browser.version)>=9))&&currentFolder&&currentFolder.permissions&&currentFolder.permissions.rename){var page_title_attributes={'data-behavior':'edit_in_place','data-url':'/index.php?rm=box_files_update_item_info','data-field':'name','data-item_id':currentFolder.id,'data-item_type':currentFolder.type,'data-editable_icon_move_right':-15,'data-width':350,'data-update_tooltip_after_edit':true,'data-make_overflow_hidden_element_visible':'page_title','data-validate':'filename not_empty'};$element.find('#page_title').addClass('edit_in_place edit_in_place_inline').attr(page_title_attributes);}},updateButtons:function(){var canvas=v5.get('Canvas'),currentFolder=canvas.current_folder,$uploadNavButtons=$element.find('#upload_button, #nav_upload_item'),$createButton=$element.find('#create_item_button');if(currentFolder&&currentFolder.permissions&&currentFolder.permissions.upload){$createButton.enable().removeAttr('title').removeAttr('data-hover aria-label');if(currentFolder.free_space_amount<=0){$uploadNavButtons.disable();var tooltip=(currentFolder.user_is_owner)?$t('You cannot upload because your account is out of space','js_upload_disable_out_of_space'):$t('You cannot upload because the owner of this folder is out of space','js_upload_disable_owner_out_of_space');$uploadNavButtons.attr({'data-hover':'tooltip','aria-label':tooltip});}else{$uploadNavButtons.enable().removeAttr('title').removeAttr('data-hover aria-label');}}else{$uploadNavButtons.attr({'data-hover':'tooltip','aria-label':TOP_DISABLED_UPLOAD_BUTTON_TIP}).disable();$createButton.attr({'data-hover':'tooltip','aria-label':TOP_DISABLED_NEW_ITEM_BUTTON_TIP}).disable();}},updateTitleWidth:function(){$element.find('.title_container').removeClass('mvn media');$element.find('#page_title').removeClass('ellipsis_halfpage');$element.find('#page_title, #title_section').css('max-width','150px').css('max-width',this.getMaximumTitleWidth());},getMaximumTitleWidth:function(){var optionsWidth=0,window=v5.get('window'),windowWidth=$(window).width();$element.find('.subheader_option:visible').each(function(index,option){optionsWidth+=$(option).outerWidth(true);});return windowWidth-optionsWidth-SUBHEADER_TITLE_PADDING;},updateNavigation:function(){var $pageNav=$element.find('#nav_paging');$pageNav.show();}};});Box.Application.addModule('subheader-previewer-embed-widget',function(context){'use strict';var SUBHEADER_TITLE_PADDING=20;var v5,dom,$element;return{messages:['x-previeweropen','x-previewerclose','x-previewerchangebefore','x-previewerchange'],init:function(){v5=context.getService('v5');dom=context.getService('dom');$element=$(context.getElement());},onmessage:function(name,data){switch(name){case'x-previeweropen':$element.show();break;case'x-previewerclose':$element.hide();break;case'x-previewerchangebefore':this.updateButtons();break;case'x-previewerchange':this.updateButtons();this.updateTitleWidth();break;}},onclick:function(event,element,elementType){var previewer=v5.get('Previewer');var navState=context.getService('nav-state');if(element&&!$(element).hasClass('disabled')){switch(elementType){case'file-options-btn':previewer.current_item().show_menu({target:element});break;case'download-btn':navState.galleryItem().download({no_confirmation:true});break;case'prev-btn':previewer.slideshow('prev');break;case'next-btn':previewer.slideshow('next');break;default:}
event.preventDefault();event.stopPropagation();}},updateButtons:function(){var navState=context.getService('nav-state'),item=navState.galleryItem(),$downloadButton=$element.find('#download_section');if($('body').attr('data-widget-size')==='narrow'){return;}
if(item&&item.type=='file'&&item.extension!='webdoc'&&item.permissions.download){$downloadButton.enable();}else{$downloadButton.disable();}},updateTitleWidth:function(){$element.find('.title_container').removeClass('mvn media');$element.find('#gallery_page_title').removeClass('ellipsis_halfpage');$element.find('#gallery_page_title, #title_section').css('max-width','150px').css('max-width',this.getMaximumTitleWidth());},getMaximumTitleWidth:function(){var optionsWidth=0,window=v5.get('window'),windowWidth=$(window).width();$element.find('.subheader_option:visible').each(function(index,option){optionsWidth+=$(option).outerWidth(true);});return windowWidth-optionsWidth-SUBHEADER_TITLE_PADDING;}};});Box.Application.addModule('page-embed-widget',function(context){'use strict';var MEDIUM_MIN_WIDTH=500,LARGE_MIN_WIDTH=800,ENABLE_COOKIES_WARNING_MESSAGE=$t('This Box widget requires 3rd-party cookies to be enabled. To properly use this widget, please click the button below to enable cookies for Box.','js_popup_enable_cookie_popup'),ENABLE_COOKIES_POPUP_URL='https://'+window.hostname+'/cookies/enable',ENABLE_COOKIES_FORM_TITLE=$t('Enable Cookies on Box','enable_cookies_on_box'),NARROW_MAX_ACTIONS_WIDTH=30,MEDIUM_MAX_ACTIONS_WIDTH=80,LARGE_MAX_ACTIONS_WIDTH=160,IMAGE_AND_PADDING_WIDTH=50,RIGHT_SIDE_EXTRA_SPACE=25,PREVIEWER_HORIZONTAL_PADDING=42,PREVIEWER_HEIGHT_RATIO=2/3,SCROLLBAR_WIDTH=15,AVERAGE_CHARACTER_WIDTH=11;var v5,$window=$(window),$body,delayedSetupIntervalId,notificationsService;function toggleEditInPlace(toggle){var editInPlaceBehaviorHandler;if(typeof toggle==='boolean'){editInPlaceBehaviorHandler=v5.get('Box_Behavior_Handler_Edit_In_Place');if(editInPlaceBehaviorHandler){editInPlaceBehaviorHandler.toggle_edit_in_place(toggle);}}}
function toggleCommentsOnUpload(toggle){var uploadProcess;if(typeof toggle==='boolean'){uploadProcess=v5.get('Upload_Process');if(uploadProcess){uploadProcess.set_show_comments_on_upload(toggle);}}}
function setNarrowConfig(){$body.addClass('widget_narrow use_small_modals');$body.attr('data-widget-size','narrow');toggleEditInPlace(false);toggleCommentsOnUpload(false);}
function setMediumConfig(){$body.addClass('widget_medium use_small_modals');$body.attr('data-widget-size','medium');toggleEditInPlace(false);toggleCommentsOnUpload(true);}
function setLargeConfig(){$body.addClass('widget_large');$body.attr('data-widget-size','large');toggleEditInPlace(true);toggleCommentsOnUpload(true);}
function getActionListWidth(){if($body.attr('data-widget-size')==='large'){return LARGE_MAX_ACTIONS_WIDTH;}else if($body.attr('data-widget-size')==='medium'){return MEDIUM_MAX_ACTIONS_WIDTH;}else{return NARROW_MAX_ACTIONS_WIDTH;}}
function getMaxItemNameWidth(){var windowWidth=$window.width();return parseInt(windowWidth-getActionListWidth()-IMAGE_AND_PADDING_WIDTH-RIGHT_SIDE_EXTRA_SPACE-SCROLLBAR_WIDTH);}
function getMinimumTooltipCharacterLength(maxItemWidth){if($body.attr('data-widget-size')==='large'){return 0;}
return parseInt(maxItemWidth/AVERAGE_CHARACTER_WIDTH);}
function getMaximumDescriptionWidth(){var windowWidth=$window.width();return parseInt(windowWidth-PREVIEWER_HORIZONTAL_PADDING-SCROLLBAR_WIDTH);}
function getMaximumPreviewerHeight(){var windowHeight=$window.height();return parseInt(windowHeight*PREVIEWER_HEIGHT_RATIO);}
return{messages:['x-searchbefore','x-previeweropen','x-previewerclose','x-previewerchange','x-folderchangeafter','viewchange'],init:function(){v5=context.getService('v5');$body=$('body');notificationsService=context.getService('notifications');if($body.is(':visible')){this.setup();}else{this.delayedSetup();}},onmessage:function(name,data){switch(name){case'x-previewerchange':case'x-searchbefore':case'x-folderchangeafter':this.scrollToTop();break;case'x-previeweropen':this.scrollToTop();if($body.attr('data-widget-size')==='medium'){toggleEditInPlace(true);}
break;case'x-previewerclose':if($body.attr('data-widget-size')==='medium'){toggleEditInPlace(false);}
break;case'viewchange':if(data.view==='icon'){this.enableDragToSelect();}else{this.disableDragToSelect();}
break;}},setup:function(){var config=context.getConfig();this.setSizeConfig();this.setThemeClass();this.setItemListConstraints();this.setDescriptionConstraint();this.setPreviewerConstraints();this.checkForCookies();this.bindResizeHandler();if(config.is_session_expired){this.showSessionExpiredNotification();}
if(config.is_security_validation_required){this.showSecurityValidationBlocker();}
this.hideLoadingBlocker();context.broadcast('x-embedsetupdone');},delayedSetup:function(){var me=this;delayedSetupIntervalId=setInterval(function(){if($body.is(':visible')){clearInterval(delayedSetupIntervalId);me.setup();}},1000);},bindResizeHandler:function(){var me=this;$window.on('resize',function(){me.setSizeConfig();me.setItemListConstraints();me.setDescriptionConstraint();me.setPreviewerConstraints();});},setThemeClass:function(){var widgetTheme=v5.get('widget_theme');$body.addClass(widgetTheme);$body.attr('data-widget-theme',widgetTheme);},setSizeConfig:function(){var windowWidth=$window.width();$body.removeClass('widget_narrow widget_medium widget_large use_small_modals');$body.addClass('embed_widget');if(windowWidth<MEDIUM_MIN_WIDTH){setNarrowConfig();}else if(windowWidth<LARGE_MIN_WIDTH){setMediumConfig();}else{setLargeConfig();}},setItemListConstraints:function(){var $itemList=$('#mod-item-list'),maxItemNameWidth=getMaxItemNameWidth(),minTooltipCharacterLength=getMinimumTooltipCharacterLength(maxItemNameWidth);$itemList.attr('data-max-item-width',maxItemNameWidth);if(minTooltipCharacterLength){$itemList.attr('data-min-tooltip-character-length',minTooltipCharacterLength);}},setDescriptionConstraint:function(){var maxDescriptionWidth=getMaximumDescriptionWidth();$('.item_description_container').attr('data-max-description-width',maxDescriptionWidth);},setPreviewerConstraints:function(){$('#gallery').attr('data-max-previewer-height',getMaximumPreviewerHeight());},showEnableCookiesPopup:function(){var theme=$body.attr('data-widget-theme'),popupWarning;popupWarning=[{type:'html',data:$('<p />').text(ENABLE_COOKIES_WARNING_MESSAGE)},{type:'buttons',items:[{value:$t('Enable','enable'),click:function openEnableCookiesPopup(){var windowPopup=context.getService('window-popup'),enableCookiesPopup;enableCookiesPopup=windowPopup.create(ENABLE_COOKIES_POPUP_URL,{location:0,queryParams:{theme:theme}});enableCookiesPopup.show();}}]}];$.popup.form(ENABLE_COOKIES_FORM_TITLE,popupWarning,{required:true});},checkForCookies:function(){var cookies=context.getService('cookies'),browser;if(!cookies.isEnabled()){browser=context.getService('browser');if(browser.isSafari()){this.showEnableCookiesPopup();}}},showSessionExpiredNotification:function(){notificationsService.warn($t('Your session has expired. We have redirected you to the original folder.','js_embed_widget_session_expired'));},showSecurityValidationBlocker:function(){var securityDragAndDropService=context.getService('security-draganddrop');securityDragAndDropService.init();securityDragAndDropService.on('success',function(){securityDragAndDropService.destroy();});securityDragAndDropService.execute();},hideLoadingBlocker:function(){$('#embed_widget_loader').fadeOut(200);},scrollToTop:function(){$('#main_content').scrollTop(0);},enableDragToSelect:function(){var selectables=v5.get('selectables');$('body').removeClass('disable_selectable');if(selectables){selectables.scrollOffsetElement='#main_content';}},disableDragToSelect:function(){$('body').addClass('disable_selectable');},_setWindow:function(windowObj){$window=$(windowObj);}};});Box.Application.addModule('item-list',function(context){'use strict';var v5,dom,$element,fakeItemsPlaceholder,$emptyPlaceholder,fakeItemsSet;function isEmptyFolder(data){var hasNodes=data.nodes&&data.nodes.length>0,hasItems=data.items&&data.items.length>0;return!hasNodes&&!hasItems;}
function isItemCollectionEmpty(){var itemListEl=dom.query('#item-list',$element);return itemListEl.childNodes.length===0;}
function setupUploadButtonForEmptyPage(){var canvas=v5.get('Canvas'),uploadProcess=v5.get('Upload_Process'),$uploadButton=$emptyPlaceholder.find('.upload_button');if($uploadButton&&$uploadButton.length>0){uploadProcess.add_trigger({element:$uploadButton,folder:canvas.current_folder,over_callback:function(){$uploadButton.addClass('hover');},out_callback:function(){$uploadButton.removeClass('hover');},handle_change:function(input,params)
{uploadProcess.handle_change(input,params);}});}}
function showChild(selector){$emptyPlaceholder.show();$emptyPlaceholder.find('.empty').hide();$(selector).show();setupUploadButtonForEmptyPage();}
return{messages:['x-searchbefore','x-folderchangeafter','x-previewerdetailsrefresh','x-itemrefresh','x-embedsetupdone','viewchange','x-searchafter','x-collabchange','x-uploadstarted','x-uploadcanceled','x-uploadupdate','x-newversionupload'],behaviors:['item'],init:function(){v5=context.getService('v5');dom=context.getService('dom');$element=$(context.getElement());$emptyPlaceholder=$(dom.query('#empty-placeholder',$element[0]));fakeItemsPlaceholder=dom.query('#item-list',$element[0]);fakeItemsSet={};},destroy:function(){this.resetFakeItems();},onmessage:function(name,data){switch(name){case'x-searchbefore':if(!data.isPreloaded){$element.find('#item-list').empty();if(data.query&&data.query.length>0){this.showSearchLoading(data.query);}else{this.showEmptySearch();}}
this.resetFakeItems();break;case'x-searchafter':if(data.json&&(data.json.item_count>0||data.json.total_count>0)){$emptyPlaceholder.hide();}else{this.showEmptyFiles();}
this.resetFakeItems();this.deferredImageLoader();break;case'x-folderchangeafter':this.handleFolderChangeAfter(data.json);this.deferredImageLoader(data.json.first_load);this.resetFakeItems();break;case'x-embedsetupdone':case'x-previewerdetailsrefresh':if($element.attr('data-max-item-width')){this.resizeItemRows('.item');}
break;case'x-itemrefresh':if($element.attr('data-max-item-width')){this.resizeItemRows('#c0_'+data.item.typed_id);}
this.deferredImageLoader();if(!isItemCollectionEmpty()){this.hideEmptyFiles();}
break;case'viewchange':this.deferredImageLoader(data.firstLoad);this.resetFakeItems();break;case'x-uploadstarted':this.hideEmptyFiles();break;case'x-uploadupdate':this.updateFakeItem('upl_'+data.item.id,data.item,data.isVisible);this.hideEmptyFiles();break;case'x-newversionupload':if(!data.skipRender){this.replaceFakeItem('upl_'+data.item.id,data.item,data.html,data.isVisible);this.hideEmptyFiles();}
break;case'x-uploadcanceled':if(isItemCollectionEmpty()){this.showEmptyFiles();this.resetFakeItems();}
break;case'x-collabchange':this.updateBlueAndYellowFolderIcons(data);break;}},handleFolderChangeAfter:function(data){var navState=context.getService('nav-state');if(isEmptyFolder(data)){$element.find('#item-list').empty();}else{if($element.attr('data-max-item-width')){this.resizeItemRows('.item');}
this.bindFolderUpload();}
if(data&&isEmptyFolder(data)){if(data.empty_html){this.setEmptyFilesHTML(data.empty_html);}
this.showEmptyFiles();if(navState.isTrash()){this.showTrashMessage();}
this.bindEmptyFolderUpload();}else{$emptyPlaceholder.hide();}},deferredImageLoader:function(firstLoad){if(typeof firstLoad==='undefined'||!firstLoad){var imageLoader=context.getService('imageloader');imageLoader.loadImages(context.getElement());}},bindFolderUpload:function(){var uploadProcess=v5.get('Upload_Process');if(uploadProcess){uploadProcess.ajax_dnd_dropzone=$element;}},expandComments:function(item){item.expansion.toggle('Item_Feed');$(item.element).find('.action_list').addClass('on');},updateBlueAndYellowFolderIcons:function(data){var canvas=v5.get('Canvas'),items=canvas.collections[0].items,toYellow=data&&data.last_collab,$item,$thumb_large,$thumb_small;for(var i=0;i<items.length;i++){$item=$(items[i].element);$thumb_large=$item.find('.thumb_large');$thumb_small=$item.find('.thumb_small');if(items[i].type!='folder'){continue;}
if(items[i].collaborators_count==1){continue;}
if(toYellow){$thumb_large.addClass('sprite_48x48_folder');$thumb_large.removeClass('sprite_48x48_collab_folder');$thumb_small.addClass('sprite_32x32_folder');$thumb_small.removeClass('sprite_32x32_collab_folder');}else{$thumb_large.removeClass('sprite_48x48_folder');$thumb_large.addClass('sprite_48x48_collab_folder');$thumb_small.removeClass('sprite_32x32_folder');$thumb_small.addClass('sprite_32x32_collab_folder');}}},expandAllComments:function(){var canvas=v5.get('Canvas'),collection=canvas.collections[canvas.collections.length-1],me=this;if(collection){$.each(collection.items,function(index,item){me.expandComments(item);});}},resizeItemRows:function(selector){var maxItemNameWidth=$element.attr('data-max-item-width'),minNameTooltipCharacterLength=$element.attr('data-min-tooltip-character-length');$element.find(selector).each(function(i,item){var $item=$(item),$name=$item.find('.item_name_text'),$description=$item.find('.description_text_container'),$excerpt=$item.find('.item_excerpt');$name.css('width',maxItemNameWidth);$description.css('width',maxItemNameWidth);$excerpt.css('width',maxItemNameWidth);if(minNameTooltipCharacterLength){if($name.text().length>minNameTooltipCharacterLength){$name.attr({'data-hover':'tooltip','aria-label':$name.text()});}}});},showEmptyFiles:function(){var animations=context.getService('animations'),browser=context.getService('browser');showChild('#empty_files');animations.openElement($element.find('.empty_state_box')[0],null,null,function showDndText(){if(browser.canUseHtml5Dnd()){$element.find('.empty_state_dnd_text').show();}});},hideEmptyFiles:function(){var animations=context.getService('animations');animations.closeElement($emptyPlaceholder.find('.empty_state_box')[0],null,null,function remove_empty_files(){$emptyPlaceholder.find('#empty_files').hide();});},showEmptySearch:function(){showChild('#empty_search');},showSearchLoading:function(query){$emptyPlaceholder.find('#search_pattern').text(query);$('.search_gif_container_disabled').removeClass('search_gif_container_disabled').addClass('search_gif_container');showChild('#search_loading');},bindEmptyFolderUpload:function(){var uploadProcess=v5.get('Upload_Process'),browser=context.getService('browser'),canvas=v5.get('Canvas'),navState=context.getService('nav-state');if(!uploadProcess){return;}
if(!navState.isTrash()&&navState.isFiles()){var canUseDnd=browser.canUseHtml5Dnd(),canUpload=canvas.current_folder.permissions.upload,canDndFolder=browser.canFolderUpload(),contentElement=dom.query('#empty-folder-content',$element[0]),textUploadCapabilitySelector='none';if(canUpload){var uploadTriggerEl=dom.query('#zero_state_dnd_box',$element[0]),overCallback=null,outCallback=null;if(canUseDnd){uploadProcess.add_dnd_handlers();uploadProcess.ajax_dnd_dropzone=$emptyPlaceholder;}
overCallback=function emptyStateOverCallback(){dom.addClass(uploadTriggerEl,'dashed_outline_medium');};outCallback=function emptyStateOutCallback(){dom.removeClass(uploadTriggerEl,'dashed_outline_medium');};uploadProcess.add_trigger({element:uploadTriggerEl,over_callback:overCallback,out_callback:outCallback,handle_change:function(input,params){uploadProcess.handle_change(input,params);}});if(canDndFolder){textUploadCapabilitySelector='dnd-folder';}else if(canUseDnd){textUploadCapabilitySelector='dnd';}else{textUploadCapabilitySelector='basic';}}
if(contentElement){var textContentEl=dom.query('[data-upload-capability='+textUploadCapabilitySelector+']',contentElement);if(textContentEl){dom.removeClass(textContentEl,'hidden');}}}},setEmptyFilesHTML:function(html){$emptyPlaceholder.find('#empty_files').html(html);},showTrashMessage:function(){var $trashMessages=$emptyPlaceholder.find('#empty_trash_messages');$trashMessages.children().hide();$trashMessages.find('.default').show().find('.trash_time').text(14);},appendFakeItemToItemList:function(html){var items=dom.queryAll('.fake-item',fakeItemsPlaceholder);if(!items.length){$(fakeItemsPlaceholder).prepend(html);}else{$(items[items.length-1]).after(html);}},createFakeItem:function(fakeItemId,item){var fakeItemService=context.getService('fake-item'),fakeItem=fakeItemService.create();fakeItemsSet[fakeItemId]=fakeItem;var itemInitCorrectly=fakeItem.init(item);if(itemInitCorrectly){this.appendFakeItemToItemList(fakeItem.getElement());}else{this.completeFakeItem(fakeItemId);}},updateFakeItem:function(fakeItemId,item,isVisible){if(fakeItemId in fakeItemsSet){fakeItemsSet[fakeItemId].updateItem(item);}else if(isVisible){this.createFakeItem(fakeItemId,item);}},completeFakeItem:function(fakeItemId){if(fakeItemId in fakeItemsSet){fakeItemsSet[fakeItemId].destroy();delete fakeItemsSet[fakeItemId];}},replaceFakeItem:function(fakeItemId,item,html,isVisible){if(isVisible){if(!(fakeItemId in fakeItemsSet)){this.createFakeItem(fakeItemId,item);}
var $item=$(html).addClass('newly-uploaded-item');$(fakeItemsSet[fakeItemId].getElement()).replaceWith($item);}
this.completeFakeItem(fakeItemId);this.renderItem(item.item);},renderItem:function(boxItem){if(boxItem){boxItem.render({init:false,file_view:true,force_render_tags:true,force_render_classes:true});}
if(dom.query('.item',$element[0])==boxItem.element&&v5.get('Upload_Process').show_comments_on_upload){boxItem.expansion.toggle('Item_Feed');}},resetFakeItems:function(){for(var id in fakeItemsSet){if(fakeItemsSet.hasOwnProperty(id)){fakeItemsSet[id].destroy();}}
fakeItemsSet={};}};});var File_Filter_Menu=Abstract_Menu.extend({constructor:function()
{this._e_menu=$j('#file_filter_list').get(0);this.j_menu=$j(this._e_menu);},show:function(params)
{params=params||{};this._j_target_element=$j(params.target);this._callback=params.callback;this.base();},_render:function(params)
{this._remove_selection();this._display_filter_options();var j_current_option=this._get_current_option_link();j_current_option.addClass('selected');},_display_filter_options:function()
{var navState=Box.Application.getService('nav-state'),state=navState.get();this.j_menu.children().children('li').hide();if(state.type==='f')
{this.j_menu.find('#box_file_filter_owned').show();this.j_menu.find('#box_file_filter_deleted').show();}},_get_current_option_link:function()
{var navState=Box.Application.getService('nav-state'),state=navState.get(),filter_type=state.trashFilter||'deleted';return this.j_menu.find('#box_file_filter_'+$.box.escapeHTML(filter_type));},event_click:function(e)
{var navState=Box.Application.getService('nav-state');this._remove_selection();var j_target=$j(e.target);var j_target_option=j_target.closest('li');j_target_option.addClass('selected');var target_option_id=j_target_option.attr('id');if(target_option_id)
{navState.set({trashFilter:target_option_id.split('_')[3]});}
navState.set({page:0});Box.Application.navigate('');},_remove_selection:function()
{this.j_menu.find('.filter_option').removeClass('selected');}},{});var File_Sort_Menu=Abstract_Menu.extend({constructor:function()
{this._e_menu=$j('#file_sort_list').get(0);this.j_menu=$j(this._e_menu);},show:function(params)
{params=params||{};this._j_target_element=$j(params.target);this._callback=params.callback;this.base();},_render:function(params)
{this._remove_selection();this._display_sort_options();var j_current_option=this._get_current_option_link();var sort_direction=this._get_current_sort_direction();this._mark_option_selected(j_current_option,sort_direction);},event_click:function(e)
{var j_target=$j(e.target);var j_target_option=j_target.closest('li');if(j_target_option.hasClass('selected'))
{this._toggle_sort_direction(j_target_option);}
else
{this._change_sort_type(j_target_option);}},_get_offsets:function(params)
{return{x:-5,y:9};},_remove_selection:function()
{this.j_menu.find('.file_sort_option').removeClass('selected');},_display_sort_options:function()
{this.j_menu.children().children('li').hide();var navState=Box.Application.getService('nav-state'),state=navState.get();if(typeof collab_page!='undefined'&&collab_page)
{this.j_menu.find('#file_sort_link_name').show();this.j_menu.find('#file_sort_link_email').show();this.j_menu.find('#file_sort_link_folders').show();}
else if(typeof(corporate_network_page)!='undefined'&&corporate_network_page)
{this.j_menu.find('#file_sort_link_name').show();this.j_menu.find('#file_sort_link_email').show();}
else if(state.type=='s')
{this.j_menu.find('#file_sort_link_relevance').show();this.j_menu.find('#file_sort_link_date').show();this.j_menu.find('#file_sort_link_size').show();}
else if(Canvas.get().current_folder&&Canvas.get().current_folder.is_trash_folder)
{this.j_menu.find('#file_sort_link_deleted').show();this.j_menu.find('#file_sort_link_name').show();this.j_menu.find('#file_sort_link_size').show();}
else
{this.j_menu.find('#file_sort_link_name').show();this.j_menu.find('#file_sort_link_date').show();this.j_menu.find('#file_sort_link_size').show();}},_get_current_option_link:function()
{var sort_type=this._get_current_sort_type();if(sort_type)
{return this.j_menu.find('#file_sort_link_'+$.box.escapeHTML(sort_type));}
return $();},_get_current_sort_type:function()
{var navState=Box.Application.getService('nav-state'),state=navState.get();return state.sort;},_get_current_sort_direction:function()
{var navState=Box.Application.getService('nav-state'),state=navState.get();return state.sortDirection;},_mark_option_selected:function(j_current_option,sort_direction)
{j_current_option.addClass('selected');var j_current_option_arrow=j_current_option.find('.arrow');var arrow_sprite=(sort_direction=='ASC')?'sprite_5x5_menu_arrow_up':'sprite_5x5_menu_arrow';j_current_option_arrow.attr('class','arrow sprite_5x5 '+arrow_sprite);},_get_type_from_clicked_element:function(j_target_option)
{return j_target_option.attr('id').split('_')[3];},_toggle_sort_direction:function(j_target_option)
{var sort_dir=this._get_current_sort_direction();var new_sort_dir;var arrow=j_target_option.find('.arrow');if(sort_dir=='ASC')
{new_sort_dir='DESC';}
else
{new_sort_dir='ASC';}
this._add_arrow_class(arrow,new_sort_dir);var sort_type=this._get_type_from_clicked_element(j_target_option);this._do_sort(sort_type,new_sort_dir);},_change_sort_type:function(j_target_option)
{this._remove_selection();var sort_type=this._get_type_from_clicked_element(j_target_option);var sort_dir=this._get_default_sort_dir(sort_type);j_target_option.addClass('selected');var j_target_option_arrow=j_target_option.find('.arrow');this._add_arrow_class(j_target_option_arrow,sort_dir);this._do_sort(sort_type,sort_dir);},_get_default_sort_dir:function(type)
{var default_sort_dir={'name':'ASC','size':'DESC','date':'DESC'};return default_sort_dir[type];},_do_sort:function(sort_type,sort_dir)
{var navState=Box.Application.getService('nav-state'),state=navState.get();if(state.sort){navState.set({sort:sort_type,sortDirection:sort_dir});}
Box.Application.navigate('');},_add_arrow_class:function(j_arrow,sort_dir)
{var j_last_option_arrows=this.j_menu.find('li').find('.arrow');j_last_option_arrows.attr('class','');j_last_option_arrows.addClass('arrow');if(sort_dir=='ASC')
{j_arrow.addClass('arrow sprite_5x5 sprite_5x5_menu_arrow_up');}
else
{j_arrow.addClass('arrow sprite_5x5 sprite_5x5_menu_arrow');}}},{});var View_Options_Menu=Abstract_Menu.extend({constructor:function(params)
{params=params||{};this._e_menu=$j('#view_options_menu').get(0);},show:function(params)
{if(typeof(Tombstone)!='undefined')Tombstone.marker('./js/menus/box_view_options_menu.js:6685','2013-05-15','auto tombstoned');params=params||{};if(params.type)this.type=params.type;this._j_target_element=$j(params.target);this.base();},_get_offsets:function(params)
{if(typeof(Tombstone)!='undefined')Tombstone.marker('./js/menus/box_view_options_menu.js:6686','2013-05-15','auto tombstoned');return{x:-7,y:-2};},_render:function()
{var j_menu=$j(this._e_menu);j_menu.find('.view_option').removeClass('selected').show();var j_current_option;if(typeof(Canvas.get().view)!='undefined'&&Canvas.get().view=='expanded')
{j_current_option=j_menu.find('#view_option_expanded');}
else
{j_current_option=j_menu.find('#view_option_icon');}
if(j_current_option)
{j_current_option.addClass('selected');}},event_click:function(e)
{var j_target=$j(e.target);var j_target_option=j_target.closest('li');var view=j_target_option.attr('id').split('_')[2];var j_menu=j_target.closest('ul');if(!j_target_option.hasClass('selected'))
{Canvas.get().change_view(view);j_menu.find('li').removeClass('selected');j_target_option.addClass('selected');}}},{});Box.Application.addService('search',function(application){'use strict';function getRequestParams(params){var filterString='',requestParams,navState=application.getService('nav-state');if($.isArray(params.filters)){filterString=navState.getSearchStringFromFilters(params.filters);}
requestParams={page_num:params.page_num,page_size:params.page_size,theme_id:params.theme_id,sort:params.sort,direction:params.direction,view:params.view,search:params.query,filter_list:filterString};return requestParams;}
function getSearchRequestUrl(runmode){return'/index.php?rm='+runmode;}
function performSearchRequest(runmode,requestParams,preloadedResults){var deferred,promise,query,url;if(!requestParams.search||!runmode){return $.Deferred().reject().promise();}
if(preloadedResults){deferred=$.Deferred();deferred.resolve(preloadedResults);promise=deferred.promise();}else{url=getSearchRequestUrl(runmode);query=$.box.formatQuery(requestParams);promise=$.getJSON(url,query);}
return promise;}
function log_full_search(requestParams){var logParams={search_string:requestParams.search};var logService=application.getService('logger');logService.sendLog('search','SEARCH_FULL_SEARCH_START',logParams);}
return{execute:function(params){var requestParams,promise;params=params||{};params.filters=params.filters||[];params.callback=params.callback||function(){};application.broadcast('x-searchbefore',{query:params.query,filters:params.filters,isPreloaded:!!params.preloadedResults});requestParams=getRequestParams(params);promise=performSearchRequest(params.runmode,requestParams,params.preloadedResults);promise.done(params.callback).done(function afterSearchCallback(json){application.broadcast('x-searchafter',{json:json});});log_full_search(requestParams);}};});Box.Application.addService('security-draganddrop',function(application){'use strict';var MINIMUM_WINDOW_WIDTH=270,MINIMUM_WINDOW_HEIGHT=300,SECURITY_DRAG_MAX_WIDTH=1000,SECURITY_PROMPT=$t('You are currently logged into Box. As an additional security measure, %1please drag the cloud into position.%2','js_box_security_additional_step_notification','<span class="strong">','</span>'),ERROR_MESSAGE=$t('The size of your Box widget is too small. The minimum supported dimensions are %1x%2.','js_box_security_window_size_error',MINIMUM_WINDOW_WIDTH,MINIMUM_WINDOW_HEIGHT);var $window,$blocker,$message,$startElement,$endElement,$endLandingElement,service;function showDragAndDropHtml(){$blocker=$('<div id="security_blocker" class="blue_radial_background"/>');$message=$('<div class="security_message blue_linear_gradient"/>').html(SECURITY_PROMPT);$startElement=$('<div id="drag_start_image" class="drag_start_image"/>');$endElement=$('<div id="drag_end_image" class="drag_end_image"/>');$endLandingElement=$('<div id="drag_end_logo" class="drag_end_logo"/>');$blocker.append($message,$startElement,$endElement,$endLandingElement).appendTo('body');}
function showErrorHtml(){$blocker=$('<div id="security_blocker" class="blue_radial_background"/>');$message=$('<div class="security_message blue_linear_gradient"/>').html(ERROR_MESSAGE);$blocker.append($message).appendTo('body');}
function removeHtml(){$blocker.remove();}
function getRandomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
function setRandomLocationForStartElement(){var windowWidth=$window.width(),widthHeight=$window.height(),isDragAreaLimited=windowWidth>SECURITY_DRAG_MAX_WIDTH,minLeft=isDragAreaLimited?(windowWidth/2-SECURITY_DRAG_MAX_WIDTH/2):10,maxLeft=windowWidth/2-$startElement.width(),minTop=$message.height()+$startElement.height(),maxTop=widthHeight-$startElement.height()+10;$startElement.css({left:getRandomInt(minLeft,maxLeft),top:getRandomInt(minTop,maxTop)});}
function setRandomLocationForEndElement(){var windowWidth=$window.width(),widthHeight=$window.height(),isDragAreaLimited=windowWidth>SECURITY_DRAG_MAX_WIDTH,minLeft=windowWidth/2,maxLeft=isDragAreaLimited?(windowWidth/2+SECURITY_DRAG_MAX_WIDTH/2)-$endElement.width():windowWidth-$endElement.width(),minTop=$message.height()+$startElement.height()+$endLandingElement.height()+5,maxTop=widthHeight-$startElement.height()+10,endCoords,endLandingCoords;endCoords={left:getRandomInt(minLeft,maxLeft),top:getRandomInt(minTop,maxTop)};endLandingCoords={left:endCoords.left,top:endCoords.top-($endLandingElement.height()+5)};$endElement.css(endCoords);$endLandingElement.css(endLandingCoords);}
function getDistanceBetweenCenterPoints(elem1,elem2){var $elem1=$(elem1),$elem2=$(elem2),startCenter,endCenter;startCenter={left:$elem1.offset().left+$elem1.width()/2,top:$elem1.offset().top+$elem1.height()/2};endCenter={left:$elem2.offset().left+$elem2.width()/2,top:$elem2.offset().top+$elem2.height()/2};return Math.sqrt(Math.pow(endCenter.left-startCenter.left,2)+Math.pow(endCenter.top-startCenter.top,2));}
function checkDragToCloud(){var distance=getDistanceBetweenCenterPoints($startElement,$endElement);if(distance<40){$startElement.css($endElement.offset());service.fire('success');}}
function bindDragEvents(){$startElement.draggable({containment:'parent'});$startElement.on('dragstop',function(){checkDragToCloud();});}
function isValidWindowSize(){var windowWidth=$window.width(),widthHeight=$window.height();return!(windowWidth<MINIMUM_WINDOW_WIDTH||widthHeight<MINIMUM_WINDOW_HEIGHT);}
service={init:function(windowObj){windowObj=windowObj||window;$window=$(windowObj);},execute:function(){if(isValidWindowSize()){showDragAndDropHtml();setRandomLocationForStartElement();setRandomLocationForEndElement();bindDragEvents();}else{showErrorHtml();}},destroy:function(){$blocker.fadeOut(200,removeHtml);}};return $.extend(service,new Box.EventTarget());});Box.Application.addService('animations',function(application){'use strict';function openCloseAnimate(element,height,opacity,complete_callback,duration,easing){var finalDispParams,animateParams,$element;$element=$(element);finalDispParams={height:height,opacity:opacity};animateParams={duration:duration||'slow',easing:easing||'linear',complete:complete_callback||null};$element.stop().animate(finalDispParams,animateParams);}
function leftRightAnimate(element,left,opacity,complete_callback,duration,easing){var finalDispParams,animateParams,$element;$element=$(element);finalDispParams={left:left,opacity:opacity};animateParams={duration:duration||'slow',easing:easing||'linear',complete:complete_callback||null};$element.stop().animate(finalDispParams,animateParams);}
return{closeElement:function(element,height,opacity,complete_callback,duration,easing){height=height||'hide';opacity=opacity||0;openCloseAnimate(element,height,opacity,complete_callback,duration,easing);},openElement:function(element,height,opacity,complete_callback,duration,easing){height=height||'show';opacity=opacity||1;openCloseAnimate(element,height,opacity,complete_callback,duration,easing);},fadeInElement:function(element,duration){duration=duration||200;$(element).fadeIn(duration);},fadeOutElement:function(element,duration){duration=duration||200;$(element).fadeOut(duration);},animateElementToLeft:function(element,left,opacity,complete_callback,duration,easing){left=left||0;opacity=opacity||0;leftRightAnimate(element,left,opacity,complete_callback,duration,easing);}};});Box.Application.addModule('item-description',function(context){'use strict';var EDIT_IN_PLACE_MESSAGE=$t('Click to edit','edit_in_place_prompt'),EDIT_IN_PLACE_CLASSES='edit_in_place edit_in_place_inline',PLACEHOLDER_CLASS='placeholder',CONTENT_BACKGROUND_CLASS='actions';var v5,$element,$description,dom,type;function nl2br(html){return html.replace(/(\n\r|\n)/g,'<br/>');}
function getCurrentFolder(){var canvas=v5.get('Canvas');return canvas.current_folder;}
function getPreviewerItem(){var previewer=v5.get('Previewer');return previewer.current_item();}
function resetEditInPlaceStyles(){if($description.text()==$description.attr('placeholder')){$element.removeClass(CONTENT_BACKGROUND_CLASS);}else{$element.addClass(CONTENT_BACKGROUND_CLASS);}}
return{messages:['x-folderchangeafter','x-searchbefore','x-previeweropen','x-previewerchange'],init:function(){v5=context.getService('v5');$element=$(context.getElement());$description=$element.find('.item_description');dom=context.getService('dom');type=dom.getData($element[0],'type');},onmessage:function(name,data){var item,folder,description,hasEditPermissions,navState=context.getService('nav-state');switch(name){case'x-folderchangeafter':if(type!=='folder-description'){break;}
folder=getCurrentFolder();if(folder&&folder.id>1){description=folder.description;hasEditPermissions=navState.isFiles()&&folder.permissions.rename;this.handleDescriptionDisplay(description,hasEditPermissions);}else{$element.hide();}
break;case'x-searchbefore':$element.hide();break;case'x-previeweropen':case'x-previewerchange':if(type!=='previewer-description'){break;}
item=getPreviewerItem();if(navState.isSharedFilePage()&&!item.permissions.download){$element.hide();}else if(item&&!navState.isGcm()){description=item.description;hasEditPermissions=item.permissions&&item.permissions.rename;this.handleDescriptionDisplay(description,hasEditPermissions);}else{$element.hide();}
break;}},bindEditInPlace:function(){$description.attr({'data-hover':'tooltip','aria-label':EDIT_IN_PLACE_MESSAGE});$description.addClass(EDIT_IN_PLACE_CLASSES);$description.data('callback',resetEditInPlaceStyles);},unbindEditInPlace:function(){$description.removeAttr('data-hover aria-label');$description.removeAttr('title');$description.removeClass(EDIT_IN_PLACE_CLASSES);$description.removeData('callback');},bindPlaceholder:function(){$description.text($description.attr('placeholder'));$description.addClass(PLACEHOLDER_CLASS);$element.removeClass(CONTENT_BACKGROUND_CLASS);},unbindPlaceholder:function(){$description.removeClass(PLACEHOLDER_CLASS);$element.addClass(CONTENT_BACKGROUND_CLASS);},setDescription:function(description){var stringsService=context.getService('strings');$description.html(nl2br(stringsService.getHyperlinkedString($.box.escapeHTML(description))));},handleDescriptionDisplay:function(description,hasEditPermissions){if(!description||!description.length){$element.hide();}else if(hasEditPermissions){this.showEditableDescription(description);}else if(description&&description.length){this.showDescription(description);}else{$element.hide();}},showDescription:function(description){var maxDescriptionWidth=$element.attr('data-max-description-width');this.setDescription(description);this.unbindEditInPlace();this.unbindPlaceholder();$element.show();if(maxDescriptionWidth){this.setDescriptionWidth(maxDescriptionWidth);}},showEditableDescription:function(description){var maxDescriptionWidth=$element.attr('data-max-description-width');this.setDescription(description);this.bindEditInPlace();if(description&&description.length){this.unbindPlaceholder();}else{this.bindPlaceholder();}
$element.show();if(maxDescriptionWidth){this.setDescriptionWidth(maxDescriptionWidth);}},setDescriptionWidth:function(maxDescriptionWidth){$element.width(maxDescriptionWidth);}};});