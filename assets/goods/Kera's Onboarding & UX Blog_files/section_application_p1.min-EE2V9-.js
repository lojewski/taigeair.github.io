function previewer_loaded(){var e=Previewer.get(),t=setInterval(function(){typeof $j("#player")[0].updateFiles=="function"&&(clearInterval(t),e.set_player($j("#player")[0]),e.show_item({load_on_left:0,load_on_right:0}))},50);if(e.scroll_down_to_tasks){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_previewer.js:16110","2013-05-15","auto tombstoned");var n=e.player.height()+200;$j(window).scrollTop(n),e.scroll_down_to_tasks=!1}}function previewer_go_next_document(){return Previewer.get().slideshow("next")}function previewer_go_previous_document(){return Previewer.get().slideshow("prev")}function previewer_has_next_document(){return Previewer.get().is_valid_state_change("next")}function previewer_has_previous_document(){return Previewer.get().is_valid_state_change("prev")}function previewer_num_documents(){return Previewer.get().item_count||1}function previewer_current_document_index(){return Previewer.get().current_item_display_index()}function previewer_get_link_to_file(){Previewer.get().current_item().sharebar()}function previewer_get_overlay_message(){return typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_previewer.js:16118","2013-05-15","auto tombstoned"),Previewer.get().current_item_overlay_message()}function previewer_can_share(){return Previewer.get().can_share()}function entering_full_screen(){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_previewer.js:16120","2013-05-15","auto tombstoned"),Previewer.get().page_title=document.title}function leaving_full_screen(){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_previewer.js:16121","2013-05-15","auto tombstoned"),document.title=Previewer.get().page_title}function previewer_subscribe_to_item_notifications(e){return Previewer.get().subscribe_to_item_notifications(e)}window.Box=window.Box||{},Box.Timing=Box.Timing||{execution:[],scripts:{}},Box.Timing.scripts.application_p1=(new Date).getTime(),Box.Timing.execution.push({name:"js/services/ajax.js",time:(new Date).getTime()}),Box.Application.addService("ajax",function(e){"use strict";function t(e,t,n){return{status:n.status,data:e}}function n(e,t,n){return{status:e.status,data:e.responseText}}function r(t,n){var r=e.getService("assets"),i=$.Deferred(),s=$.Deferred();return r.loadJSByHash(t,function(){i.resolve()}),r.loadCSSByHash(n,function(){s.resolve()}),$.when(i,s)}function i(i,s,o,u,a){var f={type:i,dataType:s,url:"/index.php?rm="+o,data:u,dataFilter:function(e,t){return e},success:function(n,i,s){if(n.type==="unidb"&&"params"in n){var o=e.getService("unidb");n={data:o.decode(n)}}var u=t(n.data,i,s),f=a.success;r(n.js||[],n.css||[]).done(function(){typeof f=="function"&&(a.context?f.call(a.context,u):f(u))})},error:function(e,t,r){var i=n(e,t,r),s=a.error;typeof s=="function"&&(a.context?s.call(a.context,i):s(i))}};$.ajax(f)}return{get:function(e,t,n){n=n||{},i("GET","json",e,t,{success:n.success,error:n.error,context:n.context})},post:function(t,n,r){r=r||{};if(n.request_token)throw"Request token will be appended automatically and should not passed in manually";n.request_token=e.getService("v5").get("request_token"),i("POST","json",t,n,{success:r.success,error:r.error,context:r.context})}}}),Box.Timing.execution.push({name:"js/services/assets.js",time:(new Date).getTime()}),Box.Application.addService("assets",function(e){"use strict";function i(e){return e?e.replace(/^\//,""):""}function s(){return $('link[rel="stylesheet"], style').length}function o(e){return $.map(e,function(e){var t=document.createElement("link");return t.rel="stylesheet",t.type="text/css",t.href=e,t})}function u(e){var t=$.Deferred(),n=function(){t.resolve()};return"onload"in e?e.onload=n:setTimeout(n,0),t.promise()}function a(e){var t=document.getElementsByTagName("head")[0],n=o(e);return $.map(n,function(e){return t.appendChild(e),u(e)})}function f(e){var t=$('link[rel="stylesheet"]'),n=t[t.length-1];for(var r=0,i=e.length;r<i;r++)n.styleSheet.addImport(e[r]);return e.length?u(n):$.Deferred().resolve()}function l(){var t=e.getGlobalConfig("initialJSHashes")||[];for(var r=0,i=t.length;r<i;r++)n[t[r]]=!0}function c(){var t=e.getGlobalConfig("initialCSSHashes")||[];for(var n=0,i=t.length;n<i;n++)r[t[n]]=!0}var t=31,n={},r={};return{boxCachedAssetIndex:{mini:null,full:null},_assetIndex:function(t){if(this.boxCachedAssetIndex[t]===null){var n=e.getService("v5"),r=null;t=="mini"?r=n.get("assets_index_mini_file"):r=n.get("assets_index_file");var i=this;$.ajax({type:"GET",url:"/"+r,dataType:"text",cache:!0,async:!1,no_context:!0,success:function(e){i.boxCachedAssetIndex[t]={};if(e){var n=e.split("\n");for(var r=0,s=n.length;r<s;r++){var o=n[r].split("	");o.length==2&&o[0].length>0&&(i.boxCachedAssetIndex[t][o[0]]=o[1])}}},error:function(e){$.log("WARN: asset index loading failed with status %s",e.status),i.boxCachedAssetIndex[t]=!1}})}return this.boxCachedAssetIndex[t]},_remoteAssetHash:function(t,n){if(n!="mini"){var r=e.getService("logger"),i={asset:t};r.sendLog("asset_caching","remote_index_load",i)}var s=this._assetIndex(n);return s===!1?!1:s[t]?s[t]:(n!="mini"&&$.log("WARN: unknown asset %s",t),!1)},_assetHash:function(e){return this._remoteAssetHash(e,"mini")||this._remoteAssetHash(e,"full")},_assetPath:function(e){var t=i(e),n=this._assetHash(e);if(n===!1)return!1;var r=t.replace(/(\w+)(\.\w+)?$/,"$1-"+n+"$2");return"/"+r},getFlashAssetURL:function(){var e="/static/flash/";return e},getAssetURL:function(t,n,r){var s=e.getService("v5"),o=s.get("Features"),u=s.get("assets_base");this.boxAssetCachingOffLogged=s.get("box_asset_caching_off_logged"),typeof n=="undefined"&&(n=""),typeof r=="undefined"&&(r=!0);var a=i(t+n),f="/"+u,l="/"+a,c=this._assetPath(a);if(o.no_asset_caching)return this.boxAssetCachingOffLogged||(this.boxAssetCachingOffLogged=!0,$.log("INFO: asset_caching feature off: asset_url('%s') -> '%s' instead of '%s'",a,l,c)),l;if(c===!1)return l;var h;return h=f+c,h},loadJSByHash:function(e,t){var r=[],i;$.isEmptyObject(n)&&l();for(var s in e)n.hasOwnProperty(s)||(r.push(e[s]),n[s]=!0);var o=$.map(r,function(e){var t=$.Deferred(),n=document.createElement("script");return n.readyState?n.onreadystatechange=function(){if(n.readyState=="loaded"||n.readyState=="complete")n.onreadystatechange=null,t.resolve()}:n.onload=function(){t.resolve()},n.src=e,document.body.appendChild(n),t.promise()});$.when.apply($,o).done(t)},loadCSSByHash:function(n,i){var o=[],u,l;$.isEmptyObject(r)&&c();for(var h in n)r.hasOwnProperty(h)||(o.push(n[h]),r[h]=!0);var p=e.getService("browser"),d=p.isIE()&&parseFloat(p.getVersion())<10;if(d){var v=s(),m=Math.min(o.length,Math.max(0,t-v)),g=o.length-m,y=f(o.slice(0,g));l=a(o.slice(g)),l.push(y)}else l=a(o);$.when.apply($,l).done(i)}}}),Box.Timing.execution.push({name:"js/services/at-mention.js",time:(new Date).getTime()}),Box.Application.addService("at-mention",function(e){"use strict";return{bind:function(t){var n=e.getService("v5"),r=n.get("Box_At_Selector"),i;i={j_input:t.inputElement,j_component:t.inputElement.parent(),item_typed_id:t.itemTypedID,show_dropdown_toggler:!1,message_mentioned:t.initialMessage,allow_empty_query:!0},new r(i)},getMessage:function(e){var t,n=e.parent().find(".at_mention_overlay"),r;return t={namesMentioned:[],message:$.trim(e.val()),messageMentioned:null},n.length&&(r=n.find("b"),r.length&&(r.each(function(e,n){var r=$(n),i=(n.textContent||n.innerText).substr(1);r.replaceWith("@["+r.data("user_id")+":"+i+"]"),t.message=t.message.replace("@"+i,i),t.namesMentioned.push({user_id:r.data("user_id"),user_name:i})}),t.messageMentioned=n.html().replace(/<br>/gi,"\n"))),t}}}),Box.Timing.execution.push({name:"js/services/box-edit.js",time:(new Date).getTime()}),Box.Application.addService("box-edit",function(e){"use strict";var t={live:"openbox_service1338",staging:"openbox_service901",dev:"openbox_service1785"},n={gdoc:1,gsheet:1},r={ppt:1,pptx:1,doc:1,docx:1,xls:1,xlsx:1};return{showLaunchingModal:function(t){if(!t)return;var n=e.getService("popups");n.open("box_edit_launch_app",{data:{typed_id:t.typed_id,application_name:this.getNativeApplicationName(t.extension)}})},getBoxEditObject:function(){var e=document.getElementById("boxedit_object");return e===null&&($('<object id="boxedit_object" style="position:fixed; bottom:0; left:0" type="application/x-boxedit" width="1" height="1"><param name="onload" value="pluginLoaded" /></object>').appendTo(document.body),e=document.getElementById("boxedit_object")),e},isFileExtHandledByOpenbox:function(e){return!!n[e]},isBoxEditDisabledByAdmin:function(){return document.getElementById("features_open_on_desktop")===null},isBoxEditInstalled:function(){var e=this.getBoxEditObject();return!!e&&!!e.valid},getNativeApplicationName:function(e){if(!this.isBoxEditInstalled())return"";var t=this.getBoxEditObject();if(t&&t.valid){var n="."+e;return t.app(n)}return""},canUserOpenFileOnDesktop:function(e){return e.permissions.download&&e.permissions.upload&&this.getNativeApplicationName(e.extension)},isBoxEditFullyEnabled:function(e){return this.isBoxEditInstalled()&&this.canUserOpenFileOnDesktop(e)&&!this.isBoxEditDisabledByAdmin()},isExtensionSupportedByDefault:function(e){return!!r[e]},isActionIdBoxEdit:function(n){var r=e.getService("v5"),i=r.get("live_site");if(i){if(n==t.live)return!0}else if(n==t.staging||n==t.dev)return!0;return!1},executeBoxEdit:function(t,n){var r=this;$.getJSON("/index.php?rm=create_open_on_desktop_token",{item_typed_id:n},function(n){var i=n.token,s=r.getBoxEditObject();if(s){var o=e.getService("v5"),u=o.get("Item").find(t);r.showLaunchingModal(u),s.bgp(t+","+i)}})}}}),Box.Timing.execution.push({name:"js/services/browser.js",time:(new Date).getTime()}),Box.Application.addService("browser",function(e){"use strict";function o(){var t=e.getService("v5"),n=t.get("navigator"),i=t.get("opera");r=[{string:n.userAgent,subString:"Chrome",identity:"Chrome"},{string:n.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:n.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:i,identity:"Opera",versionSearch:"Version"},{string:n.vendor,subString:"iCab",identity:"iCab"},{string:n.vendor,subString:"KDE",identity:"Konqueror"},{string:n.userAgent,subString:"Firefox",identity:"Firefox"},{string:n.vendor,subString:"Camino",identity:"Camino"},{string:n.userAgent,subString:"Netscape",identity:"Netscape"},{string:n.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:n.userAgent,subString:"Trident",identity:"Explorer",versionSearch:"rv"},{string:n.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:n.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}]}function u(){var t=e.getService("v5"),n=t.get("navigator");i=[{string:n.platform,subString:"Win",identity:"Windows"},{string:n.userAgent,subString:"iPod",identity:"iOS",device:"iPod"},{string:n.userAgent,subString:"iPhone",identity:"iOS",device:"iPhone"},{string:n.userAgent,subString:"iPad",identity:"iOS",device:"iPad"},{string:n.platform,subString:"Mac",identity:"Mac"},{string:n.userAgent,subString:"Android",identity:"Android"},{string:n.platform,subString:"Linux",identity:"Linux"}]}function a(e){var t,n,r,i,o=null,u=null;for(t=0,n=e.length;t<n;t++){r=e[t].string,i=e[t].prop,s=e[t].versionSearch||e[t].identity;if(r){if(r.indexOf(e[t].subString)!==-1){o=e[t].identity,u=e[t].device;break}}else if(i){o=e[t].identity,u=e[t].device;break}}return{identity:o,device:u}}function f(e){var t=e.indexOf(s),n;if(t===-1)return"";n=e.substring(t+s.length+1).match(/[0-9]+(?:\.[0-9]*)?/);if(n&&n.length)return n[0]}function l(){var t=e.getService("v5"),n=t.get("navigator"),r=n.userAgent.match(/Mac OS X (([\d]+)_([\d]+)_([\d]+))/i);return!r||!r[1]?null:{version:r[1].replace(/_/g,"."),major:parseInt(r[2],10),minor:parseInt(r[3],10),maintenance:parseInt(r[4],10)}}function c(){var e=l();return e?e.version:"Unknown"}function h(){var t=e.getService("v5"),n=t.get("navigator"),r=n.userAgent.match(/Windows NT (([\d]+).([\d]+))/i);if(!r||!r[1])return null;var i=r[1];return i=="5.0"?"2000":i=="5.1"||i=="5.2"?"XP":i=="6.0"?"Vista":i=="6.1"?"7":i=="6.2"?"8":i=="6.3"?"8.1":"Unknown"}function p(){var e;return n.OS==="Mac"?(e=l(),e.major>10||e.major===10&&e.minor>=7):!1}function d(){var t=e.getService("v5"),n=t.get("navigator"),r=n.plugins,i,s,o;if(!r)return!1;r.refresh&&r.refresh(!1);for(i=0,s=r.length;i<r.length;i++){o=r[i];if(o&&o.name.match(/^Java/))return!0}return!1}function v(){var t=e.getService("v5"),n=t.get("ActiveXObject"),r=!1;try{n&&(r=!!(new n("htmlfile")))}catch(i){r=!1}return r}function m(t,n){var r,i=e.getService("v5"),s=i.get("document");if(t.indexOf("audio/")===0)r=s.createElement("audio");else{if(t.indexOf("video/")!==0)return!1;r=s.createElement("video")}return!!r.canPlayType&&r.canPlayType(t).replace(/^no$/,"")===n}var t="9",n,r,i,s="";return n={init:function(){var t=e.getService("v5"),n=t.get("navigator"),s;o(),u(),this.browser=a(r).identity||"An unknown browser",this.version=f(n.userAgent)||f(n.appVersion)||"an unknown version",s=a(i),this.OS=s.identity||"an unknown OS",this.device=s.device||"an unknown device"},getName:function(){return this.browser},getVersion:function(){return this.version},getOSName:function(){return this.OS},getDeviceName:function(){return this.device},getOSVersionName:function(){switch(this.getOSName()){case"Mac":return c();case"Windows":return h();default:return"Unknown"}},isMinBrowser:function(e,t){return this.browser.toLowerCase()===e.toLowerCase()&&parseFloat(this.version)>=parseFloat(t)},isHtml5EnabledIE:function(){var t=e.getService("v5"),n=t.get("document");return!this.isMinBrowser("explorer","10")||!n.documentMode?!1:parseInt(n.documentMode)>=10},isIncompatibleChromeMacCombination:function(){return this.isChrome()&&p()&&!d()},isIncompatibleSafariMacCombination:function(){return n.OS==="Mac"&&this.isSafari()?this.isMinBrowser("safari","6.1"):!1},canUseFlash:function(){var t=e.getService("v5"),n=t.get("swfobject");return this.isIE()&&n?n.hasFlashPlayerVersion("9.28.0"):!1},canUseHtml5:function(){return this.isMinBrowser("firefox","3.6")||this.isMinBrowser("chrome","5")||this.isHtml5EnabledIE()||this.isMinBrowser("safari","4")},canPlayH264:function(){return this.canUseHtml5&&m('video/mp4; codecs="avc1.42E01E"',"probably")},canPlayMP3:function(){return this.canUseHtml5&&m("audio/mpeg","maybe")},canUseHtml5Dnd:function(){return this.isMinBrowser("firefox","3.6")||this.isMinBrowser("chrome","10")||this.isHtml5EnabledIE()||this.isMinBrowser("safari","5")},isSafari:function(){return this.browser.toLowerCase()==="safari"},isFirefox:function(){return this.browser.toLowerCase()==="firefox"},isChrome:function(){return this.browser.toLowerCase()==="chrome"},isIE:function(){return this.browser.toLowerCase()==="explorer"},detectBrowserPlugin:function(t){var n=e.getService("v5"),r=n.get("navigator"),i=r.plugins,s=i.length,o=!1,u,a;if(r.mimeTypes.length===0)if(!v())o=!1;else try{a=new ActiveXObject(t),o=!0}catch(f){o="unknown"}else{for(u=0;u<s;u++)if(i[u].name==t){o=!0;break}if(!o)try{a=new ActiveXObject(t),o=!0}catch(f){}}return o},isBrowserPluginsSupported:function(){var t=e.getService("v5"),n=t.get("navigator");return n&&typeof n.plugins=="object"&&n.plugins.length>0||this.isIE()&&v()},isTransformSupported:function(){var e=!1,t=["transform","webkitTransform","msTransform"],n=document.body;for(var r=0,i=t.length;r<i;r++){e=n.style[t[r]]!==undefined;if(e)break}return e},canFolderUpload:function(){return this.isMinBrowser("chrome","21")},hasMinimumFlashVersion:function(){var n=e.getService("v5"),r=n.get("swfobject"),i=r.getFlashPlayerVersion();return i.major>=parseInt(t)},hasSVGSupport:function(){var t=e.getService("v5"),n=t.get("document");return n.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")},getMinimumFlashVersion:function(){return t},hasPDFSupport:function(){var e=!1;if(!this.isIE())return this.detectBrowserPlugin("Adobe Acrobat")||this.detectBrowserPlugin("Chrome PDF Viewer")||this.detectBrowserPlugin("WebKit built-in PDF");e=this.detectBrowserPlugin("AcroPDF.PDF")||this.detectBrowserPlugin("PDF.PdfCtrl")}},n.init(),n}),Box.Timing.execution.push({name:"js/services/colorpicker.js",time:(new Date).getTime()}),Box.Application.addService("colorpicker",function(e){"use strict";function t(e){this.$element=$(e)}return t.prototype={init:function(e){var t=this.$element,n=t.find(".color-input:first"),r=t.find(".color-sample:first");t.ColorPicker({onSubmit:function(i,s,o){n.val(s.toUpperCase()),r.css("background-color","#"+s.toUpperCase()),t.ColorPickerHide(),e&&e()},onBeforeShow:function(){t.ColorPickerSetColor(n.val())}}),n.on("change.colorpicker",function(){var e=n.val();t.ColorPickerSetColor(e),r.css("background-color","#"+e)})},destroy:function(){var e=this.$element.find(".color-input:first");e.off(".colorpicker")}},{create:function(e){return new t(e)}}}),Box.Timing.execution.push({name:"js/services/connection.js",time:(new Date).getTime()}),Box.Application.addService("connection",function(e){"use strict";var t=e.getService("popups"),n=!0,r=$t("Box is unable to establish a connection to the Internet. Please wait until your computer reconnects, or press Okay to continue now.","js_no_connection_message"),i=new Box.EventTarget;return $(window).on("offline",function(){n&&t.alert(r),n=!1,i.fire("offline")}).on("online",function(){n=!0,i.fire("online"),t.close()}),i.isOnline=function(){return n},i}),Loader.t3Loaded.done(function(){Box.Application.getService("connection")}),Box.Timing.execution.push({name:"js/services/cookies.js",time:(new Date).getTime()}),Box.Application.addService("cookies",function(e){"use strict";var t=window.document;return{_setDoc:function(e){t=e},get:function(e){var n=t.cookie.split("; "),r,i,s;for(i=0,s=n.length;i<s;i++){r=n[i].split("=");if(r[0]===e)return r[1]?decodeURIComponent(r[1]):""}return""},remove:function(e){this.set(e,"",new Date(0))},set:function(e,n,r,i,s,o){var u=new Date,a;typeof r=="undefined"&&(r=u.getTime()+5184e6),u.setTime(r),i=i||"/";var f=Box.Application.getGlobalConfig("cookieDomain");!s&&f?s=f:!s&&typeof cookie_domain!="undefined"&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/services/cookies.js:82","2014-02-10","need to weed out usage of cookie_domain and move it over to globalconfig"),s=cookie_domain),a=e+"="+encodeURIComponent(n)+"; expires="+u.toGMTString()+"; path="+i,s&&(a+="; domain="+s),o&&(a+="; secure"),t.cookie=a},isEnabled:function(){return t.cookie&&t.cookie.length>0}}}),Box.Timing.execution.push({name:"js/services/datetime.js",time:(new Date).getTime()}),Box.Application.addService("datetime",function(e){"use strict";function n(e){var t=new Date;return t.getDate()==e.getDate()&&t.getMonth()==e.getMonth()&&t.getFullYear()==e.getFullYear()}function r(e){return n(new Date(e.getTime()+864e5))}function i(t,n){var r=e.getService("v5");isNaN(parseInt(n,10))&&(n=r.get("user_timezone_offset"));var i=new Date,s=i.getTimezoneOffset()*60,o=n+s,u=(o+parseInt(t,10))*1e3;return new Date(u)}var t=[$t("Jan","Jan_month"),$t("Feb","Feb_month"),$t("Mar","Mar_month"),$t("Apr","Apr_month"),$t("May","May_month"),$t("Jun","Jun_month"),$t("Jul","Jul_month"),$t("Aug","Aug_month"),$t("Sep","Sep_month"),$t("Oct","Oct_month"),$t("Nov","Nov_month"),$t("Dec","Dec_month")];return{setTimeToEOD:function(e){return e.setHours(23),e.setMinutes(59),e.setSeconds(0),e},formatDateToUnixTime:function(e){return e.getTime()/1e3},translateDate:function(t){var n=e.getService("v5");return t=="Today"?$t("Today","js_gallery_date_today"):t=="Yesterday"?$t("Yesterday","js_gallery_date_yesterday"):this.getLocalizedDate(parseInt(t,10),"M d, yy",n.get("user_timezone_offset"),1)},getLocalizedDate:function(e,t,s,o){if(!e)return e;if(isNaN(parseInt(e,10)))return e;t||(t=$.datepicker.RFC_822);var u=i(e,s),a=$.datepicker.formatDate(t,u);return o==1&&(u=new Date(parseInt(e,10)*1e3),n(u)?a=$t("Today","js_gallery_date_today"):r(u)&&(a=$t("Yesterday","js_gallery_date_yesterday"))),a},getDisplayDate:function(e,n){n=$.extend({includeYear:!0,includeTime:!1},n),e=i(e.getTime()/1e3,null);var r=t[e.getMonth()]+" "+e.getDate();return n.includeYear&&(r+=", "+e.getFullYear()),n.includeTime&&(r+=" "+e.toLocaleTimeString()),r},getEpochTime:function(){return Math.floor((new Date).getTime()/1e3)}}}),Box.Timing.execution.push({name:"js/services/dom.js",time:(new Date).getTime()}),Box.Application.addService("dom",function(e){"use strict";function o(e,t){var i;r&&t&&(i=$(e),i.one(n,function(){window.setTimeout(function(){t(e)},0)}))}function u(e,t){!r&&t&&window.setTimeout(function(){t(e)},0)}function a(){var e,s;s=document.createElement("fakeelement");for(e in t)if(typeof s.style[e]!="undefined"){n=t[e];break}r=!!n,i=!0}function f(e,t,n){var r,i,o,u=/\s+/;if(s&&typeof t=="string")if(Array.isArray(e))for(r=0,i=e.length;r<i;r++)f(e[r],t,n);else if(e instanceof HTMLElement){o=t.split(u);for(r=0,i=o.length;r<i;r++)e.classList[n](o[r].trim())}else l(e,t,n);else l(e,t,n)}function l(e,t,n){n==="add"?$(e).addClass(t):n==="remove"&&$(e).removeClass(t)}var t={transition:"transitionend",WebkitTransition:"webkitTransitionEnd"},n=null,r=!1,i=!1,s=typeof document!="undefined"&&"classList"in document.documentElement;return{query:function(e,t){return $(t||document).find(e)[0]},queryAll:function(e,t){return $(t||document).find(e).get()},setHTML:function(t,n){e.stopAll(t),$(t).html(n),e.startAll(t)},remove:function(e){e.parentNode.removeChild(e)},addClass:function(e,t,n){var r=$(e);i||a(),o(e,n),f(e,t,"add"),u(e,n)},hasClass:function(e,t){return s&&e instanceof HTMLElement?e.classList.contains(t):$(e).hasClass(t)},removeClass:function(e,t,n){var r=$(e);i||a(),o(e,n),f(e,t,"remove"),u(e,n)},getNearest:function(e,t){var n=$(e),r=n.is(t);while(!r&&n.length&&!n.hasClass("module"))n=n.parent(),r=n.is(t);return r?n[0]:null},getNearestTypeElement:function(e){return this.getNearest(e,"[data-type]")},getData:function(e,t){return $(e).data(t)},on:function(e,t,n){$(e).on(t,n)},off:function(e,t,n){$(e).off(t,n)},createFragmentFromHtml:function(e){var t=document.createElement("div"),n=document.createDocumentFragment();$(t).html(e);while(t.firstChild)n.appendChild(t.firstChild);return n},getComputedCSS:function(e){var t={},n,r,i=$(e);if(window.getComputedStyle){n=window.getComputedStyle(e,null);if(n){if(n.length)for(var s=0,o=n.length;s<o;s++)r=n[s],t[r]=i.css(r);else for(r in n)t[r]=i.css(r);return t}}if(e.currentStyle){n=e.currentStyle;for(r in n)t[r]=i.css(r);return t}if(e.style){n=e.style;for(r in n)typeof n[r]!="function"&&(t[r]=i.css(r))}return t}}}),Box.Timing.execution.push({name:"js/services/download.js",time:(new Date).getTime()}),Box.Application.addService("download",function(e){"use strict";function s(t,n){var r=e.getService("v5"),i=r.get("additional_context"),s=r.get("request_token"),o,u,a;n=n||{},a=$("#file_download_iframe"),a.length===0&&(a=$('<iframe id="file_download_iframe" name="box-download-target" style="display:none;"></iframe>').appendTo("body")),u=$('<form method="POST" style="display:none;" />').attr({action:t,id:"file_download_form",target:"box-download-target"}).appendTo("body"),i&&(n.additional_context=i),n.request_token=s;for(o in n)$('<input type="hidden">').attr({name:o,value:n[o]}).appendTo(u);return u}function o(t){var n=e.getService("url");n.goToUrl(t)}function u(e,t){return r.getHostValue(e,t,i)}function a(e,t,n){r.setHostValue(e,t,n,i)}function f(e,n,r,i,s,u,f){$.ajax({type:"HEAD",timeout:f,url:r,success:function(){a(s,u,t.getEpochTime()),o(r)},error:function(){a(s,u,-1*t.getEpochTime());var r=i.concat([u]);downloadViaPostWithReachabilityTest(e,n,r)},xhrFields:{withCredentials:!0}})}function l(e,r,i,s,a){if(typeof s!="object"){n.alert($t("Sorry, we couldn't download that file for you. Please try again.","determine_reachable_download_hosts_and_download"));return}var l=s.retest_seconds,c=s.external_ip,h=s.download_host_suggested,p=u(c,h),d=s.timeout_ms;if(!p||Math.abs(p)<t.getEpochTime()-l)f(e,r,i,a,c,h,d);else if(p<0){var v=a.concat([h]);downloadViaPostWithReachabilityTest(e,r,v)}else o(i)}function c(t,n){var r=e.getService("v5"),i=r.get("additional_context"),s=r.get("request_token"),o;t=t||{},i&&(t.additional_context=i),t.request_token=s;for(o in n)t["hosts_to_exclude[]"]=n[o];return t}var t=e.getService("datetime"),n=e.getService("popups"),r=e.getService("reachability"),i="download_host_info";return{downloadViaPostWithReachabilityTest:function(e,t,r){var i=c(t,r);$.ajax({type:"POST",url:e,data:i,success:function(n){var i=$.parseJSON(n),s=i.box_location;i.reachability_test?l(e,t,s,i,r):o(s)},error:function(){n.alert($t("There was an error with this file download, please try again.","download_via_post"))}})},downloadViaPost:function(e,t){var n=s(e,t);n.submit()},downloadViaGet:function(t){var n=e.getService("url");n.goToUrlInBackground(t)}}}),Box.Timing.execution.push({name:"js/services/reachability.js",time:(new Date).getTime()}),Box.Application.addService("reachability",function(e){"use strict";var t={},n=e.getService("cookies");return{getHostValue:function(e,r,i){if(!t[i]){var s=n.get(i);t[i]=s?JSON.parse(s):null}return t[i]===null||t[i][e]===null||t[i][e][r]===null?null:t[i][e][r]},setHostValue:function(e,r,i,s){if(!t[s]){var o=n.get(s);t[s]=o?JSON.parse(o):null}t[s]||(t[s]={}),t[s][e]||(t[s][e]={}),t[s][e][r]=i;var u=JSON.stringify(t[s]);n.set(s,u,(new Date).getTime()+6048e5)},getHostInfo:function(e){return t[e]}}}),Box.Timing.execution.push({name:"js/services/eloqua.js",time:(new Date).getTime()}),Box.Application.addService("eloqua",function(e){"use strict";return{sendEloquaWith:function(e,t,n,r){var i={form_name:e,contact_method:t,referrer_hash:n,additional_form_details:r};$.get("/gen204/_send_eloqua",i)},waitForEloquaGUIDAndSet:function(){var e=null,t=5,n=function(){if(e){if(t===0)return;if(typeof this.GetElqCustomerGUID=="function"){$('input[name="elqCustomerGUID"]').val(GetElqCustomerGUID());return}t-=1}e=setTimeout(n,500)};n(),_elqQ.push(["elqGetCustomerGUID"])}}}),Box.Timing.execution.push({name:"js/services/fullscreen.js",time:(new Date).getTime()}),Box.Application.addService("fullscreen",function(e){"use strict";function n(){t.fire("change"),t.isFullScreen()?t.fire("enter"):t.fire("exit")}var t=$.extend({},new Box.EventTarget);return $(document).on("webkitfullscreenchange mozfullscreenchange MSFullscreenChange fullscreenchange",n),$.extend(t,{isSupported:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled},enter:function(e){var t=$(e).get(0);t.requestFullScreen?t.requestFullScreen():t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen()},exit:function(){typeof document.cancelFullScreen=="function"?document.cancelFullScreen():typeof document.exitFullscreen=="function"?document.exitFullscreen():typeof document.mozCancelFullScreen=="function"?document.mozCancelFullScreen():typeof document.webkitCancelFullScreen=="function"?document.webkitCancelFullScreen():typeof document.msExitFullscreen=="function"&&document.msExitFullscreen()},isFullScreen:function(){return document.fullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement}})}),Box.Timing.execution.push({name:"js/services/imageloader.js",time:(new Date).getTime()}),Box.Application.addService("imageloader",function(e){"use strict";return{loadImages:function(e,t){$(e).find("div, span").filter("[data-background-image]").each(function(e,n){var r=$(n);r.css("display")!=="none"&&r.attr("data-background-image")&&(r.css("background-image","url("+r.attr("data-background-image")+")"),t&&r.css("background-size","100%"),r.removeAttr("data-background-image"))})}}}),Box.Timing.execution.push({name:"js/services/lightbox.js",time:(new Date).getTime()}),Box.Application.addService("lightbox",function(e){"use strict";function d(){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(t[n]);return e.join(" ")}function v(e){f.fire("lightboxactivity",{pageX:e.pageX,pageY:e.pageY})}function m(){var e=document.activeElement.tagName;return e=="INPUT"||e=="TEXTAREA"}function g(e){e.preventDefault(),e.stopPropagation()}function y(){r.removeClass(u[0],"filmstrip_open")}function b(){u.addClass("skip-transitions"),setTimeout(function(){u.removeClass("skip-transitions")},0)}function w(t){t?e.broadcast("previewsidebartoggled"):setTimeout(function(){e.broadcast("previewsidebartoggled")},500)}function E(){var t=e.getService("v5"),n=t.get("Features");if(n.lightbox_feedback_to_zendesk)window.open("https://support.box.com/hc/requests/new","_blank");else{var r=$("#lightbox-send-feedback-btn").attr("data-subject"),i=window.navigator.userAgent,s="\r\n\r\n"+$t("Shared Link: (Please add one if reporting a preview error)","preview_feedback_shared_link_message")+"\r\n"+"User Agent: "+i,o="subject="+encodeURIComponent(r)+"&body="+encodeURIComponent(s);window.open("mailto:preview-feedback@box.com?"+o,"_blank")}}var t={"item-feed":"show-item-feed","preview-metadata":"show-metadata","preview-metadata-read-only":"show-metadata","preview-metadata-service-down":"show-metadata"},n="item-feed",r=e.getService("dom"),i=e.getService("browser"),s=e.getService("fullscreen"),o=e.getService("preview-controls"),u=$("#lightbox"),a,f={},l=[],c=!1,h=n,p="";return f=$.extend(f,new Box.EventTarget),p=d(),$.extend(f,{open:function(){$("html, body").addClass("no_scroll has_lightbox").css("height","auto"),u.off("mousemove").on("mousemove",v),u.off("click").on("click",$.proxy(this.eventClick,this)),u.off("keydown").on("keydown",$.proxy(this.eventKeydown,this)),u.off("contextmenu").on("contextmenu",function(e){e.stopPropagation()});try{u.show().focus()}catch(t){}o.on("fullscreen",this.handleEnterFullscreen),o.on("exitfullscreen",this.handleExitFullscreen),s.on("exit",this.handleExitFullscreen),u.off("dragenter").on("dragenter",g),u.off("dragover").on("dragover",g),u.off("drop").on("drop",g);var n=e.getService("v5"),r=n.get("Toaster");r&&r.is_visible()&&r.hide(),$("#qs_menu").css("display","none")},close:function(){try{u.hide(),this.setContent(""),this.setSidebar(""),this.setHeader(""),y(),this.setFilmstrip(""),h=n,o&&(o.off("fullscreen",this.handleEnterFullscreen),o.off("exitfullscreen",this.handleExitFullscreen)),s&&s.off("exit",this.handleExitFullscreen),$("html, body").removeClass("no_scroll has_lightbox").css("height",""),u.off("keydown"),f.fire("close")}catch(e){}},handleEnterFullscreen:function(){u.addClass("fullscreen"),i.isSafari()&&b();var e=u.find(".content_container");s.enter(e)},handleExitFullscreen:function(){u.removeClass("fullscreen"),s.exit(),u.focus(0)},userClose:function(){this.close(),f.fire("userclose")},eventClick:function(t){var n=$(t.target),r=n.parents(),i=n.add(r);f.fire("lightboxactivity",{pageX:t.pageX,pageY:t.pageY}),i.hasClass("toggle_sidebar_button")?this.toggleSidebar():u.hasClass("fullscreen")&&a=="presentation"&&r.hasClass("content")&&t.which===1&&f.fire("nextpage"),i.hasClass("content_container")&&e.broadcast("closepreviewfilmstrip"),i.is("#lightbox-send-feedback-btn")&&(E(),t.preventDefault()),t.stopPropagation();var s=i.filter("a");if(!s.attr("data-type"))return;t.preventDefault()},eventKeydown:function(e){e.keyCode==27&&(u.hasClass("fullscreen")?s.fire("exit"):r.getNearest(u,".shared_file")||this.userClose());if(!m()){switch(e.keyCode){case 37:f.fire("previouspage");break;case 39:f.fire("nextpage")}i.isFirefox()&&e.keyCode===32&&(e.shiftKey?f.fire("pageup"):f.fire("pagedown"));if(a=="presentation"){switch(e.keyCode){case 38:f.fire("previouspage");break;case 40:f.fire("nextpage")}if(u.hasClass("fullscreen"))switch(e.keyCode){case 13:case 34:case 32:f.fire("nextpage");break;case 33:f.fire("previouspage")}}else if(a=="flash")switch(e.keyCode){case 32:f.fire("toggleplay")}else switch(e.keyCode){case 187:f.fire("zoomin");break;case 189:f.fire("zoomout")}}},eventMousewheel:function(e){var t,n,r;if(a=="presentation"){n=e.originalEvent.wheelDelta,t=n%120===0;for(r=0;r<l.length;r++)if(l[r].originalEvent.wheelDelta%120!==0){t=!1;break}t&&(n>0?f.fire("previouspage"):f.fire("nextpage")),l.push(e),setTimeout(function(){l.shift()},200)}},setContent:function(e){r.setHTML(u.find(".content")[0],e)},setSidebar:function(e){r.setHTML(u.find(".sidebar_inner_container")[0],e)},setHeader:function(e){r.setHTML(u.find(".lightbox_header")[0],e)},setType:function(e){u.off("mousewheel"),a=e,a=="presentation"&&u.on("mousewheel",$.proxy(this.eventMousewheel,this))},showSidebar:function(e){e&&b(),u.addClass("sidebar_open"),w(e),c=!0},hideSidebar:function(e){e&&b(),u.removeClass("sidebar_open"),w(e),c=!1,h=n},isSidebarVisible:function(){return c},toggleSidebar:function(
e){e&&b(),c?this.hideSidebar(e):this.showSidebar(e)},toggleSidebarWithModule:function(e,t){this.isSidebarVisible()?e==h?this.hideSidebar(t):this.setSidebarModule(e):(this.setSidebarModule(e),this.showSidebar(t))},getCurrentSidebarModule:function(){return h},setSidebarModule:function(e){var n=t[e];if(!n)return;var r=u.find(".sidebar");r.removeClass(p),r.addClass(n),h=e},toggleFilmstrip:function(){r.hasClass(u[0],"filmstrip_open")?(y(),e.broadcast("closepreviewfilmstrip")):u.find(".filmstrip").html()===""?e.broadcast("previewfilmstripfirstload",{contentWidth:u.find(".content").width()}):e.broadcast("showpreviewfilmstrip")},setFilmstrip:function(e){r.setHTML(u.find(".filmstrip")[0],e)},openFilmstrip:function(){r.addClass(u[0],"filmstrip_open")},closeFilmstrip:y,focus:function(){$("html, body").hasClass("has_lightbox")&&u.focus()},fail:function(e){var t=e&&e.message?e.message:$t("An error occurred while loading Preview. Please try again later.","preview_server_error"),n='<div id="preview_failiure" class="preview_content_wrapper"><span class="vertical-alignment-helper"></span><div class="inline-block txt_m extra_large white">'+t+"</div></div>";this.setContent(n);var r=this;$("#preview_failiure").click(function(){r.userClose()})}})}),Box.Timing.execution.push({name:"js/services/logger.js",time:(new Date).getTime()}),Box.Application.addService("logger",function(e){"use strict";function i(e,n,r){var i=t+"?"+$.param(e),s=new XMLHttpRequest;typeof n=="function"&&(s.onreadystatechange=function(){if(s.readyState!=4)return;(s.status===200||s.status===204||s.status===1223)&&n()}),s.open("GET",i,!r),s.send()}function s(t){var i=e.getGlobalConfig("debug")?"":n,s=i+r,o=new XMLHttpRequest;o.open("POST",s,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),o.send("data="+JSON.stringify(t))}var t="/gen204",n="https://client-log.box.com",r="/index.php?rm=box_gen204_json_record";return{sendLog:function(e,t,n,r,s,o){n=n||{},s=s||{};var u={category:e,event_type:t,keys_and_values:n,runmode_options:s};i(u,r,o)},sendError:function(t,n){var r=e.getService("browser"),i=r.getName();i==="Explorer"&&(i+="-"+r.getVersion());var o=$.extend({},n,{category:"js_error",event_type:t,metric_name:"webapp.jsErrors",metric_type:"counter",metric_value:1,metric_tags:{browser:i}});s([o])},sendMetric:function(e,t){t=t||{};var n={category:"metrics",event_type:"metrics",keysAndValues:{name:e,value:"+1",type:"counter",tags:t}};i(n)},sendSplitTestLog:function(e,t,n){var r={category:"experiment",event_type:t,keys_and_values:{experiment:e,additional_params:n}};i(r)},sendSplitTestConversion:function(e,t){var n="/index.php?rm=experiment_convert";$.post(n,{experiment:e,event:t})}}}),Box.Timing.execution.push({name:"js/services/menus.js",time:(new Date).getTime()}),Box.Application.addService("menus",function(e){"use strict";function s(e){var t=e.indexOf("top")>-1;return t?"top":"bottom"}function o(e){var t=e.indexOf("right")>-1;return t?"right":"left"}function u(e,t){return t>0?e+="+"+t:t<0&&(e+=t),e}function a(){i||(i=!0,$("body").on("mousedown.menus",function(e){var t=$(e.target);if(t.is(".ignore_mousedown"))return;!t.closest("[aria-haspopup]").length&&!t.closest(".ui-menu").length&&r&&r.isOpen()&&r.hide()}))}function f(){i&&($("body").off("mousedown.menus"),i=!1)}function l(e){this.$menu=$(e),$.extend(this,new Box.EventTarget)}var t='<div class="menu-beak"></div>',n=8,r=null,i=!1;return l.prototype={init:function(){var e=this;this.$menu.menu(),this.$menu.on("menuselect",function(t,n){t.stopPropagation(),t.preventDefault();var r=n.item[0];e.fire("menuselect",r),e.isOpen()&&e.$menu.menu("focus",t,n.item)})},destroy:function(){r==this&&(r=null),this.$menu.off("menuselect"),this.$menu.menu("destroy")},show:function(e,t,n,i){t=t||"",n=n||{},i=i||"auto";var f=parseInt(n.x||0,10),l=parseInt(n.y||0,10),c=$(e),h=c.offset();r&&r.hide();var p=o(t),d=s(t),v=u(p,f),m=u(d==="top"?"bottom":"top",l);this.$menu.show(),this.$menu.width(i),this.$menu.position({my:v+" "+m,at:p+" "+d,of:e,collision:"fit"}),this.$menu.focus();var g=c.offset(),y=g.left!=h.left||g.top!=h.top;y&&this.$menu.position({my:v+" "+m,at:p+" "+d,of:e,collision:"fit"}),this.fire("menushow"),r=this,a()},showWithBeak:function(e,n,r,i,s){s=s||0,this.show(e,n,r,i),this.willBeakHitPositionEl(e)||$(t).prependTo(this.$menu).css("left",s)},hide:function(){r==this&&(r=null),this.fire("menuhide"),this.$menu.hide(),f()},isOpen:function(){return this.$menu.is(":visible")},willBeakHitPositionEl:function(e){var t=e.getBoundingClientRect(),r=t.top+t.height,i=this.$menu.get(0).getBoundingClientRect().top;return r>=i-n}},{create:function(e){return new l(e)},close:function(){r&&r.hide()}}}),Box.Timing.execution.push({name:"js/services/navigation.js",time:(new Date).getTime()}),Box.Application.addService("navigation",function(e){"use strict";function u(t){var n=e.getService("v5"),r=n.get("box").hist_name,i=o[r],s,u,a;for(s=0,u=i.length;s<u;s++){a=t.match(i[s].pattern);if(a)return{name:i[s].name,match:a}}return{}}function a(t){var n=e.getService("v5"),r=e.getService("url"),i=n.get("start_item"),s=n.get("start_gallery_id"),o=n.get("startPage"),a=n.get("box").hist_name,f=u(t),l=f.name,c=f.match,h,p;if(a==="files")switch(l){case"filesPreview":p={type:"f",isGallery:!0,galleryId:c[3],id:c[2],page:c[1]};break;case"folder":p={type:"f",page:c[1],id:c[2],folderName:c[3]};break;case"search":p={type:"s",page:c[2],searchString:r.decodePathComponent(c[1]),searchFilters:c[3]?r.decodePathComponent(c[3]):""};break;case"searchPreview":p={type:"s",isGallery:!0,galleryId:c[3],page:c[1],searchString:r.decodePathComponent(c[2]),searchFilters:""};break;case"pinboardPreview":p={type:"p",page:c[1],pinboardId:c[2],id:c[2],isGallery:!0,galleryId:c[3]};break;case"pinboard":p={type:"p",page:c[1],pinboardId:c[2],id:c[2]};break;case"tagPreview":p={type:"t",page:c[1],tags:r.decodePathComponent(c[2]),id:r.decodePathComponent(c[2]),isGallery:!0,galleryId:c[3]};break;case"tag":p={type:"t",page:c[1],tags:r.decodePathComponent(c[2]),id:r.decodePathComponent(c[2])};break;case"weblink":p={redirect:t};break;default:p={type:"f",id:0}}else if(a==="shared_folder")switch(l){case"sharedSingleItem":case"vanitySingleItem":c[5]?p={page:c[2],id:c[3],isGallery:!0,galleryId:c[4]}:p={page:c[2]};break;case"sharedFolderView":case"vanityFolderView":p={page:c[2],id:c[3]};break;case"sharedRoot":case"vanityRoot":p={page:"1",id:i.substr(2)};break;case"weblink":}else if(a==="collab"){h=r.getQueryParams(t);switch(l){case"corporateNetworkWithPage":p={page:c[1],type:"corporate_network"};break;case"corporateNetworkRoot":p={page:"1",type:"corporate_network"};break;case"collaboratorsWithPage":p={page:c[1],type:"contacts"};break;case"collaboratorsRoot":p={page:"1",type:"contacts"};break;case"searchWithPage":p={page:c[1],type:"contacts",searchString:h.search};break;case"search":p={page:"1",type:"contacts",searchString:h.search}}}else if(a==="user_profile")switch(l){case"preview":p={page:c[2],isGallery:!0,galleryId:c[3]};break;case"specificUserProfileWithPage":p={page:c[2]};break;case"specificUserProfile":case"currentUserProfile":p={page:o||"1",isGallery:!!s,galleryId:s}}else if(a==="inbox")switch(l){case"previewWithFilter":p={page:c[1],type:c[2],isGallery:!0,updateType:c[3],galleryId:c[4]};break;case"previewWithoutFilter":p={page:c[1],type:c[2],isGallery:!0,galleryId:c[3]};break;case"filteredView":p={page:c[1],type:c[2],updateType:c[3]};break;case"defaultView":p={id:"",page:c[1],type:c[2],updateType:""};break;case"email":p={id:c[1],page:0,type:"u"};break;case"startPage":p={type:"a",isGallery:!!s,galleryId:s,updateType:""}}else if(a==="gcm")switch(l){case"gcmFiles":p={type:"gcm_files",gcmUserId:c[1],id:c[2],page:c[3]};break;case"gcmPreviewer":p={type:"gcm_files",gcmUserId:c[1],id:c[2],page:c[3],galleryId:c[4],isGallery:!0};break;case"gcmSearch":p={type:"gcm_search",page:c[2],searchString:r.decodePathComponent(c[1]),searchFilters:c[3]?r.decodePathComponent(c[3]):""};break;case"gcmSearchFile":p={type:"gcm_search",page:c[2],searchString:r.decodePathComponent(c[1]),galleryId:c[3],isGallery:!0};break;case"gcmQuarantinePreview":h=r.getQueryParams(t),p={type:"gcm_quarantine_preview",fileVersionId:c[1],policyId:h.policy_id||0,gcmUserId:h.user_id||0,before_id:h.before_id||0,after_id:h.after_id||0};break;case"gcmQuarantine":h=r.getQueryParams(t),p={type:"gcm_quarantine",page:c[1],policyId:h.policy_id||0,gcmUserId:h.user_id||0,before_id:h.before_id||0,after_id:h.after_id||0};break;case"weblink":p={redirect:t};break;case"gcmLanding":default:p={type:"gcm_users",id:0,page:0}}if(p){var d=e.getService("nav-state"),v=d.createNavObject(p);return v.galleryId&&v.galleryId.substr(0,2)!="f_"&&(v.galleryId="f_"+v.galleryId),v}return null}function f(e,t){var n=e.typed_id,r;return e.collection&&(r=e.collection.items),c({itemTypedID:n,allItems:r,searchFilters:t})}function l(e){return c({itemTypedID:e,allItems:[]})}function c(t){var n=e.getService("v5"),r=n.get("Features"),i=n.get("Previewer"),s=t.itemTypedID,o;return r.lightbox_preview||r.lightbox_preview_enterprises?(e.broadcast("showpreview",t),o=$.Deferred().resolve().promise()):o=i.open_by_id(s),o}function h(){var t=e.getService("v5"),n=t.get("Features"),r=t.get("Previewer");n.lightbox_preview||n.lightbox_preview_enterprises?e.broadcast("closepreview"):r&&r.is_open&&r.close()}function p(){var t=e.getService("nav-state"),n=e.getService("notifications"),r=!0;n.hide(r),t.isShowingFiles()?$("#select_all").show():$("#select_all").hide(),$("#jquery_editable_input").blur()}function d(r,i){var s=e.getService("v5"),o=s.get("box");if(typeof i!="undefined"&&i<n)return;o.load(r),e.broadcast("x-folderchangeafter",{json:r}),t&&(t(r),t=null)}function v(t){var r=e.getService("v5"),i=e.getService("search"),s=r.get("box"),o=r.get("Canvas"),u=r.get("theme_id"),a=(new Date).getTime(),f,l=e.getService("nav-state"),c=l.get();h(),c.searchString&&(p(),e.broadcast("x-folderchangebefore"),n=a,s.after_search_callback=function(e){d(e,a)}),f={runmode:"box_v2_search_item_list",query:c.searchString,page_num:c.page,page_size:o.page_size,theme_id:u,sort:c.sort,direction:c.sortDirection,filters:l.getSearchFiltersFromString(c.searchFilters),callback:$.proxy(s,"after_search_callback"),preloadedResults:t||null},i.execute(f)}function m(t){var n=e.getService("v5"),r=n.get("Canvas"),i=n.get("theme_id"),s={},o=null,u,a=$.Deferred(),f=e.getService("nav-state"),l=f.get();t=t||{};if(f.isSearch()||!f.isSortedBy("relevance")||f.isTag())s.sort=l.sort,s.direction=l.sortDirection;return f.isFiles()?(l.id!=0&&$(".body").removeClass("disable_48x48_sprites"),s.id="d_"+l.id,f.isTrash()?s.filter=l.trashFilter:s.sort==="deleted"&&(delete s.sort,delete s.direction),l.isGallery&&(s.sub_id=l.galleryId,s.sub_type="1")):f.isTag()?s.id="t_"+l.id:f.isSearch()?s.to_search=l.id:f.isPinboard()&&(s.type="p",s.board_id=l.id),s.page_num=t.page!=null?t.page:l.page,r.page_size&&(s.page_size=r.page_size),i&&(s.theme_id=i),u=r.collections.length,s.collection_id=u>0?u-1:u,t.display_on_top_typed_ids&&(s.display_on_top_typed_ids=t.display_on_top_typed_ids),f.isFiles()?o="/index.php?rm=box_item_list":f.isTag()?o="/index.php?rm=box_tag_item_list":f.isPinboard()&&(o="/index.php?rm=box_pin_board_item_list"),t.preloadedResults?(t.preloadedResults.first_load=!0,a.resolve(t.preloadedResults).promise()):$.getJSON(o,$.box.formatQuery(s))}function g(){var t=e.getService("v5"),n=t.get("Loading"),r=".collaborators",i=e.getService("nav-state"),s=i.get();n.create(),i.isCorporateNetwork()&&!s.searchString&&(r=".corporate_network"),$(".tabular_nav a").removeClass("current"),$(".tabular_nav "+r).addClass("current")}function y(t){var n,r,i,s,o=e.getService("nav-state");return o.isCorporateNetwork()&&!t.searchString?n="box_corporate_network_get_data":n="box_collaborators_get_data",r="/index.php?rm="+n,i={page:t.page,sort:t.sort,sort_direction:t.sortDirection,search:t.searchString,collab_tab:1,ajax:!0},t.preloadedResults?s=$.Deferred().resolve(t.preloadedResults).promise():s=$.getJSON(r,$.box.formatQuery(i)),s}function b(t){var n=e.getService("v5"),r=e.getService("nav-state"),i=r.get(),s=i.gcmUserId,o=i.id,u=i.galleryId,a=i.page,f=i.searchString,l=i.searchFilters,c=i.policyId,h=!1;return t.reload_current_page_if_gcm&&(f?t.track_event="search_item_click":t.track_event="middle_pane_click",o>0?h=!1:s>0?h=!1:h=!0),t=$.extend({folder_id:o,file_id:u,page_num:a,user_id:s,search:f,filter_list:l,policy_id:c,no_load_folder_tree:h,no_loading:!1},t),t}function w(t){var n=e.getService("v5"),r=e.getService("search"),i=n.get("box"),s=n.get("Canvas"),o=n.get("theme_id"),u=n.get("Loading"),a=n.get("Previewer"),f=!!t,l,c=e.getService("nav-state"),h=c.get();f?i.load({}):(u.create(),s.scroll_up(),a&&a.is_open&&a.close(),i.hide_user_folder_tree(),$(".body").removeClass("view-gcm view-quarantine").addClass("view-gcm-search")),l={runmode:"box_master_content_folder_list",query:h.searchString,page_num:h.page,page_size:s.page_size,theme_id:o,sort:h.sort,direction:h.sortDirection,filters:c.getSearchFiltersFromString(h.searchFilters),view:"search",callback:$.proxy(i,"after_search_callback"),preloadedResults:t||null},r.execute(l)}function E(t,n){var r={search:t.search,filter_list:t.filter_list,user_id:t.user_id,page_num:t.page_num,track_event:t.track_event},i=e.getService("nav-state");return i.isGcmQuarantine()?r.view="quarantine":i.isGcmSearch()?r.view="search":r.view="item",r.folder_id=t.folder_id||"0",r.user_id=t.user_id||"0",r.policy_id=t.policy_id||"0",n&&n.after_id&&(r.after_id=n.after_id),n&&n.before_id&&(r.before_id=n.before_id),$.box.formatQuery(r)}function S(t,n){var r=e.getService("v5"),i=r.get("box"),s=b(t),o=t.preloadedResults,u=$.Deferred(),a,f,l,c=e.getService("nav-state");return o?(delete o.html,delete o.path_html,a=u.resolve(o).promise()):($(".body").removeClass("view-gcm view-gcm-search view-quarantine"),c.isGcmQuarantine()?($(".body").addClass("view-quarantine"),f="/index.php?rm=box_master_quarantine_json"):($(".body").addClass("view-gcm"),f="/index.php?rm=box_master_content_folder_list"),$("#search").val("").trigger("change"),i.show_user_folder_tree(),l=E(s,n),a=$.getJSON(f,l)),a}function x(t,n){var r=e.getService("v5"),i=r.get("box"),s=r.get("Canvas"),o=i.hist_name,u,a,f,l=e.getService("nav-state"),c=l.get();switch(o){case"files":f=m(t);break;case"user_profile":u=e.getService("updates"),f=u.getForProfilePage({page:c.page?c.page:1,userId:r.get("profile_user_id"),preloadedResults:t.preloadedResults});break;case"inbox":u=e.getService("updates"),f=u.getForUpdatesPage({page:c.page,updateType:c.updateType,preloadedResults:t.preloadedResults});break;case"collab":f=y({page:c.page,sort:c.sort,sortDirection:c.sortDirection,searchString:c.searchString,preloadedResults:t.preloadedResults});break;case"shared_folder":a=e.getService("shared-items"),f=a.getItemsList({folderTypedId:"d_"+c.id,sharedName:r.get("shared_name"),page:c.page>0?c.page:1,page_size:s.page_size,sort:c.sort,sortDirection:c.sortDirection,view:s.view=="icon"?"icon":"expanded",preloadedResults:t.preloadedResults});break;case"gcm":f=S(t,n);break;default:f=$.Deferred().promise()}return f}function T(t){var n=e.getService("v5"),r=n.get("box"),i=r.hist_name;switch(i){case"files":v(t);break;case"gcm":w(t)}}function N(t){var r=e.getService("v5"),i=r.get("box"),s=r.get("Canvas"),o=i.hist_name,u=(new Date).getTime();return n=u,function(e){t||s.scroll_up(),o==="files"?d(e,u):i.load(e)}}function C(){var t=e.getService("v5"),n=t.get("box"),r=n.hist_name;switch(r){case"files":p(),e.broadcast("x-folderchangebefore");break;case"collab":g();break;default:}}function k(t){var n=e.getService("v5"),r=e.getService("url"),i=n.get("box"),s=i.hist_name,o=n.get("path_prefix")?"/"+n.get("path_prefix"):"/",u=n.get("shared_name"),a=n.get("vanity_name"),f=n.get("start_item"),l=n.get("profile_user_id"),c,h=t?t.before_id:null,p=t?t.after_id:null,d,v,m=e.getService("nav-url"),g=e.getService("nav-state"),y=g.get();if(s==="files"){var b=g.getTypeSpecificId(y.type);if(y.isGallery)v=o+"files/"+y.page,y.type==="s"?(c=r.encodePathComponent(y.searchString),v+="/s/"+c+"/1/"+y.galleryId):y.type==="t"?(d=r.encodePathComponent(y.tags),v+="/t/"+d+"/1/"+y.galleryId):y.type==="p"?v+="/p/"+y.pinboardId+"/1/"+y.galleryId:v+="/"+y.type+"/"+y.id+"/1/"+y.galleryId;else if(g.isSearch())v=m.getSearchUrl(y.searchString,y.page,y.searchFilters);else{v=o+"files/"+y.page+"/"+y.type+"/"+r.encodePathComponent(b);if(y.folderName){var w=y.folderName.replace(/([\s\:\/#])+/g,"_");try{w=decodeURIComponent(w)}catch(E){w=w.replace(/%/g,"_")}v+="/"+r.encodePathComponent(w)}}}else if(s==="shared_folder"){u&&!a?u.length==20?v=o+"s/"+u:v=o+"shared/"+u:v=o+a;if(y.isGallery||y.id!=f.substr(2)||y.page!=1)v+="/"+y.page+"/"+y.id;if(y.isGallery){var S=y.galleryId,x=S.indexOf("f_")===0?S.substr(2):S;v+="/"+x+"/1"}}else if(s==="collab")v="/contacts",g.isCorporateNetwork()?v+="/network":y.searchString&&(v+="/search"),y.page&&(v+="/"+y.page),y.searchString&&(v+="?search="+encodeURIComponent(y.searchString));else if(s==="user_profile"){v="/profile";if(y.page||y.id)l&&(v+="/"+l),y.page&&(v+="/page/"+y.page),y.id&&(v+="/"+y.id);y.isGallery&&(v+="/1/"+y.galleryId.substr(2))}else s==="inbox"?(v="/updates/"+y.page+"/"+y.type,y.updateType&&(v+="/"+y.updateType),y.isGallery&&y.galleryId&&(v+="/1/"+y.galleryId.substr(2))):s==="gcm"&&(g.isGcmQuarantine()?v=m.getGcmUrlForQuarantine(y.page,y.policyId,y.gcmUserId,h,p):g.isGcmQuarantinePreview()?v=m.getGcmUrlForQuarantinePreview(y.fileVersionId):g.isGcmSearch()?y.isGallery?v=m.getGcmUrlForSearchPreview(y.searchString,y.page,y.galleryId.substr(2)):v=m.getGcmUrlForSearch(y.searchString,y.page,y.searchFilters):y.isGallery?v=m.getGcmUrlForPreview(y.gcmUserId,y.id,y.page,y.galleryId.substr(2)):v=m.getGcmUrlForFiles(y.gcmUserId,y.id,y.page));A(v)}function L(){var t=e.getService("v5"),n=t.get("window");return n.location.protocol+"//"+n.location.hostname}function A(e){var t=L(),n=History.getState().cleanUrl.substr(t.length);i||(r[e]=!0,History.pushState(null,document.title,e))}var t,n,r={},i=!1,s="",o={collab:[{name:"corporateNetworkWithPage",pattern:new RegExp("/contacts/network/(\\d+)$")},{name:"corporateNetworkRoot",pattern:new RegExp("/contacts/network$")},{name:"collaboratorsWithPage",pattern:new RegExp("/contacts/(\\d+)$")},{name:"collaboratorsRoot",pattern:new RegExp("/contacts(/collaborators)?$")},{name:"searchWithPage",pattern:new RegExp("/contacts/search/(\\d+)")},{name:"search",pattern:new RegExp("/contacts/search")}],files:[{name:"rootFolder",pattern:new RegExp("^/files$")},{name:"filesPreview",pattern:new RegExp("/files(?:/email/[^/]+)?/(\\d+)/f/(\\d+)/1/(\\w+)")},{name:"folder",pattern:new RegExp("/files(?:/email/[^/]+)?/(\\d+)/f/(\\d+)(?:/([^/]+))?")},{name:"search",pattern:new RegExp("/files/search/([^/]+)/(\\d+)(?:/([^/]+))?")},{name:"searchPreview",pattern:new RegExp("/files/(\\d+)/s/([^/]+)/1/(\\w+)")},{name:"pinboardPreview",pattern:new RegExp("/files/(\\d+)/p/(\\d+)/1/(\\w+)")},{name:"pinboard",pattern:new RegExp("/files/(\\d+)/p/(\\d+)")},{name:"tagPreview",pattern:new RegExp("/files/(\\d+)/t/([^/]+)/1/(\\w+)")},{name:"tag",pattern:new RegExp("/files/(\\d+)/t/([^/]+)")},{name:"weblink",pattern:new RegExp("/web_links/\\d+")}],gcm:[{name:"gcmLanding",pattern:new RegExp("/master/content(/0){0,2}$")},{name:"gcmPreviewer",pattern:new RegExp("/master/content/(\\d+)/(\\d+)/(\\d+)/(\\d+)")},{name:"gcmFiles",pattern:new RegExp("/master/content/(\\d+)/(\\d+)/(\\d+)")},{name:"gcmSearchFile",pattern:new RegExp("/master/content/search/([^/]+)/(\\d+)/(\\d+)$")},{name:"gcmSearch",pattern:new RegExp("/master/content/search/([^/]+)/(\\d+)(?:/([^/]+))?")},{name:"gcmQuarantine",pattern:new RegExp("/master/content/quarantine/(\\d+)")},{name:"gcmQuarantinePreview",pattern:new RegExp("/master/content/quarantine/preview/(\\w+)")},{name:"weblink",pattern:new RegExp("/web_links/\\d+")}],user_profile:[{name:"preview",pattern:new RegExp("/profile/(\\d+)/page/(\\d+)/1/(\\d+)")},{name:"specificUserProfileWithPage",pattern:new RegExp("/profile/(\\d+)/page/(\\d+)")},{name:"specificUserProfile",pattern:new RegExp("/profile/(\\d+)")},{name:"currentUserProfile",pattern:new RegExp("/profile")}],shared_folder:[{name:"weblink",pattern:new RegExp("/web_links/\\d+")},{name:"sharedSingleItem",pattern:new RegExp("/s(?:hared)?/(\\w+)/(\\d+)/(\\d+)/(\\d+)/(1)?")},{name:"sharedFolderView",pattern:new RegExp("/s(?:hared)?/(\\w+)/(\\d+)/(\\d+)")},{name:"sharedRoot",pattern:new RegExp("/s(?:hared)?/(\\w+)")},{name:"vanitySingleItem",pattern:new RegExp("^/([^/]+)/(\\d+)/(\\d+)/(\\d+)/(1)?")},{name:"vanityFolderView",pattern:new RegExp("^/([^/]+)/(\\d+)/(\\d+)")},{name:"vanityRoot",pattern:new RegExp("^/([^/]+)")}],inbox:[{name:"previewWithFilter",pattern:new RegExp("/updates/(\\d+)/(\\w+)//?(\\w+)/1/(\\w+)")},{name:"previewWithoutFilter",pattern:new RegExp("/updates/(\\d+)/(\\w+)/1/(\\w+)")},{name:"filteredView",pattern:new RegExp("/updates/(\\d+)/(\\w+)/(\\w+)")},{name:"defaultView",pattern:new RegExp("/updates/(\\d+)/(\\w+)")},{name:"email",pattern:new RegExp("/updates/([^/]*@[^/]*)")},{name:"startPage",pattern:new RegExp("/updates")}]},O={navigate:function(n,r,i){var s=e.getService("v5"),o=s.get("box"),u=s.get("Loading"),c=e.getService("notifications"),p=e.getService("url"),d=s.get("Features"),v=s.get("Item"),m=e.getService("nav-state"),g=s.get("Canvas"),y=m.get(),b=$.extend({},y),w,E,S,L,A=!1,O=!1;i=i||{},A=!!i.preloadedResults;if((!o||!o.hist_name)&&n){p.goToUrl(n);return}t=i.callback||o.after_load_callback,o.after_load_callback=null,!i.no_load_folder_tree&&o.hist_name==="gcm"&&o.load_folder_tree();var M=y.searchFilters;if(n){w=a(n),A?O=!0:w&&(!w.id&&!y.id?O=!0:O=w.id==y.id);if(!w){p.goToUrl(n);return}if(w.redirect){p.goToUrl(w.redirect);return}w.wasGallery=y.isGallery,m.set(w)}else m.setPrevious(),y=m.get(),y.isGallery&&y.wasGallery&&(O=!0);y=m.get(),S=v.find(y.galleryId),g&&(g.target_item=S),L=N(i.not_scroll),(m.isMovingIntoSearch()||m.isMovingOutOfSearch())&&m.resetSort(),y=m.get(),m.isMovingOutOfPreview()&&!i.reload_page_after_preview?h():(m.isSearch()||m.isGcmSearch())&&!y.isGallery?T(i.preloadedResults):y.isGallery&&S&&O||m.isGcmQuarantinePreview()?(y=m.get(),i.preloadedResults&&(e.broadcast("x-folderchangebefore"),L(i.preloadedResults)),m.isGcmQuarantinePreview()?l(y.fileVersionId):f(S,M),t&&(t({}),t=null)):(h(),y=m.get(),c.hide(),u.create(),C(),E=x(i,w),E.done(L).done(t),y=m.get(),y.isGallery&&E.done(function(e){var t=v.find(y.galleryId);t&&f(t,M)})),t=null,i.preloadedResults||k(w)}};return History.Adapter.bind(window,"statechange",function(){var e=L(),t=History.getState(),n=t.cleanUrl.substr(e.length);if(t.data.navState)return;if(typeof r[n]!="undefined"&&r[n]){delete r[n];return}i=!0,O.navigate(n||t.url,{},{no_load_folder_tree:!0}),s=n,i=!1}),O},{exports:["navigate"]}),Box.Timing.execution.push({name:"js/services/notifications.js",time:(new Date).getTime()}),Box.Application.addService("notifications",function(e){"use strict";function b(e){if(h&&!e){var t=$(h);if(t[0])return t}return c||(c=document.getElementById(i)),c}function w(e){e.preventDefault(),d&&d.clickHandler&&d.clickHandler()}function E(e){e.preventDefault(),N()}function S(e){var t=$(b(e));t.delegate(o,"click",w),t.delegate(u,"click",E)}function x(e){var t=$(b(e));t.undelegate(o,"click"),t.undelegate(u,"click")}function T(){var t=$(b()),n=typeof $.fn.stalker!="undefined";g=e.getService("dom"),v=e.getService("v5").get("Box_Confirmation_Message"),S(!0),n&&t.stalker({offset:a,stopCallback:function(){x(!0),c=null,S(!0)}}),p=!0}function N(e){var t,n;p||T(),v!==null&&v.hide(y);if(e&&d&&e!==d.notificationId)return;d&&d.timeoutId&&window.clearTimeout(d.timeoutId),t=$(b()),h&&(x(),h=null),n=t.find(s),g.removeClass(n,f,function(){n.remove()}),d&&d.hideHandler&&(d.hideHandler(),d.hideHandler=null),d=null}function C(){return{type:d.type,title:d.title,description:d.description,descriptionClass:d.description?"":"hidden",actionClass:d.hasAction?"":"hidden",actionText:d.actionText}}function k(e,t,n,r){d={type:e,title:n,description:r?r.description:"",hasAction:r&&r.action,actionText:r&&r.action?r.action.text:"",clickHandler:r&&r.action?r.action.onclick:null,hideHandler:r?r.onhide:null,notificationId:t,timeoutId:null}}function L(){return m++}function A(e){d.timeoutId=window.setTimeout(function(){N(e)},l)}function O(){return d.type===t&&!d.hasAction}function M(t,n,r){var i,o,u,a,l;p||T(),N(),h=r?r.containerNode||null:null,a=L(),k(t,a,n,r),i=e.getService("templates"),o=i.getTemplateFragment("notification",C()),u=$(b()),u.prepend(o),l=u.find(s),window.setTimeout(function(){g.addClass(l,f)},0),O()&&A(a),h&&S()}var t="confirm",n="warn",r="error",i="top_notification",s=".notification_container",o=".notification_action",u=".notification_close",a=93,f="is-open",l=5e3,c,h,p=!1,d=null,v=null,m=0,g=null,y=!0;return{confirm:function(e,n){M(t,e,n)},warn:function(e,t){M(n,e,t)},error:function(e,t){M(r,e,t)},hide:function(){N()},destroy:function(){this.hide(),x()},displayServerNotification:function(){var e,i,o,u;p||T(),e=b(),i=g.query(".pre_rendered",e);if(i){o=L();var a;switch(i.getAttribute("data-type")){case"warn":a=n;break;case"error":a=r;break;default:a=t}k(a,o),u=g.query(s,e),g.addClass(u,f),O()&&A(o)}}}}),Box.Timing.execution.push({name:"js/services/openbox-service-actions.js",time:(new Date).getTime()}),Box.Application.addService("openbox-service-actions",function(e){"use strict";var t=e.getService("v5"),n=t.get("OpenboxAction");return{init:function(){var e=t.get("Canvas");e.logged_in&&this.getActionsFromServer()},getActionsFromServer:function(){var r=e.getService("ajax");r.get("get_openbox_service_actions",{},{success:function(e){var r=t.get("Create_Item_Menu"),i=t.get("Box_Menus");$(document.body).append(e.data.create_item_menu_html),i.create_item_menu=new r,i.map_menu_id_to_menu_object.dd_menu_create_item=i.create_item_menu,n.load(e.data.openbox_actions)}})},loadOpenboxActionOnItemAndExecute:function(t,r){r=r||{};var i=this.getActions(t,{type:"openbox"}),s=null,o=this,u=null;for(var a=0,f=i.length;a<f;a++){u=i[a];if(u.name===r.action_name){s=u;break}}if(s!==null)s.execute();else{var l="/index.php?rm=box_add_service",c={uniq_name:r.uniq_name,return_actions:!0},h=$.box.formatQuery(c);$.postJSON(l,h,function(t){if(t.result!=="success")e.getService("popups").alert($t("This action could not be performed because you do not have permission to use Openbox.","js_services_js_popup_error_no_permission_to_post"));else{var r=t.actions;n.incrementalLoad(r),s=o.createAction("openbox_service"+r[0].id),s.execute()}})}},getDefaultOpenboxAction:function(e,t){var n=this.getActions(e,{executed_by_default:!0,type:"openbox",options:t}),r=null;for(var i=0,s=n.length;i<s;i++){r=n[i];if(r.can_execute())return r}return null},createAction:function(e,n,r,i){var s=t.get("ItemAction"),o=new s({id:n,item:e,options:r,sync:i});return o},getActions:function(e,r){r=r||{};var i=r.type||"all",s=[],o=this,u=t.get("Item"),a=[];if(i==="all"||i==="default")s=s.concat(u.actions);if(i==="all"||i==="openbox")s=s.concat(n.actions);for(var f=0,l=s.length;f<l;f++){var c=s[f],h=null;typeof c=="object"?h=o.createAction(e,c.id,r.options,c.sync):h=o.createAction(e,c,r.options),(!r.executed_by_default||h.executed_by_default)&&a.push(h)}return a}}}),Box.Timing.execution.push({name:"js/services/overlay.js",time:(new Date).getTime()}),Box.Application.addService("overlay",function(e){"use strict";function n(t){var n=e.getService("dom"),r=document.createElement("div");return n.addClass(r,"overlay"),n.addClass(r,"hidden"),n.addClass(r,t),document.body.appendChild(r),r}function r(e,t){if(typeof e=="string")throw new Error("HTML strings not allowed for Overlays - use an HTMLElement or DocumentFragment instead.");this.element=e,this.initialized=!1,this.overlay=n(t.className)}var t=null;return r.prototype={_open:function(n,r,i,s){var o=e.getService("dom");i=i||0,s=s||0,t&&t.close(),t=this,this.initialized?e.startAll(this.overlay):(this.initialized=!0,o.setHTML(this.overlay,this.element));var u={of:n,collision:"none"};r==="below"?(u.my="center top",u.at="center+"+i+" bottom+"+s):r==="left"&&(u.my="right center",u.at="left+"+i+" center+"+s),o.removeClass(this.overlay,"hidden"),$(this.overlay).position(u),this.positionParams=$.extend({},u)},openBelow:function(e,t,n){this._open(e,"below",t,n)},openToLeft:function(e,t,n){this._open(e,"left",t,n)},freezePosition:function(e){this.overlay.style.position="fixed",this.overlay.style.top=e+"px"},unfreezePosition:function(){this.overlay.style.position="absolute",$(this.overlay).position(this.positionParams)},isOpen:function(){var t=e.getService("dom");return!t.hasClass(this.overlay,"hidden")},close:function(){t==this&&(t=null);if(this.isOpen()){var n=e.getService("dom");e.stopAll(this.overlay),n.addClass(this.overlay,"hidden")}},destroy:function(){t==this&&(t=null),this.overlay.parentNode.removeChild(this.overlay)}},{create:function(e,t){return new r(e,t||{})},close:function(){t&&t.close()}}}),Box.Timing.execution.push({name:"js/services/popups.js",time:(new Date).getTime()}),Box.Application.addService("popups",function(e){"use strict";function l(){a=document.getElementById("popup-container"),f=document.getElementById("popup-overlay")}function c(){u.isBlocking=!0}function h(){var e=$(a).find("#popup-title h2");return!!e.text().length}function p(){$(a).find("#popup-title").hide()}function d(t){var n=e.getService("dom");n.setHTML(a,t),h()||p()}function v(){var t=e.getService("dom");t.setHTML(a,"")}function m(){$(a).find("input, textarea, button, select").not("#popup-close-btn").first().focus()}function g(){$(a).find("input, textarea, button, select").not("#popup-close-btn").last().focus()}function y(){var e=$(a),t=$(document).width(),n=e.width(),r=(t-n)/2,i=($(window).height()-e.height())/2;i<5?i=5:i>150&&(i=150);var s=window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;i+=s,e.css({top:i,left:r})}function b(){a.style.display="block",f.style.display="block";var t=e.getService("dom");t.addClass(document.body,"popup-opened"),y(),m()}function w(){a.style.display="none",f.style.display="none";var t=e.getService("dom");t.removeClass(document.body,"popup-opened"),typeof u.onclose=="function"&&u.onclose()}function E(){$(a).addClass("blocked")}function S(){$(a).removeClass("blocked")}function x(){$(a).on("click.popup",'[data-type="confirm-btn"]',function(){typeof u.onconfirm=="function"&&u.onconfirm(),u.isBlocking?E():w()})}function T(){$(a).on("click.popup",'[data-type="cancel-btn"]',function(){typeof u.oncancel=="function"&&u.oncancel(),w()})}function N(){$(a).on("click.popup",'[data-type="close-btn"]',w),$(f).on("click.popup",w)}function C(){$(a).on("keyup.popup",function(t){t.keyCode==27&&(w(),t.stopPropagation(),t.preventDefault())})}function k(){$(a).off("click.popup"),$(f).off("click.popup")}function L(){var e=$(a).find(".popup-accessibility-top-helper"),t=$(a).find(".popup-accessibility-bottom-helper");e.off("focusin.popup").on("focusin.popup",g),t.off("focusin.popup").on("focusin.popup",m)}function A(){a||l(),v(),S(),k(),w(),$.popup&&typeof $.popup.close=="function"&&$.popup.close(),$("body").trigger("popup.open"),u={}}function O(t){var n=e.getService("nav-state");return n.isGcm()&&$.inArray(t,o)>-1?s+"_"+t:i+"_"+t}var t=$t("Okay","js_popup_button_okay"),n=$t("Cancel","js_popup_button_cancel"),r=$t("An error has occurred while loading this feature","js_popup_failure_message"),i="box_popup",s="box_popup_gcm",o=["quarantined_file","collaborate"],u={},a,f;return{alert:function(t,n){var r=e.getService("templates"),i;n=n||{},A(),i=r.getTemplateFragment("popup-alert",{title:n.title,message:t}),d(i),u.onclose=n.onclose,L(),N(),C(),b()},confirm:function(r,i){var s=e.getService("templates"),o;i=i||{};if(!i.onconfirm&&!i.oncancel)throw new Error("No action specified for confirm dialog");A(),o=s.getTemplateFragment("popup-confirm",{title:i.title,message:r,confirmText:i.confirmText||t,cancelText:i.cancelText||n}),d(o),u.onconfirm=i.onconfirm,u.oncancel=i.oncancel,u.onclose=i.onclose,i.isBlocking&&c(),L(),x(),T(),b()},open:function(t,n){var i=e.getService("ajax"),s,o;n=n||{},s=n.data||{},o=O(t),A(),i.get(o,s,{success:function(t){d(t.data.html),L(),N(),C(),b()},error:function(e){this.alert(e.data||r)},context:this})},close:function(){l(),w()},block:function(){l(),E()}}}),Box.Timing.execution.push({name:"js/services/strings.js",time:(new Date).getTime()}),Box.Application.addService("strings",function(e){"use strict";function i(e){var t=$("<div />").css({display:"block",left:0,position:"absolute",top:0,visibility:"hidden",whiteSpace:"nowrap"}).appendTo("body");if(e){var n=$(e);t.css({fontFamily:n.css("font-family"),fontSize:n.css("font-size"),fontWeight:n.css("font-weight")})}return t[0]}function s(e,t,n){return typeof
n.innerText!="undefined"?n.innerText=e:n.textContent=e,n.offsetWidth<=t}function o(e,t,n){var r=e.length,i=0,o=r,u=r,a=e;while(o-i>1)s(a,t,n)?i=u:o=u,u=Math.floor((i+o)/2),i!=r&&(a=e.substr(0,u)+"...");return a}function u(e,t){var n="",r,i;for(var s=0;s<e.length;s++){if(e[s]=="a"){n+="(?!/?"+e[s]+"[^>]*>)";var o=new RegExp('<a\\s[^>]*(href="[^"]*")[^>]*>',"g");t=t.replace(o,'<a $1 target="_blank">'),o=new RegExp("<a\\s[^h][^>]*>","g"),t=t.replace(o,"&lt;a>")}else n+="(?!/?"+e[s]+">)",i=new RegExp("<"+e[s]+"\\s[^>]*>","g"),t=t.replace(i,"<"+e[s]+">");i=new RegExp("</"+e[s]+"\\s[^>]*>"),t=t.replace(i,"</"+e[s]+">")}try{r=new RegExp("<"+n,"gi")}catch(u){return $.log(u),""}return t=t.replace(r,"&lt;").replace(new RegExp("\n","g"),"<br>").replace(new RegExp("\r","g"),"<br>"),t}var t="(\\b)((https?|ftp|gopher|telnet|file|wais):\\/\\/)(([A-z0-9_]+):([A-z0-9-_]*)@)?(([A-z0-9_-]+\\.)*)(([A-z0-9-]{2,})\\.)([A-z]{2,})(:(\\d+))?((\\/[a-z0-9-_.%~+]*)*)?(\\?[^?\\s]*)?",n=["B","KB","MB","GB","TB"],r=["b","strong","i","em","u","a","span"];return{getFastShortString:function(e,t){return!e||e.length===0?"":e.length<=t?e:e.substring(0,t-3)+"..."},getShortString:function(e,t,n){if(!e||e.length===0)return e;var r,s;return s=i(n),r=o(e,t,s),$(s).remove(),r},getHyperlinkedString:function(e){var n=new RegExp(t,"gim");return e.replace(n,function(e){return'<a href="'+e+'" target="_blank">'+e+"</a>"})},getHumanReadableSize:function(e,t){var r,i;return typeof t=="undefined"&&(t=1),e=parseInt(e),r=Math.floor(Math.log(e)/Math.log(1024)),r=Math.min(Math.max(r,0),n.length-1),i=e/Math.pow(1024,r),r>0&&(i=i.toFixed(t)),i+" "+n[r]},capitalize:function(e){return(e+"").replace(/^([a-z])|\s+([a-z])|_([a-z])/g,function(e){return e.toUpperCase()})},escapeMarkupTags:function(e){return u(r,e)}}}),Box.Timing.execution.push({name:"js/services/templates.js",time:(new Date).getTime()}),Box.Application.addService("templates",function(e){"use strict";var t=/[<>"&'\/`]/g,n={"<":"&lt;",">":"&gt;",'"':"&quot;","&":"&amp;","'":"&#x27;","/":"&#x2f;","`":"&#x60;"},r=document;return{escapeHTML:function(e){return e.replace(t,function(e){return n[e]})},getTemplateHTML:function(e,t){var n=r.getElementById("jst-"+e),i="";if(n){i=n.text.replace(/^\s+|\s+$/g,"");if(i)return t&&(i=i.replace(/<%=\s*(\w+)\s*%>/g,$.proxy(function(e,n){var r=t[n]||"";return r?this.escapeHTML(r):""},this))),i;throw new Error('Template "'+e+'" is an empty string.')}throw new Error('Template "'+e+'" not found.')},getTemplateFragment:function(t,n){var r=e.getService("dom"),i=this.getTemplateHTML(t,n);return r.createFragmentFromHtml(i)}}}),Box.Timing.execution.push({name:"js/services/thumbnail.js",time:(new Date).getTime()}),Box.Application.addService("thumbnail",function(e){"use strict";function n(e){var t=e.lastIndexOf(".");return t===-1?"":e.slice(t+1).toLowerCase()}function r(e,t){return"sprite_doc_"+e+"_"+e+"-"+t}var t=$();return{getFileTypeIcon:function(e,t){var i=n(e);return r(t,i)},showThumbnail:function(e,n){var r=$(n),i=r.offset(),s,o,u,a;t.length||(t=$('<div id="thumbnail" class="bubble square_bubble"><div class="arrow"></div></div>'),t.appendTo($("body"))),t.css("left","-99999px").show(),s=t.outerWidth(),o=t.outerHeight(),u=i.top-o/4,a=i.left-10-s,a<1||r.hasClass("locked")||r.hasClass("has_task_to_complete")?(a=i.left,u=i.top-10-o,t.find(".arrow").removeClass("arrow").addClass("arrow_down")):t.find(".arrow_down").removeClass("arrow_down").addClass("arrow"),t.css({top:u,left:a,background:"#fff url("+e+") center center no-repeat",display:"block"})},hideThumbnail:function(){t.hide()}}}),Box.Timing.execution.push({name:"js/services/tooltips.js",time:(new Date).getTime()}),Box.Application.addService("tooltips",function(e){"use strict";function i(){clearTimeout(t),t=null}function s(e,s){var o=$("#tooltip");if(t){i();return}e?o.fadeOut("fast",function(){$(this).remove()}):o.remove(),s&&s.hide_event_type&&r&&r.unbind(s.hide_event_type),r=null,n=null}function o(e){return e===document.body||!e||e===window}function u(e){return e.attr("data-hover")==="tooltip"||e.attr("data-tooltipid")||e.attr("data-htmltooltip")?!0:!1}function a(t){var n=t.attr("data-hover")==="tooltip"?t.attr("aria-label"):null,r;if(n)return n;n=t.attr("data-tooltipid");if(n)return r=e.getService("templates"),n="html:"+r.getTemplateHTML(n),n;n=t.attr("data-htmltooltip");if(n)return n="html:"+n,n}function f(e){while(!o(e)){if(u($(e)))return e;e=e.parentNode}return null}function l(t,o){i(),$("#tooltip").remove();var u=t.indexOf("|"),a=u!==-1,f=250,l=!1,c,h=e.getService("templates"),p=$(h.getTemplateHTML("tooltip_prototype")),d=p.attr("id","tooltip").hide().appendTo(document.body),v=d.find(".tooltip"),m=v.find("h4"),g=v.find("p"),y;if(a){var b=t.substring(0,u);b.indexOf("html:")===0&&(b=b.substring(5)),m.text(b).show(),y=t.substr(u+1),c=b.length+y.length}else m.hide(),y=t,c=y.length;t.indexOf("html:")===0?g.html(a?t.substring(u+1):t.substring(5)):g.text(y),c>f&&(l=!0);var w=d.find(".beak");l&&v.addClass("tooltip_large");var E=r.outerHeight(),S=r.outerWidth(),x=r.offset();x.top===0&&x.left===0&&o.event&&(x.top=o.event.pageY,x.left=o.event.pageX);var T=$(window),N=parseInt(r.css("padding-top"),10),C=Math.max(5-N,0),k=d.height()+10+C,L=d.css("left","-99999px").appendTo($("body")).outerWidth();l&&L>350?L=d.css("width","350px").outerWidth():!l&&L>200&&(L=d.css("width","200px").outerWidth());var A=Math.floor(L/2),O=Math.floor(d.height()/2),M=r.parents().andSelf();r.attr("data-tooltip-dark-grey")=="true"?d.addClass("tooltip_dark_grey"):M.hasClass("dark_background")&&d.addClass("tooltip_inverse"),r.attr("data-tooltip-margin-left")=="true"&&d.addClass("tooltip_margin_left");if(M.hasClass("use_sideways_tooltip")){w.css("top",O),x.top-=O;var _=13;x.left-L<T.scrollLeft()?(v.addClass("left"),x.left+=S+_):(v.addClass("right"),x.left-=L+_)}else{w.css("left",A-9),x.left+=S/2,x.left=Math.floor(x.left),x.left-=A,x.left+L>T.width()?(x.left=x.left+r.outerWidth()-A+20,x.left+L>T.width()&&(x.left=T.width()-L-5),w.css({left:L-30+"px"})):x.left<T.scrollLeft()&&(x.left=T.scrollLeft(),w.css({left:T.scrollLeft()+r.offset().left+r.outerWidth()/2-10+"px"}));if(x.top-k>=T.scrollTop()){v.addClass("down"),x.top-=k;var D=v.find(".tooltip_table");D.length>0&&D.closest(".tooltip").addClass("down_tooltip_table")}else v.addClass("up"),x.top+=E}d.css({left:x.left+"px",top:x.top+"px"});var P=function(){n&&setTimeout(function(){s(!0,o)},n)};n=o.duration,d.fadeIn(0,P)}var t=null,n=null,r=null;return{triggerTooltips:function(e){if(e.target.tagName&&e.target.tagName.toLowerCase()=="object")return;var t="mouseleave.tooltip",n=$(e.target).closest("button, a").get(0);n&&!$(n).is(":disabled")&&(t+=", click.tooltip"),this.showTooltips({hide_event_type:t,element:e.target,delay:200,event:e})},showTooltips:function(e){var n=f(e.element);if(!n){s(!0,e);return}if(r&&r.get(0)==n)return;var o=$(n),u=a(o);if(!u)return;s(!1),r=o,e.hide_event_type&&r.bind(e.hide_event_type,function(){s(!0,e)});var c=e.delay||0;c?(i(),t=setTimeout(function(){l(u,e)},c)):l(u,e)},hideTooltips:function(){if(n)return;s(!1)}}}),Box.Timing.execution.push({name:"js/services/tours.js",time:(new Date).getTime()}),Box.Application.addService("tours",function(e){"use strict";function c(){var t=e.getService("dom");return t.query(i)}function h(){var e=c();return e?e.getAttribute("data-module"):null}function p(){var t=e.getService("lollipops"),n=e.getService("backdrops"),r=e.getService("dom");t.erase(),n.erase();var i=r.queryAll(".tour-slide.displayed",c());r.removeClass(i,"displayed")}function d(){var e=c();return parseInt(e.getAttribute(a),10)}function v(t){var n=e.getService("logger");n.sendLog("tours",t,{tour_name:h(),step:d()})}function m(e){return t+e}function g(){return d()>0}function y(){var t=e.getService("dom"),n=t.query(i),r=parseInt(n.getAttribute(f),10);return d()<r-1}function b(){var t=e.getService("dom"),n=t.query(r),i=t.query(s,n),u=t.query(o,n);g()?t.removeClass(i,"hidden"):t.addClass(i,"hidden"),y()?t.removeClass(u,"hidden"):t.addClass(u,"hidden")}function w(e){var t=c();t.setAttribute(a,e)}function E(){var t=e.getService("dom"),n=d(),r=t.query('.tour-slide[data-slide-index="'+n+'"]'),i={},s;i.maskItemSelector=r.getAttribute("data-masked-item-selector"),i.fakeLayerTemplateId=r.getAttribute("data-fake-layer-template-id"),i.fakeLayerAnchorSelector=r.getAttribute("data-fake-layer-anchor-selector");var o=t.queryAll(".lollipop-description",r);i.highlightItems=[];if(o.length>0){var u;for(var a=0;a<o.length;++a)u=o[a],s=u.getAttribute("data-size-factor"),i.highlightItems.push({descSelector:u.getAttribute("data-desc-selector"),anchorSelector:u.getAttribute("data-anchor-selector"),highlightMode:u.getAttribute("data-highlight-mode"),textPosition:u.getAttribute("data-text-position"),sizeFactor:s?parseFloat(s):1})}return i}function S(t){var n=e.getService("backdrops");n.mask(t)}function x(t,n){var r=e.getService("backdrops");r.drawFakeLayer(t,n)}function T(){var t=e.getService("dom"),n=d();t.addClass(t.query('.tour-slide[data-slide-index="'+n+'"]'),"displayed")}function N(t){var n=e.getService("dom");return n.query('[data-selector="'+t+'"]',c())}function C(t){var n=e.getService("dom"),r=e.getService("lollipops"),i,s,o;for(var u=0;u<t.length;u++)o=t[u],s=n.query(o.anchorSelector),i=N(o.descSelector),s?r.draw(o.anchorSelector,o.highlightMode,i,o.textPosition,o.sizeFactor):n.addClass(i,"hidden")}function k(){var t=e.getService("dom"),n=t.query(r);return t.query(u,n)}function L(){var t=e.getService("dom"),n=c(),r=k(),i=n.getAttribute("data-hide-progress"),s=t.queryAll(".tour-slide",n).length;if(i)return;var o=document.createElement("li");t.addClass(o,"progress-indicator mhs");for(var u=0;u<s;u++)r.appendChild(o.cloneNode(!1))}function A(){var t=e.getService("dom"),n=c(),r=k(),i=n.getAttribute("data-hide-progress"),s=d();if(i)return;var o=t.queryAll(".progress-indicator",r);t.removeClass(o,"full"),t.addClass(o[s],"full")}function O(){var e=E();v("SHOW_SLIDE"),p(),e.maskItemSelector&&S(e.maskItemSelector),e.fakeLayerTemplateId&&x(e.fakeLayerTemplateId,e.fakeLayerAnchorSelector),T(),A(),e.highlightItems&&window.setTimeout(function(){C(e.highlightItems)},0),b()}function M(){var e=d();w(e+1),O()}function _(){var e=d();w(e-1),O()}function D(t,r){var i=e.getService("dom"),u=document.createElement("div"),a=$(u),l,h;document.body.appendChild(u),i.addClass(u,n),i.addClass(u,r),i.setHTML(u,t),a.on("click",s,_),a.on("click",o,M),l=c(),h=i.queryAll(".tour-slide",l).length,w(0),l.setAttribute(f,h),L()}function P(){var t=e.getService("dom"),n=t.query(r);v("STOP_TOUR"),p(),$(n).off("click",s,_),$(n).off("click",o,M),t.setHTML(n,""),n.parentNode.removeChild(n)}function H(e,t){D(e,t),v("START_TOUR"),O()}function B(e){e.keyCode===27&&(v("ESCAPE_KEY_PRESSED"),l.stop())}function j(){$(window).on("keydown.tours",B)}function F(){$(window).off("keydown.tours",B)}function I(){var t=e.getService("backdrops");t.showCurtain(h())}function q(){var t=e.getService("backdrops");t.removeCurtain()}var t="box_tour_",n="tour-container",r="."+n,i=r+" .module",s=".previous-button",o=".next-button",u=".tour-progress",a="data-current-slide",f="data-total-slide-count",l;return l={start:function(t,n){var r=m(t),i=e.getService("ajax");n=n||{},i.get(r,n,{success:function(n){H(n.data.html,t),I(),j()},error:function(t){},context:this})},stop:function(){F(),P(),q()},goToSlide:function(e){w(e),O()},logEvent:v,getCurrentTourName:h},l}),Box.Timing.execution.push({name:"js/services/unidb.js",time:(new Date).getTime()}),Box.Application.addService("unidb",function(e){"use strict";function t(e){return $.type(e)==="object"&&"unidb"in e}function n(r){var i=e.getService("v5"),s=i.get("Box_Object");if(t(r))return s.find_or_create(r.unidb);if($.isArray(r)||$.isPlainObject(r)){for(var o in r)r[o]=n(r[o]);return r}return r}return{decode:function(t){if(!t)return;var r=e.getService("v5"),i=r.get("Box_Object"),s=t.db;for(var o in s){var u=n(s[o]);i.find_or_create(u)}var a=n(t.params);return a},isUniDB:function(e){return $.type(e)==="object"&&e.type==="unidb"},loadTagsFromDocument:function(){var e=$(".unidb_data"),t,n;for(t=0,n=e.length;t<n;t++)this.loadTagsFromElement(e[t])},loadTagsFromElement:function(e){var t=$(e);this.decode($.parseJSON(t.text())),t.remove()}}}),Box.Timing.execution.push({name:"js/services/url.js",time:(new Date).getTime()}),Box.Application.addService("url",function(e){"use strict";function s(e){return decodeURIComponent(e.replace(n," "))}var t=window,n=/\+/g,r=/([^&=]+)=?([^&]*)/g,i=/\?(.*)/;return{_setWindow:function(e){t=e},getCurrentWindowUrl:function(){return t.location.hash||t.location.href},getHostDomain:function(){var e=t.location.hostname.split("."),n=e.length;return e[n-2]+"."+e[n-1]},getGcmCompatibleRmUrl:function(t,n){var r=e.getService("nav-state"),i="/index.php?rm=";return r.isGcm()&&(t="box_master_gcm_"+t),n?t:i+t},createUrl:function(e,t){var n="";for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];n+=(n?"&":"")+encodeURIComponent(r)+"="+encodeURIComponent(i)}if(n){var s=e.indexOf("?"),o=s!=-1,u=s==e.length-1;o?u||(e+="&"):e+="?",e+=n}return e},goToUrl:function(n){var r=e.getService("v5"),i=r.get("open_link_in_new_window"),s=r.get("path_prefix");n=this.addAdditionalContext(n);if(i&&n&&s&&n.indexOf(s)<0){t.open(n);return}t.location.href=n},goToUrlInBackground:function(t){var n=e.getService("dom"),r=n.query("#downloadiframe"),i=!1;r||(r=document.createElement("iframe"),i=!0),t=this.addAdditionalContext(t),r.src=t,r.style.display="none",r.setAttribute("id","downloadiframe"),i&&document.body.appendChild(r)},openWindow:function(e,n,r,i){return e?(n=n||"",r=r||"",i=i||!1,e=this.addAdditionalContext(e),t.open(e,n,r,i)):null},addAdditionalContext:function(t){var n=e.getService("v5"),r=n.get("additional_context");if(r&&t.indexOf("additional_context")<0){var i="additional_context="+encodeURIComponent(r);t+=(t.indexOf("?")>0?"&":"?")+i}return t},encodePathComponent:function(e){return e=encodeURIComponent(e).replace(/%2F/g,"%252F").replace(/%23/g,"%2523").replace(/%26/g,"%2526"),e},decodePathComponent:function(e){return e=e.replace(/%2526/g,"%26").replace(/%2523/g,"%23").replace(/%252F/g,"%2F"),decodeURIComponent(e)},getQueryParams:function(e){var t,n=e.match(i),o,u={};if(n){o=n[1];while(t=r.exec(o))u[s(t[1])]=s(t[2])}return u},getQueryParamString:function(e){var t=e.match(i);return t?t[1]:""}}}),Box.Timing.execution.push({name:"js/services/v5.js",time:(new Date).getTime()}),Box.Application.addService("v5",function(e){"use strict";return{get:function(e){var t=null;return t=window[e],t&&typeof t.get=="function"&&(t=t.get()),t}}}),Box.Timing.execution.push({name:"js/services/v5popups.js",time:(new Date).getTime()}),Box.Application.addService("v5popups",function(e){"use strict";function n(t,n,r){var i=e.getService("logger");i.sendLog(t,n,r)}function r(e){var t="/index.php?rm=box_load_upgrade_popup";$.ajax({url:t,dataType:"html",success:e})}function i(r,i,s){var o=e.getService("v5"),u=o.get("Box_Event_Tracker"),a={},f=$("#upgrade_"+r),l,c,h,p;return f.length===0?null:(l=f.attr("title").split(" : "),a.title=l[0],a.subtitle=l[1],a.html=f.html(),a.favicon="sprite_24x24 "+(t[r]||""),s?c="/ref/"+s:c="/ref/upsell_"+r,$.inArray(r,["shared_link_download","virtual_user_login"])!==-1?(r=="virtual_user_login"?h=$t("Upgrade now","popup_action_upgrade_now"):h=$t("Sign up now","popup_action_sign_up_now"),p={upgrade:{value:h,click:function(){u.send(1),n("marketing","SHARED_DOWNLOAD_CLICK_POPUP_SIGNUP");var t=e.getService("url");t.openWindow(c),$.popup.close(i)}},learn_more:{value:$t("Learn more","js_popup_button_learn_more"),click:function(){u.send(0),n("marketing","SHARED_DOWNLOAD_CLICK_POPUP_LEARN_MORE");var t=e.getService("url");t.openWindow(c+"_learn_more"),$.popup.close(i)}}}):p={tour:{value:$t("Take feature tour","popup_action_take_feature_tour"),click:function(){u.send(0),n("marketing","UPGRADE_POPUP_CLICK_TOUR");var t=e.getService("v5popups");t.showUpgradeTourPopup($("#upgrade_id").val())}},upgrade:{value:$t("Upgrade","popup_action_upgrade"),classes:"invert_color",click:function(t,r){u.send(1),n("marketing","UPGRADE_POPUP_CLICK_UPGRADE");var i=e.getService("url");i.goToUrl(c),$.popup.revert()}}},a.buttons=p,a)}function s(e){var t="/index.php?rm=box_log_upgrade_popup_view",n={type:e},r=$.box.formatQuery(n);$.postJSON(t,r)}var t={password_protect:"sprite_24x24_master_settings",direct_link:"sprite_24x24_link",version_history:"sprite_24x24_version_history",larger_file:"sprite_24x24_upload",full_text:"sprite_24x24_search",file_lock:"sprite_24x24_master_settings",collab_manage:"sprite_24x24_collab_manage",new_folder_collab_manage:"sprite_24x24_collab_manage",virtual_user_login:"sprite_24x24_upload",security:"sprite_24x24_ssl",apps:"sprite_24x24_master_apps",group_management:" ",bulk_add:" ",bulk_edit:" ",set_due_dates:" "};return{showUpgradePopup:function(e,t,o){var u=this,a="",f;if($("#upgrade_messages").length===0){r(function(r){$("body").append(r),u.showUpgradePopup(e,t,o)});return}f=i(e,t,o);if(!f)return;e==="shared_link_download"?n("marketing","SHARED_DOWNLOAD_VIEW_POPUP"):s(e),$.popup.close(null,!0),$.inArray(e,["virtual_user_login","set_due_dates","shared_link_download"])===-1&&(a=' <span class="badge upgrade txt_t mts">'+$t("UPGRADE","js_upgrade_badge")+"</span>"),$.popup.form(f.title+a,[{type:"html",data:"<h3>"+f.subtitle+"</h3>"+f.html,class_name:"upgrade_popup_main_text background_upgrade_"+e},{type:"buttons",items:f.buttons,wide:!0},{type:"html",data:$(".question_contact_us:first").clone(),class_name:"upgrade_content_question_contact_us"},{type:"hidden",name:"upgrade_id",id:"upgrade_id",value:e}],{favicon_class:f.favicon||""})},showUpgradeTourPopup:function(t,s,o){var u=this,a=e.getService("v5"),f=a.get("Box_Event_Tracker"),l=e.getService("eloqua"),c=[],h=["password_protect","security","full_text","collab_manage","version_history"],p=$.inArray(t,h);if($("#upgrade_messages").length===0){r(function(n){$("body").append(n),u.showUpgradeTourPopup(t,s,o)});return}l.sendEloquaWith("ToastUpgrade","Toast Upgrade","upgradetour"),p!==-1&&h.splice(p,1),$.each(h,function(e,n){var r="upsell_popup_tour_"+n,o=i(n,s,r),u,a,f;u="",$.inArray(n,["virtual_user_login","set_due_dates","shared_link_download"])===-1&&(u=' <span class="badge upgrade txt_t mts">'+$t("UPGRADE","js_upgrade_badge")+"</span>"),a=c.length===0,delete o.buttons.tour,f={type:"slide",label:o.title+u,height:275,selected:a,id:"slide_"+n,favicon:o.favicon,contents:[{type:"html",data:"<h3>"+o.subtitle+"</h3>"+o.html,class_name:"upgrade_popup_main_text background_upgrade_"+t},{type:"buttons",items:o.buttons,wide:!0},{type:"html",data:$(".question_contact_us:first").clone(),class_name:"upgrade_content_question_contact_us"}]},c.push(f)}),$.popup.form("",c,{close_popup_on_click_outside:!1,prev_slide_callback:function(){f.send(0),n("marketing","UPGRADE_TOUR_PREV",{from:$.popup.selected_tab.id})},next_slide_callback:function(){f.send(0),n("marketing","UPGRADE_TOUR_NEXT",{from:$.popup.selected_tab.id})}})},showTooManyFilesUseFolderPopup:function(t){var n,r=e.getService("v5").get("Upload_Process"),i;n=$t("Please use the %1Upload Folders%2 option to upload more than %3 files at a time.","js_show_too_many_files__use_chrome_popup_message",'<button class="upload_folder_via_chrome anchor">',"</button>",t),$.popup.alert($t("Error","js_show_too_many_files_popup_title"),n),i=$(".upload_folder_via_chrome"),r.add_trigger({element:i,directory_upload:!0,over_callback:function(){i.addClass("hover")},out_callback:function(){i.removeClass("hover")},click_callback:function(){$.popup.close()},handle_change:function(e,t){r.handle_change(e,t)}})},showTooManyFilesUseJavaPopup:function(t){var n,r=e.getService("v5").get("Upload_Process");n=$t("Please use the %1Folder Uploader%2 to upload more than %3 files at a time.","js_show_too_many_files_popup_message",'<button class="bulk_upload_link anchor">',"</button>",t),$.popup.alert($t("Error","js_show_too_many_files_popup_title"),n,{click_handlers:{".bulk_upload_link":function(){return r.popup_upload_java_open(),!1}}})}}}),Box.Timing.execution.push({name:"js/services/window-popup.js",time:(new Date).getTime()}),Box.Application.addService("window-popup",function(e){"use strict";function r(e,n){var r;r=setInterval(function(){try{if(e===null||e.closed)clearInterval(r),n()}catch(t){}},t)}function i(e,t){t=t||{},this.url=e,this.options=$.extend(!0,{},n,t)}var t=1e3,n={popupName:"BoxPopup",queryParams:{},width:270,height:320,left:500,top:200,toolbar:0,scrollbars:1,status:0,resizable:1,location:1,menuBar:0};return i.prototype={popup:null,url:null,options:null,closeCallback:null,closeIntervalId:null,_getPopupUrl:function(){return this.url+($.isEmptyObject(this.options.queryParams)?"":"?"+$.box.formatQuery(this.options.queryParams))},_getPopupConfiguration:function(){var t=e.getService("v5"),n=t.get("screen"),r;return r={width:this.options.width,height:this.options.height,toolbar:this.options.toolbar,scrollbars:this.options.scrollbars,status:this.options.status,resizable:this.options.resizable,location:this.options.location,menuBar:this.options.menuBar,left:n?(n.availWidth-this.options.width)/2:this.options.left,top:n?(n.availHeight-this.options.height)/2:this.options.top},$.param(r).replace(/&/g,",")},setCloseCallback:function(e){this.closeCallback=e},show:function(){var t=e.getService("url"),n=this._getPopupUrl(),i=this._getPopupConfiguration();this.popup&&!this.popup.closed?this.popup.focus():(this.popup=t.openWindow(n,this.options.popupName,i),this.closeCallback&&r(this.popup,this.closeCallback))},hide:function(){this.popup&&this.popup.close()}},{create:function(e,t){return new i(e,t)}}}),Box.Timing.execution.push({name:"js/behaviors/item.js",time:(new Date).getTime()}),Box.Application.addBehavior("item",function(e){"use strict";function n(t,n){var r=e.getService("v5"),i=r.get("Box_Event_Tracker"),s=r.get("Canvas");i.set_category_by_rm("Menu Opened"),i.set_action("Arrow"),i.send(1),i.set_category_by_rm("Arrow menu"),s.target_item=t,t.show_menu({target:n})}function r(e){return $(e).closest(".item, .mini_item, .item_expansion_share")}function i(t){var n=e.getService("v5"),r=n.get("Item");return r.find(t.closest("[data-typed-id]").attr("data-typed-id"))}var t;return{init:function(){t=e.getService("nav-state")},onclick:function(s,o,u){var a=e.getService("v5"),f=e.getService("dom"),l=e.getService("logger"),c=e.getService("url"),h=e.getService("navigation"),p=e.getService("popups"),d=a.get("box"),v=a.get("Canvas"),m=a.get("Share_Access_Menu"),g=r(s.target),y=i(g),b=g.find(".action_list"),w=$(s.target).closest("li.item").index(),E=s.originalEvent&&s.originalEvent.pageX||0,S,x,T="",N;if(!y)return;if(t.isGcm()&&y.is_hidden_external_collab){s.stopPropagation(),s.preventDefault();return}if(t.isSearch()&&w!=-1){N=t.get();var C={result_num:w+1,page_num:N.page,page_size:v.page_size,item_id:y.id,item_type:y.type,search_string:N.searchString,total_results:d.search_total_results_count,sort_type:N.sort,sort_direction:N.sortDirection};t.isFirstResultClick()?(t.setFirstResultClick(!1),l.sendLog("search","SEARCH_FIRST_RESULT_CLICK",C)):l.sendLog("search","SEARCH_RESULT_CLICK",C)}if(u=="description-link"||u=="partner-tag-btn")return;switch(u){case"version-btn":y.version_history();break;case"context-menu-btn":n(y,s.target);break;case"select-checkbox":$(o).find("input[type=checkbox]").is(":checked")?y.unselect():y.select();break;case"path-anchor":h.navigate(o.href);break;case"stats-btn":y.edit_properties({selected_tab:"stats"});break;case"expiration-btn":y.set_expirations();break;case"item-feed-btn":y.expansion.toggle("Item_Feed",{default_field:"comment"});break;case"share-btn":y.expansion.toggle("Share");break;case"download-btn":y.download();break;case"play-btn":y.click();break;case"send-btn":y.sharebar({selected_tab:"send",source:"expansion"});break;case"share-access-btn":m.visible?m.hide():m.show({item:y,target:s.target.parentNode,source:"expansion"});break;case"shared-link-input":o.focus(),o.select();break;case"tag-btn":var k=o.id.substr(2);v.tag_collection.apply_tags([k]);break;case"add-tag-btn":y.tag();break;case"profile-link":c.openWindow(s.target.href);break;case"item-row":if(y.is_quarantined&&!f.getNearest(s.target,".action_list")){p.open("quarantined_file",{data:{typed_id:y.typed_id}}),s.stopPropagation(),s.preventDefault();return}if(b.is(":visible")&&E>b.offset().left||f.getNearest(s.target,"input, .item_expansion")){s.stopPropagation(),s.preventDefault();return}t.isGcm()?(S=g.find("a.item_link").attr("href"),S&&(T=S),y.is_deleted||(y.type=="folder"&&(x={no_load_folder_tree:!0},t.isGcmSearch()?(N=t.get(),x.search=N.searchString,x.filter_list=N.searchFilters,x.track_event="search_item_click"):x.track_event="middle_pane_click"),h.navigate(T,{},x))):s.ctrlKey||s.metaKey?(T=y.build_url(),c.openWindow(T)):y.click();break;default:return}s.stopPropagation(),s.preventDefault()},oncontextmenu:function(t,n,s){var o=e.getService("v5"),u=o.get("Canvas"),a=e.getService("nav-state"),f=o.get("Box_Event_Tracker"),l=o.get("accessor_can_edit_global_content"),c=r(t.target),h=i(c);if(!h)return;if(Box.Application.getGlobalConfig("useMinimal")==="use_minimal"&&a.isFiles()){t.stopPropagation(),t.preventDefault();return}if(s==="shared-link-input")return;u.target_item=h,f.set_category_by_rm("Menu Opened"),f.set_action("Context"),f.send(1),f.set_category_by_rm("Context menu");if(a.isGcm()&&!l)return;h.show_menu({event:t,type:"right_click"}),t.stopPropagation(),t.preventDefault()},onmousedown:function(t,n,s){var o=e.getService("v5"),u=o.get("Canvas"),a=r(t.target),f=i(a);f&&(u.target_item=f)},onmouseover:function(n,s,o){var u=e.getService("v5"),a=e.getService("thumbnail"),f=u.get("shared_name"),l=u.get("Canvas"),c=u.get("Item"),h=r(n.target),p=$(n.target),d=i(h),v="";if(!d)return;h.addClass("hover"),d.collection.view=="expanded"&&!p.hasClass("file_properties")&&!p.closest(".file_properties").length&&!t.isEmbedWidget()&&(c.update_preview_tooltip=function(){d.has_pic_x&&(f&&!d.pic_x.match("shared_name")&&(d.pic_x=d.pic_x+"&shared_name="+f),a.showThumbnail(d.pic_x,h[0]),delete c.update_preview_tooltip)},c.update_preview_tooltip());if(d.concurrently_locked)d.locked_key?v=$t("You are currently editing this file. Other people can still edit the file simultaneously.","item_tooltip_concurrently_locked_by_me"):v=$t("Other people are currently editing this file. You can still edit this file simultaneously","item_tooltip_concurrently_locked"),h.find(".concurrent_lock").attr({"data-hover":"tooltip","aria-label":$t("Currently being edited","currently_being_edited")+"|"+v});else if(d.lock){if(d.lock.service_name!="Locking"&&d.lock.service_name!="Locking (beta)"){var m="<strong>"+$.box.escapeHTML(d.lock.service_name)+"</strong>",g="<strong>"+d.lock.user_display_name+"</strong>";d.lock.user_id==l.user.id?v=$t("This file is automatically locked while being edited using the %1 service. It will be unlocked when you close the editor.","item_tooltip_lock_edited_by_you",m)+"<br>":v=$t("This file is automatically locked while being edited using the %1 service. It will be unlocked when %2 closes the editor.","item_tooltip_lock_edited_by_you2",m,g)+"<br>"}d.locked_key?(v+=d.generate_lock_info_html(),h.find(".locked_key").attr("data-htmltooltip",v)):(d.lock.service_name=="Locking"||d.lock.service_name=="Locking (beta)"?v+=d.generate_lock_info_html():v+=$t("You cannot overwrite this file","item_tooltip_lock_cannot_overwrite"),h.find(".lock").attr("data-htmltooltip",v))}},onmouseout:function(t,n,s){var o=e.getService("v5"),u=e.getService("thumbnail"),a=o.get("Box_Menus"),f=r(t.target),l=i(f);if(!l||a.menu&&a.menu.item==l||f.hasClass("ignore_mouseout"))return;f.removeClass("hover"),u.hideThumbnail()}}}),Box.Timing.execution.push({name:"js/modules/common/admin-header.js",time:(new Date).getTime()}),Box.Application.addModule("admin-header",function(e){"use strict";function s(){var e=t.get("current_rm");return e==="box_enterprise_settings"}var t,n,r,i;return{init:function(){var s=e.getConfig();t=e.getService("v5"),n=$(e.getElement()),r=s.isViewSwitchEnabled,i=s.isLogoutRequiredUponUserClose},onclick:function(e,t,n){if(t){switch(n){case"silent-mode-off-btn":this.disableSilentMode();break;case"close-user-btn":this.closeUserTab(t)}e.stopPropagation(),e.preventDefault()}},disableSilentMode:function(){var e=t.get("Loading"),i=t.get("request_token"),o,u=this;e.create(),o="/index.php?rm=box_master_users_turn_silent_mode_off",$.postJSON(o,{request_token:i},function(){e.destroy(),u.hideAlertBadge(),r||n.hide(),s()&&u.reloadNotificationSettings()})},hideAlertBadge:function(){n.find("#alert_badge").hide()},reloadNotificationSettings:function(){var e=t.get("settings_reload");e&&e("notification")},removeInstantLoginSession:function(){var e=t.get("request_token"),n;return n="/index.php?rm=box_master_users_remove_instant_login_session",$.postJSON(n,{request_token:e})},closeUserTab:function(t){var n=this.removeInstantLoginSession();i?n.done(function(){var t=e.getService("url");t.goToUrl("/logout")}):n.done(function(){$(t).closest("li").remove()})}}}),Box.Timing.execution.push({name:"js/modules/common/header.js",time:(new Date).getTime()}),Box.Application.addModule("header",function(e){"use strict";function f(e){var t=r.get_menu_group("header"),n,i;a=e;if(t)for(n=t.length-1;n>=0;n--)i=t[n],i.stalking=e,i.redraw();o&&o.isOpen()&&(e?o.freezePosition(s.outerHeight()):o.unfreezePosition())}var t="/index.php?rm=box_pim_get_pending_items",n,r,i,s,o,u=!1,a=!1;return{messages:["x-folderchangebefore","x-searchfilterremove","x-searchfilterchange","x-searchfilterapply","x-searchbefore","overlayclosed","pendingitemcountchanged","pendingitemcompleted"],init:function(){n=e.getService("v5"),r=n.get("Box_Menus"),i=e.getService("dom"),s=$(e.getElement()),this.initSearchPlaceholder(),this.initPIMBadge();if($("#header-container.header_stalking").length)return;$("#header-container").stalker({stalkerStyle:"header_stalking",startCallback:function(){f(!0)},stopCallback:function(){f(!1)}})},onmessage:function(e,t){switch(e){case"x-folderchangebefore":this.handleFolderChangeBefore();break;case"x-searchfilterchange":case"x-searchfilterremove":this.updateSearchFilters(t.filters);break;case"x-searchfilterapply":s.find("#search_files_form").submit();break;case"x-searchbefore":this.resetSearchFilters(),this.updateSearchTerm(t.query),t.filters&&this.updateSearchFilters(t.filters);break;case"overlayclosed":o&&o.close();break;case"pendingitemcountchanged":this.updatePIMIconBadgeCount(t);break;case"pendingitemcompleted":this.incrementPIMIconBadgeCount(t?-t:-1)}},onclick:function(t,n,r){if(n){switch(r){case"user-menu-btn":var o=!!i.getData(n,"admin-view");this.showUserMenu(n,o);var u=e.getService("imageloader");u.loadImages($("#current_user_menu")[0],!0);break;case"upgrade-menu-btn":this.showUpgradeMenu(n);break;case"pim-btn":this.togglePIMOverlay(n);break;case"search-btn":s.find("#search_files_form").submit()}t.preventDefault(),t.stopPropagation()}},onmouseover:function(t,r,i){var o=e.getService("nav-state"),u=o.get(),a=$(n.get("window")),f,l;$.browser.mozilla&&u.isGallery&&(l=$("#player"),f=a.scrollTop(),l.hide(),s.focus(),l.show(),a.scrollTop(f))},onkeyup:function(e,t,n){t&&n==="search-form"&&e.which===13&&(s.find("#search_files_form").submit(),e.preventDefault(),e.stopPropagation())},onsubmit:function(e,t,n){t&&n==="search-form"&&(this.performSearch(),e.preventDefault(),e.stopPropagation())},handleFolderChangeBefore:function(){var t=e.getService("nav-state");t.isMovingOutOfSearch()&&this.initSearchPlaceholder()},showUserMenu:function(e,t){var r=n.get("Box_Menus"),i=r.current_user_menu;i.visible?i.hide():i.show({target:e,from_admin:t})},showUpgradeMenu:function(e){var t=n.get("Box_Menus"),r=t.upgrade_dropdown;r.visible?r.hide():r.show({target:e})},initSearchPlaceholder:function(){var e=s.find("#search");e.placeholderize({forceBlock:!0,extraMarginTop:3,extraMarginTopIE:2})},performSearch:function(){var t=s.find("#search").val(),n,r={},i=e.getService("nav-state"),o=e.getService("nav-url");t=$.trim(t),t.length&&(i.setFirstResultClick(!0),i.isGcm()?(r.no_load_folder_tree=!0,n=o.getGcmUrlForSearch(t,0,i.getSearchStringFromFilters(this.getSearchFilters()))):n=o.getSearchUrl(t,0,i.getSearchStringFromFilters(this.getSearchFilters())),e.navigate(n))},resetSearchFilters:function(){s.find('[data-type="search-filter"]').val("")},updateSearchTerm:function(e){s.find("#search").val(e).trigger("change").trigger("blur")},updateSearchFilters:function(e){var t,n,r,i;for(r=0,i=e.length;r<i;r++)t=e[r].type,n=e[r].value,s.find('input[name="'+t+'"]').val(n)},getSearchFilters:function(){var e,t=[];return e=s.find('[data-type="search-filter"]').filter('[value!=""]'),e.each(function(e,n){var r=$(n);t.push({type:r.attr("name"),value:r.val()})}),t},togglePIMOverlay:function(t){var n=
e.getService("ajax"),r=e.getService("overlay"),f=i.query("#tasks_tab_link",s[0]);e.getService("tooltips").hideTooltips(!0);if(u)return;o?o.isOpen()?o.close():(o.openBelow(f,104,12),a&&o.freezePosition(s.outerHeight())):(u=!0,n.get("box_pim_get_module",{},{success:function(e){var t=i.createFragmentFromHtml(e.data.html);o=r.create(t),o.openBelow(f,104,12),a&&o.freezePosition(s.outerHeight()),u=!1},error:function(){e.getService("popups").alert($t("An error has occurred while loading this feature.","popups_default_exception_message"))}}))},incrementPIMIconBadgeCount:function(e){var t=$("#tasks_tab .badge"),n=parseInt(t.html(),10)+e;this.updatePIMIconBadgeCount(n)},updatePIMIconBadgeCount:function(t){var n=e.getService("cookies"),r=$("#tasks_tab .badge");n.set("pim_badge_count",t),r.html(t),t>0?r.show():r.hide()},initPIMBadge:function(){var r=e.getService("cookies"),i=$.box.formatQuery({sort_method:"date",sort_direction:"DESC",dont_log:!0}),s=n.get("box"),o=this;this.updatePIMIconBadgeCount(r.get("pim_badge_count")),s&&s.hist_name=="files"&&$.getJSON(t,i,function(e){o.updatePIMIconBadgeCount(e.tasks_tab.count+e.messages_tab.count+e.sent_tab.count)})}}}),Box.Timing.execution.push({name:"js/modules/common/paging-bottom.js",time:(new Date).getTime()}),Box.Application.addModule("paging-bottom",function(e){"use strict";var t,n;return{messages:["x-searchbefore","x-searchafter","x-folderchangeafter"],init:function(){t=e.getService("dom"),n=$(e.getElement())},destroy:function(){t=null,n=null},onmessage:function(e,t){switch(e){case"x-searchbefore":t.isPreloaded||n.empty();break;case"x-searchafter":case"x-folderchangeafter":t.json&&"paging_html"in t.json&&this.setPagingHTML(t.json.paging_html)}},setPagingHTML:function(e){var t;t=$(e).filter("#paging_data").attr("id","paging_data_bottom"),n.html(t)}}}),Box.Timing.execution.push({name:"js/modules/common/preview-main.js",time:(new Date).getTime()}),Box.Application.addModule("preview-main",function(e){"use strict";function L(){var e=k.get("user_location")||navigator.language||navigator.userLanguage||navigator.browserLanguage||"";return e=e.split("-"),e=e[e.length-1],e.toUpperCase()}function A(){var t=e.getService("nav-state"),n=e.getService("nav-url");m&&(t.setSearchFilters(m),m=null),e.navigate(n.getReturnUrlForPreview())}function O(){s.off("userclose",A),s.on("userclose",A)}function M(){d=$(e.getElement()),C=L(),s=e.getService("lightbox"),o=e.getService("preview-controls"),u=e.getService("templates"),p=k.get("Realtime_Notification"),O()}function _(){var i=e.getService("nav-state");return i.isGcm()&&!i.isGcmQuarantine()?n:i.isSharedPageOrEmbedWidget()?r:t}function D(){switch(l&&l.extension){case"aac":case"aifc":case"aiff":case"amr":case"au":case"flac":case"m4a":case"mp3":case"ogg":case"ra":case"ram":case"wav":case"wma":return!0;default:return!1}}function P(){var t=e.getGlobalConfig("tours"),n=e.getService("nav-state"),r=t&&t.shouldSeePreviewTour&&!E&&!n.isSharedPageOrEmbedWidget()&&!D()&&o.isFullScreenAvailable();if(r){var i=e.getService("tours");i.getCurrentTourName()===null&&(i.start("preview"),E=!0)}}function H(){var e=u.getTemplateHTML("preview_loading_module_template");s.setContent(e),s.isSidebarVisible()&&s.hideSidebar(!0),s.setSidebar(""),s.open()}function B(t,n,r){var i=this,u,p,m=document.body.getAttribute("data-widget-size"),g=e.getService("browser"),y=g.getOSName()==="iOS"||g.getOSName()==="Android",E=g.hasSVGSupport(),C=g.hasMinimumFlashVersion(),k=r&&r.useFlash?!1:g.canPlayMP3(),L=r&&r.useFlash?!1:g.canPlayH264();$.popup.close(),e.broadcast("previewfileupdated",{currentItemPosition:f,typedId:a[f]}),v=n||0,m&&(b=!0,w=m||""),u={file_id:t,retry_counter:v,file_index:f+1,embed_widget_size:w,client_is_mobile:y,client_supports_swf:C,client_supports_svg:E,client_supports_mp3:k,client_supports_h264:L,first_set_id:c.items?c.items[0].id:null,last_set_id:c.items?c.items[c.items.length-1].id:null},d.attr("data-sharedname")&&(u.q={shared_item:{shared_name:d.attr("data-sharedname"),vanity_name:d.attr("data-vanityname")}}),typeof l!="undefined"&&$(l.element).hasClass("newly-uploaded-item")&&(u.is_newly_uploaded_item=!0);if(this.isCollectionBasedView())u.total_num_files=a?a.length:1,u.current_file_number=u.file_index,u.is_collection_based=!0;else{S&&(u.total_num_files=S),x&&(u.current_file_number=x);if(N||T)u.file_id_of_last_file_on_previous_page=N,u.file_id_of_first_file_on_next_page=T}var A=e.getService("nav-state"),O=A.get();typeof A!="undefined"&&A.isSharedFolderPage()&&(u.sort_type=O.sort,u.sort_direction=O.sortDirection),$(".preview_content_in_progress").length||H(),p=$.getJSON(_(),u),p.done(function(r){!A.isSharedFilePage()&&typeof l!="undefined"&&i.reportNavigationMetrics({isConversionNeeded:r.status==="pending"});if(r.status==="fatal"){s.fail(r);return}b?s.hideSidebar(!0):r.isSidebarEmpty||s.showSidebar(!0),h=!0,s.setContent(r.content_html),s.setSidebar(r.sidebar_html),s.setHeader(r.header_html);var u=s.getCurrentSidebarModule();s.setSidebarModule(u),o.init(),e.getGlobalConfig("useMinimal")==="use_minimal"&&l.get_shared_info(function(){e.broadcast("previewsharedinfofetched")}),r.status!=="success"&&(z(t,r.realtimeSubscriptionUrl),K(r.status))}),p.fail(function(e){s.fail(e)})}function j(){var t=a[f],n=t.substr(2),r=e.getService("nav-state"),i=r.get(),s=e.getService("nav-url");return r.isGcmSearch()?s.getGcmUrlForSearchPreview(i.searchString,i.page,n):r.isGcm()?s.getGcmUrlForPreview(i.gcmUserId,i.id,i.page,n):s.getFileUrlForPreview(n)}function F(t,n){var r=e.getService("nav-state"),i=r.get(),s=parseInt(i.page,10)+n,o=e.getService("nav-url");return s=s<0?0:s,r.isGcmSearch()?o.getGcmUrlForSearchPreview(i.searchString,s,t):r.isGcm()?o.getGcmUrlForPreview(i.gcmUserId,i.id,s,t):o.getFileUrlForPreview(t,s)}function I(t){S=parseInt(t.totalNumFiles,10)||a.length,x=parseInt(t.currentFileNumber,10)||f+1,T=t.fileIdOfFirstFileOnNextPage||"",N=t.fileIdOfLastFileOnPreviousPage||"";var n="",r="",i=f+t.fileOffset,s=x+t.fileOffset;s<1?(i=0,s=1):s>S&&(i=a.length-1,s=S);if(i===f||s===x)return;t.fileOffset<0&&i>=0||t.fileOffset>0&&i<a.length?(r=a[i],f=i,x=s,n=j()):(S="",x="",T="",N="",t.fileOffset<0?(n=F(t.fileIdOfLastFileOnPreviousPage,1),r=t.fileIdOfLastFileOnPreviousPage):(n=F(t.fileIdOfFirstFileOnNextPage,-1),r=t.fileIdOfFirstFileOnNextPage)),y[r]={fromPreviousOrNext:!0},e.navigate(n)}function q(e){e=e||{},typeof e.fileOffset!="number"&&(e.fileOffset=1),I(e)}function R(e){e=e||{},typeof e.fileOffset!="number"&&(e.fileOffset=-1),I(e)}function U(e){a=[];var t=0,n=e.allItems.length,r=e.itemTypedID,i,s;for(s=0;s<n;s++)i=e.allItems[s],i.type==="file"&&$.inArray(i.typed_id,a)<0&&(a.push(i.typed_id),i.typed_id===r&&(f=t,l=i,c=l.collection),t++);$.inArray(r,a)<0&&(a.unshift(r),f=0),m=e.searchFilters||m||null}function z(t,n){var r={notification_url:n,item_typed_id:t,callback:function(t){var n=t.content;e.broadcast("previewprogress",n),n.status!=="success"&&p.subscribe_to_item_notifications(r)}};p.subscribe_to_item_notifications(r)}function W(){var t={typedId:g.typedId||"",extension:g.extension||"",error:g.error||"",previously_converted:g.previouslyConverted==="false"?"false":"true",interrupted:g.interrupted==="true"?"true":"false",country_code:C},n=e.getService("logger");g.interrupted==="true"?t.interruption_time=(new Date).getTime()-g.requestStart:(typeof g.rendered=="number"&&typeof g.requestStart=="number"&&(t.open_to_ready=g.rendered-g.requestStart),typeof g.rendered=="number"&&typeof g.conversionStart=="number"&&(t.conversion_to_ready=g.rendered-g.conversionStart)),g={},n&&n.sendLog("lightbox_preview","performance",t)}function X(){typeof g.open_to_ready!="number"&&typeof g.typedId=="string"&&(g.interrupted="true",W())}function V(e,t){e=e||{},t=t||{};if(!g.typedId||e.typed_id!==g.typedId&&t.itemTypedID!==g.typedId)typeof g.typedId=="string"&&typeof g.requestStart=="number"&&X(),g={requestStart:(new Date).getTime(),typedId:e.typed_id||t.itemTypedID||"",extension:e.extension||t.itemExtension||""}}function J(e,t){g[e]=t}function K(e){switch(e){case"pending":g.previouslyConverted="false",g.conversionStart||(g.conversionStart=(new Date).getTime());return;case"none":g.error="File type not supported";break;case"error":g.error="Error, likely a permission issue."}g.hasOwnProperty("requestStart")&&(J("rendered",(new Date).getTime()),W())}function Q(t){var n=e.getService("logger"),r=l.typed_id,i=y[r],s=!0,o;i&&i.fromPreviousOrNext&&(s=!i.fromPreviousOrNext),o={typedId:r,isFreshOpenPreview:s,isConversionNeeded:t.isConversionNeeded,extension:l.extension,country_code:C},n&&n.sendLog("lightbox_preview","navigation",o)}function G(){h=!1,T="",N="",x="",s.close(),X()}var t="/index.php?rm=controller_preview_get",n="/index.php?rm=box_master_controller_preview_get",r="/index.php?rm=controller_preview_get_shared",i="/index.php?rm=controller_preview_get_filmstrip",s,o,u,a,f,l,c=[],h,p,d,v=0,m,g={},y={},b=!1,w="",E=!1,S="",x="",T="",N="",C="",k=e.getService("v5");return{messages:["showpreview","lightboxrefreshrequested","closepreview","previewexpired","previewpreviousfile","previewnextfile","previewloaded","previewfilmstripfirstload","previewfilmstripselect"],onmessage:function(e,t){switch(e){case"showpreview":U(t),this.show(a[f]),V(l,t);break;case"lightboxrefreshrequested":this.refresh();break;case"previewexpired":if(!h)break;v++,this.show(a[f],v,t);break;case"closepreview":G();break;case"previewpreviousfile":R(t);break;case"previewnextfile":q(t);break;case"previewloaded":P(),J("rendered",(new Date).getTime()),this.reportMetrics();break;case"previewfilmstripfirstload":this.setFilmstripHTML(t.contentWidth);break;case"previewfilmstripselect":this.showByTypedId(t.typedId)}},init:M,show:B,showPrevious:R,showNext:q,showByTypedId:function(t){f=$.inArray(t,a);if(f>-1){var n=j();e.navigate(n)}},refresh:function(){var t=j();e.navigate(t)},initNavigation:U,reportMetrics:W,reportNavigationMetrics:Q,getPreviewDataAjaxUrl:_,setFilmstripHTML:function(){var t=k.get("Canvas"),n,r,o=e.getService("nav-state"),l=o.get();if(l.type==="f")n={folder_id:l.id,sort:l.sort,direction:l.sortDirection,current_page:l.page,page_size:t.page_size,current_typed_id:a[f],current_item_position:f};else{if(l.type!=="s")return;n={query:l.searchString,current_page:l.page,page_size:t.page_size,sort:l.sort,direction:l.sortDirection,filters:m,current_typed_id:a[f],current_item_position:f}}o.isSharedFolderPage()&&(n.current_page=l.page-1),r=$.getJSON(i,n);var c=u.getTemplateHTML("preview_filmstrip_loading_module_template");s.setFilmstrip(c),s.openFilmstrip(),r.done(function(e){s.setFilmstrip(e.filmstrip_html)})},isCollectionBasedView:function(){var t=k.get("Canvas"),n=e.getService("nav-state");return n.isGcmQuarantinePreview()||n.isUpdates()||n.isPinboard()||n.isProfile()||n.isSearch()||n.isGcmSearch()||n.isSharedFilePage()||t&&t.page_count===1}}}),Box.Timing.execution.push({name:"js/modules/common/legacy-footer.js",time:(new Date).getTime()}),Box.Application.addModule("legacy-footer",function(e){"use strict";var t,n;return{init:function(){t=e.getService("dom"),n=$(e.getElement())},onclick:function(e,n,r){var i;if(n){switch(r){case"legal-link":i=t.getData(n,"url"),i&&this.openLegalPopup(i)}e.preventDefault(),e.stopPropagation()}},openLegalPopup:function(t){var n=e.getService("window-popup"),r;r=n.create(t,{width:700,height:400}),r.show()}}}),Box.Timing.execution.push({name:"js/modules/main/tag-filters.js",time:(new Date).getTime()}),Box.Application.addModule("tag-filters",function(e){"use strict";var t,n;return{messages:["x-folderchangebefore"],init:function(){t=e.getService("v5"),n=$(e.getElement())},onmessage:function(t,r){var i=e.getService("nav-state");t==="x-folderchangebefore"&&(i.isTag()?(this.renderTagFilters(),n.show()):n.hide())},onclick:function(n,r,i){var s=e.getService("dom"),o=t.get("Canvas"),u;r&&(i==="remove-tag-btn"?(u=s.getData(r,"tag-name"),o.tag_collection.remove(u)):i==="remove-all-tags-btn"&&o.tag_collection.remove(),n.preventDefault(),n.stopPropagation())},renderTagFilters:function(){var t,r,i,s,o,u,a=e.getService("nav-state"),f=a.get();s=n.find(".inline_list").empty(),i=$("<li />").html("<strong />").text($t("Filter by","filter_by")),i.appendTo(s),u=f.id.split(",");for(t=0,r=u.length;t<r;t++)o=this.renderTagFilterBadge(u[t],"remove-tag-btn"),o.appendTo(s);s.show()},renderTagFilterBadge:function(e,t){var n=$('<span class="badge filter mhs" />').text(e);return $('<a href="#" />').addClass("mls img_ext sprite_16x16_x_white").attr("data-tag-name",e).attr("data-type",t).appendTo(n).show(),n}}}),Box.Timing.execution.push({name:"js/modules/main/subheader-breadcrumb.js",time:(new Date).getTime()}),Box.Application.addModule("subheader-breadcrumb",function(e){"use strict";function i(e,t,n){$(e).show().position({my:"left top",at:n,of:t})}function s(t,n){var r=t?t.substr(2):0,i=e.getService("nav-url"),s=i.getFolderUrl(r,0,n);e.navigate(s)}var t,n,r;return{messages:["x-folderchangeafter"],init:function(){t=e.getService("v5"),n=e.getService("dom"),r=t.get("Canvas")},destroy:function(){t=null,n=null,r=null},onclick:function(t,r,s){if(r&&!n.hasClass(r,"disabled")){switch(s){case"jump-to-folder-link":this.showJumpToFolderMenu(r);break;case"path-link":e.navigate($(r).attr("href"));break;case"breadcrumb-ellipses-btn":i("#breadcrumb_ellipses_menu",r,"left+12 bottom")}t.preventDefault(),t.stopPropagation()}},onmessage:function(e,t){switch(e){case"x-folderchangeafter":t.json&&t.json.path_html&&this.setPathHTML(t.json.path_html)}},setPathHTML:function(t){var r=e.getService("nav-state");r.isSearch()||n.setHTML(n.query("#main_path"),t)},showJumpToFolderMenu:function(e){var n,i,o=t.get("root_folder_id");r.current_folder&&r.current_folder.typed_id?i=r.current_folder.typed_id:i=o,n=t.get("Box_Menus").folder_picker_menu,n.show({target:e,opened_item_id:i,callback:s})}}}),Box.Timing.execution.push({name:"js/modules/main/actionbar-files.js",time:(new Date).getTime()}),Box.Application.addModule("actionbar-files",function(e){"use strict";var t=$t("You do not have permission to create new items in this folder","files_page_new_items_button_disabled_tip"),n=$t("You do not have permission to upload to this folder","files_page_upload_button_disabled_tip"),r="actionbar-wrapper",i="search",s="tags",o="trash",u,a,f,l,c,h,p,d;return{behaviors:["upload-menu"],messages:["x-folderchangeafter","x-newversionupload"],init:function(){u=e.getService("v5"),a=e.getService("dom"),f=u.get("Canvas"),l=e.getElement(),c=u.get("Box_Menus"),h=$(l),p=e.getService("popups"),d=e.getService("openbox-service-actions"),d.init()},destroy:function(){u=null,a=null,f=null,l=null,c=null,h=null},onclick:function(e,t,n){if(t&&!a.hasClass(t,"disabled")){switch(n){case"create-item-menu-btn":c.create_item_menu.show({target:t}),this.loadDeferredImages();break;case"folder-options-btn":f.current_folder.show_menu({target:t,type:"containing_folder",displayedByMoreButton:!0});break;case"new-box-note-btn":p.open("new_document",{data:{folder_id:f.current_folder.id,type:"boxnote"}});break;default:return}e.preventDefault(),e.stopPropagation()}},onmessage:function(t,n){var r=e.getService("nav-state");switch(t){case"x-folderchangeafter":r.isSearch()?this.changeActionbar(i):r.isTrash()?this.changeActionbar(o):r.isTag()&&this.changeActionbar(s),this.updateButtons();break;case"x-newversionupload":this.updateButtons()}},updateButtons:function(){var e=f.current_folder,r=u.get("window"),i=a.query("#folder_options_button",l);e.id!==r.root_folder_id.substr(2)?a.removeClass(i,"hidden"):a.addClass(i,"hidden");if(e&&e.permissions&&e.permissions.upload){h.attr("data-epoxy")==="icon-button"?h.find("#create_item_button").enable().attr("aria-label",$t("New","actionbar_new_button")):h.find("#create_item_button").enable().removeAttr("data-hover aria-label");if(e.free_space_amount<=0){h.find("#upload_button, #nav_upload_item").disable();var s=e.user_is_owner?$t("You cannot upload because your account is out of space","js_upload_disable_out_of_space"):$t("You cannot upload because the owner of this folder is out of space","js_upload_disable_owner_out_of_space");h.find("#upload_button, #nav_upload_item").attr({"data-hover":"tooltip","aria-label":s})}else h.attr("data-epoxy")==="icon-button"?h.find("#upload_button, #nav_upload_item").enable().attr("aria-label",$t("Upload","actionbar_upload_button")):h.find("#upload_button, #nav_upload_item").enable().removeAttr("data-hover aria-label")}else h.find("#upload_button, #nav_upload_item, #create_item_button").disable(),h.find("#upload_button, #nav_upload_item").attr({"data-hover":"tooltip","aria-label":n}),h.find("#create_item_button").attr({"data-hover":"tooltip","aria-label":t})},changeActionbar:function(e){var t=document.getElementById(r);t&&t.setAttribute("data-actionbar",e)},loadDeferredImages:function(){var t=e.getService("imageloader");t.loadImages(a.query("#actionbar-multiple-selection"))}}}),Box.Timing.execution.push({name:"js/modules/main/actionbar-search.js",time:(new Date).getTime()}),Box.Application.addModule("actionbar-search",function(e){"use strict";var t=["Create_Filter_Type_Menu","Create_Filter_Folder_Tree_Menu","Create_Filter_Date_Menu","Create_Filter_Size_Menu","Create_Filter_Kind_Menu","Create_Filter_Owner_Menu","Create_Filter_Menu"],n=[{type:"folder_tree",value:[0,$t("All Folders","advanced_search_folder_tree_filter_default_text_all_folders")]},{type:"types",value:[]}],r="actionbar-wrapper",i="files",s="trash",o="tags",u,a,f,l;return{messages:["x-searchfilterremove","x-searchfilterchange","x-searchbefore","x-searchafter","x-folderchangeafter"],init:function(){u=e.getService("v5"),a=e.getService("dom"),f={},l=e.getService("templates"),this.initSearchFilters()},destroy:function(){this.hideFilterMenus(),u=null,a=null,f=null,l=null},onclick:function(t,n,r){if(n&&!a.hasClass(n,"disabled"))switch(r){case"search-apply":e.broadcast("x-searchfilterapply"),this.hideFilterMenus();break;case"search-back":this.goBackFromSearch()}},onmessage:function(t,n){var r=e.getService("nav-state");switch(t){case"x-searchbefore":n.isPreloaded||(this.removePagination(),this.showSearchPlaceholders()),this.hideApplyButton(),this.updateSearchFilters(n.filters);break;case"x-searchafter":n.json.selected_users&&this.setSelectedUsers(n.json.selected_users);break;case"x-searchfilterremove":this.handleSearchFilterRemove(n.isFilterChanged);break;case"x-searchfilterchange":this.showApplyButton();break;case"x-folderchangeafter":this.hideFilterMenus(),r.isTrash()?this.changeActionbar(s):r.isFiles()?this.changeActionbar(i):r.isSearch()?this.setSearchTitle(n.json.path_html):r.isTag()&&this.changeActionbar(o)}},addNewFilter:function(e){e.reset_filter(),e.bind_menu(),f[e._filter_type]=e},initSearchFilters:function(){for(var e=0,n=t.length;e<n;e++)this.addNewFilter(new(u.get(t[e])))},hideFilterMenus:function(){for(var e in f)f[e].hide_menu()},goBackFromSearch:function(){var t=u.get("history"),n=e.getService("nav-state");t.back(),n.isTrash()?this.changeActionbar(s):n.isFiles()?this.changeActionbar(i):n.isTag()&&this.changeActionbar(o)},removePagination:function(){$(a.query("#top_pages")).empty()},showSearchPlaceholders:function(){var e=l.getTemplateFragment("search-page-title-placeholder");$(a.query("#main_path")).html(e).show()},hideApplyButton:function(){$(a.query("#search_apply_button")).hide()},showApplyButton:function(){$(a.query("#search_apply_button")).show()},resetFilters:function(){for(var e in f){var t=f[e];t.reset_filter(),t.bind_menu()}},showDefaultFilters:function(){for(var e=0,t=n.length;e<t;e++){var r=n[e];f[r.type].update_filter(r.value)}},updateSearchFilters:function(e){var t,n;e=e||[],this.resetFilters(),e.length||this.showDefaultFilters();for(var r=0,i=e.length;r<i;r++){var s=e[r];t=s.type,n=s.value.split(":"),f[t].update_filter(n)}f.add.has_other_filters()||f.add.hide_add_filter_button()},setSelectedUsers:function(e){f.owner.selected_users=e},handleSearchFilterRemove:function(e){this.hideFilterMenus(),e&&this.showApplyButton()},changeActionbar:function(e){var t=document.getElementById(r);t&&t.setAttribute("data-actionbar",e)},setSearchTitle:function(e){$(a.query("#main_path")).html(e).show()},_getFilters:function(){return f}}}),Box.Timing.execution.push({name:"js/modules/main/actionbar-trash.js",time:(new Date).getTime()}),Box.Application.addModule("actionbar-trash",function(e){"use strict";var t="actionbar-wrapper",n="files",r="search",i="tags",s,o,u,a;return{messages:["x-folderchangeafter"],init:function(){s=e.getService("v5"),o=e.getService("dom"),u=s.get("Canvas"),a=e.getElement()},destroy:function(){s=null,o=null,u=null,a=null},onclick:function(e,t,n){if(t&&!o.hasClass(t,"disabled")){switch(n){case"trash-restore":u.current_folder.restore();break;case"trash-delete":u.current_folder.delete_from_trash();break;default:return}e.preventDefault(),e.stopPropagation()}},onmessage:function(t,s){var o=e.getService("nav-state");switch(t){case"x-folderchangeafter":o.isSearch()?this.changeActionbar(r):o.isTag()?this.changeActionbar(i):o.isTrash()||this.changeActionbar(n),this.updateButtons()}},changeActionbar:function(e){var n=document.getElementById(t);n&&n.setAttribute("data-actionbar",e)},updateButtons:function(){var t=e.getService("nav-state");if(t.isTrash()){var n=o.query("#delete_button",a),r=o.query("#restore_button",a),i=u.collections[u.collections.length-1];i.size()===0?(n.title=$t("There are no items in the trash to delete","actionbar_trash_button_nothing_to_delete_tooltip"),r.title=$t("There are no items in the trash to restore","actionbar_trash_button_nothing_to_restore_tooltip"),o.addClass(n,"disabled"),o.addClass(r,"disabled")):i.can_delete_from_trash()?(n.title=$t("Delete all the items in the trash","actionbar_trash_button_delete_all_tooltip"),r.title=$t("Restore all the itmes in the trash","actionbar_trash_button_restore_all_tooltip"),o.removeClass(n,"disabled"),o.removeClass(r,"disabled")):(n.title=$t("You do not have permission to delete these items","actionbar_trash_button_no_delete_permission_tooltip"),r.title=$t("Restore all the itmes in the trash","actionbar_trash_button_restore_all_tooltip"),o.addClass(n,"disabled"),o.removeClass(r,"disabled"))}}}}),Box.Timing.execution.push({name:"js/modules/main/actionbar-collaborators.js",time:(new Date).getTime()}),Box.Application.addModule("actionbar-collaborators",function(e){"use strict";var t;return{messages:[],init:function(){t=e.getService("dom")},destroy:function(){t=null},onclick:function(n,r,i){if(r&&!t.hasClass(r,"disabled")){switch(i){case"collaborators-add":var s={};e.getService("v5").get("CollaborateAction").create_invite_popup(s,"add_collaborators_button")}n.preventDefault(),n.stopPropagation()}}}}),Box.Timing.execution.push({name:"js/modules/main/view-options.js",time:(new Date).getTime()}),Box.Application.addModule("view-options",function(e){"use strict";function o(e,t){var n=e&&e.length>0,r=t&&t.length>0;return!n&&!r}var t,n,r,i,s;return{messages:["x-folderchangeafter","x-newversionupload"],behaviors:["view-options-menu"],init:function(){t=e.getService("v5"),n=e.getService("dom"),s=t.get("Box_Menus"),i=e.getElement()},destroy:function(){t=null,n=null,r=null,s=null,i=null},onclick:function(e,i,o){if(i&&!n.hasClass(i,"disabled")){switch(o){case"paging-btn":r=r||t.get("Canvas"),r.update_page(i.getAttribute("data-page_num"));break;case"paging-menu-btn":s.paging_menu.show({target:i});break;case"tags-menu-btn":s.tags_menu.toggle({target:i});break;default:return}e.preventDefault(),e.stopPropagation()}},onmessage:function(e,t){switch(e){case"x-folderchangeafter":this.updateCheckbox(t.json.nodes,t.json.items)}},enableCheckbox:function(){var e=n.query(".select_all",i);n.removeClass(e,"disabled")},disableCheckbox:function(){var e=n.query(".select_all",i);n.addClass(e,"disabled")},updateCheckbox:function(e,t){o(e,t)?this.disableCheckbox():this.enableCheckbox()}}}),Box.Timing.execution.push({name:"js/modules/epoxy/import-contacts.js",time:(new Date).getTime()}),Box.Application.addModule("import-contacts",function(e){"use strict";var t;return{init:function(n){t=e.getService("v5")},onclick:function(e,n,r){if(n)switch(r){case"gmail":case"yahoo":case"outlook":t.get("Import_Contacts").show({tab:r})}}}}),Box.Timing.execution.push({name:"js/modules/epoxy/epoxy-sidebar-announcement.js",time:(new Date).getTime()}),Box.Application.addModule("epoxy-sidebar-announcement",function(e){"use strict";var t,n;return{init:function(){t=e.getService("dom"),n=e.getService("cookies");var r=e.getService("logger");r.sendSplitTestLog("epoxy_quadruple_upload_size_existing_user","CLIENT_ANNOUNCEMENT_DISPLAYED")},destroy:function(){t=null,n=null},onclick:function(r,i,s){if(i)switch(s){case"dismiss-announcement":n.set(e.getConfig().cookie_name,1),t.addClass(e.getElement(),"hidden")}}}}),Box.Timing.execution.push({name:"js/modules/pin-board.js",time:(new Date).getTime()}),Box.Application.addModule("pin-board",function(e){"use strict";var t,n={},r,i,s,o,u,a,f=!1,l,c,h,p=function(e,t){var n=e.id.split("_").pop(),r;s.selection.collection.size()>0?r=s.selection.collection:r=s.target_item,r.new_pin({target:n})},d=function(e){if(!e||!e.board_id||!e.html)return;n[e.board_id]=e},v=function(e){var t=n[e];return t?t:null},m=function(e,t){var n={board_id:e},r=$.box.formatQuery(n);$.getJSON(c,r,function(e){d(e),t&&t(e)})};return{messages:["pinboardchanged"],onmessage:function(e,t){e==="pinboardchanged"&&this.refreshItemsLightList(t)},init:function(n){t=$(e.getElement()),r=e.getService("v5"),s=r.get("Canvas"),o=r.get("Box_Menus"),i=e.getService("dom"),u=e.getService("url"),l="/index.php?rm=box_pin_board_delete",c="/index.php?rm=module_controller_get_items_light_list_for_pin_board",h="/index.php?rm=box_pin_board_add",this.attachDragAndDropEvents()},onclick:function(e,t,n){if(t)switch(n){case"add-pin-board-btn":this.showCreatePinBoard();break;case"delete-pin-board-btn":this.showConfirmationToDeletePinBoard(t)}},onmouseover:function(e,t,n){if(t)switch(n){case"pin-board":var r=this,i=$(t);i.find(".delete_pin_board_in_place_cntr").addClass("hover"),i.parent().addClass("hover"),this.displayItemsLightList(i),i.off("mouseleave").on("mouseleave",function(e){r.hideItemsLightList(e.currentTarget),i.find(".delete_pin_board_in_place_cntr").removeClass("hover"),i.parent().removeClass("hover")})}},attachDragAndDropEvents:function(){if(s.use_dragdrop){var e=t.find(".pin_board_list").find("li");e.droppable({accept:".item",area:null,drop:function(e,t){p(e,t)},hoverClass:"pin_board_receiving_drop",doNotResetDrops:!0})}},invalidateCache:function(e){e&&delete n[e]},displayItemsLightList:function(e){if(!e)return;var t,n;a=e,t=e.attr("data-pin-board-id");if(!t)return;f=!0,n=v(t),n&&n.html?r.get("Box_Menus").pin_board_menu.show({target:e,board_id:t,html:n.html}):(o.pin_board_menu.show({target:e,board_id:t,html:$t("Loading...","loading")}),m(t,function(n){n&&n.board_id&&n.board_id==t&&f&&r.get("Box_Menus").pin_board_menu.show({target:e,board_id:t,html:n.html})}))},hideItemsLightList:function(e){f=!1,$(e).hasClass("ignore_mouseout")||r.get("Box_Menus").pin_board_menu.hide()},refreshItemsLightList:function(e){this.invalidateCache(e.pinBoardId),this.displayItemsLightList(a)},showCreatePinBoard:function(){var e=this;$.popup.form($t("Add File Collection","js_popup_add_file_collection"),[{type:"input",label:$t("File Collection Name","js_popup_file_collection_name"),name:"board_name",id:"new_pin_board_name_txt_input"},{type:"buttons",items:{okay:{value:$t("Okay","js_popup_button_okay"),click:function(n,r){if(n.board_name===""){alert($t("Please set name","js_popup_please_set_name")),$.popup.revert();return}var i={board_name:n.board_name,owner_id:s.user.id},o=$.box.formatQuery(i);$.postJSON(h,o,function(n){t.find("#pin_board_list_in_sidebar").append(n.html),$.popup.close(),e.attachDragAndDropEvents()})}},cancel:{value:$t("Cancel","js_popup_button_cancel"),click:$.popup.close}}}]),$("#new_pin_board_name_txt_input").focus()},showConfirmationToDeletePinBoard:function(e){var t=this,n=$(i.getNearest(e,".pin_board_item"));$.popup.confirm($t("Delete Collection","delete_collection_confirmation_title"),$t("Are you sure you want to delete collection %1?","move_item_confirmation_message",n.attr("data-pin_board_name")),null,function(e){e&&t.deletePinBoard(n)})},deletePinBoard:function(t){var n,r,i;n=this,r=t.attr("data-pin-board-id"),i=$.box.formatQuery({pin_board_id:r,owner_id:s.user.id}),$.postJSON(l,i,function(n){if(n.message=="done"){var i=e.getService("nav-state"),s=i.get();s.id==r?u.goToUrl("/files"):t.parent().remove()}})}}}),Box.Timing.execution.push({name:"js/modules/download-apps.js",time:(new Date).getTime()}),Box.Application.addModule("download-apps",function(e){"use strict";function s(){n.sendSplitTestConversion("epoxy_download_apps_sidebar","button_clicked"),n.sendSplitTestConversion("epoxy_sidebar_button_text_take_two","button_clicked"),n.sendSplitTestConversion("why_install_box_link","button_clicked")}function o(e,t){n.sendLog("sidebar_buttons",e,t),n.sendSplitTestLog("epoxy_download_apps_sidebar",e),n.sendSplitTestLog("epoxy_sidebar_button_text_take_two",e),n.sendSplitTestLog("why_install_box_link",e)}var t,n,r,i;return{onclick:function(e,t,n){switch(n){case"sync-button":o("sync_download_cta_button_clicked"),this.downloadSyncAndShowPopup(),s();break;case"why-install-box-link":o("why_install_box_link_clicked"),this.downloadSyncAndShowPopup(),s();break;case"mobile-button":o("mobile_download_cta_button_clicked"),this.showMobilePopup(),s();break;default:}e.preventDefault(),e.stopPropagation()},init:function(){t=e.getService("browser"),n=e.getService("logger"),r=e.getService("popups"),i=e.getService("v5"),o("sidebar_displayed",{has_mobile:document.getElementById("download_mobile")!==null,has_sync:document.getElementById("download_sync")!==null})},downloadSyncAndShowPopup:function(){var n=e.getService("download"),r=i.get("sync4_download_url_base"),s=t.getOSName(),u=s==="Mac";u?r+=i.get("sync4_download_filename_mac"):r+=i.get("sync4_download_filename_win"),n.downloadViaGet(r),this.showSyncPopup(),o("download_sync",{os_name:s})},showSyncPopup:function(){r.open("download_sync"),o("show_sync_popup")},showMobilePopup:function(){r.open("download_mobile_app"),o("show_mobile_popup")}}}),Box.Timing.execution.push({name:"js/modules/common/sidebar-collaborators.js",time:(new Date).getTime()}),Box.Application.addModule("sidebar-collaborators",function(e){"use strict";function s(e){var n=t.get("Item"),r=t.get("Canvas"),i=t.get("box_sidebar"),s=r.users.find(e),o=i.get_current_item(),u=o;o.type!="folder"&&(u=n.find(o.parent)),u&&u.edit_collaborators({action:"remove_access",email:s.email})}function o(){var e=n.find(".sidebar_collaborators_header .arrow");e.removeClass("open").removeClass("sprite_9x9_down_arrow_grey").addClass("sprite_9x9_right_arrow_grey");var t=document.getElementById("sidebar_collaborators_list"),i=document.getElementById("sidebar_collaborators_invite");r.removeClass(t,"is-open"),r.addClass(i,"hidden")}function u(){var e=n.find(".sidebar_collaborators_header .arrow");e.addClass("open").removeClass("sprite_9x9_right_arrow_grey").addClass("sprite_9x9_down_arrow_grey");var t=document.getElementById("sidebar_collaborators_list"),i=document.getElementById("sidebar_collaborators_invite");r.addClass(t,"is-open"),r.removeClass(i,"hidden")}function a(){var e=n.find(".sidebar_collaborators_header .arrow");e&&(e.hasClass("open")?o():u())}function f(n){var r=t.get("Canvas");t.get("Features").collab_popup_redesign?e.getService("popups").open("show_collabs_by_folder",{data:{folderId:r.current_folder.id,collabType:"inherited"}}):r.current_folder.collab_list()}function l(){var n=t.get("Item"),r=t.get("box_sidebar"),i=r.get_current_folder(),s=e.getService("nav-state"),o=s.get();return i&&o&&(o.id!=n.DEFAULT_ROOT_FOLDER_ID.substr(2)||o.isGallery||o.galleryId)}function c(){var n=t.get("Canvas"),r=t.get("User"),s=t.get("Collab"),o=t.get("Features"),a=t.get("Box_All_Contact_Selector"),f=e.getService("url"),c=n.current_folder,h,p=$("#sidebar_collaborators_input").empty(),d=$('<div class="advanced_options gets_hover" style="display: none;"/>'),v,m,g=$('<ul class="inline_list" />'),y=p.data("typed-id"),b="",w=!1,E=!1,S,x=t.get("box_sidebar"),T=e.getService("nav-state"),N=e.getService("imageloader");N.loadImages(e.getElement(),!0),v=$('<li data-type="info-link"/>').append($('<a href="#" />').text($t("Advanced options","advanced_options_link_label"))),m=$("<li />").append($('<div class="mts list_img sprite_16x16_info" />').attr({"data-hover":"tooltip","aria-label":$t("How does this work?","js_contacts_how_work")+"|"+$t("Use 'Advanced options' to restrict access permissions or include a personal message.","js_contacts_how_work_text")})),g.append(v),g.append(m),d.append(g);if(c){h=r.find(c.user_id);if(l()){var C=e.getConfig();c.update_collabs(C),u()}h&&(E=h.is_external_collab_restricted
),w=c.restrict_collab_to_company||E,w&&(b=s.getCollabWarningWhenCollabRestrictedForItemOwner(c.owner_enterprise_display_domain))}S=function(){w&&s.render_restricted_collab_warning_flyout(this._j_container,"sidebar_restricted_collab_flyout",b),d.show()},T.isGcm()&&(y="d_0"),i=new a({j_component:p,show_dropdown_toggler:!1,include_network_contacts:!0,item_typed_id:y,no_results_label:$t("No matching contacts","no_results_label_contact_selector_invite_collabs"),show_advanced_options:!0,hide_no_results_item:!0,ui_elements_to_append:[d],on_first_focus_callback:S}),T.isGcm()&&(i.filter.rm=f.getGcmCompatibleRmUrl("box_contacts_get",!0)),x.populate_canvas_collabs()}function h(r,i){var s=t.get("box_sidebar"),o=s.get_current_folder(),u=e.getService("nav-state");if(!l())return;i=i||{};var a=!!i.hideElementsForGCM,f=!!i.forceLoadAll,h={folder_id:o.id,hide_elements_for_gcm:a,just_collab_section:!0};f||(h.number_of_collaborators_to_load=8);var p=$.box.formatQuery(h),d=e.getService("url"),v=d.getGcmCompatibleRmUrl("box_collaborate_get_sidebar");$.ajax({dataType:"json",url:v,data:p,success:function(t){o.update_collabs(t);var i=e.getService("dom"),a;s.populate_canvas_collabs(),u.isGcm()?(i.setHTML(n,t.sidebar_html),c()):i.setHTML(n.parent(),t.sidebar_html),n.data("rendered","1"),s.get_current_folder().all_collaborators_loaded=t.all_collabs_loaded,a=n.children(".icon_list"),a.hide(),a.slideDown(500),typeof r=="function"&&r()}})}function p(){var n=t.get("Canvas"),r=n.user,i=n.current_folder,s="/index.php?rm=get_collab_names_and_emails_for_item",o,u;u={item_typed_id:i.typed_id},$.getJSON(s,u,function(t){t.result==="error"?e.getService("popups").alert($t("There was an error fetching collaborators who would be mailed","mail_collabs_error")):(o=t.collab_names_and_emails,r.mail_collaborators(o))})}function d(){var n=e.getService("logger"),r=e.getService("popups"),s=t.get("Canvas"),o=s.current_folder;o&&(r.open("collaborate",{data:{typed_id:o.typed_id,prepopulated_users:i.get_full_selected_options()}}),n.sendLog("sharing","INVITE_COLLABORATORS_ADVANCED_OPTIONS_CLICK",{location:"SIDEBAR"}))}function v(e){var n=t.get("Collab"),r=t.get("Canvas"),i=r.current_folder;e.length&&n.collab_form_submit({message:$t("I'd like to share my files with you on Box","collab_invite_default_share_message"),folder_typed_id:i.typed_id,folder_name:i.name,permission:"Editor",location:"all-files",emails:e})}function m(){var n=t.get("Collab"),r=t.get("Canvas"),s=r.current_folder,o=t.get("Box_Event_Tracker"),u=e.getService("popups"),a=i.get_restricted_and_unrestricted_collab_emails(),f=a.restricted_collab_emails,l=a.unrestricted_collab_emails;if(f.length){n.render_restricted_email_popup(f,s,function(){v(l)});return}l.length?v(l):(o.set_category("Files - Side bar"),u.open("collaborate",{data:{typed_id:s.typed_id}}))}function g(e,n,r,i){var s=t.get("Box_Event_Tracker"),o=t.get("Box_Menus");s.set_category("Collaborator mouseover"),o.user_menu.show({_target:e,user:n,this_folder_only:i,profile_link:r,expiration:n.collab_in_current_folder&&n.collab_in_current_folder[0].expiration})}var t,n,r,i;return{messages:["x-previeweropen","x-collabchange","x-searchafter"],init:function(){t=e.getService("v5"),n=$(e.getElement()),r=e.getService("dom"),c(),e.broadcast("x-collabwidgetinit")},onmessage:function(e,t){switch(e){case"x-previeweropen":o();break;case"x-collabchange":h(function(){},t);break;case"x-searchafter":n.empty()}},onclick:function(e,t,n){var i=r.getData(t,"user-id"),o=r.getData(t,"user-email");if(t&&!r.hasClass(t,"disabled")){switch(n){case"remove-btn":s(i||o);break;case"toggle-list-btn":a();break;case"show-more-btn":f(r.getData(t,"hide-elements-for-gcm"));break;case"mail-link":p();break;case"info-link":d();break;case"submit-btn":m();break;default:return}e.preventDefault(),e.stopPropagation()}},onmouseover:function(e,n,i){var s=r.getData(n,"user-id"),o=r.getData(n,"user-email"),u=r.getData(n,"show-profile-link"),a=r.getData(n,"this-folder-only"),f=t.get("User"),l;n&&!r.hasClass(n,"disabled")&&i=="user-listing"&&(l=s?f.find(s):f.find_collab_data_by_email(o),g(n,l,u,a))}}}),Box.Timing.execution.push({name:"js/modules/common/notifications.js",time:(new Date).getTime()}),Box.Application.addModule("notifications",function(e){"use strict";var t,n,r,i;return{messages:["x-folderchangeafter"],init:function(){t=e.getService("v5"),n=e.getService("dom"),r=$(e.getElement()),i=e.getService("notifications"),i.displayServerNotification()},onmessage:function(e,t){e==="x-folderchangeafter"&&this.handleFolderChangeAfter(t.json)},handleFolderChangeAfter:function(e){e.is_from_instant_login&&i.confirm($t("Results owned by external collaborators have been omitted.","external_collab_content_omitted"))}}}),Box.Timing.execution.push({name:"js/modules/common/legacy-confirmations.js",time:(new Date).getTime()}),Box.Application.addModule("legacy-confirmations",function(e){"use strict";var t,n,r="/index.php?rm=box_services_accept_app_folder",i="/index.php?rm=box_services_reject_app_folder";return{messages:[],init:function(){t=e.getService("dom"),n=e.getService("notifications")},onclick:function(e,n,r){var i,s,o,u;if(n){switch(r){case"accept-app-invite-link":o=$(t.getNearest(n,"form")),u=t.getNearest(n,".app_folder_invite_row"),i=o.find('[name="service_id"]').val(),this.acceptAppFolderInvite(i,u);break;case"reject-app-invite-link":o=$(t.getNearest(n,"form")),u=t.getNearest(n,".app_folder_invite_row"),i=o.find('[name="service_id"]').val(),s=o.find('[name="service_name"]').val(),this.rejectAppFolderInvite(i,s,u)}e.preventDefault(),e.stopPropagation()}},acceptAppFolderInvite:function(e,t){$.postJSON(r,{service_id:e},function(n){n.result==="success"&&$(t).find(".app_folder_invite_actions").html(n.html)})},rejectAppFolderInvite:function(e,t,r){$.popup.confirm($t("Revoke app access to Box","revoke_app_access_to_box_title"),$t("After revoking access, %1 will no longer have access to your Box account. Are you sure you want to continue?","revoke_app_access_confirmation_message",t),{okay_button:$t("Revoke access","revoke_app_access_button")},function(t){if(!t)return;$.postJSON(i,{service_id:e},function(t){if(t.result==="success"){var i=$(r).parent();$(r).remove(),i.find(".app_folder_invite_row").length||n.hide()}})})}}}),Box.Timing.execution.push({name:"js/modules/common/page.js",time:(new Date).getTime()}),Box.Application.addModule("page",function(e){"use strict";return{init:function(){}}}),Box.Timing.execution.push({name:"js/modules/menus/breadcrumb-ellipses-menu.js",time:(new Date).getTime()}),Box.Application.addModule("breadcrumb-ellipses-menu",function(e){"use strict";var t,n,r,i,s;return{messages:["x-folderchangeafter"],init:function(){t=e.getService("v5"),n=e.getService("dom"),r=$("#breadcrumb_ellipses_menu"),i=r[0],r.menu(),this.setupHoverBehavior()},destroy:function(){r.menu("destroy"),t=null,n=null,r=null,i=null,s=null},onclick:function(t,n,i){if(n){switch(i){case"path-link":e.navigate(n.href),window.setTimeout(function(){r.hide()},500)}t.preventDefault(),t.stopPropagation()}},onmessage:function(e,t){switch(e){case"x-folderchangeafter":var n=t.json.sub_path_html,r=t.json.is_scrollable_ellipses_menu;n&&this.updateMenuItems(n,r)}},setupHoverBehavior:function(){var e=$("#breadcrumb_ellipses_menu, .breadcrumb_item_link");e.mouseleave(function(){s=window.setTimeout(function(){r.hide()},100)}),e.mouseenter(function(){s&&window.clearInterval(s)})},updateMenuItems:function(e,t){r.menu("destroy"),r.empty().append(e),t?(n.addClass(r,"scrollable"),r.css("height","350px")):(n.removeClass(r,"scrollable"),r.css("height","auto")),r.menu().hide()}}}),Box.Timing.execution.push({name:"js/box_base.js",time:(new Date).getTime()});var Box_Base=Base.extend({constructor:function(e){this.set_params(e)},set_params:function(e){e=e||{};for(var t in e)this[t]=e[t];return this}},{});Box.Timing.execution.push({name:"js/filters/box_abstract_filter.js",time:(new Date).getTime()});var Box_Abstract_Filter=Box_Base.extend({_query:null,_filtered_options:{},_load_all_results:{},_on_complete_callback:null,_load_all_completed:!1,constructor:function(e){this._filtered_options={},this._load_all_results={},this.base(e)},set_on_complete_callback:function(e){this._on_complete_callback=e},run:function(e){if(!this._filtered_options[e]){if(!$.isFunction(this._filter_callback))return;this._filter_callback(e)}else this._complete_filter(e,this._filtered_options[e])},load_all:function(){this._load_all_completed?this._complete_load_all(this._load_all_results):this._load_all_callback()},_complete_load_all:function(e){this._load_all_completed||(this._load_all_completed=!0,this._load_all_results=e),$.isFunction(this._on_complete_callback)&&this._on_complete_callback("",e),this._query=""},_complete_filter:function(e,t){this._cache_filtered_results(e,t),$.isFunction(this._on_complete_callback)&&this._on_complete_callback(e,t),this._query=e},_cache_filtered_results:function(e,t){this._filtered_options[e]={};for(var n in t)this._filtered_options[e][n]=t[n]},_filter_callback:function(e){},_load_all_callback:function(){}},{});Box.Timing.execution.push({name:"js/filters/box_abstract_contact_filter.js",time:(new Date).getTime()});var Box_Abstract_Contact_Filter=Box_Abstract_Filter.extend({folder_typed_id:null,item_typed_id:null,filter_request:null,constructor:function(e){this.base(e)},run:function(e){this._clear_filter_request(),this.base(e)},_load_all_callback:function(){var e=this;this._get_contacts("",function(t,n){e._complete_load_all(n)})},_filter_callback:function(e){if(e===!1)return;var t=this;this._get_contacts(e,function(e,n){t._complete_filter(e,n)})},_clear_filter_request:function(){this.filter_request&&clearTimeout(this.filter_request)},_get_contacts:function(e,t){this.filter_request&&clearTimeout(this.filter_request);var n=Box_Abstract_Contact_Filter.REQUEST_MAX_DELAY-(e.length-1)*Box_Abstract_Contact_Filter.REQUEST_DELAY_BACKOFF;n=Math.max(Box_Abstract_Contact_Filter.REQUEST_MIN_DELAY,n);var r=this,i=this._create_params_callback(e);this.filter_request=setTimeout(function(){$j.getJSON("/index.php?rm="+r.rm,i,function(n){var i=r._process_results_callback(n);t(e,i)})},n)}},{REQUEST_MAX_DELAY:1e3,REQUEST_MIN_DELAY:250,REQUEST_DELAY_BACKOFF:250});Box.Timing.execution.push({name:"js/filters/box_item_contact_filter.js",time:(new Date).getTime()});var Box_Item_Contact_Filter=Box_Abstract_Contact_Filter.extend({item_typed_id:null,include_pending_collabs:!1,rm:"box_contacts_get_for_item",constructor:function(e){this.base(e)},_create_params_callback:function(e){var t={search_string:e,item_typed_id:this.item_typed_id,include_pending_collabs:this.include_pending_collabs?1:0};return t},_process_results_callback:function(e){var t=e.contacts,n=e.is_uploader,r=this._process_results_list(t,"id","contact_name","email",n,!0),i=this._process_results_list(e.pending_collabs,"email","email","email");return $.extend(r,i)},_process_results_list:function(e,t,n,r,i,s){var o={};if(e)for(var u=0,a=e.length;u<a;u++){var f=e[u];if(f[t]){var l=f[t],c=i&&i[l],h=f.is_edit_disabled_in_enterprise;o[l]={name:f[n],email:f[r],is_uploader:c,is_edit_disabled_in_enterprise:h,not_selectable:s&&(h||c)}}}return o}},{});Box.Timing.execution.push({name:"js/filters/box_all_contact_filter.js",time:(new Date).getTime()});var Box_All_Contact_Filter=Box_Abstract_Contact_Filter.extend({item_typed_id:null,include_self:!1,rm:"box_contacts_get",constructor:function(e){this.base(e)},_create_params_callback:function(e){return{search_string:e,item_typed_id:this.item_typed_id,include_self:this.include_self?1:0}},_process_results_callback:function(e){var t={},n=e.contacts,r=null;for(var i=0,s=n.length;i<s;i++)r=n[i],t[r.id]={name:r.contact_name,email:r.email};n=e.collabs_without_account;for(var i=0,s=n.length;i<s;i++)r=n[i],t[r.email]={name:r.email,email:r.email};n=e.friends_without_account;for(var i=0,s=n.length;i<s;i++)r=n[i],t[r.email]={name:r.contact_name,email:r.email};return t}},{});Box.Timing.execution.push({name:"js/filters/box_folder_tree_search_filter.js",time:(new Date).getTime()});var Box_Folder_Tree_Search_Filter=Box_Abstract_Filter.extend({constructor:function(e){this.base(e)},load_all:function(){},_filter_callback:function(e){var t=this,n="/index.php?rm=box_quick_search",r=$j.box.formatQuery({search_string:e,folder_tree_search:!0,search_type:"folder",sort:"relevance"});$j.getJSON(n,r,function(n){t._complete_filter(e,n.items)})}},{});Box.Timing.execution.push({name:"js/selectors/box_abstract_selector.js",time:(new Date).getTime()});var Box_Abstract_Selector=Box_Base.extend({_j_component:null,_j_container:null,_filter:null,_dropdown:null,_state_machine:{},_mouse_state_machine:{},create_container:!1,dropdown_toggler_sprite:"sprite_16x16_contacts",show_dropdown_toggler:!0,placeholder_text:"",placeholder_offset:{},allow_empty_query:!1,on_first_focus_callback:null,use_commas_to_select:!0,_first_focus:!1,z_index:2,constructor:function(e,t,n){n=n||{};var r=this;this.base(n),"z_index"in n&&(this.z_index=n.z_index),this._init_state_machine(),this._options={},$.isFunction(this._init_callback)&&this._init_callback(),this._filter=e,this._dropdown=t,this._filter.set_on_complete_callback(function(e,t){r._complete_filter(e,t)}),this._dropdown.set_on_select_callback(function(e){r._state_machine.dispatch(Box_Abstract_Selector.EVENTS.MOUSE_SELECT,e),r._j_input.trigger("change")}),this._create_ui_components(n)},_init_state_machine:function(){var e=this,t=Box_Abstract_Selector.STATES,n=Box_Abstract_Selector.EVENTS;this._state_machine=new Box_State_Machine(t.IDLE),this._state_machine.add_state({id:t.IDLE,transitions:{FOCUS:t.TYPING,KEYUP:t.TYPING,TOGGLE_DROPDOWN:t.DROPDOWN_LOCKED,MOUSE_SELECT:t.DROPDOWN_LOCKED},callbacks:{ON_ENTER:function(){e._hide_dropdown(!0)}}}),this._state_machine.add_state({id:t.DROPDOWN_LOCKED,transitions:{FOCUS:t.TYPING,MOUSE_SELECT:this.show_dropdown_toggler?t.IDLE:t.DROPDOWN_LOCKED,TOGGLE_DROPDOWN:t.IDLE},callbacks:{ON_ENTER:function(){e._load_all()}}}),this._state_machine.add_state({id:t.TYPING,transitions:{DOWN:t.SELECTING,UP:t.SELECTING,KEYUP:t.TYPING,BLUR:t.IDLE,MOUSE_SELECT:t.TYPING,TOGGLE_DROPDOWN:t.DROPDOWN_LOCKED,KEY_SELECT:t.TYPING,TEXT_SELECT:t.TYPING},callbacks:{ON_ENTER:function(){e._j_input.trigger("focus",{triggered:!0}),e._dropdown.reset_highlight_index(),e._search()}}}),this._state_machine.add_state({id:t.SELECTING,transitions:{DOWN:t.SELECTING,UP:t.SELECTING,KEYUP:t.TYPING,BLUR:t.IDLE,MOUSE_SELECT:t.TYPING,KEY_SELECT:t.TYPING}}),this._state_machine.on_transition(n.DOWN,function(){e._dropdown.highlight_next_option(!0)}),this._state_machine.on_transition(n.UP,function(){e._dropdown.highlight_previous_option(!0)}),this._state_machine.on_transition(n.MOUSE_SELECT,function(t,n){e._on_select_callback(t,n)}),this._state_machine.on_transition(n.KEY_SELECT,function(t){e._select_by_index(t)}),this._state_machine.on_transition(n.TEXT_SELECT,function(t){e._select_by_text(t)}),this._mouse_state_machine=new Box_State_Machine(t.MOUSEOUT),this._mouse_state_machine.add_state({id:t.MOUSEOUT,transitions:{MOUSEOVER:t.MOUSEOVER}}),this._mouse_state_machine.add_state({id:t.MOUSEOVER,transitions:{MOUSEOUT:t.MOUSEOUT}})},_create_ui_components:function(e){var t=this;e.j_component?this._j_component=e.j_component:this._j_component=$j("#"+e.component_id),e.j_input?this._j_input=e.j_input:this._j_input=$j('<input type="text" />'),this._j_component.hide().addClass("option_selector").css({position:"relative","z-index":this.z_index}).on("mouseover",function(e){t._event_mouseover(e)}).on("mouseleave",function(e){t._event_mouseout(e)}),this._j_input.attr({autocomplete:"off"}).addClass("input_filter_transparent").on("keyup",function(e,n){return t._event_keyup(e,n)}).on("keydown",function(e){return t._event_keydown(e)}).on("keypress",function(e){return t._event_keypress(e)}).on("blur",function(e){t._event_blur(e)}).on("focus",function(e,n){t.on_first_focus_callback&&!t._first_focus&&(t.on_first_focus_callback(),t._first_focus=!0),t._event_focus(e,n&&n.triggered)});var n=this._j_component;Canvas.get().register_body_click_handler(this);if(this.create_container||this.show_dropdown_toggler)this._j_container=$j('<div class="input full_width_input selector_input_box"/>').on("click",function(e){return t._event_click(e),!1}),this._j_container.appendTo(this._j_component),n=this._j_container;this.show_dropdown_toggler&&$('<a id="dropdown_toggler" class="dropdown_toggler_icon img_ext" href="#" />').addClass(this.dropdown_toggler_sprite).prependTo(this._j_container).click(function(e){t._event_toggle_dropdown(),t._j_input.focus()}),this._j_input.appendTo(n),this._dropdown.get_ui_component().appendTo(this._j_component);if(this.ui_elements_to_append){var r=this.ui_elements_to_append;for(var i=0,s=r.length;i<s;i++)this._j_component.append(r[i])}this._j_component.show()},body_click_handler:function(e){this.clear_input_on_hide_dropdown&&this._clear_input(),this._hide_dropdown()},_add_placeholder_text:function(){this.placeholder_text?this._j_input.attr("placeholder",this.placeholder_text):this.placeholder_text=this._j_input.attr("placeholder");var e,t,n,r,i;this.placeholder_offset&&(e=this.placeholder_offset.top_IE||4,t=this.placeholder_offset.left_IE||0,n=this.placeholder_offset.top||0,r=this.placeholder_offset.left||0,i=this.placeholder_offset.force_block||!1),this._j_input.placeholderize({extraMarginTopIE:e,extraMarginLeftIE:t,extraMarginTop:n,extraMarginLeft:r,forceBlock:i})},_event_focus:function(e,t){if(!t){var n=Box_Abstract_Selector.STATES,r=this._state_machine.is_in_state(n.TYPING)||this._state_machine.is_in_state(n.SELECTING);r&&this._dropdown._j_dropdown.is(":visible")?this._hide_dropdown():(this._show_dropdown(),this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.FOCUS))}},_event_click:function(e){return e.target.id!="dropdown_toggler"&&!$j(e.target).hasClass("delete_badge")&&this._j_input.focus(),!1},_event_keyup:function(e){var t=Box_Abstract_Selector.EVENTS,n=Box_Abstract_Selector.STATES;if(e.keyCode==Box_Abstract_Selector.KEY.ESCAPE)return!1;var r=this._state_machine.is_in_state(n.TYPING)||this._state_machine.is_in_state(n.SELECTING);return(e.keyCode!=Box_Abstract_Selector.KEY.DOWN&&e.keyCode!=Box_Abstract_Selector.KEY.UP&&e.keyCode!=Box_Abstract_Selector.KEY.BACKSPACE||e.keyCode==Box_Abstract_Selector.KEY.BACKSPACE&&r)&&this._state_machine.dispatch(t.KEYUP),!0},_event_keydown:function(e){var t=!1;if(e.keyCode==Box_Abstract_Selector.KEY.DOWN||e.keyCode==Box_Abstract_Selector.KEY.UP){t=this._dropdown._j_dropdown.is(":visible");if(t){var n=e.keyCode==Box_Abstract_Selector.KEY.DOWN?Box_Abstract_Selector.EVENTS.DOWN:Box_Abstract_Selector.EVENTS.UP;return this._state_machine.dispatch(n),!1}}else{if(e.keyCode==Box_Abstract_Selector.KEY.ESCAPE)return this._hide_dropdown(),!1;if(e.keyCode==Box_Abstract_Selector.KEY.BACKSPACE&&this._query_is_empty()&&this._dropdown._j_dropdown.is(":visible"))this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.KEYUP);else if(this._can_autocomplete_with_tab_or_enter_key(e)){var r=this._dropdown.get_highlighted_option_index();return r!=null?this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.KEY_SELECT,r):this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.TEXT_SELECT,$j.trim(this._query())),!1}}return!0},_event_keypress:function(e){var t=e.charCode||e.keyCode;return this.use_commas_to_select&&t==Box_Abstract_Selector.CHARCODE.COMMA?(this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.TEXT_SELECT,$j.trim(this._query())),!1):!0},_can_autocomplete_with_tab_or_enter_key:function(e){var t=e.keyCode==Box_Abstract_Selector.KEY.TAB||e.keyCode==Box_Abstract_Selector.KEY.ENTER,n=this._dropdown._j_dropdown.is(":visible"),r=this._query_is_valid()&&!this.ignore_tab_and_enter_keys_for_valid_query;return t&&(n||r)},_event_mouseout:function(e){$j(e.relatedTarget).parents().hasClass("option_selector")||this._mouse_state_machine.dispatch(Box_Abstract_Selector.EVENTS.MOUSEOUT)},_event_mouseover:function(e){this._mouse_state_machine.dispatch(Box_Abstract_Selector.EVENTS.MOUSEOVER)},_event_blur:function(e){this._mouse_state_machine.is_in_state(Box_Abstract_Selector.STATES.MOUSEOUT)&&this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.BLUR)},_event_toggle_dropdown:function(){this._j_component.attr("disabled")||this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.TOGGLE_DROPDOWN)},_search:function(){this._filter_options(this._query())},_complete_filter:function(e,t,n){if(this._state_machine.is_in_state(Box_Abstract_Selector.STATES.DROPDOWN_LOCKED)||this._query()==e){var r=(this.show_dropdown_toggler||this.allow_empty_query)&&e==""?!1:this._filter._query==e;this._dropdown.highlight_and_populate(e,t,r,n),this._position_dropdown()}},_filter_options:function(e){this._query_is_valid()?this._filter.run(e):this._hide_dropdown()},_load_all:function(){this._filter.load_all()},_position_dropdown:function(){var e=this._j_container?this._j_container:this._j_input;this._dropdown.position(e.outerHeight(),e.outerWidth())},_query:function(){return $j.trim(this._j_input.val())},_query_is_empty:function(){return this._query()==""},_query_is_valid:function(){return this.allow_empty_query||!this._query_is_empty()},_clear_input:function(){this._j_input.val("")},_show_dropdown:function(){this._dropdown.show()},_hide_dropdown:function(){this._dropdown.hide()},_on_select_callback:function(e){},_select_by_text:function(e){},_load_all_options_callback:function(){}},{KEY:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,UP:38,DOWN:40},CHARCODE:{COMMA:44},STATES:{IDLE:"IDLE",TYPING:"TYPING",SELECTING:"SELECTING",MOUSEOUT:"MOUSEOUT",MOUSEOVER:"MOUSEOVER",DROPDOWN_LOCKED:"DROPDOWN_LOCKED"},EVENTS:{UP:"UP",DOWN:"DOWN",BLUR:"BLUR",FOCUS:"FOCUS",KEYUP:"KEYUP",MOUSEOVER:"MOUSEOVER",MOUSEOUT:"MOUSEOUT",MOUSE_SELECT:"MOUSE_SELECT",KEY_SELECT:"KEY_SELECT",TEXT_SELECT:"TEXT_SELECT",TOGGLE_DROPDOWN:"TOGGLE_DROPDOWN",NOOP:"NOOP"}});Box.Timing.execution.push({name:"js/selectors/box_option_selector.js",time:(new Date).getTime()});var Box_Option_Selector=Box_Abstract_Selector.extend({_options:{},_option_is_selected:{},_selection_count:0,allow_not_selectable_items:!1,allow_item_not_in_list:!0,_on_option_added:null,_on_option_removed:null,constructor:function(e,t,n){var r=n.default_selections;delete n.default_selections,this._options={},this._option_is_selected={},n.callbacks&&(this._on_option_added=n.callbacks._on_option_added||null,this._on_option_removed=n.callbacks._on_option_removed||null),this.base(e,t,n);for(var i in r)this._add_option(i,r[i]),this._on_select_callback(i)},_is_selected:function(e){return this._option_is_selected[e]},_select_by_index:function(e){var t=this._dropdown.get_key_from_index(e);t&&this._on_select_callback(t)},_select_by_text:function(e){if(!e)return;var t=null;for(var n in this._options)if(this._option_is_match_callback&&this._option_is_match_callback(this._options[n],e)){t=[n];if(!this._option_is_selected[n])break}if(!t&&this._add_option_from_text_callback&&this.allow_item_not_in_list){if(this._validate_text_callback&&!this._validate_text_callback(e))return!1;t=this._add_option_from_text_callback(e)}if(t)for(var r=0,i=t.length;r<i;r++){var s=t[r];s&&!this._option_is_selected[s]&&this._on_select_callback(s)}},_create_unique_key:function(e){return e+jQuery.now()},_deselect:function(e){this._remove_from_selected_options(e),this._repopulate_dropdown(),this._position_dropdown()},_has_option_selected:function(){var e;for(e in this._option_is_selected)return!0;return!1},_add_to_selected_options:function(e){this._selection_count++,this._option_is_selected[e]=!0,this._on_option_added&&this._on_option_added(this._selection_count,e)},_remove_from_selected_options:function(e){this._selection_count--,delete this._option_is_selected[e],this._on_option_removed&&this._on_option_removed(this._selection_count)},_repopulate_dropdown:function(){var e={};for(var t in this._dropdown._available_options)this._option_is_selected[t]||(e[t]=this._dropdown._available_options[t]);this._dropdown._populate(e)},_get_selected_keys:function(){var e=[],t=this._option_is_selected;return $j.each(t,function(t,n){e.push(t)}),e},_complete_filter:function(e,t,n){var r={},i=!1;for(var s in t)this._add_option(s,t[s]),this._is_selected(s)||(r[s]=t[s],i=!0);i&&n&&n.hide_no_results&&(n.hide_no_results=!1),this.base(e,r,n)},_add_option:function(e,t){return this._options[e]=t,t},value:function(){return this._query()},get_full_selected_options:function(){var e={};for(var t in this._option_is_selected)e[t]=this._options[t];return e},_on_select_callback:function(e){if(!this._is_selected(e)&&(!this.allow_not_selectable_items||!this._options[e].not_selectable)){this._add_to_selected_options(e),this._dropdown.remove(e);var t=this;return window.setTimeout(function(){t._hide_dropdown()},0),$j.isFunction(this._filter._clear_filter_request)&&this._filter._clear_filter_request(),!0}return!1}},{});Box.Timing.execution.push({name:"js/selectors/box_badge_selector.js",time:(new Date).getTime()});var Box_Badge_Selector=Box_Option_Selector.extend({_j_badges:{},_badge_keys:[],_j_input_container:null,_j_input:null,constructor:function(e,t,n){this.reset_badges(),n.create_container=!0,this.base(e,t,n)},_init_state_machine:function(){var e=this;this.base();var t=Box_Abstract_Selector.STATES,n=Box_Badge_Selector.STATES,r=Box_Badge_Selector.EVENTS;this._state_machine.add_state({id:n.BACKSPACE_ONCE,transitions:{BACKSPACE:n.BACKSPACE_TWICE,KEYUP:t.TYPING,TOGGLE_DROPDOWN:t.DROPDOWN_LOCKED},callbacks:{ON_ENTER:function(){e._hide_dropdown()}}}),this._state_machine.add_state({id:n.BACKSPACE_TWICE,transitions:{BACKSPACE:n.BACKSPACE_ONCE,KEYUP:t.TYPING,TOGGLE_DROPDOWN:t.DROPDOWN_LOCKED},callbacks:{ON_ENTER:function(){e._remove_last()}}}),this._state_machine.add_transition(r.REMOVE_BADGE,t.DROPDOWN_LOCKED,t.DROPDOWN_LOCKED),this._state_machine.add_transition(r.REMOVE_BADGE,t.TYPING,t.TYPING),this._state_machine.add_transition(r.REMOVE_BADGE,t.SELECTING,t.TYPING),this._state_machine.add_transition(r.REMOVE_BADGE,t.IDLE,t.TYPING),this._state_machine.add_transition(r.BACKSPACE,t.TYPING,n.BACKSPACE_ONCE),this._state_machine.add_transition(r.REMOVE_BADGE,n.BACKSPACE_ONCE,t.TYPING),this._state_machine.on_transition(r.REMOVE_BADGE,function(t){e._deselect(t)})},_create_ui_components:function(e){this.base(e),this._j_input_container=$('<ul class="inline_list mbn mtn"></ul>'),this._j_input_item=$('<li class="pan badge_selector_input_item"></li>'),this._j_input_container.appendTo(this._j_container),this._j_input_item.appendTo(this._j_input_container),this._j_input.appendTo(this._j_input_item),this._add_placeholder_text()},_add_placeholder_text:function(){var e={elementToCheck:this._j_component,elementToCheckSelector:".pill",fontSize:"12px",skipModernBrowsers:!1,delayInitialTextUpdate:!0};this.placeholder_text&&this._j_input.attr("placeholder",this.placeholder_text),this._j_input.placeholderize(e)},_event_keydown:function(e){return e.keyCode==Box_Abstract_Selector.KEY.BACKSPACE&&this._query_is_empty()&&this._has_option_selected()?(this._state_machine.dispatch(Box_Badge_Selector.EVENTS.BACKSPACE),!0):this.base(e)},_remove_last:function(){var e=this._badge_keys.length;e>0&&this._deselect(this._badge_keys[e-1])},_remove_badge:function(e){this._j_badges[e]&&(this._badge_keys.splice($.inArray(e,this._badge_keys),1),this._badge_values.splice($.inArray(this._options[e],this._badge_values),1),this._j_badges[e].hide(),this._j_input.change())},remove_all_badges:function(){var e=this._badge_keys.length;while(e>0)this._deselect(this._badge_keys[e-1]),e--;return this.reset_badges(),!0},reset_badges:function(){this._j_badges={},this._badge_keys=[],this._badge_values=[]},_add_badge:function(e){var t=this,n=this._options[e];typeof n!="undefined"&&(n.id=e);if(!this._j_badges[e]){this._j_badges[e]=$('<li class="pan mbs mrs"><span></span></li>');var r=this._j_badges[e].find("span");r.addClass(this._create_badge_style(this._options[e])).text(this._create_badge_label(this._options[e])).append('<div class="delete_badge_container"><a href="#" class="mls delete_badge">&#215;</a></div>'),$j.isFunction(this._update_badge_color)&&this._update_badge_color(e)}this._j_badges[e].find("a").click(function(n){return t._state_machine.dispatch(Box_Badge_Selector.EVENTS.REMOVE_BADGE,e),!1}),this._j_badges[e].show().insertBefore(this._j_input_item),this._j_badges[e].css({display:"inline-block"}),this._badge_values.push(n),this._badge_keys.push(e)},_deselect:function(e){this._remove_badge(e),this.base(e)},_on_select_callback:function(e){this.base(e)&&(this._clear_input(),this._add_badge(e))},_create_badge_label:function(e){return e},_create_badge_style:function(e){return Box_Badge_Selector.DEFAULT_PILL_CLASS}},{STATES:{BACKSPACE_ONCE:6,BACKSPACE_TWICE:7},EVENTS:{BACKSPACE:"BACKSPACE",REMOVE_BADGE:"REMOVE_BADGE"},DEFAULT_PILL_CLASS:"pill"});Box.Timing.execution.push({name:"js/selectors/box_folder_tree_search_selector.js",time:(new Date).getTime()});var Box_Folder_Tree_Search_Selector=Box_Option_Selector.extend({_j_component:null,_hide_after_select:!1,_select_callback_passed_from_caller:function(){},constructor:function(e){e=e||{};var t=this;$.extend(e,{allow_empty_query:!1,use_commas_to_select:!1,show_dropdown_toggler:!1,create_container:!0,placeholder_text:$t("Type a folder name to search","folder_tree_search_box_placeholder"),no_results_label:$t("No matching folders","folder_tree_search_no_results_label")}),e.j_component?this._j_component=e.j_component:this._j_component=e.j_component=this._create_selector_container(),this._hide_after_select=e.hide_after_select||!1;var n=new Box_Folder_Tree_Search_Dropdown,r=new Box_Folder_Tree_Search_Filter;this.base(r,n,e);var i=this._j_component.find(".selector_input_box");i.addClass("tab_header"),i.find("input").addClass("needs_hover center pas ram"),r.set_on_complete_callback(function(e,n,r){t._dropdown.hide_loading(),t._complete_filter(e,n,r)}),this._select_callback_passed_from_caller=e.select_callback||null,this._dropdown.set_on_select_callback(function(n,r){var i=r.closest(".fts_result"),s=i?i.attr("data-item_name"):"";t._state_machine.dispatch(Box_Abstract_Selector.EVENTS.MOUSE_SELECT,n,s)})},_init_state_machine:function(){this.base();var e=this,t=Box_Abstract_Selector.STATES,n=Box_Abstract_Selector.EVENTS;this._state_machine.add_state({id:t.TYPING,transitions:{DOWN:t.SELECTING,UP:t.SELECTING,KEYUP:t.TYPING,BLUR:t.IDLE,MOUSE_SELECT:t.IDLE,TOGGLE_DROPDOWN:t.DROPDOWN_LOCKED,KEY_SELECT:t.IDLE},callbacks:{ON_ENTER:function(t){e._dropdown.reset_highlight_index(),t==n.KEY_SELECT||t==n.TEXT_SELECT?e._clear_input():(e._j_input.trigger("focus",{triggered:!0}),e._search())}}}),this._state_machine.add_state({id:t.SELECTING,transitions:{DOWN:t.SELECTING,UP:t.SELECTING,KEYUP:t.TYPING,BLUR:t.IDLE,MOUSE_SELECT:t.TYPING,KEY_SELECT:t.IDLE}})},_on_select_callback:function(e,t){this._hide_after_select?this.hide():(Box.Application.getService("tooltips").hideTooltips(!0),this._j_input.trigger("change"),this._j_input.blur(),this._j_input.focus(),this._reload_folder_tree_to_item(e,!0),this._hide_dropdown(),$("#folder_tree").show()),typeof this._select_callback_passed_from_caller=="function"&&this._select_callback_passed_from_caller(e,t)},_on_folder_tree_item_select_callback:function(e,t){typeof this._select_callback_passed_from_caller=="function"&&this._select_callback_passed_from_caller(e,t)},_select_by_index:function(e){var t=this._dropdown.get_key_from_index(e);if(t){var n=this._dropdown.get_folder_name(t);this._on_select_callback(t,n)}},body_click_handler:function(e){return!0},_event_blur:function(e){},_create_selector_container:function(){var e=$j("#fts_component");return e.length||(e=$j('<div id="fts_component" class="fts_component" style="overflow:hidden;"></div>'),e.appendTo(document.body)),e},_create_ui_components:function(e){var t=this;this.base(e),this._add_placeholder_text(),this._j_clear_search_btn=$j('<a class="img_ext mls sprite_16x16_close" id="fts_clear_search_btn" href="#"></a>'),this._j_clear_search_btn.attr({"data-hover":"tooltip","aria-label":$t("Clear Search","fts_clear_search_button_label")}),this._j_clear_search_btn.off("click").on("click",function(e){return t.handle_clear_search_btn(),!1}),this._j_input.parent().append(this._j_clear_search_btn.hide()),this._tree_open_item_id=e.opened_item_id||0,this._show_trash=e.show_trash||!1,this._skip_no_invite_collab=e.skip_no_invite_collab||!1,this._check_permission=e.check_permission||!1,this._init_folder_tree()},_add_placeholder_text:function(){this.placeholder_offset={force_block:!0,left:4},this.base()},_init_folder_tree:function(){var e=this,t=function(t,n,r,i){e._on_folder_tree_item_select_callback(t,n)},n={append:!0,hide_callback:function(){e.hide()},behavior:"selector",skip_no_invite_collab:this._skip_no_invite_collab,show_trash:this._show_trash,check_permission
:this._check_permission,cache_identifier:"fts_component_first_load",force_open:!0};folder_tree.show(this._j_component,t,this._tree_open_item_id,"auto",n)},_reload_folder_tree_to_item:function(e,t){var n={selected_item_id:e,show_trash:this._show_trash,skip_no_invite_collab:this._skip_no_invite_collab,check_permission:this._check_permission,has_parents:!0};n.ancestors_only=typeof t=="undefined"?!0:t,folder_tree.load_folder_into_container(null,e,null,null,n)},hide:function(){folder_tree.hide(),this._dropdown.hide(),this._j_component.remove()},_filter_options:function(e){this._query_is_empty()?(this._dropdown.hide_loading(),this._hide_dropdown(),this._j_clear_search_btn.hide(),this._init_folder_tree()):($("#folder_tree").hide(),this._dropdown.show_loading(),this._filter.run(e),this._j_clear_search_btn.show())},handle_clear_search_btn:function(){Box.Application.getService("tooltips").hideTooltips(!0),this._clear_input(),this._j_input.trigger("change"),this._filter_options("")},attachTo:function(e){return this._j_component.detach().appendTo(e)},component:function(){return this._j_component},_event_focus:function(e,t){if(!t){var n=Box_Abstract_Selector.STATES,r=this._state_machine.is_in_state(n.TYPING)||this._state_machine.is_in_state(n.SELECTING);if(!r||!this._dropdown._j_dropdown.is(":visible"))this._query_is_empty()||this._show_dropdown(),this._state_machine.dispatch(Box_Abstract_Selector.EVENTS.FOCUS)}},_event_keyup:function(e){e.keyCode!=13?this.base(e):(e.stopPropagation(),e.preventDefault())}},{});Box.Timing.execution.push({name:"js/selectors/box_contact_selector.js",time:(new Date).getTime()});var Box_Contact_Selector=Box_Badge_Selector.extend({constructor:function(e){e=e||{},$.extend(e,{placeholder_text:$t("Names or email addresses","contact_selector_placeholder_text")});var t=e.dropdown_params||{};e.no_results_label&&(t.no_results_label=e.no_results_label),t.hide_no_results_item=e.hide_no_results_item,this.on_select_callback=e.on_select_callback;var n=e.dropdown||new Box_Contact_Dropdown(t);this.base(e.filter,n,e)},_filter_options:function(e){var t=$j.box.isEmail(e);if(!t){var n=this._get_emails_from_input_string(e);if(n.length>0){this._hide_dropdown();return}this._query_is_valid()&&this._filter.run(e)}else this.base(e)},_on_select_callback:function(e){this.base(e),typeof this.on_select_callback=="function"&&this.on_select_callback()},contact_names:function(){var e=this.value();this._select_by_text(e);var t=[];for(var n=0,r=this._badge_values.length;n<r;n++)t.push(this._badge_values[n].name);return t},contact_ids:function(){var e=this.value();this._select_by_text(e);var t=[];for(var n=0,r=this._badge_values.length;n<r;n++)t.push(this._badge_values[n].id);return t},get_selected_options:function(e){var t=this._get_selected_keys(),n=[],r,i=this._options;$j.each(t,function(e,t){r=i[t],n.push(r.email)});if(!e){var s=this._get_emails_from_input_string(this.value());s.length>0&&(n=n.concat(s))}return n},_option_is_match_callback:function(e,t){var n=t.toLowerCase();return n==e.email.toLowerCase()||n==e.name.toLowerCase()},_validate_text_callback:function(e){var t=this._get_emails_from_input_string(e);return t.length>0},_create_badge_label:function(e){return e.name?e.name.replace(/\s+/g," "):null},_add_option_from_text_callback:function(e){var t=this._get_emails_from_input_string(e),n=[];for(var r=0,i=t.length;r<i;r++){var s=t[r];if(s){var o=this._create_unique_key(s);this._add_option(o,this._get_option_by_email(s)),n.push(o)}}return n},_get_option_by_email:function(e){return{name:e,email:e}},_get_emails_from_input_string:function(e){var t=e.split(/,|;|\s/),n=[];for(var r=0,i=t.length;r<i;r++){var s=t[r],o=null;$j.box.isEmail(s)?o=s:o=this._get_email_in_angle_brackets(s),o&&n.push(o)}return n},_get_email_in_angle_brackets:function(e){var t=/<([^>]*)>/g,n=t.exec(e);if(n){var r=n[1];if($j.box.isEmail(r))return n[1]}return null}},{});Box.Timing.execution.push({name:"js/selectors/box_item_contact_selector.js",time:(new Date).getTime()});var Box_Item_Contact_Selector=Box_Contact_Selector.extend({constructor:function(e){var t=e.collab_item&&e.collab_item.permissions,n={};if(e.collab_item&&!e.collab_item.is_root_folder()&&t&&t.create_collab){var r=e.collab_item.is_webdoc()?$t("Invite collaborators to this webdoc","item_contact_selector_invite_collaborators_to_webdoc"):$t("Invite collaborators to this folder","item_contact_selector_invite_collaborators_to_folder");n={default_item_text:r,default_item_sprite_class:"sprite_16x16_add_collab",default_item_callback:function(){e.collab_item&&Box.Application.getService("popups").open("collaborate",{data:{typed_id:e.collab_item.typed_id}})}}}else"placeholder_text"in e&&(n.default_item_text=e.default_item_text);e.filter=new Box_Item_Contact_Filter({item_typed_id:e.item_typed_id,include_pending_collabs:e.include_pending_collabs}),e.dropdown=new Box_Item_Contact_Dropdown($j.extend(n,e)),this.base(e)}},{});Box.Timing.execution.push({name:"js/selectors/box_all_contact_selector.js",time:(new Date).getTime()});var Box_All_Contact_Selector=Box_Contact_Selector.extend({item_typed_id:null,include_self:!1,show_advanced_options:!1,is_external_collab_restricted_for_folder_owner:!1,constructor:function(e){e&&this._fetch_item_owner_data(e.item_typed_id),e.filter=new Box_All_Contact_Filter({item_typed_id:e.item_typed_id,include_self:e.include_self}),e.allow_empty_query=!1,this.base(e)},_fetch_item_owner_data:function(e){var t=Item.find(e);t&&User.find_item_owner_data_by_item_typed_id(t.user_id,e)},_update_badge_color:function(e){var t=this._options[e],n=this._j_badges[e],r={contact_email:t.email||"",item_typed_id:this.item_typed_id},i=this;$j.getJSON("/index.php?rm="+Box_All_Contact_Selector.GET_EXTERNAL_COLLAB_STATUS_RM,r,function(t){var r=t.is_external_collab_restricted,s=n.find("span");r?(i._options[e].is_external_collab_restricted=!0,s.removeClass(Box_Badge_Selector.DEFAULT_PILL_CLASS),s.addClass(Box_All_Contact_Selector.RESTRICTED_PILL_STYLE)):(i._options[e].is_external_collab_restricted=!1,s.removeClass(Box_All_Contact_Selector.RESTRICTED_PILL_STYLE),s.addClass(Box_Badge_Selector.DEFAULT_PILL_CLASS))})},_add_option:function(e,t){return this._options[e]||(this._options[e]=t),t},get_item_typed_id:function(){return this.item_typed_id},get_restricted_and_unrestricted_collab_emails:function(){var e=this.get_restricted_and_unrestricted_collab_contacts(),t=$j.map(e.restricted_collab_contacts,function(e){return e.email}),n=$j.map(e.unrestricted_collab_contacts,function(e){return e.email});return{restricted_collab_emails:t,unrestricted_collab_emails:n}},get_restricted_and_unrestricted_collab_contacts:function(){var e=this.value();this._select_by_text(e);var t,n=this._get_selected_keys(),r=this._options,i=[],s=[];return $j.each(n,function(e,n){t=r[n],t.is_external_collab_restricted?i.push(t):s.push(t)}),{restricted_collab_contacts:i,unrestricted_collab_contacts:s}},_get_option_by_email:function(e){return{name:e,email:e}},update_selector_item:function(e){if(e){this.item_typed_id=e,this.filter.item_typed_id=e;var t=Item.find(e),n=this;t&&"user_id"in t&&User.find_item_owner_data_by_item_typed_id(t.user_id,e,function(){n._reinsert_selected_badages(t.user_id)})}},_reinsert_selected_badages:function(e){var t=this._get_selected_keys();this.remove_all_badges(),this._j_badges={};for(var n=0,r=t.length;n<r;n++){var i=t[n];this._add_to_selected_options(i),this._add_badge(i)}}},{RESTRICTED_PILL_STYLE:"pill restricted",GET_EXTERNAL_COLLAB_STATUS_RM:"box_collaborate_is_external_collab_restriction_for_contact"});Box.Timing.execution.push({name:"js/selectors/box_at_selector.js",time:(new Date).getTime()});var Box_At_Selector=Box_Option_Selector.extend({_j_input_container:null,_j_input:null,folder_typed_id:null,constructor:function(e){e.allow_empty_query=!0,e.use_commas_to_select=!1,e.ignore_tab_and_enter_keys_for_valid_query=!0,e.allow_not_selectable_items=!0,this._j_texts={},this.base(new Box_Item_Contact_Filter({item_typed_id:e.item_typed_id,allow_not_selectable_items:!0}),new Box_Item_Contact_Dropdown({allow_not_selectable_items:!0}),e)},_create_ui_components:function(e){this.base(e),this._j_input_container=this.j_component,this.j_component.css("position","relative");if(!this._at_selector_text_holder){var t=this,n=this._j_input_container.find(".at_mention_overlay");n.length?this._at_selector_text_holder=n:this._at_selector_text_holder=$j('<div class="at_mention_overlay"></div>');var r=["width","margin","padding","font","line-height"];this._at_selector_text_holder.copyCSS(this.j_input,r),this._at_selector_text_holder.width(this.j_input.width());if(e.message_mentioned){var i=e.message_mentioned.replace(/@\[([0-9]+):([^\]]+)\]/g,'<b data-user_id="$1">@$2</b>');this._at_selector_text_holder.html(i)}this._at_selector_text_holder.find("b").each(function(){t._add_to_selected_options($j(this).data("user_id"))}),this._at_selector_text_holder.prependTo(this.j_component),this._at_selector_text_holder.on("focus",function(t){$j(this).nextAll("textarea").trigger(t)})}},_query:function(e){var t=$j(this._j_input[0]).val(),n=t.replace(/(\r|\n)/g,"|").length,r=this._j_input.getSelection().start,i=this._get_idx_closest_at_symbol_before_cursor(t,r-1),s=r==n;if(i==undefined||i==-1)return!1;if(/(^|\s)\@/.test(t)){if(s){var o=this._at_selector_text_holder.find("b:last").text();if(o){var u=t.indexOf(o);if(u>-1){var a=u+o.length,f=t.substr(a,t.length);if(!/(^|\s)\@/.test(f))return!1}}return t.substring(i+1,t.length)}var l=this._get_idx_next_whitespace(t,r);return t.substring(i+1,l>-1?l:t.length)}return!1},_event_keydown:function(e){if(e.keyCode==Box_Abstract_Selector.KEY.BACKSPACE&&this._query_is_empty()){if(this._has_option_selected())return!0}else{if(e.keyCode==Box_Abstract_Selector.KEY.BACKSPACE)return!0;e.keyCode==Box_Abstract_Selector.KEY.ENTER&&this._dropdown._j_dropdown.is(":visible")&&e.preventDefault()}return this.base(e)},_event_keyup:function(e,t){var n=e.which||e.keyCode;if(!(!this._dropdown._j_dropdown_container.is(":visible")||n!=Box_Abstract_Selector.KEY.DOWN&&n!=Box_Abstract_Selector.KEY.UP))return;var r=this._j_input.val(),i=this._j_input.getSelection().start;if(i>0){var s=this._get_idx_closest_at_symbol_before_cursor(r,i);if(s==-1)this._dropdown.hide();else{var o=r.charAt(s+1,1),u=r.charAt(s-1,1),a=this._query(n);a===!1||i-1!=s&&o!="\n"&&/\s/.test(o)||u!=""&&!/(\s)/.test(u)||r.indexOf("@")==-1||this._get_idx_closest_at_symbol_before_cursor(r,i-1)==-1?this._dropdown.hide():o==""&&i-1==s?this.base(e):(this.base(e),this._filter_options(a))}}else this._dropdown.hide();this._update_highlight(t)},_complete_filter:function(e,t){if($j.isEmptyObject(t)){this._dropdown.hide();return}var n={hide_no_results:!0};this.base(e,t,n)},_add_text:function(e){this._j_texts[e]||(this._j_texts[e]=$j("<b />").text(this._options[e])),this._j_texts[e].show().insertBefore(this._j_input_item)},_on_select_callback:function(e){var t=this.base(e);t&&this._add_text(e);if(!t)return;var n=this._options[e].name,r=this._j_input.val(),i=this._j_input.getSelection().start,s=this._get_idx_closest_at_symbol_before_cursor(r,i-1),o=r.substr(0,s+1),u=this._get_idx_next_whitespace(r,i),a=u>-1?r.substr(u,r.length):r.substr(i,r.length);this._j_input.val(o+n+a);if(i==this._j_input.getSelection().start){var f=o+n;this._j_input.setCaretToPos(f.length)}this._update_highlight()},_update_highlight:function(e){var t=this;if(e&&e.initialize)this._at_selector_text_holder.find("b").each(function(){t._add_to_selected_options($j(this).data("user_id"))});else{if(!this._selection_count)return;var n=this._j_input.val();n=n.replace(/</g,"&lt;").replace(/>/g,"&gt;");var r=n,i=[];$.each(this._option_is_selected,function(e,s){var o=t._options[e];if(o){var u=o.name,a=r.indexOf("@"+u);a>-1?i.push({user_name:u,user_id:e}):t._remove_from_selected_options(e)}else{t._at_selector_text_holder.find("b[data-user_id="+e+"]").each(function(){var e=$j(this).text();n=n.replace(e,'<b data-user_id="'+$(this).data("user_id")+'">'+e+"</b>")});if(t.message_mentioned){var f=t.message_mentioned.indexOf("@["+e+":")>-1,l=n.indexOf('<b data-user_id="'+e+'">')>-1;f&&!l&&t._remove_from_selected_options(e)}}}),i=i.sort(function(e,t){return t.user_name.length-e.user_name.length});for(var s=0,o=i.length;s<o;s++){var u=i[s],a=r.indexOf("@"+u.user_name),f='<b data-user_id="'+u.user_id+'">@'+u.user_name+"</b>",l='<b data-user_id="'+u.user_id+'">@'+u.user_name.replace(/./gi,"{")+"</b>";r=r.replace("@"+u.user_name,l),n=n.substring(0,a)+n.substring(a,n.length).replace("@"+u.user_name,f)}var c=n.replace(/\n/g,"<br>");this._at_selector_text_holder.html(c),this._at_selector_text_holder.find("b b").each(function(e,t){$j(t).replaceWith($j(t).text())})}},_get_idx_closest_at_symbol_before_cursor:function(e,t){var n=e.lastIndexOf("@",t);return n<=t?n:-1},_get_idx_next_whitespace:function(e,t){var n=e.substr(t).search(/\s/);return n===-1?-1:n+t}},{});Box.Timing.execution.push({name:"js/behaviors/view-options-menu.js",time:(new Date).getTime()}),Box.Application.addBehavior("view-options-menu",function(e){"use strict";function v(e){n.addClass(e,"selected")}function m(e){n.removeClass(e,"selected")}function g(e,t){var r=n.query("span",e),i=r.className,s=i.replace(/(active|inactive)/,""),o=s+t;n.removeClass(r),n.addClass(r,o)}function y(e){return e.getAttribute("data-sort")}function b(e){return e.getAttribute("data-display")}function w(e){return e.getAttribute("data-filter")}function E(e){return p[e]}function S(e,t){var n="[data-"+e+"]",r=$(i).find(n);for(var s=0,o=t.length;s<o;s++)r=r.not("[data-"+e+'="'+t[s]+'"]');r.remove()}function x(e){var t="[data-"+e+"]",n=$(i).find(t);n.remove(),$(i).find("."+e+"-divider").remove(),$(i).find("."+e+"-label").remove()}function T(){var e=n.query(".menu_arrow_up, .menu_arrow_down",i);n.removeClass(e,"menu_arrow_up"),n.removeClass(e,"menu_arrow_down")}function N(e){T(),n.addClass(e,"menu_arrow_up")}function C(e){T(),n.addClass(e,"menu_arrow_down")}function k(){var e=s.get(),r=e.sort,u=e.sortDirection;if(r){var a=n.query('[data-sort="'+$.box.escapeHTML(r)+'"]',i);v(a),f=a;var h=n.query(".arrow",a,i);u==="ASC"?N(h):C(h)}o=o||t.get("Canvas");var p=o.view;if(p){p=p==="expanded"?"list":"icon";var m=n.query('[data-display="'+$.box.escapeHTML(p)+'"]',i);v(m),g(m,"active"),c=m}if(s.isTrash()){var y;l?y=w(l):y=d;var b=n.query('[data-filter="'+$.box.escapeHTML(y)+'"]',i);v(b),l=b}}function L(){var e=s.get();a?S("sort",["name","email","folders"]):h?S("sort",["name","email"]):e.type==="s"?S("sort",["relevance","date","size"]):s.isTrash()?S("sort",["deleted","name","size"]):S("sort",["name","date","size"])}function A(){!a&&!h?S("display",["list","icon"]):x("display")}function O(){s.isTrash()?S("filter",["deleted","owned"]):x("filter")}function M(){L(),A(),O(),k()}function _(){r&&(r.destroy(),r=null),i&&($(u).parent().get(0).removeChild(i),i=null)}function D(){r&&_();var t=e.getService("templates"),n=t.getTemplateFragment("view-options-menu");i=n.firstChild,M(),$(u).after(i),r=e.getService("menus").create(i),r.init(),$(i).css("maxWidth","250px")}var t,n,r,i,s,o,u,a,f,l,c,h,p={name:"ASC",size:"DESC",date:"DESC"},d="deleted";return{init:function(){t=e.getService("v5"),n=e.getService("dom"),s=e.getService("nav-state"),a=t.get("collab_page"),h=t.get("corporate_network_page"),u=n.query('[data-type="view-options-menu-btn"]',e.getElement())},destroy:function(){r&&this.hideMenu(),t=null,n=null,o=null,s=null},onclick:function(e,t,i){if(t&&!n.hasClass(t,"disabled")){switch(i){case"view-options-menu-btn":r&&r.isOpen()?this.hideMenu():this.showMenu(t);break;default:return}e.preventDefault(),e.stopPropagation()}},handleMenuClick:function(e,t){if(e&&!n.hasClass(e,"disabled")){switch(t){case"sort":n.hasClass(e,"selected")?this.toggleSortDirection(e):this.changeSortType(e);break;case"display":this.changeDisplayType(e);break;case"filter":this.changeFilterType(e)}var r=this;setTimeout(function(){r.hideMenu()},200)}},showMenu:function(e){D(),this.bindMenuSelectEvent(),r.show(e)},hideMenu:function(){r.hide(),this.unbindMenuSelectEvent(),_()},bindMenuSelectEvent:function(){var e=this;r.on("menuselect",function(t){var n=t.data;e.handleMenuClick(n,n.getAttribute("data-type"))})},unbindMenuSelectEvent:function(){r.off("menuselect")},sort:function(t,n){var r=s.get();r.sort&&s.set({sort:t,sortDirection:n}),e.navigate("")},display:function(e){o=o||t.get("Canvas"),e==="list"?o.change_view("expanded"):o.change_view("icon")},filter:function(t){s.set({trashFilter:t,page:0}),e.navigate("")},changeSortType:function(e){m(f),f=e;var t=y(e),r=E(t),i=n.query(".arrow",e);v(f),r==="ASC"?N(i):C(i),this.sort(t,r)},changeDisplayType:function(e){m(c),g(c,"inactive"),c=e,v(c),g(c,"active");var t=b(e);this.display(t)},changeFilterType:function(e){m(l),l=e,v(l);var t=w(e);this.filter(t)},toggleSortDirection:function(e){var t=s.get(),r=t.sortDirection==="ASC"?"DESC":"ASC",i=n.query(".arrow",e);r==="ASC"?N(i):C(i);var o=y(e);this.sort(o,r)}}}),Box.Timing.execution.push({name:"js/behaviors/upload-menu.js",time:(new Date).getTime()}),Box.Application.addBehavior("upload-menu",function(e){"use strict";function c(){var t=e.getService("templates"),n=t.getTemplateFragment("upload-menu");u=n.firstChild,$(a).after(n),o=e.getService("menus").create(u),o.init()}function h(){o.destroy(),$(e.getElement()).find(u).remove(),u=null,o=null}function p(e,t){var n=i.current_folder;return s.add_trigger({element:$(e),folder:n,directory_upload:t,handle_change:function(e,t){o.hide(),s.handle_change(e,t)}})}function d(){var n=t.query('[data-type="upload-files-option"]',e.getElement());f=p(n,!1)}function v(){f&&(f.destroy(),f=null)}function m(){var n=t.query('[data-type="upload-directory-option"]',e.getElement());n&&r.canFolderUpload()&&(l=p(n,!0))}function g(){l&&(l.destroy(),l=null)}var t,n,r,i,s,o,u,a,f,l;return{init:function(){t=e.getService("dom"),n=e.getService("v5"),r=e.getService("browser"),i=n.get("Canvas"),s=n.get("Upload_Process"),a=t.query('[data-type="upload-menu-btn"]',e.getElement()),c(),this.bindMenuSelectEvent()},destroy:function(){this.unbindMenuSelectEvent(),h()},onclick:function(e,n,r){if(n&&!t.hasClass(n,"disabled")){switch(r){case"upload-menu-btn":o.isOpen()?this.hideMenu():this.showMenu(n);break;default:return}e.preventDefault(),e.stopPropagation()}},handleMenuClick:function(e,t){switch(t){case"upload-files-option":f&&f.open();break;case"upload-directory-option":l?l.open():(s.popup_upload_java_open(),this.hideMenu())}},bindMenuSelectEvent:function(){var e=this;o.on("menuselect",function(t){var n=t.data;e.handleMenuClick(n,n.getAttribute("data-type"))})},unbindMenuSelectEvent:function(){o.off("menuselect")},showMenu:function(e,t){v(),g(),d(),m(),o.show(e,t)},hideMenu:function(){o.hide()}}}),Box.Timing.execution.push({name:"js/menus/box_menus.js",time:(new Date).getTime()});var Box_Menus=Base.extend({map_menu_id_to_menu_object:{},menu_groups:{},constructor:function(){if(Box_Menus._initializing)throw new Error("Circular reference in initializing Box_Menus");Box_Menus._initializing=!0,this._initialize_default_menus(),this._bind_click_handler(),this._bind_close_on_popup_handler(),Box_Menus._initializing=!1},_bind_click_handler:function(){var e=this;$("body").on("click.menus",".handle_menu_events",function(t){var n=e.get_menu_by_element_id($(this).attr("id"));if(n&&n.event_click)return n.event_click(t)})},_bind_close_on_popup_handler:function(){var e=this;$("body").on("popup.open.menus",function(){var t,n;for(t in e.map_menu_id_to_menu_object)n=e.map_menu_id_to_menu_object[t],n&&n.visible&&n.hide()})},_initialize_default_menus:function(){typeof Action_Types_Selector_Menu!="undefined"&&(this.action_types_selector_menu=new Action_Types_Selector_Menu),typeof App_Category_Filter_Menu!="undefined"&&(this.app_category_filter_menu=new App_Category_Filter_Menu),typeof App_View_Filter_Menu!="undefined"&&(this.app_view_filter_menu=new App_View_Filter_Menu),typeof Add_Account_Menu!="undefined"&&(this.add_account_menu=new Add_Account_Menu),typeof Collab_Folder_Role_Menu!="undefined"&&(this.collab_folder_role_menu=new Collab_Folder_Role_Menu),typeof Collaborator_Menu!="undefined"&&(this.collaborator_menu=new Collaborator_Menu),typeof Corporate_Network_Menu!="undefined"&&(this.corporate_network_menu=new Corporate_Network_Menu),typeof Current_User_Menu!="undefined"&&(this.current_user_menu=new Current_User_Menu,this.add_menu_to_group(this.current_user_menu,"header")),typeof Upgrade_Dropdown!="undefined"&&(this.upgrade_dropdown=new Upgrade_Dropdown,this.add_menu_to_group(this.upgrade_dropdown,"header")),typeof Enterprise_Action_Menu!="undefined"&&(this.enterprise_action_menu=new Enterprise_Action_Menu),typeof External_User_Menu!="undefined"&&(this.external_user_menu=new External_User_Menu),typeof External_User_Sort_Menu!="undefined"&&(this.external_user_sort_menu=new External_User_Sort_Menu),typeof Folder_Membership_Permission_Menu!="undefined"&&(this.folder_membership_permission_menu=new Folder_Membership_Permission_Menu),typeof Folder_Picker_Menu!="undefined"&&(this.folder_picker_menu=new Folder_Picker_Menu),typeof Group_Tag_Filter_Menu!="undefined"&&(this.group_tag_filter_menu=new Group_Tag_Filter_Menu),typeof Group_Tag_Role_Menu!="undefined"&&(this.group_tag_role_menu=new Group_Tag_Role_Menu),typeof Group_Selector_Menu!="undefined"&&(this.group_selector_menu=new Group_Selector_Menu),typeof Group_Tag_Menu!="undefined"&&(this.group_tag_menu=new Group_Tag_Menu),typeof Item_Menu!="undefined"&&(this.menu=new Item_Menu),typeof Lightbox_Item_Menu!="undefined"&&(this.lightbox_item_menu=new Lightbox_Item_Menu),typeof Lightbox_File_Info_Layer!="undefined"&&(this.lightbox_file_info_layer=new Lightbox_File_Info_Layer),typeof Multi_Options_Menu!="undefined"&&(this.multi_options_menu=new Multi_Options_Menu),typeof Paging_Menu!="undefined"&&(this.paging_menu=new Paging_Menu),typeof PIM_Sort_Menu!="undefined"&&(this.pim_sort_menu=new PIM_Sort_Menu),typeof Shared_File_Menu!="undefined"&&(this.shared_file_menu=new Shared_File_Menu),typeof Sort_Enterprise_Menu!="undefined"&&(this.sort_enterprise_menu=new Sort_Enterprise_Menu),typeof File_Filter_Menu!="undefined"&&(this.file_filter_menu=new File_Filter_Menu),typeof File_Sort_Menu!="undefined"&&(this.file_sort_menu=new File_Sort_Menu),typeof Tags_Menu!="undefined"&&(this.tags_menu=new Tags_Menu),typeof Upload_Menu!="undefined"&&(this.upload_menu=new Upload_Menu),typeof User_Action_Menu!="undefined"&&(this.user_action_menu=new User_Action_Menu),typeof User_Menu!="undefined"&&(this.user_menu=new User_Menu),typeof User_Role_Menu!="undefined"&&(this.user_role_menu=new User_Role_Menu),typeof User_Sort_Menu!="undefined"&&(this.user_sort_menu=new User_Sort_Menu),typeof View_Options_Menu!="undefined"&&(this.view_options_menu=new View_Options_Menu),typeof GCM_User_Menu!="undefined"&&(this.gcm_user_menu=new GCM_User_Menu),typeof Pin_Board_Menu!="undefined"&&(this.pin_board_menu=new Pin_Board_Menu),this.map_menu_id_to_menu_object={dd_menu_box_item:this.menu,item_submenu_upload:this.menu,item_submenu_share:this.menu,item_submenu_properties:this.menu,item_submenu_sync_folder:this.menu,item_submenu_openbox:this.menu,dd_menu_share_access:typeof Share_Access_Menu!="undefined"?Share_Access_Menu.get():null,dd_menu_create_filter:this.create_filter_menu,dd_menu_upload:this.upload_menu,dd_menu_collaborator:this.collaborator_menu,dd_menu_user_action:this.user_action_menu,dd_menu_group_tag:this.group_tag_menu,dd_menu_external_user:this.external_user_menu,action_types_selector_menu:this.action_types_selector_menu,"actionbar-multiple-selection":this.multi_options_menu,add_account_menu:this.add_account_menu,app_category_filter_menu:this.app_category_filter_menu,app_view_filter_menu:this.app_view_filter_menu,collab_folder_role_menu:this.collab_folder_role_menu,external_user_sort_menu:this.external_user_sort_menu,folder_membership_permission_menu:this.folder_membership_permission_menu,group_tag_filter_menu:this.group_tag_filter_menu,group_tag_role_menu:this.group_tag_role_menu,group_selector_menu:this.group_selector_menu,menu_enterprise_action:this.enterprise_action_menu,multi_options_menu:this.multi_options_menu,paging_menu:this.paging_menu,pim_sort_menu:this.pim_sort_menu,qu_outer_container:this.quick_updates_menu,sort_enterprise_list:this.sort_enterprise_menu,file_filter_list:this.file_filter_menu,file_sort_list:this.file_sort_menu,task_type_selector_menu:typeof Task_Type_Selector_Menu!="undefined"?Task_Type_Selector_Menu.get():null,task_assignment_status_menu:typeof Task_Assignment_Status_Menu!="undefined"?Task_Assignment_Status_Menu.get():null,task_assignee_menu:typeof Task_Assignee_Menu!="undefined"?Task_Assignee_Menu.get():null,user_role_menu:this.user_role_menu,user_sort_menu:this.user_sort_menu,view_options_menu:this.view_options_menu,device_application_type_filter:typeof Device_Application_Type_Filter_Menu!="undefined"?Device_Application_Type_Filter_Menu.get():null,gcm_user_menu:this.gcm_user_menu,pin_board_menu:this.pin_board_menu}},get_menu_group:function(e){return this.menu_groups[e]||[]},add_menu_to_group:function(e,t){this.menu_groups[t]||(this.menu_groups[t]=[]),this.menu_groups[t].push(e)},get_menu_by_element_id:function(e){return this.map_menu_id_to_menu_object[e]}},{_initializing:!1,get:function(){return Box_Menus.__instance||(Box_Menus.__instance=new Box_Menus),Box_Menus.__instance}});Box.Timing.execution.push({name:"js/menus/box_abstract_menu.js",time:(new Date).getTime()});var Abstract_Menu=Base.extend({PAGE_MARGIN:10,_e_menu:null,_j_target_element:null,_target_event:null,_elements_that_keep_menu_open:this._elements_that_keep_menu_open||null,_elements_told_menu_is_open:this._elements_told_menu_is_open||null,_hovers:null,_timeout_id:null,_timeout_duration:150,visible:!1,stalking:!1,_action_required_to_close:this._action_required_to_close||!1,_callback:null,_defined_inline:!1,_prevent_rendering_offscreen:!0,window:window,_triggering_elements:function(){return $j(this._e_menu).add(this._j_target_element).add(this._elements_that_keep_menu_open)},_responding_elements:function(){return $j(this._e_menu).add(this._j_target_element).add(this._elements_that_keep_menu_open).add(this._elements_told_menu_is_open)},_attach_events:function(){var e=this;this._hovers={on:function(t){e._hover_on(t)},off:function(t){e._hover_off(t)}},this._triggering_elements().mouseover(this._hovers.on).mouseout(this._hovers.off)},_unattach_events:function(){if(!this._hovers)return;this._triggering_elements().unbind("mouseout",this._hovers.off).unbind("mouseover",this._hovers.on),this._hovers=null},_hover_off:function(e){var t=this;this._timeout_id&&clearTimeout(this._timeout_id),this._timeout_id=setTimeout(function(){t.hide()},this._timeout_duration)},_hover_on:function(e){if(!this._timeout_id)return;clearTimeout(this._timeout_id),this._timeout_id=null},_set_position:function(){var e=$j(this._e_menu),t=5,n;this._target_event?n={left:this._target_event.pageX-t,top:this._target_event.pageY-t}:(n=this._j_target_element.offset(),this.stalking&&(n.top=0),n.top+=this._j_target_element.height());var r=this._get_offsets();n.top+=r.y,n.left+=r.x,this._e_menu.style.display=="none"&&(this._e_menu.style.visibility="hidden"),this._e_menu.style.display="block",this._e_menu.style.position=this.stalking?"fixed":"absolute",this._e_menu.style.left=n.left+"px",this._e_menu.style.top=n.top+"px",this._prevent_rendering_offscreen&&this._adjust_menu_offset(),e.hasClass("drop_down")&&e.css("visibility")=="hidden"?e.hide().css("visibility","visible").stop(!0,!0).slideDown(100):e.css("visibility","visible")},_adjust_menu_offset:function(){var e=$j(this._e_menu),t=e.offset(),n=this._get_size(),r=$j(this.window),i=this._calculate_available_space(t);i.left>=i.right?t.left+n.width>r.width()+r.scrollLeft()-this.PAGE_MARGIN&&(this.parent_menu?e.css("left",$j(this.parent_menu._e_menu).offset().left-n.width):e.css("left",r.width()+r.scrollLeft()-n.width-this.PAGE_MARGIN)):(i.right<n.width+this.PAGE_MARGIN||this._can_have_submenu&&i.right<n.width*2+this.PAGE_MARGIN)&&t.left<n.width&&(this.parent_menu||e.css("left",r.scrollLeft()+this.PAGE_MARGIN)),t.left<r.scrollLeft()+this.PAGE_MARGIN&&e.css("left",r.scrollLeft()+this.PAGE_MARGIN),t.top+n.height>r.height()+r.scrollTop()-this.PAGE_MARGIN&&e.css("top",r.height()+r.scrollTop()-n.height-this.PAGE_MARGIN),t.top<r.scrollTop()+this.PAGE_MARGIN&&e.css("top",r.scrollTop()+this.PAGE_MARGIN)},_calculate_available_space:function(e){var t=$(this.window),n=0,r=e.left;return this.parent_menu?(r=$j(this.parent_menu._e_menu).offset().left,n=t.width()+t.scrollLeft()-r-this.parent_menu._get_size().width):n=t.width()+t.scrollLeft()-r,{left:r,right:n}},_get_offsets:function(){return{x:0,y:0}},_get_size:function(){var e=$j(this._e_menu),t=e.css("left");e.css("left",0);var n={height:e.outerHeight()||e.children().outerHeight(),width:e.outerWidth()||e.children().outerWidth()};return e.css("left",t),n},hide:function(){this._j_target_element&&!this._j_target_element.is('input[type="text"], textarea')&&this._j_target_element.blur();if(!this.visible)return;this.visible=!1,this._timeout_id=null,$j(this._e_menu).hide(),typeof Previewer!="undefined"&&$j.popup.get().length===0&&Previewer.get().set_player_active(!0),this._action_required_to_close||this._unattach_events(),this._responding_elements().removeClass("hover menu_open ignore_mouseout");var e=Box.Application.getService("thumbnail");e.hideThumbnail(),this._callback&&this._callback()},show:function(){this.visible||(this._timeout_id=null,$j(this._e_menu).hide(),this._unattach_events(),this._responding_elements().removeClass("menu_open ignore_mouseout")),this.visible=!0,this._defined_inline&&this._e_menu.parentElement!=document.body&&$j(this._e_menu).detach().appendTo(document.body),typeof Previewer!="undefined"&&Previewer.get().set_player_active(!1,!0),this._structure(),this._render(),this._set_position(),this._action_required_to_close||this._attach_events(),this._responding_elements().addClass("hover menu_open ignore_mouseout")},redraw:function(){this.visible&&this._set_position()},_render:function(){return},_structure:function(){return}},{});Box.Timing.execution.push({name:"js/menus/box_abstract_scrollable_menu.js",time:(new Date).getTime()});var Abstract_Scrollable_Menu=Abstract_Menu.extend({_scroll_interval_id:null,show:function(e){this.base();var t=this._get_size(),n=$j(window);this._prevent_rendering_offscreen&&t.height+60>=n.height()&&(this._show_scroll(),this._set_position())},hide:function(){this.base(),this._remove_scroll()},_show_scroll:function(){var e=this,t=$j(window),n=$j(this._e_menu),r=n.find(".list_menu li:first").parent(),i=r.parent(),s=r.outerHeight(),o=t.height()-75,u=s-o;i.css("padding",0),r.css("overflow-y","hidden").height(o).scrollTop(0);var a=n.find(".list_menu_scroll_up"),f=n.find(".list_menu_scroll_down");a.length?(a.show(),f.show()):(a=$j('<ul class="list_menu_scroll list_menu_scroll_up"></ul>').append($j('<li class="txt_c list_menu_scroll_arrow list_menu_scroll_arrow_up"><b class="sprite_9x9_up_arrow list_img"></b></li>')).append($j('<li class="separator pan mvs"><hr class="divider mbn mhs"></li>')),a.mouseenter(function(t){e._scroll_interval_id&&window.clearInterval(e._scroll_interval_id),e._scroll_interval_id=window.setInterval(function(){var e=r.scrollTop();e<=9?(r.scrollTop(0),a.find(".list_menu_scroll_arrow").addClass("list_menu_scroll_hidden")):(r.scrollTop(e-9),f.find(".list_menu_scroll_arrow").removeClass("list_menu_scroll_hidden"))},50)}).mouseleave(function(t){e._scroll_interval_id&&(window.clearInterval(e._scroll_interval_id),e._scroll_interval_id=null)}),f=$j('<ul class="list_menu_scroll list_menu_scroll_down"></ul>').append($j('<li class="separator pan mvs"><hr class="divider mbn mhs"></li>')).append($j('<li class="txt_c list_menu_scroll_arrow list_menu_scroll_arrow_down"><b class="sprite_9x9_down_arrow list_img"></b></li>')),f.mouseenter(function(t){e._scroll_interval_id&&window.clearInterval(e._scroll_interval_id),e._scroll_interval_id=window.setInterval(function(){var e=r.scrollTop();e>=u?(r.scrollTop(u),f.find(".list_menu_scroll_arrow").addClass("list_menu_scroll_hidden")):(r.scrollTop(e+9),a.find(".list_menu_scroll_arrow").removeClass("list_menu_scroll_hidden"))},50)}).mouseleave(function(t){e._scroll_interval_id&&(window.clearInterval(e._scroll_interval_id),e._scroll_interval_id=null)}),n.prepend(a),n.append(f)),r.scrollTop()<=0&&(a.find(".list_menu_scroll_arrow").addClass("list_menu_scroll_hidden"),f.find(".list_menu_scroll_arrow").removeClass("list_menu_scroll_hidden"))},_remove_scroll:function(){var e=$j(this._e_menu);e.find(".list_menu").css("height","auto"),e.find(".list_menu_scroll_up").remove(),e.find(".list_menu_scroll_down").remove()}},{});Box.Timing.execution.push({name:"js/menus/box_abstract_menu_with_submenus.js"
,time:(new Date).getTime()});var Abstract_Menu_With_Submenus=Abstract_Scrollable_Menu.extend({is_mouse_at_menu:!1,is_mouse_at_submenu:!1,displayed_submenu:null,_can_have_submenu:!0,_base:null,_hover_off:function(e){this.is_mouse_at_menu=!1;var t=this;this._timeout_id&&clearTimeout(this._timeout_id),this._base=this.base,this._timeout_id=setTimeout(function(){if(t.is_mouse_at_submenu)return;t._base(),t._base=null,t._timeout_id=!1},50)},_hover_on:function(e){this.is_mouse_at_menu=!0,this.base(e)},hide:function(){this.displayed_submenu&&this.displayed_submenu.hide(),this.base()},show_submenu:function(e,t){this.displayed_submenu&&this.displayed_submenu.hide();var n=this._new_submenu({submenu_id:e,parent_menu:this});n.show({_j_target_element:$j(t)}),this.displayed_submenu=n},_new_submenu:function(e){return new Submenu(e)}},{}),Submenu=Abstract_Scrollable_Menu.extend({parent_menu:null,keep_submenu_open:!1,constructor:function(e){e=e||{},this._e_menu=$j("#"+e.submenu_id).get(0),this.parent_menu=e.parent_menu},_hover_on:function(e){this.parent_menu.is_mouse_at_submenu=!0,this.parent_menu._timeout_id&&(clearTimeout(this.parent_menu._timeout_id),this.parent_menu._timeout_id=null),this.base()},_hover_off:function(e){var t=this;if(this.keep_submenu_open)return;this.parent_menu.is_mouse_at_submenu=!1,!this.parent_menu.is_mouse_at_menu&&!this.parent_menu.is_mouse_at_submenu&&(this.parent_menu._timeout_id&&clearTimeout(this.parent_menu._timeout_id),this.parent_menu._timeout_id=setTimeout(function(){t.parent_menu.hide()},250)),this.base()},hide:function(){this.parent_menu.is_mouse_at_submenu=!1,this.base()},_get_offsets:function(){var e=this.parent_menu._get_size();return{x:e.width-3,y:-(this._j_target_element.height()+4)}},show:function(e){this._j_target_element=e._j_target_element;var t=Box_Menus.get().map_menu_id_to_menu_object[this._e_menu.id];t&&$.isFunction(t._render)&&(t._render(),t.visible=!0),this.base()}},{});Box.Timing.execution.push({name:"js/menus/box_item_menu.js",time:(new Date).getTime()});var Item_Menu=Abstract_Menu_With_Submenus.extend({item:null,type:null,_displayed_by_more_button:!1,constructor:function(e){e=e||{},this._e_menu=$j("#dd_menu_box_item").get(0)},hide:function(){$j.browser.msie&&this.item&&($j(this.item.element).find(".item_info").css("background-color","transparent"),$j(this.item.element).find(".item_data").css("background-color","transparent")),this.base(),this.item=null},show:function(e){e=e||{},this._target_event=e.event,this._j_target_element=$j(e.target);if(!e.item)return;this._elements_told_menu_is_open=$j(e.item.element),this.item=e.item,this.type=e.type;var t=$j(this._e_menu);e.match_target_width?t.width(this._j_target_element.outerWidth()):t.width("auto"),Canvas.get().target_item=e.item,this.module_context=e.module_context,this._displayed_by_more_button=!!e.displayedByMoreButton,this.base(e),this._adjust_separators()},_render:function(){var e=Box.Application.getService("nav-state"),t=e.isGcm(),n=this.item.type=="folder",r=this.item.type=="file",i=this.item.type=="web_link",s=this.item.extension=="webdoc",o=this.item.extension=="boxnote",u=this.item.is_root_folder(),a=$j(".dd_menu_box_item li").hide();$j("#item_menu_multiselect").hide().html("");if(Canvas.get().selection.collection.items.length<=1||this.type!="right_click"){!t&&(n||i)&&this.item.can_open()?($j("#item_menu_open").show(),i||$j("#item_menu_open_new_tab").show()):t&&n&&$j("#item_menu_export").show(),Features.pin_board&&!this.item.is_root_folder()?(e.isPinboard()&&(e.isPreviewerOpen()||$j("#item_menu_remove_item_in_pin_board").show()),e.isEmbedWidget()||$j("#item_menu_item_in_boards").show()):($j("#item_menu_remove_item_in_pin_board").hide(),$j("#item_menu_item_in_boards").hide()),r&&!s&&!o&&(this.item.permissions.download&&$j("#item_menu_download").show(),!t&&this.item.permissions.upload&&($j("#item_menu_upload_new_version").show(),Box.Application.getService("upload-process").disableUploadElementForAjaxEol($("#item_menu_upload_new_version")[0])),!t&&this.item.permissions.preview&&($j("#item_menu_preview").show(),$j("#item_menu_preview_new_tab").show()),this._show_edit_options()),!u&&n&&this.item.permissions.download&&$j("#item_menu_download").show();if(!t&&n&&this.item.permissions.upload){this._displayed_by_more_button||$j("#item_menu_new_folder").show();if(!e.isEmbedWidget()){var f=!0;$j("#item_menu_upload_new_to_folder").show(),this.item.permissions.rename&&($j("#item_submenu_email_upload").show(),f=!1),this.item.permissions.upload&&(this.item.user_is_owner&&!Canvas.get().user.is_free_user||!this.item.user_is_owner&&this.item.permissions.options?($j("#item_submenu_upload_widget").show().find(".upgrade").hide(),f=!1):(this.item.user_is_owner||this.item.permissions.options)&&Canvas.get().user.is_free_user&&($j("#item_submenu_upload_widget").show().find(".upgrade").show(),$j("#item_submenu_upload_widget").find("a").prop("onclick",null),$j("#item_submenu_upload_widget").click(function(){var e=Box.Application.getService("v5popups");return e.showUpgradePopup("upload_widget"),!1}),f=!1),this.item.user_is_owner&&Canvas.get().user.is_free_user&&($j("#item_submenu_upload_widget_for_free_user").show(),f=!1)),f&&$j("#item_menu_upload_new_to_folder").hide()}}this._show_lock_options(),this._display_collab_option(),this.item.permissions.synchronize&&(Features.subfolder_sync_ui?this.item.is_synced_for_current_user===CONST.BOX_ITEM_SYNC_SYNCED?($j("#item_menu_folder_fully_synced").show(),$j("#item_submenu_sync_folder_disabled").show(),$j("#item_submenu_unsync").show()):this.item.is_synced_for_current_user===CONST.BOX_ITEM_SYNC_PARTIALLY_SYNCED?($j("#item_menu_folder_partially_synced").show(),$j("#item_submenu_sync_remaining").show(),$j("#item_submenu_unsync").show()):$j("#item_menu_sync").show():this.item.is_synced_for_current_user?$j("#item_menu_disable_sync").show():$j("#item_menu_sync").show()),this.item.is_item_type_taggable()&&this.item.permissions.create_tag?$j("#item_menu_add_edit_tags").show():$j("#item_menu_add_edit_tags").hide(),(!this.item.is_weblink()||this.item.permissions.rename)&&this._show_property_options(),e.isEmbedWidget()&&n&&this._j_target_element&&this._j_target_element.attr("id")=="folder_options_button"&&($j("#item_menu_view").show(),$j("#item_submenu_view_expanded").show(),$j("#item_submenu_view_icon").show(),$j("#item_menu_sort").show(),$j("#item_submenu_sort_name").show(),$j("#item_submenu_sort_date").show(),$j("#item_submenu_sort_size").show()),this.item.permissions.download&&this.item.permissions["delete"]&&!this.item.is_quarantined&&$j("#item_menu_move").show(),this.item.permissions["delete"]&&!(t&&this.item.collaborated&&!this.item.user_is_owner)&&!this.item.is_app_folder&&$j("#item_menu_delete").show(),!t&&this.item.collaborated&&!this.item.user_is_owner&&n&&$j("#item_menu_remove_folder").show(),this.item.is_app_folder&&this.item.user_is_owner&&$j("#item_menu_revoke_folder").show(),this._render_openbox_actions();var l=this.get_page();l!="shared"&&this._show_share_options();if(l=="inbox"||l=="profile"||l=="shared")$j("#item_menu_upload_new_to_folder").hide(),$j("#item_menu_lock_for_free_user").hide(),l=="shared"&&($j("#item_menu_lock").hide(),$j("#item_menu_unlock").hide()),$j("#item_menu_properties").hide(),$j("#item_submenu_general_info_file").hide(),$j("#item_submenu_general_info").hide(),$j("#item_submenu_expiration").hide(),$j("#item_submenu_version_for_free_user").hide(),$j("#item_submenu_version").hide(),$j("#item_submenu_advanced").hide(),$j("#item_submenu_access_level").hide(),$j("#item_submenu_access_stats").hide(),$j("#item_menu_sync").hide(),$j("#item_menu_folder_fully_synced").hide(),$j("#item_menu_folder_partially_synced").hide(),$j("#item_menu_disable_sync").hide(),$j("#item_menu_move").hide(),$j("#item_menu_delete").hide(),$j("#item_menu_remove_folder").hide();l=="shared"?($j("#item_menu_add_edit_tags").hide(),$j("#item_submenu_send_link").hide(),$j("#item_submenu_embed_widget").hide(),$j("#item_submenu_unshare").hide(),$j("#item_menu_request_unlock").hide()):l=="gcm"&&($j("#item_menu_move").hide(),$j("#item_menu_item_in_boards").hide(),$j("#item_submenu_embed_widget").hide(),$j("#item_submenu_widget").hide(),$("#item_menu_add_services").hide(),$("#item_submenu_add_services").hide()),this.type!="right_click"&&($j("#item_menu_open_new_tab").hide(),$j("#item_menu_preview_new_tab").hide()),this.type=="containing_folder"?($j("#item_menu_open").hide(),$j("#item_menu_add_services").hide()):$j("#item_menu_new_folder").hide(),e.isPreviewerOpen()&&($j("#item_menu_preview").hide(),$j("#item_menu_preview_new_tab").hide());if(this.item.can_delete_from_trash()||this.item.can_restore())a.hide(),this.item.can_delete_from_trash()&&$j("#item_menu_delete_from_trash").show(),this.item.can_restore()&&this.item.raw_size<Canvas.get().current_folder.free_space_amount&&$j("#item_menu_restore").show();this.item.is_quarantined&&($j("#item_menu_move").hide(),$j("#item_menu_lock").hide())}else{var c=!0;e.isEmbedWidget()?$j(".multi_options li").each(function(){var e=$j(this);e.clone().appendTo("#item_menu_multiselect"),c=!1}):$("#actionbar-multiple-selection li:visible").each(function(){var e=$(this),t=$(this).find("button").attr("aria-label");t&&($("<li />").attr("id",e.attr("id")).addClass("dropdown_menu").text(t).appendTo("#item_menu_multiselect"),c=!1)}),c&&$j("<li />").addClass("ignore_mouseover").text($t("No actions available","js_item_menu_no_actions")).appendTo("#item_menu_multiselect");var h=$j("#item_menu_multiselect");h.find("li").each(function(){var e=$j(this);e.css("display")!="none"&&e.css("display","block")}),h.show()}this._adjust_separators()},get_page:function(){var e="files",t=Box.Application.getService("v5").get("current_rm"),n=Box.Application.getService("nav-state");return t=="box_v2_new_inbox"?e="inbox":t=="box_user_profile_view"?e="profile":t=="box_shared_show"||t=="box_shared_show_by_name"||t=="box_view_vanity_url"?e="shared":n.isGcm()&&(e="gcm"),e},_get_box_edit_item_menu_label_text:function(){var e=Box.Application.getService("box-edit"),t=e.getNativeApplicationName(this.item.extension);return t==""?$t("Edit","box_edit_display_text"):$t("Edit with %1","edit_with_native_app_name",t)},_display_embed_option:function(){this._check_item_open_access()?$j("#item_submenu_embed_widget").show():$j("#item_submenu_embed_widget").hide()},_check_item_open_access:function(){return this.item&&this.item.shared&&this.item.shared_access==Item.SHARED_ACCESS_OPEN},_display_collab_option:function(){var e=$("#item_submenu_collaborators").hide(),t=this.item,n=t.permissions.view,r=t.is_self_or_ancestor_collaborated,i=t.permissions.options,s=t.hide_collaborators===!0||t.hide_collaborators==="1";r&&n&&(!s||i)&&e.show()},show_submenu:function(e,t){this.base(e,t)},_show_edit_options:function(){var e=Box.Application.getService("browser"),t=Box.Application.getService("box-edit"),n=Box.Application.getService("nav-state");if(!t)return;var r=t.isBoxEditInstalled(),i=this.item.permissions.rename&&!t.isBoxEditDisabledByAdmin()&&e.isBrowserPluginsSupported(),s=!n.isEmbedWidget()||r;if(i&&s){var o=!r&&t.isExtensionSupportedByDefault(this.item.extension);if(t.canUserOpenFileOnDesktop(this.item)||o){var u=this._get_box_edit_item_menu_label_text(),a=$j("#item_menu_box_edit");a.find(".item_menu_label").text(u),a.show()}}},_show_share_options:function(){var e=this.item.can_generate_link(),t=this.item.can_collab(),n=Box.Application.getService("nav-state");if(e||t){$j("#item_menu_share").show(),t&&$j("#item_submenu_collaborate").show(),e&&($j("#item_submenu_get_link").show(),$j("#item_submenu_send_link").show());if(this.item.is_folder()&&this.item.permissions.share&&!n.isEmbedWidget())$j("#item_submenu_embed_widget").show();else if(this.item.is_file()&&this.item.permissions.download&&this.item.permissions.share&&!n.isEmbedWidget()){var r=typeof Previewer!="undefined"&&Previewer.get().preview_on_click(this.item.type,this.item.extension);r&&this._display_embed_option()}this.item.permissions.share&&(this.item.shared||this.item.vanity_name)&&$j("#item_submenu_unshare").show()}},_show_lock_options:function(){var e=this.item.type=="file",t=this.item.lock;if(e)if(t){var n=t.service_action_id==locking_action_id;n&&(t.can_unlock?$j("#item_menu_unlock").show():this.item.permissions.view&&$j("#item_menu_request_unlock").show())}else this.item.is_manually_lockable()&&this.item.permissions.upload&&this.item.permissions.download&&(this.item.owner_is_free?Canvas.get().user.is_free_user&&$j("#item_menu_lock_for_free_user").show():$j("#item_menu_lock").show())},_show_property_options:function(){var e=!1,t=Box.Application.getService("nav-state"),n=t.isGcm();this.item.is_root_folder()||$j("#item_menu_properties").show(),this.item.permissions.view&&($j("#item_submenu_general_info").show(),this.item.is_folder()&&this.item.permissions.options&&$j("#item_submenu_advanced").show(),e=!0),this.item.can_view_download_stats()&&($j("#item_submenu_access_stats").show(),e=!0);var r=Canvas.get().user.has_custom_feature("auto_expiration")&&(this.item.can_change_share_expiration||this.item.can_change_delete_expiration);!n&&r&&($j("#item_submenu_expiration").show(),e=!0),this.item.is_folder()&&!t.isEmbedWidget()&&this.item.permissions.view&&($j("#item_submenu_email").show(),e=!0),this.item.is_file()&&this.item.permissions.view&&!this.item.is_boxnote()&&(Canvas.get().user.is_free_user&&this.item.owner_is_free?$j("#item_submenu_version_for_free_user").show():$j("#item_submenu_version").show(),e=!0),e||$("#item_menu_properties").hide()},_adjust_separators:function(){var e=$j(this._e_menu).find(".separator");e.show().each(function(){var e=$j(this).nextAll(":visible:first"),t=$j(this).prevAll(":visible:first");(!e.length||e.hasClass("separator"))&&$j(this).hide(),t.length||$j(this).hide()})},_render_openbox_actions:function(){var e=Box.Application.getService("openbox-service-actions"),t=e.getActions(this.item,{type:"openbox"}),n=window.promoted_app_ids||"",r=Box.Application.getService("nav-state");n=n.split(","),$j("#openbox_separator").hide(),$j("#dd_menu_box_item").find(".item_menu_action_default").remove();var i=0,s={};for(var o=0,u=t.length;o<u;o++){s=t[o],$j.inArray(s.id.substring("openbox_service".length),n)>-1&&(s.promoted=!0);var a=this._render_openbox_action(s);a&&i++}var f=r.isEmbedWidget(),l;if(i){var c=$j("#item_menu_more_openbox");c.find(".badge").text(i),c.show();if(Canvas.get().logged_in&&!f){var h=$j("#submenu_openbox_menu");l=$j("#item_submenu_add_services").detach();var p=$j("#openbox_separator").detach();p.appendTo(h).show(),l.appendTo(h).show()}}else Canvas.get().logged_in&&!f&&(l=$j("#item_menu_add_services").detach(),l.show().appendTo($j("#dd_menu_box_item .item_menu")))},_render_openbox_action:function(e){function i(){r.off().on("click",function(){return e.execute(),!1})}if(!e.can_execute())return!1;var t=Box.Application.getService("box-edit"),n=!0,r=$j('.openbox_action[data-openbox_action_id="'+e.id+'"]');return r.length||(n=!1,r=$j("<li>").attr("data-openbox_action_id",e.id).addClass("openbox_action"),r.append($j('<a href="#" class="item_menu_item_openbox" />').text(e.name)),e.favicon_url&&r.children(".item_menu_item_openbox").prepend($j('<img class="list_img" width="16" height="16">').attr("src",e.favicon_url))),e.executed_by_default||e.promoted?(n||$j("#default_openbox_separator").before(r.addClass("item_menu_action_default")),i(),!1):e.editable_on_gallery?($j(this._e_menu).find("#item_menu_edit_file").off().on("click",function(){return e.execute({skip_popup:!0}),!1}).show(),t&&t.isFileExtHandledByOpenbox(this.item.extension)&&$j("#item_menu_box_edit").hide(),i(),!1):t&&t.isActionIdBoxEdit(e.id)?!1:(n||$j("#item_submenu_openbox ul").append(r),i(),r.show(),!0)},event_click:function(e){var t=Box.Application.getService("box-edit"),n=$j(e.target).closest("li")[0],r=n.id,i=Box.Application.getService("v5popups"),s=Box.Application.getService("v5popups-postload"),o=this.item.j_element,u=Box.Application.getService("nav-state");if(n.parentNode.id=="item_menu_multiselect")return Box_Menus.get().multi_options_menu.event_click(e);switch(r){case"item_menu_open":this.item.click();break;case"item_menu_open_new_tab":this.item.open_in_new_window();break;case"item_menu_preview":o&&(Box.Application.navigate(o.find("a.item_link").attr("href")),this.hide());break;case"item_menu_preview_new_tab":this.item.open_in_new_window();break;case"item_menu_download":this.item.download(),this.hide();break;case"item_menu_box_edit":t&&t.isBoxEditFullyEnabled(this.item)?t.executeBoxEdit(this.item.id,this.item.typed_id):Box.Application.getService("popups").open("box_edit_download",{data:{action:"edit",typed_id:this.item.typed_id,extension:this.item.extension}});break;case"item_menu_new_folder":this.item.new_folder();break;case"item_menu_upload_new_version":var a=Upload_Process.get();a.get_type()==="ajax"?Box.Application.getService("upload-process").showAjaxEolMessage():Upload_Process.get().show_upload_new_version_popup();break;case"item_menu_lock_for_free_user":i.showUpgradePopup("file_lock");break;case"item_menu_request_unlock":s.showUnlockRequestPopup(Canvas.get().target_item.lock);break;case"item_menu_share":case"item_submenu_send_link":Box_Menus.get().menu.handle_share_click("send");break;case"item_menu_sync":this.item.synchronize();break;case"item_menu_properties":case"item_submenu_general_info":this.item.edit_properties();break;case"item_menu_add_edit_tags":this.item.tag();break;case"item_menu_disable_sync":this.item.synchronize({unsync:!0});break;case"item_menu_move":this.item.move({create_new_action_instance:!0});break;case"item_menu_delete":if(this.item.id==Canvas.get().current_folder.id){var u=Box.Application.getService("nav-state");u.set({id:Canvas.get().current_folder.parent})}this.item.delete_me();break;case"item_menu_remove_folder":this.item.remove_collab();break;case"item_menu_revoke_folder":this.item.revoke_app_folder();break;case"item_menu_delete_from_trash":this.item.delete_from_trash();break;case"item_menu_restore":this.item.restore();break;case"item_menu_lock":this.item.lock_file();break;case"item_menu_unlock":this.item.unlock_file();break;case"item_submenu_email_upload":case"item_submenu_email":Box_Menus.get().menu.item.edit_properties({selected_tab:"email_options"});break;case"item_submenu_upload_widget":Box_Menus.get().menu.item.embed_upload_widget();break;case"item_submenu_collaborate":this.handle_item_submenu_collaborate_click();break;case"item_submenu_get_link":Box_Menus.get().menu.handle_share_click("link");break;case"item_submenu_embed_widget":Box_Menus.get().menu.handle_share_click("embed");break;case"item_submenu_unshare":Box_Menus.get().menu.item.unshare();break;case"item_submenu_access_stats":Box_Menus.get().menu.item.edit_properties({selected_tab:"stats"});break;case"item_submenu_version_for_free_user":i.showUpgradePopup("version_history");break;case"item_submenu_version":Box_Menus.get().menu.item.version_history();break;case"item_submenu_collaborators":this.handle_item_submenu_collaborators_click();break;case"item_submenu_advanced":Box_Menus.get().menu.item.edit_properties({selected_tab:"advanced"});break;case"item_submenu_expiration":Box_Menus.get().menu.item.set_expirations();break;case"item_submenu_sync_remaining":Box_Menus.get().menu.item.synchronize();break;case"item_submenu_unsync":Box_Menus.get().menu.item.synchronize({unsync:!0});break;case"item_menu_add_services":case"item_submenu_add_services":var f=Box.Application.getService("url");f.openWindow("/services");break;case"item_menu_item_in_boards":this.item.show_pins(),this.hide();break;case"item_menu_remove_item_in_pin_board":var l=u.get();this.item.remove_pin({target:l.id}),this.hide();break;case"item_menu_export":if(u.isGcm()){var c=Box_Menus.get().menu.item;Box_Master_GCM.get().export_folder_tree(c)}break;case"item_menu_quarantine_restore":Box.Application.broadcast("x-quarantinerestore",{element:this.module_context}),this.hide();break;case"item_menu_quarantine_delete":Box.Application.broadcast("x-quarantinedelete",{element:this.module_context}),this.hide();break;case"item_menu_quarantine_false_positive":Box.Application.broadcast("x-quarantinefalsepositive",{element:this.module_context}),this.hide();break;default:return!1}return!1},_get_offsets:function(){var e=this._target_event?{x:-5,y:-5}:{x:0,y:-7};return this._j_target_element.is("button")&&(e.y=11),e},handle_share_click:function(e){if(this.item.shared_link==""){var t=this;return this.item.get_shared_info(function(){t.handle_share_click(e)}),!1}return box.hist_name=="shared_folder"?this.item.sharebar({selected_tab:"link_only"}):this.item.sharebar({selected_tab:e}),this.hide(),this.displayed_submenu.hide(),!1},handle_item_submenu_collaborate_click:function(){var e=Box.Application.getService("v5"),t=e.get("Box_Menus").menu,n=e.get("Features"),r=Box.Application.getService("popups");t.item&&r.open("collaborate",{data:{typed_id:t.item.typed_id}})},handle_item_submenu_collaborators_click:function(){var e=Box.Application.getService("v5");e.get("Features").collab_popup_redesign?Box.Application.getService("popups").open("show_collabs_by_folder",{data:{folderId:e.get("Canvas").current_folder.id,collabType:"inherited"}}):e.get("Box_Menus").menu.item.collab_list()}},{});Box.Timing.execution.push({name:"js/menus/box_create_item_menu.js",time:(new Date).getTime()});var Create_Item_Menu=Abstract_Menu.extend({_defined_inline:!0,constructor:function(e){e=e||{},this._e_menu=$j("#dd_menu_create_item").get(0)},show:function(e){e=e||{},this._j_target_element=$j(e.target),this._elements_that_keep_menu_open=$j(e.target).find("span"),this._filter_supported_box_edit_types($j(this._e_menu).find(".new_box_edit_file_type")),this.base()},_get_offsets:function(e){return{x:0,y:11}},_filter_supported_box_edit_types:function(e){var t=Box.Application.getService("browser"),n=Box.Application.getService("box-edit"),r=Box.Application.getService("nav-state");if(n&&!n.isBoxEditDisabledByAdmin()&&t.isBrowserPluginsSupported())if(n.isBoxEditInstalled())for(var i=0,s=e.length;i<s;i++){var o=$j(e).eq(i),u=o.data("newdoc_extension");(!u||!n.getNativeApplicationName(u))&&o.hide()}else r.isEmbedWidget()?e.remove():e.off("click").on("click",function(){var e=$j(this);return Box.Application.getService("popups").open("box_edit_download",{data:{action:"create",file_type:e.data("newdoc_type"),extension:e.data("newdoc_extension")}}),!1});else e.remove()},event_click:function(e){var t=Box.Application.getService("nav-state"),n=$(e.target).closest("li").get(0);if(t.isSearch())return!1;var r=Box.Application.getService("popups"),i=Box.Application.getService("v5").get("Canvas");switch(n.id){case"new_item_new_folder":case"new_item_new_folder_link":i.current_folder.new_folder();break;case"new_item_new_webdoc":case"new_item_new_webdoc_link":r.open("new_document",{data:{folder_id:i.current_folder.id,type:"webdoc"}});break;case"new_item_new_boxnote":case"new_item_new_boxnote_link":r.open("new_document",{data:{folder_id:i.current_folder.id,type:"boxnote"}});break;case"new_item_new_bookmark":case"new_item_new_bookmark_link":r.open("new_web_link",{data:{folder_id:i.current_folder.id}});break;default:var s=$j(n),o=s.parents().andSelf(),u=s.attr("data-newdoc_type")||s.parent().attr("data-newdoc_type");u&&o.hasClass("new_file_type")&&r.open("new_document",{data:{folder_id:i.current_folder.id,type:u}})}return!1}},{});Box.Timing.execution.push({name:"js/menus/share_access_menu.js",time:(new Date).getTime()});var Share_Access_Menu=Abstract_Menu.extend({constructor:function(e){this.params=e||{},this._menu_container_selector="#dd_menu_share_access",this._e_menu=$j(this._menu_container_selector).get(0),Canvas.get().register_body_click_handler(this)},show:function(e){e=e||{},this._j_target_element=$(e.target),this.source=e.source,this.item=e.item,this.after_permission_switch_callback=e.after_permission_switch_callback,this.base(),$j(this._e_menu).find(".list_ext li").removeClass("first_child").filter(":visible:first").addClass("first_child")},hide:function(e){$j(this._e_menu).find("input[type=text]").is(":focus")||this.base()},_get_offsets:function(e){return{x:-1,y:-6}},_render:function(e){e=e||{};var t=this;$j(this._e_menu).find("input[type=text]").blur(),$j("#share_access_normal_container").find(".hidden_onload").hide(),$j("#share_access_normal_container").find(".security_access_option").show(),$j("#share_access_permission_disabled").hide(),$j("#share_access_password_text").text(""),$j("#share_access_password_input").val("").blur(),$j("#shared_access_file_embed_password_warning").hide(),$j("#share_access_custom_link_input").val("").blur(),$j("#share_access_normal_container").find(".security_access_option").find("input").prop("disabled",!1).removeAttr("checked").removeClass("disabled").removeAttr("title data-hover aria-label"),$j(".share_access_custom_link_root").text(this.item.custom_shared_link_root),$j("#share_access_menu_email_domain_ucfirst").text(this.item.owner_enterprise_display_domain),this.item.owner_disabled_shared_download?($j("#share_access_permission_download_off").find("input").prop("checked",!0),this._disable_permission_options()):this.item.shared_download_off?$j("#share_access_permission_download_off").find("input").prop("checked",!0):$j("#share_access_permission_enabled").find("input").prop("checked",!0),this.item.user_is_owner?$j("#share_access_permissions_change_settings").show():$j("#share_access_permissions_change_settings").hide(),this.item.extension=="webdoc"||this.item.type=="web_link"?$j("#share_access_permissions_cntr").hide():$j("#share_access_permissions_cntr").show(),Canvas.get().user.has_custom_feature("auto_expiration")||($j("#share_access_password_block_pro").show(),$j("#share_access_expiration_block_pro").show()),(this.item.user_is_owner||this.item.permissions.share)&&this.item.has_password&&($j("#share_access_password_text").text("*******"),$j("#share_access_password_input").val(""),this.item.permissions.set_share_access||$j("#share_access_password_delete").hide(),$j("#share_access_password_display_cntr").show(),$j("#share_access_password_input_cntr").hide(),$j("#share_access_password_options").show()),this.item.permissions.share&&this.item.vanity_name&&($j("#share_access_custom_link_vanity_name").text(this.item.vanity_name),$j("#share_access_custom_link_display_cntr").show(),$j("#share_access_custom_link_input_cntr").hide(),$j("#share_access_custom_link_options").show(),$j("#share_access_custom_link_input").val(this.item.vanity_name),this.item.permissions.set_share_access||$j("#share_access_password_delete").hide()),this.update_menu_selection(t.item.shared_access)},_disable_permission_options:function(){$j("#share_access_permission_disabled").show();var e=$j(this._e_menu).find(".security_access_option");e.unbind("click").addClass("disabled"),e.find("a").addClass("disabled"),e.find("input").addClass("disabled").prop("readonly","readonly").addClass("disabled")},set_share_permissions:function(e){var t=this,n=$j("#share_access_permission_download_off").find("input");e?n.prop("checked",!1):n.prop("checked",!0),this.item.share({download_enabled:e?1:0,callback:function(){t.item.shared_download_off=!e}})},event_click:function(e){var t=this,n=$j(e.target),r=n.attr("id"),i=n.parentsUntil("#dd_menu_share_access","li"),s=Box.Application.getService("v5popups");if(i.hasClass("disabled"))return i.find("input.access_type").prop("checked",!1),!1;if(r=="share_access_custom_link_detail_toggle"){var o=$j("#share_access_custom_link_input_cntr"),u=$j("#share_access_custom_link_options");u.is(":visible")?t.item.vanity_name?t._show_custom_link_input():(u.hide(),$j("#share_access_custom_link_cntr").find(".error_message").hide()):(u.show(),t.item.vanity_name?($j("#share_access_custom_link_display_cntr").show(),o.hide()):($j("#share_access_custom_link_display_cntr").hide(),o.show(),$j("#share_access_custom_link_input").focus()))}else{if(r=="share_access_password_detail_toggle"){if(!Canvas.get().user.has_custom_feature("auto_expiration"))s.showUpgradePopup("password_protect",function(){});else if(!t.item.has_password){var o=$j("#share_access_password_input_cntr"),u=$j("#share_access_password_options"),a=$j("#shared_access_file_embed_password_warning");u.is(":visible")?(i.find("#share_access_password_cntr .error_message").hide(),u.hide(),a.hide()):(u.show(),o.show(),t.item.type=="file"&&a.show(),$j("#share_access_password_input").focus())}return!1}if(r=="share_access_expiration_detail_toggle")return Canvas.get().user.has_custom_feature("auto_expiration")?t.item.set_expirations():s.showUpgradePopup("password_protect",function(){}),!1;if(r=="share_access_permission_detail_toggle")return $j("#share_access_permission_options").toggle(),!1;if(r=="share_access_password_block_pro")return s.showUpgradePopup("password_protect",function(){}),!1;if(r=="share_access_expiration_block_pro")return s.showUpgradePopup("password_protect",function(){}),!1;if(r=="share_access_permissions_change_settings"){var f=Box.Application.getService("url");return f.goToUrl(n.attr("href")),!1}}return t._handle_custom_link_event_click(n)?!1:t._handle_password_event_click(n)?!1:t._handle_permission_event_click(n)?n.attr("type")=="checkbox"||n.is("label"):n.parents("ul").hasClass("share_access_actions")?!1:(t._handle_access_level_event_click(n),n.is("input"))},_handle_custom_link_event_click:function(e){var t=this,n=Box.Application.getService("logger");n.sendLog("custom_url","share_access_menu_custom_link_click");var r=e.prop("id"),i=e.parent().prop("id");return r=="share_access_set_custom_link_button"?(t.set_share_custom_link(!0),!0):i=="share_access_custom_link_edit"?(t._show_custom_link_input(),!0):i=="share_access_custom_link_delete"?(t.set_share_custom_link(!1),!0):!1},_handle_password_event_click:function(e){var t=this,n=e.prop("id"),r=e.parent().prop("id");return n=="share_access_set_password_button"?(t.set_share_password(!0),!0):r=="share_access_password_delete"?(t.set_share_password(!1),!0):!1},_handle_permission_event_click:function(e){var t=this,n=e.parentsUntil("#share_access_permissions_cntr","li"),r=n.prop("id");return r=="share_access_permission_download_off"?(t.set_share_permissions(!n.find("input").prop("checked")),!0):!1},_handle_access_level_event_click:function(e){var t=this,n=e.parentsUntil("#dd_menu_share_access","li").prop("id");if(!n)return;var r=Item.SHARED_ACCESS_DISABLED;n=="share_access_open"?r=Item.SHARED_ACCESS_OPEN:n=="share_access_company"?r=Item.SHARED_ACCESS_COMPANY:n=="share_access_restricted"&&(r=Item.SHARED_ACCESS_RESTRICTED),this.update_menu_selection(r),r==Item.SHARED_ACCESS_DISABLED?(t.hide(),t.item.unshare()):r!=t.item.shared_access&&t.item.set_share_access({access:r,source:t.source,callback:t.save_item_callback,menu:t})},_show_custom_link_input:function(){$j("#share_access_custom_link_display_cntr").hide(),$j("#share_access_custom_link_input_cntr").show(),$j("#share_access_custom_link_input").focus()},save_item_callback:function(e,t,n){var r=this,i=Item.shared_access_to_string(e);t!="expansion"?($j("#sharing_sidebar_access_link").html(i+'<span class="arrow"></span>'),t!="sidebar"&&($j("#popup_settings_launcher").find("a").text(i),r.sharebar()),box_sidebar.update_share_icons(n.item)):(n.item.expansion.update_access(),n.item.update_item_share_info_ui(),n.item._render_expirations()),$.isFunction(n.after_permission_switch_callback)&&n.after_permission_switch_callback()},set_share_custom_link:function(e){var t=this,n=e===!1,r=$j("#share_access_custom_link_input"),i=e?$j.trim(r.val()):"";$j("#share_access_custom_link_cntr").find(".error_message").hide();if(e&&(i.length===0||!Validator.validate_partial_url(i))){r.focus(),$j("#share_access_custom_link_cntr").find(".error_message").text($t("Please enter a custom url.  You can use letters, numbers and hyphens.","share_access_menu_enter_custom_link_label")).show();return}r.prop("readonly",!0).css("background-color","#EEE"),this.item.share({vanity_name:i,callback:function(s){return r.prop("readonly",!1).css("background-color",""),n?($j("#share_access_custom_link_vanity_name").text(""),$j("#share_access_custom_link_input").val(""),$j("#share_access_custom_link_display_cntr").hide(),$j("#share_access_custom_link_options").hide()):($j("#share_access_custom_link_vanity_name").text(i),$j("#share_access_custom_link_display_cntr").show(),$j("#share_access_custom_link_input_cntr").hide()),t.item.update_item_share_info_ui(),!1}})},set_share_password:function(e){var t=$j("#share_access_password_input"),n=$j("#share_access_password_text"),r=$j("#share_access_password_display_cntr"),i=$j("#share_access_password_input_cntr"),s=$j("#share_access_password_options"),o=t.val();if(e&&o.length===0){t.focus(),$j("#share_access_password_cntr").find(".error_message").show();return}return t.prop("readonly","readonly"
).css("background-color","#EEE"),this.item.share({password:o,callback:function(){t.val(""),e?(t.prop("readonly","").css("background-color",""),i.hide().find(".error_message").hide(),$j("#share_access_password_cntr").find(".error_message").hide(),$j("#open_custom_link_warning").hide(),n.text("*******"),r.show()):(i.show(),r.hide(),s.hide(),$j("#open_custom_link_warning").show(),t.prop("readonly",!1).css("background-color",""))}}),!0},update_menu_selection:function(e){var t=this,n=$j("#share_access_normal_container"),r=$j("#share_access_disabled"),i=$j("#share_access_company"),s=$j("#share_access_restricted"),o=$j("#share_access_open"),u=$j("#open_custom_link_warning").hide();n.find("input.access_type").prop("disabled",!1).prop("checked",!1),n.find(".share_access_actions").hide(),e==Item.SHARED_ACCESS_DISABLED?r.find("input.access_type").prop("checked",!0):e==Item.SHARED_ACCESS_COMPANY?(i.find("input.access_type").prop("checked",!0),i.find(".share_access_actions ").show(),i.find(".share_access_actions").append($j("#share_access_custom_link_cntr")).append($j("#share_access_expiration_cntr")).append($j("#share_access_permissions_cntr"))):e==Item.SHARED_ACCESS_RESTRICTED?(s.find("input.access_type").prop("checked",!0),s.find(".share_access_actions").show(),s.find(".share_access_actions").append($j("#share_access_custom_link_cntr")).append($j("#share_access_expiration_cntr"))):(o.find("input.access_type").prop("checked",!0),o.find(".share_access_actions").show(),o.find(".share_access_actions").prepend($j("#share_access_custom_link_cntr")).append($j("#share_access_expiration_cntr")).append($j("#share_access_permissions_cntr")),$j("#share_access_password_cntr").show(),this.item.has_password?u.hide():u.show());var a={};a[Item.SHARED_ACCESS_OPEN]=o,a[Item.SHARED_ACCESS_COMPANY]=i,a[Item.SHARED_ACCESS_RESTRICTED]=s,a[Item.SHARED_ACCESS_DISABLED]=r,$j.each(a,function(n,r){r.show(),r.removeClass("disabled"),t.item.permissions.set_share_access?t.item.shared_access_levels&&(n!=Item.SHARED_ACCESS_DISABLED&&!t.item.shared_access_levels[n]?t.disable_option(r,n):n==Item.SHARED_ACCESS_COMPANY&&!t.item.owner_enterprise_display_domain?(t.disable_option(r,n),e==n&&($j("#share_access_expiration_cntr").hide(),$j("#share_access_permissions_cntr").hide())):r.find(".description").text(t.item.shared_access_option_text(n,!0))):n==e?(n==Item.SHARED_ACCESS_OPEN&&($j("#share_access_password_cntr").hide(),$j("#share_access_expiration_cntr").hide(),$j("#share_access_permissions_cntr").hide()),r.find(".description").text(t.item.shared_access_option_text(n,!0))):t.disable_option(r,n)}),this.update_custom_url_visibility(e)},disable_option:function(e,t){e.find(".description").text(this.item.shared_access_option_text(t,!1)),e.addClass("disabled"),e.hide()},update_custom_url_visibility:function(e){this.item.owner_enterprise_disable_open_custom_links&&e==Item.SHARED_ACCESS_OPEN?$j("#share_access_custom_link_cntr").hide():this.item.permissions.set_share_access?$j("#share_access_custom_link_cntr").show():$j("#share_access_custom_link_cntr").hide()},body_click_handler:function(e){this.visible&&!$j(e.target).parents().is(this._menu_container_selector)&&($j(this._menu_container_selector).find("input[type=text]").blur(),this.hide())}},{get:function(){return Share_Access_Menu.__instance||(Share_Access_Menu.__instance=new Share_Access_Menu),Share_Access_Menu.__instance}});Box.Timing.execution.push({name:"js/menus/box_current_user_menu.js",time:(new Date).getTime()});var Current_User_Menu=Abstract_Menu.extend({from_admin:!1,constructor:function(e){e=e||{},this._e_menu=$j("#current_user_menu").get(0),this._elements_that_keep_menu_open=$j("#current_user_tab")},show:function(e){Box_Menus.get().upgrade_dropdown.hide(),e=e||{},this._j_target_element=$j(e.target),this._elements_told_menu_is_open=this._j_target_element.parent(),this.from_admin=e.from_admin,$j(this._e_menu).css("min-width",this._elements_told_menu_is_open.width()-parseInt(this._elements_told_menu_is_open.css("margin-left"))-parseInt(this._elements_told_menu_is_open.css("margin-right"))),this.base()},_get_offsets:function(e){var t=Box.Application.getService("nav-state");if(t.isEmbedWidget())return{x:10,y:9};if(this.from_admin){var n=this._j_target_element.width()-$j(this._e_menu).width();return{x:n,y:this.stalking?23:13}}return{x:-173,y:this.stalking?23:12}},_render:function(){this.from_admin?($j(".end_user_menu_only").hide(),$j(".admin_menu_only").show(),$j(".current_user_menu_arrow").css({right:"3px",left:"auto"})):($j(".admin_menu_only").hide(),Canvas.get().logged_in&&$j(".end_user_menu_only").show(),Canvas.get().user.is_free_user||($j("#current_user_business_solutions").hide(),$j("#current_user_upgrade").hide()))}},{});Box.Timing.execution.push({name:"js/menus/box_select_element.js",time:(new Date).getTime()});var Select_Element=Abstract_Menu.extend({j_select:null,constructor:function(e){this.j_select=$j(e).parent(),this.j_button=$j(e),this._j_target_element=this.j_button,this._e_menu=this.j_select.find(".select_options")[0]},show:function(){if(this.j_button.hasClass("disabled"))return;if(this.j_button.data("not_show")){this.j_button.data("not_show",!1);return}this.menu_clicked=!1,$j(".select_options").filter(":visible").hide(),$j(this._e_menu).detach().appendTo($j("body")),this._set_position(),this._attach_events(),$j(this._e_menu).width($j(this.j_button).outerWidth()-2).show(),this.j_button.focus()},_set_position:function(){var e;e=this._j_target_element.offset(),e.top+=this._j_target_element.outerHeight(),this._e_menu.style.display="block",this._e_menu.style.position="absolute",this._e_menu.style.left=e.left+"px",this._e_menu.style.top=e.top+"px"},_attach_events:function(){var e=this;this.j_button.unbind("blur").bind("blur",function(t){e.menu_clicked||$j(e._e_menu).hide().detach().appendTo(e.j_select)}),this.j_button.unbind("click.selectelement").bind("click.selectelement",function(t){if(!$j(e._e_menu).is(":visible"))return;$j(this).blur().data("not_show",!0)}),$j(this._e_menu).unbind("mousedown").bind("mousedown",function(t){e.menu_clicked=!0}),$j(this._e_menu).unbind("scroll").bind("scroll",function(t){e.menu_clicked=!1,e.menu_scrolled=!0}),$j("body").unbind("mousedown").bind("mousedown",function(t){e.menu_scrolled&&!e.menu_clicked&&($j(e._e_menu).hide().detach().appendTo(e.j_select),e.menu_scrolled=!1)}),$j(this._e_menu).find("a").unbind("mousedown").bind("mousedown",function(t){e.menu_clicked=!0}).unbind("click").bind("click",function(t){return e.handle_option_click(t),!1})},handle_option_click:function(e){var t=this,n=$j(e.target),r=n.closest("li"),i=r.find(".hidden_value").text();r.hasClass("disabled")||(r.removeClass("hover"),Box.Application.getService("tooltips").hideTooltips(),this.select(i)),r.closest(".select_options").hide().detach().appendTo(t.j_select),Box.Application.broadcast("x-optionclick",{id:this.j_select.attr("id"),value:i})},select:function(e){var t=this.j_select,n=$j(this._e_menu).find('[data-option-name="'+e.toString()+'"]');n.length||(n=$j(this._e_menu).find("."+e.toString().replace(" ","-")));var r=n.text();t.find(".currently_selected").text(r),t.find("input").val(e).change()},option_actions:function(e,t){if(!t)return;var n=$j(this._e_menu).find("."+e),r=[],i=[];$j.in_array("show",t)&&i.push("hidden_value"),$j.in_array("hide",t)&&r.push("hidden_value"),$j.in_array("enable",t)&&i.push("disabled"),$j.in_array("disable",t)&&r.push("disabled"),r.length&&n.addClass(r.join(" ")),i.length&&n.removeClass(i.join(" "))}},{});Box.Timing.execution.push({name:"js/menus/box_task_type_selector_menu.js",time:(new Date).getTime()});var Task_Type_Selector_Menu=Abstract_Menu.extend({constructor:function(e){this.params=e||{},this._e_menu=$j("#task_type_selector_menu").get(0),this.reset()},show:function(e){e=e||{},this._j_target_element=e.target,this._j_label=this._j_target_element.find(".task_type_label"),this._j_sprite=this._j_target_element.find(".task_type_icon"),this.item=e.item,this.task=e.task,this.base()},_get_offsets:function(e){return{x:-5,y:-3}},set_new_task_action:function(e){this._new_task_action=e},get_new_task_action:function(){return this._new_task_action},reset:function(){this._new_task_action=Task_Type_Selector_Menu.ACTION_DEFAULT},event_click:function(e){var t=$j(e.target).closest("li").attr("id"),n=Task_Type_Selector_Menu.id_to_label,r=Task_Type_Selector_Menu.id_to_action,i=Task_Type_Selector_Menu.id_to_sprite;if(t in n){var s=r[t],o=n[t],u=i[t];if(this.task)this.task.change_action({new_label:o,target:this._j_target_element,new_action:s,new_sprite:u});else{this._j_label.text(o),this._new_task_action=s,this._j_sprite.removeClass().addClass("task_type_icon "+u);var a=$j("#new_item_feed_object_textarea");$.inArray(a.val(),Task_Type_Selector_Menu.default_text)>=0&&a.val(Task_Type_Selector_Menu.id_to_default_text[t])}}return this.hide(),!1}},{id_to_label:{task_type_review:$t("To Review:","task_type_selector_menu_to_review_js"),task_type_approve:$t("To Approve:","task_type_selector_menu_to_approve_js"),task_type_update:$t("To Update:","task_type_selector_menu_to_update_js")},id_to_action:{task_type_review:"review",task_type_approve:"approve",task_type_update:"update"},id_to_sprite:{task_type_review:"sprite_16x16_review",task_type_approve:"sprite_16x16_approve",task_type_update:"sprite_16x16_update"},id_to_default_text:{task_type_review:$t("Please review this file","js_item_feed_object_default_review_text"),task_type_approve:$t("Please approve or reject this file","js_item_feed_object_default_approve_text"),task_type_update:$t("Please upload a new version of this file","js_item_feed_object_default_update_text")},default_text:[$t("Please review this file","js_item_feed_object_default_review_text"),$t("Please approve or reject this file","js_item_feed_object_default_approve_text"),$t("Please upload a new version of this file","js_item_feed_object_default_update_text")],ACTION_DEFAULT:"review",get:function(){return Task_Type_Selector_Menu.__instance||(Task_Type_Selector_Menu.__instance=new Task_Type_Selector_Menu),Task_Type_Selector_Menu.__instance}});Box.Timing.execution.push({name:"js/menus/box_task_assignment_status_menu.js",time:(new Date).getTime()});var Task_Assignment_Status_Menu=Abstract_Menu.extend({constructor:function(){this._e_menu=$j("#task_assignment_status_menu").get(0)},show:function(e){e=e||{},this._j_target_element=$j(e.target),this.task_assignment=e.task_assignment,this.task=e.task,this.base(e)},_render:function(){var e=this.task_assignment?this.task_assignment.task.action:this.task.action,t=Task_Assignment_Status_Menu.option_ids,n;for(n in t)$j("#"+t[n]).hide();var r=this.task_assignment?Task_Assignment_Status_Menu.option_ids_to_show_existing:Task_Assignment_Status_Menu.option_ids_to_show_new;if(r[e])for(n in r[e])$j("#"+r[e][n]).show()},_get_offsets:function(){return{x:this._j_target_element.outerWidth()-$(this._e_menu).outerWidth(),y:0}},get_new_status:function(){return this._new_status},event_click:function(e){var t=$j(e.target).closest("li").attr("id");if($.inArray(t,Task_Assignment_Status_Menu.option_ids)>=0){var n=Task_Assignment_Status_Menu.id_to_status[t];if(this.task){$j("#task_info_"+this.task.id).disable(),this._new_status=n;var r=Task_Assignment_Status_Menu.id_to_html[t];this._j_target_element.closest(".buttons").find(".task_response_submit").html(r)}else $j("#task_info_"+this.task_assignment.task_id).disable(),this.task_assignment.complete({new_status:n})}return this.hide(),!1},reset:function(){this._new_status=null}},{get:function(){return Task_Assignment_Status_Menu.__instance||(Task_Assignment_Status_Menu.__instance=new Task_Assignment_Status_Menu),Task_Assignment_Status_Menu.__instance},option_ids_to_show_existing:{review:["task_assignment_status_menu_complete","task_assignment_status_menu_incomplete"],approve:["task_assignment_status_menu_complete","task_assignment_status_menu_incomplete"],update:["task_assignment_status_menu_complete","task_assignment_status_menu_incomplete"]},option_ids_to_show_new:{review:["task_assignment_status_menu_complete","task_assignment_status_menu_comment","task_assignment_status_menu_decline"],approve:["task_assignment_status_menu_complete","task_assignment_status_menu_comment","task_assignment_status_menu_decline"],update:["task_assignment_status_menu_complete","task_assignment_status_menu_comment","task_assignment_status_menu_decline"]},option_ids:["task_assignment_status_menu_complete","task_assignment_status_menu_incomplete","task_assignment_status_menu_approve","task_assignment_status_menu_reject","task_assignment_status_menu_decline","task_assignment_status_menu_incomplete","task_assignment_status_menu_comment"],id_to_html:{task_assignment_status_menu_complete:$t("%1 Complete","js_task_assignment_status_menu_complete","&#x2714;"),task_assignment_status_menu_incomplete:$t("%1 Incomplete","js_task_assignment_status_menu_incomplete","?"),task_assignment_status_menu_approve:'<span class="sprite_12x12_green_plus img"></span>'+$t("Approve","js_task_assignment_status_menu_approve"),task_assignment_status_menu_reject:'<span class="sprite_12x12_red_minus img"></span>'+$t("Reject","js_task_assignment_status_menu_reject"),task_assignment_status_menu_decline:$t("%1 Decline Task","js_task_assignment_status_menu_decline","&#x2717;"),task_assignment_status_menu_comment:'<span class="sprite_12x12_reply_blue img mrs"></span>'+$t("Comment","js_task_assignment_status_menu_comment")},id_to_status:{task_assignment_status_menu_complete:"complete",task_assignment_status_menu_incomplete:"incomplete",task_assignment_status_menu_approve:"approve",task_assignment_status_menu_reject:"reject",task_assignment_status_menu_decline:"decline",task_assignment_status_menu_comment:"incomplete"}});Box.Timing.execution.push({name:"js/menus/box_task_assignee_menu.js",time:(new Date).getTime()});var Task_Assignee_Menu=Abstract_Menu.extend({constructor:function(e){this.params=e||{},this._e_menu=$j("#task_assignee_menu").get(0)},show:function(e){e=e||{},this._j_target_element=e.target,this.task_assignment=e.task_assignment,this.base()},_render:function(){var e=$j("#task_assignee_remove");this.task_assignment.permissions.assign?e.show():e.hide(),this.task_assignment.permissions["delete"]?e.show():e.hide()},_get_offsets:function(e){return{x:-1,y:-6}},event_click:function(e){var t=$j(e.target).closest("li").attr("id");return t=="task_assignee_remind"&&this.task_assignment.remind(),t=="task_assignee_remove"&&this.task_assignment.delete_me({item_feed:this._j_target_element.closest(".item_feed")}),this.hide(),!1}},{_instance:null,get:function(){return Task_Assignee_Menu.__instance||(Task_Assignee_Menu.__instance=new Task_Assignee_Menu),Task_Assignee_Menu.__instance}});Box.Timing.execution.push({name:"js/menus/box_user_menu.js",time:(new Date).getTime()});var User_Menu=Abstract_Menu_With_Submenus.extend({_this_folder_only:!1,_profile_link:null,_pending:!1,_expiration:null,_direct_collab_on_item:null,_available_roles:null,user:null,user_activity:{},constructor:function(e){e=e||{},this._elements_that_keep_menu_open=$j("#user_menu_roles").get(0),this._e_menu=$j("#user_menu").get(0)},hide:function(){this.base(),this.user=null},_get_offsets:function(){return this._j_target_element.hasClass("corporate_network")?{x:-$j(this._e_menu).width()-18,y:-$j(this._e_menu).height()}:{x:-$j(this._e_menu).width()-18,y:-64}},show:function(e){e=e||{};if(!e._target||!e.user)return;this._j_target_element=$j(e._target),this.user=e.user,this._this_folder_only=e.this_folder_only||!1,this._profile_link=e.profile_link,this._expiration=e.expiration||!1,this.base()},_render:function(){var e=this,t=$j(this._e_menu),n=Canvas.get().current_folder;this._reset_collab_in_current_folder(),e._this_folder_only||!n||!n.parent||n.parent==0||!n.user_is_owner?this._direct_collab_on_item=Collab.direct_collab_on_item(e.user.collab_in_current_folder,n):this._direct_collab_on_item=null,this._pending=(n&&n.permissions.options||this._direct_collab_on_item&&this._direct_collab_on_item.inviter_user_id==Canvas.get().user.id)&&this._direct_collab_on_item&&this._direct_collab_on_item.accepted==0,this._render_user_info(t),this._render_links(t)},_reset_collab_in_current_folder:function(){var e=Canvas.get().current_folder;this.user&&e&&this.user.id==e.user_id&&(this.user.collab_in_current_folder=null)},_render_user_info:function(e){var t=this,n=e.find(".profile_pic");this.user.pic_urls.large?n.attr("src",this.user.pic_urls.large).removeClass("hidden"):n.addClass("hidden");var r=e.find(".name"),i=this.user.display_name({profile_link:this._profile_link,return_wrapper:"<strong></strong>"});r.html(i);var s=this.user.email,o=e.find(".email");s&&s!=i&&!this._pending?o.text(s).show():o.hide();var u=e.find(".title");this.user.job_title?u.text(this.user.job_title).show():u.hide();var a=e.find(".expires");if(this._expiration&&this._expiration.execute_at_formatted){var f=this._expiration.execute_at_formatted,l=this._expiration.extend_interval,c=this._expiration.can_extend_to,h=this._expiration.time_until_execute_in_days,p='<span class="list_img mls sprite_16x16_pending_expiration"></span>',d=$t("Collaborator's access will expire on %1","collaborators_access_expire_date",'<span id="expiration_date_user_menu">'+f+"</span>")+p+"<br>";a.html(d);if(Canvas.get().current_folder.permissions.options&&this._expiration.can_change_expiration){var v=$j('<button class="mln img" id="flyout_extend_access_button" />').text($t("Extend Access","extend_access_button_js")),m=null;if(l-h>0)m=$j('<div class="ptm" />').text($t("to %1","extend_access_to_new_date",c)),v.attr({"data-hover":"tooltip","aria-label":$t("Extend %1 days from today","extend_n_days_from_today",l)}),v.click(function(){var e="/index.php?rm=box_item_expirations_extend_collab_expiration",n=Canvas.get().current_folder,r=t.user.email,i=n.collaborations[r]&&n.collaborations[r][0].collab_id;if(i){var s={collab_id:i},o=$j.box.formatQuery(s);$j.postJSON(e,o,function(e){if(!e)return alert($t("Error","Error_popup_title"),$t("Could not extend expiration date.","Error_popup_extend_expiration_body")),!1;var n=$t("Expiration has been extended","popup_action_extend_expirations_confirm");return Box.Application.getService("notifications").confirm(n),v.text($t("Extended","extended_js_button")).addClass("disabled").attr({"data-hover":"tooltip","aria-label":$t("Extended %1 days.","extended_n_days",t._expiration.extend_interval)}).unbind("click"),$j("#expiration_date_user_menu").text(c),t._expiration.execute_at_formatted=t._expiration.can_extend_to,t._expiration.time_until_execute_in_days=t._expiration.extend_interval,!1})}});else{var g=l-1;v.text($t("Extend Access","extend_expiration_text")).addClass("disabled"),l==1?v.attr({"data-hover":"tooltip","aria-label":$t("You can extend this collaborator's access on the day of the expiration date.","extend_enable_on_the_date_only_title_js")}):g>1?v.attr({"data-hover":"tooltip","aria-label":$t("You can extend this collaborator's access when it's within %1 days of expiration date.","extend_enable_after_x_days_title_js",g)}):g==1&&v.attr({"data-hover":"tooltip","aria-label":$t("You can extend this collaborator's access when it's within 1 day of expiration date.","extend_enable_after_1_day_title_js",g)})}var y=$j('<div class="media mtn"></div>').appendTo(a);y.append(v).append(m)}else a.append($j("<p />").text($t("Contact admin about this expiration","contact_admin_about_this_expiration")))}else a.html("");var b=e.find(".not_accepted");this._pending?b.show():b.hide()},_render_links:function(e){var t=this,n=Canvas.get().current_folder,r=Canvas.get().user==this.user,i=$j(),s=this.user.profile_link("",!0),o=e.find(".profile");this._profile_link&&!this._pending&&!r?(o.show().find("a").attr("href",s),i=o):o.hide();var u=e.find(".email_link");r?u.hide():(u.show().unbind().click(function(){return Canvas.get().user.mail_collaborators([t.user]),t.hide(),!1}),i=u);var a=e.find(".resend_invite"),f=Box.Application.getService("nav-state");this._pending?(a.show().unbind().click(function(){return n.id!=t.user.collab_in_current_folder[0].item_id?Collaborator_Roles_Menu.create_popup_cannot_edit_collab_in_subfolder(t.user,t.user.id==Canvas.get().user.id):n.edit_collaborators({action:"resend_invite",email:t.user.email}),!1}),i=a):a.hide();var l=e.find(".access");if(n&&!n.is_root_folder()){var c=this.user.permission_on_current_folder(t._this_folder_only,{ignore_accepted:!0}),h=Collab.get_translated_role_by_role_name(c);l.find(".access_level").text(h),this.user.id==Canvas.get().user.id?$j("#access_level_link_for_collaborator").addClass("is_you"):$j("#access_level_link_for_collaborator").removeClass("is_you"),t._init_collab_roles_menu(),i=l}else l.hide();i.addClass("last-child")},_init_collab_roles_menu:function(){var e=new Collaborator_Roles_Menu({target:$j("#user_menu"),target_folder:Canvas.get().current_folder,user:Canvas.get().user,target_user:this.user,this_folder_only:this._this_folder_only,request_from_sidebar:!0,direct_collab_on_item:this._direct_collab_on_item});e.init()}},{});Box.Timing.execution.push({name:"js/menus/box_multi_options_menu.js",time:(new Date).getTime()});var Multi_Options_Menu=Base.extend({_collection:null,_positioned:!1,_is_embed_widget:!1,_is_gcm:!1,_offsets:{x:12,y:-15,stalker:51},_actions:{multi_options_sharebar:{selected_tab:"send"},multi_options_tag:undefined,multi_options_move:{from:"Group Move/Copy"},multi_options_delete_me:undefined,multi_options_download:undefined,multi_options_delete_from_trash:undefined,multi_options_restore:undefined,multi_options_synchronize:undefined},constructor:function(){this._collection=new ItemCollection;var e=Box.Application.getService("nav-state");this._is_embed_widget=e.isEmbedWidget(),this._is_gcm=e.isGcm(),!this._is_embed_widget&&!this._is_gcm&&(this._offsets.x=49)},render:function(e){var t=this,n=!1,r;this._collection=e;if(this._collection.size()===0){this.hide();return}n=!1,r=this._get_j_element(),$j.each(this._actions,function(e){var i=e.replace("multi_options","can"),s=t._collection[i]();r.find("#"+e)[s?"show":"hide"](),n=n||s});var i=Box.Application.getService("nav-state");i.isGcm()&&this.hide_gcm_actions(),r.find("#multi_options_no_actions")[n?"hide":"show"]();if(!this._is_embed_widget&&!this._is_gcm){var s=document.getElementById("actionbar-wrapper");if(!!s){var o=s.getAttribute("data-actionbar");o!=="multiple-selection"&&(s.setAttribute("data-prev-actionbar",o),s.setAttribute("data-actionbar","multiple-selection"),$(".actionbar_button_wrapper:visible:first button").addClass("mln"))}}else this._show_stalker_or_non_stalker(),this._position(),this._get_j_element().trigger("scroll.stalker")},hide_gcm_actions:function(){var e=this._get_j_element();e.find("#multi_options_move").hide(),e.find("#multi_options_sharebar").hide()},event_click:function(e){var t;if(!this._is_embed_widget&&!this._is_gcm){var n=$(e.target);n.hasClass("dropdown_menu")?t=n.attr("id"):t=n.parents("li").first().attr("id");if(!t)return!1}else t=e.target.parentNode.id;var r=t.replace("multi_options_","");return this._collection[r](this._actions[r]),!1},hide:function(){if(!this._is_embed_widget&&!this._is_gcm){var e=document.getElementById("actionbar-wrapper");if(!!e){var t=e.getAttribute("data-actionbar"),n=e.getAttribute("data-prev-actionbar");n&&t==="multiple-selection"&&($(".actionbar_button_wrapper:visible:first button").removeClass("mln"),e.setAttribute("data-actionbar",n))}}else this._get_j_element().css("visibility","hidden")},_get_j_element:function(){return!this._is_embed_widget&&!this._is_gcm?$("#actionbar-multiple-selection"):$(".multi_options")},_get_j_container:function(){return $(".multi_options_container").filter(function(e,t){return $(t).height()>0})},_hide_non_stalker:function(){this._get_j_element().first().css("visibility","hidden"),this._position()},_show_non_stalker:function(){if(this._collection.size()===0){this.hide();return}this._get_j_element().first().css("visibility","visible"),this._position()},_show_stalker_or_non_stalker:function(){this._get_j_element().last().css("visibility","visible")},_stalk:function(){var e=this;this._get_j_element().stalker({offset:this._offsets.stalker,startCallback:function(){e._hide_non_stalker()},stopCallback:function(){e._show_non_stalker()}})},_position:function(){this._set_width();var e=this._get_j_container(),t=e.offset(),n=e.width(),r=this,i,s,o;this._get_j_element().css("left",t.left+n-this._get_j_element().width()-this._offsets.x);var u=Box.Application.getService("nav-state");if(!this._positioned||u.isGcm())this._positioned=!0,i=0,s=e.attr("data-multi_options_container"),s?(o=$(s).filter(":visible"),i=o.offset().top+o.outerHeight()-parseInt(this._get_j_element().css("margin-top"),10)):i=t.top+this._offsets.y,this._get_j_element().css("top",i),r=this,$(window).on("resize.multi_options",function(){r._position()}),this._stalk()},_set_width:function(){var e=0;this._get_j_element().filter(":visible").find("li:visible").each(function(t,n){e+=$(n).outerWidth()}),this._get_j_element().css("width",e+1)}},{});Box.Timing.execution.push({name:"js/menus/box_folder_picker_menu.js",time:(new Date).getTime()});var Folder_Picker_Menu=Abstract_Menu.extend({folder_selector:null,_action_required_to_close:!0,constructor:function(e){e=e||{},this._e_menu=$j("#folder_picker_menu").get(0),Canvas.get().register_body_click_handler(this)},hide:function(){this.folder_selector&&this.folder_selector.hide(),this.folder_selector=null,this.base()},_get_offsets:function(){return this._j_target_element.is("#folder_tree_filter_button")?{x:0,y:8}:{x:0,y:-4}},show:function(e){e=e||{},this._j_target_element=$j(e.target),this.folder_selector&&this.folder_selector.hide();var t=this,n=function(r,i){e.callback(r,i),t.hide()},r=!e.hide_trash;this.folder_selector=new Box_Folder_Tree_Search_Selector({select_callback:n,opened_item_id:e.opened_item_id||null,show_trash:r}),this.base(),this.folder_selector.component().find(".selector_input_box input").focus(),this.folder_selector.component().find(".selector_input_box input").removePlaceholderize().placeholderize({extraMarginLeftIE:6})},_render:function(){var e=$j(this._e_menu);this.folder_selector.attachTo(e)},body_click_handler:function(e){var t=$j(this._e_menu),n=!1;if(this._j_target_element)for(var r=0,i=this._j_target_element.length;r<i;r++)$j.elementIsDescendent(e.target,this._j_target_element[r])&&(n=!0);t.is(":visible")&&!$j.elementIsDescendent(e.target,t[0])&&!n&&this.hide()}},{});Box.Timing.execution.push({name:"js/menus/box_paging_menu.js",time:(new Date).getTime()});var Paging_Menu=Abstract_Menu.extend({current_page:null,_defined_inline:!0,constructor:function(e){e=e||{},this._set_menu()},_get_offsets:function(e){return{x:0,y:16}},_set_menu:function(){this._j_menu=$j("#paging_menu"),this._e_menu=this._j_menu.get(0)},show:function(e){e=e||{},this._j_target_element=$j(e.target),this._set_menu(),this.base(),this._j_menu.find(".cntr").scrollTo(this._j_menu.find(".selected"))},event_click:function(e){var t=$j(this._e_menu),n=$j(e.target);n.is("a")&&(n=n.parent());var r=n.attr("id").substr(5);return r==this.current_page?(this.hide(),!1):(this.current_page=r,t.find("li").removeClass("selected"),n.addClass("selected"),Canvas.get().update_page(r),Box.Application.broadcast("x-pagechange",r),this.hide(),!1)}},{});Box.Timing.execution.push({name:"js/menus/box_tags_menu.js",time:(new Date).getTime()});var Tags_Menu=Abstract_Menu.extend({selected_option:null,selected_tags:null,tag_timeout_id:null,loading:!1,constructor:function(){this._j_menu=$j("#tags_outer_container"),this.j_list_container=$j("#tag_and_filter_list_container"),this._e_menu=this._j_menu.get(0),this._prevent_rendering_offscreen=!1,this.selected_option=Tags_Menu.OPTION_MY_TAGS},show:function(e){this.params=e||{};var t=this;this._j_target_element=e.target?$j(e.target):null;var n="#tags_button";$j(n).addClass("ignore_mouseout hover"),this._hide_apply_button(),this.j_list_container.css({width:"220px"}).off("click").on("click",function(e){return t.event_click(e)}),this.base()},toggle:function(e){this.j_list_container&&this.j_list_container.is(":visible")?this.hide():this.show(e)},_get_offsets:function(){return{x:0,y:11}},_render:function(e){var t=this,n=e?Tag_Collection.get().tags:Tag_Collection.get().my_tags;if($j.isEmptyObject(n)){var r=$j("#tag_loading");this.loading||(this.loading=!0,r.find(".spinner_gif_container").addClass("spinner_gif"),r.show(),Canvas.get().load_tags(function(){t.loading=!1,r.hide(),t._j_menu.is(":visible")&&t._render_tags()},{partial:e?"all_tags":"my_tags"}))}else this._render_tags()},_render_tags:function(){if(this.selected_option==Tags_Menu.OPTION_ALL_TAGS||this.selected_option==Tags_Menu.OPTION_MY_TAGS){var e=this.selected_option==Tags_Menu.OPTION_ALL_TAGS,t=$j("#tag_and_filter_list").empty();this.j_list_container.find(".select_all").show();var n={},r=Box.Application.getService("nav-state"),i=r.get();if(r.isTag()){var s=i.id.split(",");for(var o in s)n[s[o]]=1}var u=0,a=!0,f;this.selected_option==Tags_Menu.OPTION_MY_TAGS?f=Tag_Collection.get().my_tags:f=Tag_Collection.get().tags;if(f){var l=$j("<ul></ul>");for(var c in f){if(!e&&!f[c].self_tagged)continue;u++;var h=f[c],p=$j('<li class="media pas mvn tag_and_filter_list_item" />').attr("id","li_"+$.box.escapeHTML(h.name)),d=$j('<div class="bd tag_name"></div>').append($j('<a href="#"></a>').text(h.name)),v;n[h.name]?v="sprite_16x16_selected":(v="sprite_16x16_select select",a=!1);var m=$j('<div class="img_ext sprite_16x16 fakebox" />').addClass(v);p.append(m),h.collaborated||$j('<div class="img_ext sprite_16x16_delete tag_delete" style="display:none" />').attr("id",$.box.escapeHTML(c)).appendTo(p),p.append(d),p.appendTo(l),$j('<li class="separator pan ignore_mouseover"><hr class="divider mbn mhs" /></li>').appendTo(l)}t.append(l.children()),t.on("mouseenter",".tag_and_filter_list_item",function(){$j(this).find(".sprite_16x16_delete").show()}).on("mouseleave",".tag_and_filter_list_item",function(){$j(this).find(".sprite_16x16_delete").hide()})}!f||u===0?(this.j_list_container.find(".select_all_checkbox").hide(),$j('<div class="center sprite_128x128_empty_tag"></div>').appendTo(t),$j('<h4 class="center center_contents" />').text($t("You have no tags yet","you_have_no_tags")).appendTo(t),$j('<p class="center center_contents phs" />').text($t("Add tags to your items in the file or folder options menu.","add_tags_text")).appendTo(t)):this.j_list_container.find(".select_all_checkbox").show(),a?this.j_list_container.find(".select_all").addClass("all_selected sprite_16x16_selected").removeClass("select_all sprite_16x16_select"):this.j_list_container.find(".all_selected").removeClass("all_selected sprite_16x16_selected").addClass("select_all sprite_16x16_select"),this._j_menu.show()}},event_click:function(e){var t=$j(e.target);if(t.hasClass("tag_remove"))return!1;var n=Box.Application.getService("nav-state"),r=n.get();if(t.parents().andSelf().hasClass("tag_name"))return r.isGallery&&Previewer.get().close(),this._select_all(!1),this._hide_apply_button(),this.apply_tags(t.closest("a").text()),!1;if(t.hasClass("tag_menu_option")&&!t.hasClass("badge")){var i=t.closest("ul").find(".badge");for(var s=0;s<i.length;s++){var o=$j(i[s]);o.removeClass("badge filter"),o.addClass("midlight")}t.removeClass("midlight").addClass("badge filter");var u=t.attr("id");return this.selected_option=Tags_Menu["OPTION_"+u.split("_")[1].toUpperCase()+"_TAGS"],this._render(this.selected_option==Tags_Menu.OPTION_ALL_TAGS),!1}if(t.hasClass("fakebox")||t.hasClass("tag_and_filter_list_item")){var a=t.hasClass("fakebox")?t:t.children(".fakebox");if(a.length>0)if(a.hasClass("select_all"))a.removeClass("select_all sprite_16x16_select").addClass("all_selected sprite_16x16_selected"),this._select_all(!0);else if(a.hasClass("all_selected"))a.removeClass("all_selected sprite_16x16_selected").addClass("select_all sprite_16x16_select"),this._select_all(!1);else if(a.hasClass("sprite_16x16_select")){a.removeClass("sprite_16x16_select").addClass("sprite_16x16_selected");var f=this._j_menu.find(".sprite_16x16_select");f.length==1&&this._j_menu.find(".select_all").addClass("all_selected sprite_16x16_selected").removeClass("select_all sprite_16x16_select"),this._show_apply_button()}else{a.addClass("sprite_16x16_select").removeClass("sprite_16x16_selected");var l=this._j_menu.find(".all_selected");l.length&&l.removeClass("all_selected sprite_16x16_selected").addClass("select_all sprite_16x16_select"),this._show_apply_button()}var c=a.parent().parent().find(".sprite_16x16_selected");c.length||this._hide_apply_button()}return t.hasClass("tag_delete")&&Tag_Collection.get().delete_tag(t.attr("id"),t.closest("li")),!1},_show_apply_button:function(){var e=this,t=$j("#apply_and_cancel_buttons");if(t.length)return t.show(),!1;t=
$j('<div id="apply_and_cancel_buttons" style="width:220px"></div>'),$j("<button></button>").text($t("Apply","apply")).click(function(){e.apply_tags(),e.hide()}).appendTo(t),$j("<button></button>").text($t("Cancel","js_button_cancel")).click(function(){e.hide()}).appendTo(t),$j('<hr class="divider" />').prependTo(t),this._j_menu.append(t)},_hide_apply_button:function(){$j("#apply_and_cancel_buttons").hide()},_select_all:function(e){var t=this.j_list_container.find("#tag_and_filter_list").find(".fakebox");e?t.removeClass("sprite_16x16_select").addClass("sprite_16x16_selected"):t.addClass("sprite_16x16_select").removeClass("sprite_16x16_selected"),this._show_apply_button()},apply_tags:function(e){var t=[];if(e)t.push(e);else{var n=this.j_list_container.find("#tag_and_filter_list .fakebox");for(var r=0;r<n.length;r++){var i=n.eq(r);i.hasClass("sprite_16x16_selected")&&t.push(i.parent().text())}}this.hide(),Tag_Collection.get().apply_tags(t)}},{OPTION_ALL_TAGS:"All tags",OPTION_MY_TAGS:"My Tags"});Box.Timing.execution.push({name:"js/menus/box_upgrade_dropdown.js",time:(new Date).getTime()});var Upgrade_Dropdown=Abstract_Menu.extend({constructor:function(e){e=e||{},this._e_menu=$j("#upgrade_dropdown").get(0),this._elements_that_keep_menu_open=$j("#upgrade_button")},show:function(e){Box_Menus.get().current_user_menu.hide();var t=Box.Application.getService("logger");e=e||{},this._j_target_element=$j(e.target),this._elements_told_menu_is_open=this._j_target_element.parent(),t.sendLog("marketing","HEADER_UPGRADE_DROPDOWN_OPEN"),this.base(),this._handle_upgrade_menu_item_click()},_handle_upgrade_menu_item_click:function(){$j(this._e_menu).find(".upsell_info").off("click").on("click",function(){var e=$j(this),t=e.data("url"),n=Box.Application.getService("eloqua"),r=Box.Application.getService("logger"),i=t.split("/"),s=i[i.length-1];return(s=="upgrade_header_admin_controls"||s=="upgrade_header_security"||s=="upgrade_header_business_case_studies")&&n.sendEloquaWith("Box_Upgrade_Form","Upgrade Header",s),r.sendLog("marketing","HEADER_UPGRADE_DROPDOWN_LINK_CLICK",{link:e.data("name")},function(){var e=Box.Application.getService("url");e.openWindow(t,"_blank")}),!1})},_get_offsets:function(){return{x:-50,y:this.stalking?24:14}},hide:function(){var e=Box.Application.getService("logger");e.sendLog("marketing","HEADER_UPGRADE_DROPDOWN_CLOSE"),this.base()}},{});Box.Timing.execution.push({name:"js/menus/box_corporate_network_menu.js",time:(new Date).getTime()});var Corporate_Network_Menu=Abstract_Menu.extend({constructor:function(e){e=e||{},this._e_menu=$j("#corporate_network_menu").get(0),this._j_e_menu=$j(this._e_menu)},show:function(e){e=e||{},this._j_target_element=$j(e.target);var t=this._j_target_element.offset().top,n=t+10;this.base(),this._j_e_menu.find(".arrow").offset({top:n||379})},_get_offsets:function(e){return{x:-this._j_e_menu.width()-18,y:-this._j_e_menu.height()}}});Box.Timing.execution.push({name:"js/menus/box_pin_board_menu.js",time:(new Date).getTime()});var Pin_Board_Menu=Abstract_Menu.extend({constructor:function(e){this._e_menu=$j("#pin_board_menu").get(0),this._j_e_menu=$j(this._e_menu),this._link_to_pin_board_page=$j("#link_to_pin_board_page_in_menu"),this._title_element=$j("#items_in_pin_board_light_list_title"),this._content_element=$j("#items_in_pin_board_light_list")},show:function(e,t){var n=e||{};this._j_target_element=$j(n.target);var r=n.board_id;this._link_to_pin_board_page.attr("href","/files/0/p/"+r);var i=this._j_target_element.find(".pin_board_name_link");i&&this._title_element.text($t("Items in %1","items_in_pin_board_title",i.text())),this._content_element.html(n.html),this.base();var s=this._j_target_element.offset().top;this._j_e_menu.find(".arrow").offset({top:s||379})},_get_offsets:function(e){return{x:-this._j_e_menu.width()-18,y:-this._j_e_menu.height()+10}}});Box.Timing.execution.push({name:"js/menus/filters/abstract_filter_menu.js",time:(new Date).getTime()});var Abstract_Filter_Menu=Abstract_Menu.extend({_action_required_to_close:!0,_default_menu_width:null,_defined_inline:!0,constructor:function(e){e=e||{},this._filter_type=e.filter_type||this._filter_type,this._default_text=e.default_text||this._default_text;if(!this._filter_type)throw new Error("missing filter type");if(this._filter_type!="filter"&&!this._default_text)throw new Error(this._filter_type+" missing default text");this.j_filter_menu_item=$j("#"+this._filter_type+"_filter"),this.j_button=$j("#"+this._filter_type+"_filter_button"),this.j_button_name=$j("#"+this._filter_type+"_button_name");var t="dd_menu_create_filter_"+this._filter_type;this.j_dd_menu=$j("#"+t),this._e_menu=this.j_dd_menu.get(0),Box_Menus.get().map_menu_id_to_menu_object[t]=this,this.base(e),Canvas.get().register_body_click_handler(this)},reset_filter:function(){this._zero_value(),this._hide_button(),this.hide_menu(),this.j_button.siblings(".close_icon").addClass("hidden")},show:function(e){e=e||{},this._j_target_element=$j(e.target).parent(),this.base(),e.match_target_width&&(this._default_menu_width||(this._default_menu_width=this.j_dd_menu.width()),this.j_dd_menu.width(Math.max(this._default_menu_width,this.j_button.outerWidth())))},update_filter:function(e){this._set_value(e),this._update_and_show_filter(e)},bind_menu:function(){var e=this;this.j_button.off().on("click",function(t){return e.j_dd_menu.is(":visible")?e.hide_menu():e.show({target:$j(this),match_target_width:!0}),!0}).on("mouseover",function(t){return e.j_button.siblings(".close_icon").removeClass("hidden"),!0}).on("mouseout",function(t){return $j(t.relatedTarget).hasClass("close_icon")||e.j_button.siblings(".close_icon").addClass("hidden"),!0}),this.j_button.siblings(".close_icon").off().on("mousedown",function(t){var n=e.get_encoded_value();return e.reset_filter(),$j(this).addClass("hidden"),e.broadcast_filter_remove(n),!1}).on("mouseout",function(t){return $j(t.relatedTarget).is(e.j_button)||e.j_button.siblings(".close_icon").addClass("hidden"),!0})},validate_and_submit_filter:function(){},event_click:function(e){var t=this.get_encoded_value(),n=$j(e.target),r=n.closest("li");r.length&&(this._set_value(r.attr("data-value")),this._update_and_show_filter()),this.hide_menu(),this.broadcast_filter_change(t)},hide_menu:function(){this.j_dd_menu.hide(),this.j_button.blur()},broadcast_filter_change:function(e){var t=this.get_encoded_value();e!=t&&Box.Application.broadcast("x-searchfilterchange",{filters:[{type:this._filter_type,value:t}]})},broadcast_filter_remove:function(e){var t=this.get_encoded_value();Box.Application.broadcast("x-searchfilterremove",{filters:[{type:this._filter_type,value:t}],isFilterChanged:e!=""})},get_filter_value:function(){return this.filter_value},get_encoded_value:function(){var e=this.get_filter_value();return $.makeArray(e).join(":")},_update_and_show_filter:function(e){if(!e)throw new Error(this._filter_type+" called update_and_show_filter without a default text");this.j_button_name.text(e),this.j_button.parent().find(".hidden").not(".close_icon").removeClass("hidden"),this.j_button.show(),this.j_filter_menu_item.hide()},_set_value:function(e){this.filter_value=e!=""?e:null},_hide_button:function(){this.j_button.hide(),this.j_button_name.text(this._default_text),this.j_filter_menu_item.show();var e=$j("#add_filter_button");e.is(":visible")||e.show()},_zero_value:function(){this.filter_value=null},body_click_handler:function(e){this.j_dd_menu.is(":visible")&&!$j.elementIsDescendent(e.target,this.j_dd_menu[0])&&!$j.elementIsDescendent(e.target,this.j_button[0])&&this.hide_menu()},_get_offsets:function(){return{x:0,y:-10}},_get_object_keys:function(e){var t=[],n;if(typeof e=="object")for(n in e)e.hasOwnProperty(n)&&t.push(n);return t}},{});Box.Timing.execution.push({name:"js/menus/filters/abstract_range_filter_menu.js",time:(new Date).getTime()});var Abstract_Range_Filter_Menu=Abstract_Filter_Menu.extend({get_filter_value:function(){return this.min||this.max?[this.min,this.max]:null},event_click:function(e){var t=$j(e.target),n=t.closest("li");n.length&&(n.attr("data-value")=="custom"?(this._show_popup(),this.hide_menu()):this.base(e))},_validate_values:function(e){return!0},_show_popup:function(e){var t=this,n=e.title||$t("Custom range","custom_range_popup_title"),r=e.input_type||"input",i=$.extend({},e.extra_input_options,{type:r,label:$t("From","reports_from"),name:"from",value:this.min}),s=$.extend({},e.extra_input_options,{type:r,label:$t("To","reports_to"),name:"to",value:this.max}),o=function(n,r){var i=[n.from,n.to],s=t.get_encoded_value();if(t._validate_values(i))t._set_value(i),t._update_and_show_filter(),$j.popup.close(),t.broadcast_filter_change(s);else{r.find("input").css("color","#BE4300");if(!r.find(".error").length){var o=$j('<div class="error"/>').text($t("The current values entered are invalid.","invalid_errors_range_menu"));r.append(o)}$j.popup.get().find("#popup_button_okay").text($t("Okay","js_popup_button_okay"))}},u={type:"buttons",items:{okay:{value:$t("Okay","js_popup_button_okay"),click:function(e,t){o(e,t)}},cancel:{value:$t("Cancel","js_popup_button_cancel"),click:function(){$j.popup.close()}}}};$j.popup.form(n,[i,s,u])},_zero_value:function(){this.min=null,this.max=null}},{});Box.Timing.execution.push({name:"js/menus/filters/box_create_filter_menu.js",time:(new Date).getTime()});var Create_Filter_Menu=Abstract_Filter_Menu.extend({_filter_type:"add",_default_text:" ",_get_offsets:function(e){return{x:5,y:-5}},event_click:function(e){var t=e.target;if(t){var n=$j("#"+t.id+"_button"),r=n.parent();r.detach(),n.show(),r.insertBefore(this._j_target_element),n.click(),r.find("span").not(".close_icon").removeClass("hidden"),this.j_button.blur(),$j("#"+t.id).hide(),$j(this._e_menu).hide(),this.has_other_filters()||this.hide_add_filter_button()}return!1},has_other_filters:function(){var e=$(this._e_menu).find("ul li").filter(function(){return this.style.display!="none"});return!!e.length},hide_add_filter_button:function(){$j("#add_filter_button").hide()},reset_filter:function(){}},{});Box.Timing.execution.push({name:"js/menus/filters/box_create_filter_folder_tree_menu.js",time:(new Date).getTime()});var Create_Filter_Folder_Tree_Menu=Abstract_Filter_Menu.extend({filter_value:null,_filter_type:"folder_tree",_default_text:$t("All Folders","advanced_search_folder_tree_filter_default_text_all_folders"),_zero_value:function(){this.filter_value=[0,this._default_text]},show:function(e){this.base(e);var t=this,n;this.filter_value&&this.filter_value[0]?n="d_"+this.filter_value[0]:n=root_folder_id;var r=function(e,n){t._on_folder_selected(e,n)};Features.folder_tree_search?Box_Menus.get().folder_picker_menu.show({target:this.j_button,opened_item_id:n,hide_after_select:!0,hide_trash:!0,callback:r}):folder_tree.show(this.j_button,r,n,325,{show_trash:!0})},hide_menu:function(){this.j_dd_menu.hide(),Box_Menus.get().folder_picker_menu.hide()},_on_folder_selected:function(e,t){var n=e.substr(2),r=this.get_encoded_value();this.update_filter([n,t]),this.broadcast_filter_change(r)},update_filter:function(e){this._set_value(e);var t=e[1];this._update_and_show_filter(t)},get_filter_value:function(){var e=this.filter_value?this.filter_value[0]:0;return e>0?this.filter_value:null}},{REQUEST_DELAY:500});Box.Timing.execution.push({name:"js/menus/filters/box_create_filter_type_menu.js",time:(new Date).getTime()});var Create_Filter_Type_Menu=Abstract_Filter_Menu.extend({filter_value:[],_filter_type:"types",_default_text:$t("All Types","gcm_all_file_types"),event_click:function(e){var t=$j(e.target),n=t.closest("li"),r=this.get_encoded_value();if(n.length){var i=n.attr("data-value");this._toggle_and_update_value(n.find(".fakebox"),i),this._update_and_show_filter()}this.broadcast_filter_change(r)},_toggle_and_update_value:function(e,t){if(e.hasClass("select"))e.removeClass("select sprite_16x16_select").addClass("sprite_16x16_selected"),this.filter_value.push(t);else{e.addClass("select sprite_16x16_select").removeClass("sprite_16x16_selected");var n=$j.inArray(t,this.filter_value);this.filter_value.splice(n,1)}},_update_and_show_filter:function(){this._update_selected_types();var e=this._default_text,t=this.filter_value.length;t==1?e=$t("1 Type Selected","single_type_button_text"):t>1&&(e=$t("%1 Types Selected","multi_type_button_text",t)),this.base(e)},_update_selected_types:function(){for(var e=0,t=this.filter_value.length;e<t;e++){var n=this.j_dd_menu.find('li[data-value="'+this.filter_value[e]+'"]'),r=n.find(".fakebox");r.removeClass("select sprite_16x16_select").addClass("sprite_16x16_selected")}},_set_value:function(e){this.filter_value=$j.makeArray(e)},_zero_value:function(){this.filter_value=[],this._deselect_all_types()},_deselect_all_types:function(){var e=this.j_dd_menu.find(".fakebox");e.addClass("select sprite_16x16_select").removeClass("sprite_16x16_selected")},get_filter_value:function(){return this.filter_value.length?this.filter_value:null}},{});Box.Timing.execution.push({name:"js/menus/filters/box_create_filter_kind_menu.js",time:(new Date).getTime()});var Create_Filter_Kind_Menu=Abstract_Filter_Menu.extend({filter_value:null,_filter_type:"kind",_default_text:$t("Content: Everything","content_button_label"),_update_and_show_filter:function(){var e=$j('[data-value="'+this.filter_value+'"]').text(),t=$t("Content: %1","file_content_button_text",e);this.base(t)}},{});Box.Timing.execution.push({name:"js/menus/filters/box_create_filter_date_menu.js",time:(new Date).getTime()});var Create_Filter_Date_Menu=Abstract_Range_Filter_Menu.extend({_filter_type:"date",_default_text:$t("Date","date_button_label"),_relative_value:"",_previous_dates:{},constructor:function(e){this.base(e),this._set_discrete_date_values()},_show_popup:function(){var e={title:$t("Custom date range","custom_date_range_popup_title"),input_type:"datepicker",extra_input_options:{past:!0}};this.base(e)},_set_discrete_date_values:function(){var e=new Date;this._previous_dates={today:this._make_date_string_from_utc(e),day:this._make_date_string_from_utc((new Date).setDate(e.getDate()-1)),week:this._make_date_string_from_utc((new Date).setDate(e.getDate()-7)),month:this._make_date_string_from_utc((new Date).setMonth(e.getMonth()-1)),year:this._make_date_string_from_utc((new Date).setFullYear(e.getFullYear()-1))}},_set_value:function(e){$j.isArray(e)&&e.length==1&&(e=e[0]),$j.isArray(e)?(this.min=e[0].replace(/-/g,"/"),this.max=e[1].replace(/-/g,"/"),this._relative_value=this._determine_relative_value(e)):(this.min=this._previous_dates[e],this.min&&(this.max=this._previous_dates.today,this._relative_value=e))},_validate_values:function(e){if($j.isArray(e)){var t=e[0],n=e[1];if(!t&&!n)return!1;if(Date.parse(n)<Date.parse(t))return!1}return!0},_make_date_string_from_utc:function(e){var t=Box.Application.getService("datetime");return t.getLocalizedDate(e/1e3,"mm/dd/yy")},get_encoded_value:function(){var e=this.get_filter_value();return e?this._relative_value==="custom"?this.format_date_for_history(e[0])+":"+this.format_date_for_history(e[1]):this._relative_value:""},format_date_for_history:function(e){return e?e.replace(/\//g,"-"):""},_determine_relative_value:function(e){if(e[1]==this._previous_dates.today){var t=this._get_object_keys(this._previous_dates);for(var n=0,r=t.length;n<r;n++)if(e[0]==this._previous_dates[t[n]])return t[n]}return"custom"},_update_and_show_filter:function(){var e=this._determine_relative_value([this.min,this.max]),t=this.j_dd_menu.find('[data-value="'+this._relative_value+'"]'),n;e=="custom"||!t.length?this.min?this.max?n=$t("%1 - %2","date_label_min_max",this.min,this.max):n=$t("After %1","date_label_min",this.min):n=$t("Before %1","date_label_max",this.max):n=t.text(),this.base(n)}},{});Box.Timing.execution.push({name:"js/menus/filters/box_create_filter_size_menu.js",time:(new Date).getTime()});var Create_Filter_Size_Menu=Abstract_Range_Filter_Menu.extend({_filter_type:"size",_default_text:$t("Size","size_label_js"),_show_popup:function(){var e={title:$t("Custom size range","custom_size_range_popup_title"),input_type:"input",extra_input_options:{instructions:$t("Size (in MB)","custom_size_range_input_instructions")}};this.base(e)},_set_value:function(e){$j.isArray(e)||(e=e.split("to")),this.min=Math.round(e[0])||0,this.max=Math.round(e[1])||0,this.max<this.min&&(this.max=this.min)},_get_size_with_unit:function(e){var t=$t("MB","unit_megabyte");for(var n=1;e>=1e3;n++)e/=1e3,e=e.toFixed(2),t=Create_Filter_Size_Menu.SIZE_UNITS[n];return e+" "+t},_update_and_show_filter:function(){if(this.min||this.max){var e=$t("%1 - %2","size_label_min_max",this._get_size_with_unit(this.min),this._get_size_with_unit(this.max));this.base(e)}}},{SIZE_UNITS:[$t("MB","unit_megabyte"),$t("GB","unit_gigabyte"),$t("TB","unit_terabyte"),$t("PB","unit_petabyte"),$t("EB","unit_exabyte"),$t("ZB","unit_zettabyte"),$t("YB","unit_yottabyte")]});Box.Timing.execution.push({name:"js/menus/filters/box_create_filter_owner_menu.js",time:(new Date).getTime()});var Create_Filter_Owner_Menu=Abstract_Filter_Menu.extend({filter_value:null,_filter_type:"owner",_default_text:$t("Any Owner","owner_button_text"),menu_initialized:!1,user_added_timestamp:0,constructor:function(e){e=e||{},this.base(e),this.selected_users=e.selected_users,this._j_input=this.j_dd_menu.find("input"),this._j_done_button=this.j_dd_menu.find(".done_button")},show:function(e){this.base(e);var t=this;if(this.menu_initialized)this._j_input.trigger("change");else{var n={show_dropdown_toggler:!0,hide_no_results_item:!1,default_selections:this.selected_users,bind_contact_selector:!0,include_self:!0,callbacks:{_on_option_added:function(){t._on_option_added()}}};this.populate_contact_selector(n),this.update_input_reference(this.j_dd_menu.find("input")),this.bind_event_handlers(),this.menu_initialized=!0}this._j_input.focus()},bind_event_handlers:function(){var e=this;this.j_dd_menu.off().on("keypress",function(t){if(t.keyCode===13&&!e.j_dd_menu.find(".drop_down_container").is(":visible")){var n=(new Date).getTime();n-e.user_added_timestamp>Create_Filter_Owner_Menu.CONTACT_ADDED_DELAY&&(e.validate_and_submit_filter(),e.hide_menu(),e.user_added_timestamp=0)}}),this._j_done_button.off().on("click",function(t){return e.hide_menu(),e.validate_and_submit_filter(),!1})},update_input_reference:function(e){this._j_input=e},_on_option_added:function(){this.user_added_timestamp=(new Date).getTime()},populate_contact_selector:function(e){var t=$j.popup.renderControl("boxContactsSelector",e);this.contact_selector=e.contact_selector,$j(t).find("#dropdown_toggler").hide(),this.j_dd_menu.find(".contact_selector_wrapper").html(t)},validate_and_submit_filter:function(){var e=this.selected_users,t=this.filter_value||[],n=this.get_encoded_value();this.contact_selector&&(this.selected_users=this.contact_selector.get_full_selected_options(),this._set_value(this._get_object_keys(this.selected_users))),this.filter_value&&$.arrayDiff(t,this.filter_value)?this._update_and_show_filter():!$j.isEmptyObject(e)&&$j.isEmptyObject(this.selected_users)&&this.reset_filter(),this.broadcast_filter_change(n)},reset_filter:function(){this.menu_initialized=!1,this.selected_users=null,this.j_dd_menu.off("keypress"),this.j_dd_menu.find(".placeholderize-wrapper-noname").off("mousedown"),this.contact_selector&&this.contact_selector.remove_all_badges(),this.base()},_update_and_show_filter:function(){var e,t=this.filter_value?this.filter_value.length:0;t==1?e=" "+$t("%1 User Selected","user_button_name_user_selected_v2",t):t===0?e=this._default_text:e=" "+$t("%1 Users Selected","user_button_name_users_selected_v2",t),this.base(e)},_set_value:function(e){this.filter_value=e?$j.makeArray(e):null}},{CONTACT_ADDED_DELAY:300});Box.Timing.execution.push({name:"js/box_quick_search.js",time:(new Date).getTime()});var Quick_Search=Abstract_Menu.extend({_active_menu_links_count:null,_active_menu_selected_index:null,block_search_menu:!1,block_search_submit:!1,_html:null,_e_menu:null,_j_menu:null,_j_target_element:null,menu_css:null,_search_input:null,_search_string:null,_previous_search_string:"",_search_tooltip_text:null,_search_total_results_count:null,_warmed_up:!1,_path_populated:!1,__instance:this,constructor:function(){this._search_input=$j("#search"),this._j_menu=$j("#qs_menu"),this._e_menu=$j("#qs_menu").get(0),this._action_required_to_close=!0;var e=this;this._j_menu.on("click","li",function(t){return e.event_click(t)}),this._search_input.focus(function(t){if(!e._warmed_up){var n="/index.php?rm=box_search_warmup";$j.getJSON(n,{},function(e){}),e._warmed_up=!0}}),this._search_input.keydown(function(t){if(t.which==Quick_Search.KEY_DOWN||t.which==Quick_Search.KEY_UP)e._j_menu.is(":visible")?e._walk_in_menu(t.which==Quick_Search.KEY_UP?"up":"down"):e._show_menu();t.which==Quick_Search.KEY_ENTER&&(Quick_Search.get()._submit("keyboard"),e.block_search_submit&&t.preventDefault(),e.hide()),t.which==Quick_Search.KEY_ESCAPE&&(e.hide(),t.preventDefault())}),this._search_input.keyup(function(t){var n=$j.trim(this.value);if(t.which===Quick_Search.KEY_ENTER&&e.block_search_submit){t.stopPropagation(),e.block_search_submit=!1;return}!e._is_control_key(t.which)&&(n.length>0||!n)&&e._search_string!=n&&e._show_menu(),e._is_start_of_quick_search_session(n)&&e._log_quick_search_start(),e._previous_search_string=n}),Canvas.get().register_body_click_handler(this)},_is_start_of_quick_search_session:function(e){return!this._previous_search_string&&e!==this._previous_search_string},_get_offsets:function(e){return this.stalking?{x:1,y:33}:{x:1,y:this._show_dropdown_arrow()?23:12}},_toggle_spinner:function(e){var t=$j("#search");e?t.css({"background-image":"url("+Box.Application.getService("assets").getAssetURL(images_box_path,"spinner.gif")+")","background-repeat":"no-repeat","background-position":"98% 50%"}):t.css("background-image","")},_load:function(e,t){var n=this;e.length>1&&this._toggle_spinner(!0);var r="/index.php?rm=box_quick_search",i={search_string:e,sort:"relevance",sort_direction:null,user_id_sql:""},s=$j.box.formatQuery(i);this._path_populated=!1,$j.getJSON(r,s,function(e){if(e.html&&!n.block_search_menu){if(e.search_string!=$.box.escapeHTML(n._search_string))return;n._html=e.html,$j.isFunction(t)&&t.call(n),n._search_total_results_count=e.total_count}else n._html="",n.hide();n._toggle_spinner(!1)})},_remove_hover:function(){this._j_menu.find(".hover").each(function(){$j(this).removeClass("hover")}),$j("#tooltip").remove()},_render:function(){var e=this;this._show_dropdown_arrow()&&(this._html='<div class="header_drop_down_arrow qs_menu_arrow"><div class="header_drop_down_arrow_border" /></div>'+this._html),this._j_menu.html(this._html);var t=this._j_menu.find("li");t.mouseenter(function(){e._remove_hover(),$j(this).addClass("hover"),e._active_menu_selected_index=$j(this).index()}).mouseleave(function(){e._remove_hover(),e._active_menu_selected_index=-1}),this._j_menu.find("a").on("mouseenter mouseleave",function(){e._remove_hover(),e._active_menu_selected_index=$j(this).parents("#qs_menu li").index()})},show:function(e){e?(this._search_input=$j("#search"),this._j_target_element=this._search_input,this.block_search_menu=!1,this.block_search_submit=!1,this._active_menu_selected_index=-1,this._active_menu_links_count=null,this._j_menu.width(this._j_target_element.outerWidth()+(this._show_dropdown_arrow()?30:0)),this._load(e,this.base)):this.hide()},_show_menu:function(){var e=this;this._search_string=$j.trim(this._search_input.val()),Quick_Search.get().show(e._search_string)},_walk_in_menu:function(e){if(this._j_menu.is(":visible")){this._remove_hover(),this._active_menu_links_count||(this._active_menu_links_count=this._j_menu.find("a").length),e=="down"&&this._active_menu_links_count>this._active_menu_selected_index+1?this._active_menu_selected_index++:e=="up"&&this._active_menu_selected_index-1>=0?this._active_menu_selected_index--:e=="down"?this._active_menu_selected_index=0:e=="up"&&(this._active_menu_selected_index=this._active_menu_links_count-1);var t=this._j_menu.find("li:eq("+this._active_menu_selected_index+")");t.addClass("hover").trigger("mouseover")}},_submit:function(e){if(this._active_menu_selected_index===null)return;var t=Box.Application.getService("nav-state");t.setFirstResultClick(!0);if(this._active_menu_selected_index>-1){var n=this._j_menu.find("a:eq("+this._active_menu_selected_index+")");n.hasClass("qs_result")?this._log_result_pick(e,n):this._log_search_all(e),this.block_search_submit=!0,this.hide();var r=this._get_openbox_action_for_element(n);if(r)r.execute();else if(window.box&&box.hist_name==="files")Box.Application.navigate(n.attr("href"));else{var i=Box.Application.getService("url");i.goToUrl(n.attr("href"))}this._search_input.blur()}else this._log_search_all("keyboard")},_get_item_model_for_element:function(e){var t=Box.Application.getService("v5"),n=t.get("Item"),r=n.find(e.data("typed_id"));return r||(r=new n({id:e.data("item_id"),extension:e.data("item_extension"),typed_id:e.data("typed_id"),type:e.data("item_type")})),r},_get_openbox_action_for_element:function(e){var t=Box.Application.getService("openbox-service-actions"),n=this._get_item_model_for_element(e);return n?t.getDefaultOpenboxAction(n,{ignore_permissions:!0}):null},hide:function(){this._search_string=null,this.block_search_menu=!0,this._search_total_results_count=null,this._remove_hover(),this._active_menu_selected_index=-1,this._toggle_spinner(!1),this.base()},event_click:function(e){return this._submit("mouse"),!1},_log_quick_search_start:function(){var e={search_string:this._search_string,total_results:this._search_total_results_count},t=Box.Application.getService("logger");t.sendLog("search","SEARCH_QUICK_SEARCH_START",e)},_log_result_pick:function(e,t){var n={result_num:this._active_menu_selected_index+1,search_string:this._search_string,total_results:this._search_total_results_count,user_input_trigger:e,item_type:t.data("item_type"),item_id:t.data("item_id"),typed_id:t.data("typed_id")},r=Box.Application.getService("logger");r.sendLog("search","SEARCH_QUICK_SEARCH_PICK_RESULT",n)},_log_search_all:function(e){var t={search_string:this._search_string,total_results:this._search_total_results_count,user_input_trigger:e},n=Box.Application.getService("logger");n.sendLog("search","SEARCH_QUICK_SEARCH_PICK_SEARCH_ALL",t)},_show_dropdown_arrow:function(){var e=Box.Application.getService("nav-state");return!e.isEmbedWidget()},body_click_handler:function(e){var t=$j("#qs_menu");t.is(":visible")&&!$j.elementIsDescendent(e.target,t[0])&&Quick_Search.get().hide()},_is_control_key:function(e){return e==Quick_Search.KEY_ESCAPE||e==Quick_Search.KEY_DOWN||e==Quick_Search.KEY_UP||e==Quick_Search.KEY_ENTER}},{KEY_DOWN:40,KEY_UP:38,KEY_ENTER:13,KEY_ESCAPE:27,get:function(){return Quick_Search.__instance||(Quick_Search.__instance=new Quick_Search),Quick_Search.__instance}});Box.Timing.execution.push({name:"js/features.js",time:(new Date).getTime()});var Features=Base.extend({},{load:function(){var e=$("meta[type=feature_flag]");$.each(e,function(e,t){t=$(t),Features[t.prop("name")]=!0})}});Features.load(),Box.Timing.execution.push({name:"js/box_object.js",time:(new Date).getTime()});var Box_Object=Box_Base.extend({set_params:function(e){e=e||{},Box_Object._convert_old_id(this.constructor,e),"id"in e&&(this.id=e.id),this.id!=null&&this.id!=""&&(this.type in Box_Object._objects_by_type_and_id||(Box_Object._objects_by_type_and_id[this.type]={}),Box_Object._objects_by_type_and_id[this.type][this.id]=this);for(var t in e)this[t]=e[t];return this},process_permissions:function(e,t){if(!this.permissions||typeof this.permissions=="string")this.permissions={};if(!e)return;if(typeof e=="string"){var n=e.split("");e={};for(var r in n)e[n[r]]=!0}for(var i in t){var s=t[i];this.permissions[i]=e[i]||e[s]?!0:!1}},update_params_and_render:$j.abstract_function},{extend:function(e,t){if(!t.type)return $j.throw_error("The 'type' static property is missing in the declaration of the Box_Object subclass",t),null;e.type=t.type;var n=Box_Base.extend.call(Box_Object,e,t),r=["find","find_or_create"];for(var i in r){var s=r[i];if(s in t)continue;n[s]=Box_Object[s]}return n.type=="item"?$j.each(n._subtypes,function(e,t){Box_Object._objects_by_type_and_id[t]={}}):Box_Object._objects_by_type_and_id[n.type]={},n},_objects_by_type_and_id:{},_types_by_old_prefix:{d:"folder",f:"file",l:"web_link",u:"user"},_old_prefix_by_type:{folder:"d",file:"f",web_link:"l",user:"u"},_subclass_names_by_type:{folder:"Item",file:"Item",web_link:"Item"},_convert_old_id:function(e,t){var n=e.type+"_id";return!("id"in t)&&n in t&&(t.id=t[n],delete t[n]),t},_get_subclass:function(e){var t=Box_Object._subclass_names_by_type[e],n=Box.Application.getService("strings");t||(t=n.capitalize(e));var r=window[t];return r?r.find_or_create?r:($j.throw_error("The class "+t+" does not inherit from Box_Object"),null):($j.throw_error("The class "+t+" is not defined"),null)},_is_id:function(e){return(e+"").match(/^\d+$/)},_get_typed_id_regex:function(){return/^([a-z_]+)_(\d+_?\d*)?$/},_is_typed_id:function(e){return(e+"").match(this._get_typed_id_regex())},_get_type_and_id:function(e){var t=this._get_typed_id_regex();e=e.toString();var n=e.match(t),r=n[1];r.length==1&&(r=Box_Object._types_by_old_prefix[r]);var i=n[2];return{type:r,id:i}},_get_typed_id:function(e,t){if(t){var n=this._old_prefix_by_type[e.type];return n+"_"+e.id}return e.type+"_"+e.id},find_by_type_and_id:function(e,t){var n=e;return arguments.length==1&&(t=e.id,n=e.type),Box_Object._objects_by_type_and_id[n]?Box_Object._objects_by_type_and_id[n][t]:null},find_by_typed_id:function(e){var t=Box_Object._get_type_and_id(e);return Box_Object.find_by_type_and_id(t)},get_params:function(e,t){return $j.isArray(e)?$j.map(e,function(e){return e[t]}):[e[t]]},load_params:function(e,t,n){$j.getJSON("/index.php?rm=unidb_get_objects",{typed_ids:this.get_params(e,"typed_id"),format:t},function(e){n&&n(e)})},find:function(e){return Box_Object.find_by_type_and_id(this.type,e)},find_or_create:function(e){if(e=="")return null;var t,n,r;if(typeof e!="object"){var i=e,s=Box_Object._get_type_and_id(i);t=s.type,n=s.id}else r=e,r=Box_Object._convert_old_id(this,r),t=r.type,n=r.id;var o;if(this==Box_Object){o=Box_Object._get_subclass(t);if(!o)return null;if(typeof o.find_or_create!="undefined"&&o.find_or_create!=this.find_or_create)return o.find_or_create(e)}else o=this;if(t!=o.type)return $j.throw_error("The class "+o.type+" cannot create an object of type "+t),null;var u=o.find(n);return u?(r&&u.set_params(r),u):(r||(r={id:n}),new o(r))},find_async:function(e){var t=Box_Object._get_type_and_id(e),n=t.type,r=t.id,i;if(this==Box_Object){i=Box_Object._get_subclass(n);if(!i)return s.reject().promise()}else i=this;var s=$.Deferred();if(n!=i.type)return $j.throw_error("The class "+i.type+" cannot create an object of type "+n),s.reject().promise();var o=i.find(r);if(o)return s.done(o).promise();var u="/index.php?rm=unidb_get_items",a={type:n,id:r},f=$.box.formatQuery(a);return $.getJSON(u,f,function(e){var t=new i(e.params);s.resolve(t)}),s.promise()},type:"undefined"});Box.Timing.execution.push({name:"js/box_behavior_handler.js",time:(new Date).getTime()});var Box_Behavior_Handler=Box_Base.extend({handle_event:function(e){var t="event_"+e.type;return t in this?this[t](e):!0}},{RIGHT_CLICK:2,find_by_element:function(e){var t=Box.Application.getService("strings"),n=$j(e).closest("[data-behavior]");if(!n.length)return null;var r=n.attr("data-behavior"),i="Box_Behavior_Handler_"+t.capitalize(r),s=window[i];if(!s)return $j.throw_error("Undefined Behavior_Handler class",i),null;var o={};o.j_element=n;var u=new s(o);return u}});Box.Timing.execution.push({name:"js/box_behavior_handler/edit_in_place.js",time:(new Date).getTime()});var Box_Behavior_Handler_Edit_In_Place=Box_Behavior_Handler.extend({event_mouseover:function(e){if(!Box_Behavior_Handler_Edit_In_Place.enabled)return;var t=this,n=this.j_element;if(this.show_form()){var r=n.attr("data-edit-icon-sprite-class")||"sprite_16x16_pencil",i=$j('<span class="edit_in_place_hover_cntr" />').append($j('<div class="edit_in_place_hover"></div>').attr({"data-hover":"tooltip","aria-label":Box_Behavior_Handler_Edit_In_Place.edit_prompt}).addClass(r));if(n.next().hasClass("icon")){var s=n.next().width();i.css("padding-left",s+23+"px"),i.css("right","-"+(s+23)+"px")}n.prepend(i),n.data("editable_icon_move_right")&&(i.css("right",parseInt(i.css("right"))-n.data("editable_icon_move_right")),i.css("padding-left",parseInt(i.css("padding-left"))+n.data("editable_icon_move_right")));var o=n.data("make_overflow_hidden_element_visible");o&&(this.j_overflow_hidden_element=$j("#"+o)),n.mousedown(function(e){var r=$j(e.target);if(r.hasClass("edit_in_place_hover")||r.hasClass
("placeholder")||r.hasClass("edit_in_place_inline")){e.preventDefault(),e.stopPropagation(),$j(".edit_in_place_hover_cntr").remove(),n.unbind(),Box.Application.getService("tooltips").hideTooltips(),$j(".edit_popup").find("input").trigger({type:"keydown",keyCode:27}),t.need_to_change_draggable()&&n.parents('[draggable="true"]').removeAttr("draggable").addClass("need_to_restore_dnd_draggable");var i=n.data("type")||"text",s=n.data("select_data")||null,o=n.data("update_html")||null,u=n.data("maxlength")||null,a=n.data("validate")||null,f=null,l=n.data("item_id")||null,c=n.data("item_type")||null,h=n.data("field")||null,a=n.data("validate")||null,p=Box_Behavior_Handler_Edit_In_Place.placeholder_text,d=n.hasClass("item_name");n.attr("placeholder")&&(p=n.attr("placeholder"));var v={},m=null,g,y=Box.Application.getService("nav-state");l&&c&&(l=="gallery"?m=y.galleryItem():l=="current"?m=Canvas.get().current_folder:m=Item.find(l),n.attr("id")=="page_title"&&(v.return_path=!0),v.item_id=m.id,v.item_type=c,d&&(f=function(e,t){return m.type=="file"&&m.extension?e.substr(0,e.lastIndexOf(".")):e}),g=function(e){e&&e.result===!0&&(m[h]=e.value,n.data("update_tooltip_after_edit")&&n.attr({"data-hover":"tooltip","aria-label":e.value})),t.on_form_close();var r=n.data("callback");typeof r=="function"&&r(e)},i=="textarea"&&$j.browser.msie&&parseInt($j.browser.version)<8&&(i="text",n.data("width","500"))),h&&(v.field=h);var b="24px",w="235px";i=="textarea"&&(b="40px",w="730px"),n.data("width")&&(w=n.data("width")),n.height()>parseInt(b,10)&&(b=n.height());var E={};if(a){E.rules={},E.messages={};var S=a.split(" ");for(var x in S){var T=S[x];if(T=="empty")$j.extend(!0,E.rules,{value:{required:!1}});else if(T=="url")$j.extend(!0,E.rules,{value:{url:!0}}),$j.extend(!0,E.messages,{value:$t("Please enter correct URL.","Please_enter_correct_URL")});else if(T=="not_empty")$j.extend(!0,E.rules,{value:{required:!0}}),$j.extend(!0,E.messages,{value:{required:$t("Field can't be empty. Please enter correct value.","Field_cant_be_empty_Please_enter_correct_value")}});else if(T=="not_empty_item_type"){$j.extend(!0,E.rules,{value:{required:!0}});var N=$t("Please enter a file name.","js_please_enter_a_file_name");n.data("item_type")=="folder"&&(N=$t("Please enter a folder name.","js_please_enter_a_folder_name")),$j.extend(!0,E.messages,{value:{required:N}})}else T=="phone"?($j.extend(!0,E.rules,{value:{phone:!0}}),$j.extend(!0,E.messages,{value:$t("Please enter correct phone.","Please_enter_correct_phone")})):T=="filename"&&($j.extend(!0,E.rules,{value:{filename:!0}}),$j.extend(!0,E.messages,{value:{filename:"|"+$t("The name you specified contains special characters %1 or words that are not allowed. Names with leading or trailing whitespace or periods are not allowed. Modify the name and try again.","file_name_special_chars",Validator.file_name_special_chars)}}));E.tip_delay=3e3}}t.j_overflow_hidden_element&&t.j_overflow_hidden_element.css("overflow","visible"),t.j_element.removeAttr("data-hover aria-label");var C=Box.Application.getService("strings");n.editable({cssclass:"edit_popup",width:w,height:b,type:i,data:s?s:f,placeholder:n.attr("placeholder")||Box_Behavior_Handler_Edit_In_Place.placeholder_text,update_html:o,submitdata:v,maxlength:u,validate:E?E:null,text_filter:C.getHyperlinkedString,callback:g,onreset:function(){t.on_form_close()},onsubmit:function(){if(m&&m.type=="file"&&m.extension){var e=this.find("input");e.val(e.val()+"."+m.extension)}},hide_original_text:t.j_overflow_hidden_element?!0:!1})}});var u=n;n.data("editable_mouseout_target")=="parent"&&(u=n.parent()),u.mouseleave(function(e){var t=$j(e.relatedTarget);!t.parent().andSelf().hasClass("edit_in_place_hover_cntr")&&!t.hasClass("icon")&&(n.find(".edit_in_place_hover_cntr").hide().remove(),n.unbind())})}},show_form:function(){var e=this.j_element;return!e.find(".edit_in_place_hover_cntr").length&&!e.find("form").length&&!e.closest("ul.icon_view").length},on_form_close:function(){this.j_overflow_hidden_element&&this.j_overflow_hidden_element.css("overflow","hidden"),this.need_to_change_draggable&&$j(".need_to_restore_dnd_draggable").removeClass("need_to_restore_dnd_draggable").attr("draggable",!0),Box.Application.getService("tooltips").hideTooltips()},need_to_change_draggable:function(){var e=Box.Application.getService("browser");return e.isFirefox()||e.isIE()}},{enabled:!0,placeholder_text:$t("Add","edit_in_place_placeholder"),edit_prompt:$t("Click to edit","edit_in_place_prompt"),toggle_edit_in_place:function(e){this.enabled=e},j_overflow_hidden_element:null});Box.Timing.execution.push({name:"js/box_behavior_handler/select_text_when_clicked.js",time:(new Date).getTime()});var Box_Behavior_Handler_Select_Text_When_Clicked=Box_Behavior_Handler.extend({event_click:function(e){this.j_element.focus(),this.j_element.select()}},{});Box.Timing.execution.push({name:"js/box_view_handler.js",time:(new Date).getTime()});var Box_View_Handler=Box_Base.extend({j_event_elements:null,handle_event:function(e){var t=e.type;t=="mouseup"&&e.button==Box_View_Handler.RIGHT_CLICK&&(t="right_click");var n=this["event_"+t];return n?n.call(this,e):!0},get_j_event_elements:function(e){if(!this.j_event_elements){var t=$j(e.target);t.is("[data-view_id]")?this.j_event_elements=t.add(this.j_element):this.j_event_elements=t.parentsUntil("[data-view_id]").andSelf().add(this.j_element)}return this.j_event_elements}},{RIGHT_CLICK:2,find_object_by_element:function(e){var t=$j(e).closest("[data-view_id]");if(!t.length)return null;var n=t.data("view_id");return Box_Object._is_typed_id(n)?Box_Object.find_by_typed_id(n):null},find_by_element:function(e){var t=$j(e).closest("[data-view_id]");if(!t.length)return null;var n=t.attr("data-view_id"),r,i,s,o;if(Box_Object._is_typed_id(n)){s=n,o=Box_Object.find_by_typed_id(s);if(!o)return $j.throw_error("Model not found for View with id",s),null;r=o.type;if(r=="file"||r=="folder"||r=="web_link")r="item";i={object:o}}else{var u=n.match(/^([a-z_]+)_(\{.*\})$/);if(!u)return $j.throw_error("Invalid view_id",n),null;r=u[1],i=$j.parseJSON(u[2]),s=i.typed_id;if(s){o=Box_Object.find_by_typed_id(s);if(!o)return $j.throw_error("Model not found for View with id "+n+" and object_typed_id "+s,n,s),null;i.object=o}else if(r=="user"&&i.email){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_view_handler.js:48","2013-05-15","auto tombstoned"),o=User.find_collab_data_by_email(i.email);if(!o)return $j.throw_error("Model not found for pending collab with email "+i.email),null;i.object=o}}var a=Box.Application.getService("strings"),f="Box_View_Handler_"+a.capitalize(r),l=window[f];return typeof l!="function"?($j.throw_error("Undefined View_Handler class",f),null):(i.j_element=t,new l(i))},find_by_object:function(e){var t=e.typed_id,n=$j("."+t),r=[];return $j.each(n,function(e,t){var n=Box_View_Handler.find_by_element(t);r.push(n)}),r},target_has_href:function(e){var t=$(e).attr("href"),n=window.location.href,r=n.indexOf("#");return t&&t!="#"&&t!=n.substring(0,r)&&t!=n.substring(0,r+1)?!0:!1}});Box.Timing.execution.push({name:"js/box_view_handler/comment.js",time:(new Date).getTime()});var Box_View_Handler_Comment=Box_View_Handler.extend({event_click:function(e){var t=this.object,n=this.get_j_event_elements(e);if(n.hasClass("reply"))t.item.create_item_feed_object({item:t.item,comment_to_reply_to:t,j_comment_to_reply_to:this.j_element,j_item_feed:this.j_element.closest(".item_feed"),show_all:this.show_all_comments});else if(n.hasClass("edit"))t.item.create_item_feed_object({item:t.item,comment_to_edit:t,j_comment_to_edit:this.j_element,j_item_feed:this.j_element.closest(".item_feed"),show_all:this.show_all_comments});else{if(!n.hasClass("delete"))return!0;t.delete_me({j_comment:this.j_element})}return!1},show_all_comments:function(){var e=Box.Application.getService("nav-state");return e.isPreviewerOpen()?1:0}},{});Box.Timing.execution.push({name:"js/box_view_handler/contact.js",time:(new Date).getTime()});var Box_View_Handler_Contact=Box_View_Handler.extend({event_click:function(e){var t=Box.Application.getService("url");this.override_object();var n=this.get_j_event_elements(e);if(n.hasClass("more_item"))return this.show_menu_from_arrow_click(),!1;if(n.hasClass("mail"))return Canvas.get().user.mail_collaborators([{email:this.object.login,id:this.object.login}]),!1;if(n.hasClass("show_more_folders")){var r=this.j_element.find(".show_more_folders");return r.siblings(".hidden_pending_folders, .hidden_accepted_folders").show(),r.hide(),!1}if(n.hasClass("webdoc")){var i=Item.find_or_create($j(e.target).attr("id"));return i.refresh(function(){var e=Box.Application.getService("openbox-service-actions");e.loadOpenboxActionOnItemAndExecute(i,{action_name:"Edit Web Document",uniq_name:"web_documents"})}),!1}if(n.hasClass("collaborating-in"))return t.goToUrl($j(e.target).attr("href")),!1;if(n.hasClass("corporate_network_invite")){var s=$j(e.target).closest(".collaborator"),o={};return s.length!==0&&(o[s.data("user_id")]={name:s.data("full_name"),email:s.data("email")}),CollaborateAction.create_invite_popup(o,"corporate_network_tab"),!1}return this.object.type=="user"?t.goToUrl(this.object.profile_link("",!0)):Box.Application.getService("popups").alert($t("Profile is unavailable because this user has not registered for an account yet.","profile_unavailable_user_not_registered")),!1},event_right_click:function(e){return this.override_object(),this.show_menu_from_arrow_click(e),!1},show_menu_from_arrow_click:function(e){Box_Menus.get().collaborator_menu.show({target:e?null:this.j_element.find(".more_item"),event:e?e:null,collaborator_id:this.object.id,collaborator_element:this.j_element})},override_object:function(){var e=this.contact_typed_id.lastIndexOf("_"),t=this.contact_typed_id.substring(e+1);oCollaborators.tree[t]&&oCollaborators.tree[t].exists?this.object=new User({id:t,login:oCollaborators.tree[t].login}):this.object=new Contact_User({id:t,login:t})}},{});Box.Timing.execution.push({name:"js/box_view_handler/task.js",time:(new Date).getTime()});var Box_View_Handler_Task=Box_View_Handler.extend({constructor:function(e){this.base(e),this._initialize_subscriptions()},_initialize_subscriptions:function(){var e=this;Box_View_Handler_Task._subscribed_to_task_events||(Canvas.get().subscribe("task_update",function(t,n){e.render(n)}),Canvas.get().subscribe("task_expand",function(t,n){e.render(n,!0)}),Box_View_Handler_Task._subscribed_to_task_events=!0)},event_click:function(e){var t=this.object,n=this.get_j_event_elements(e),r=t.task_upload;if(n.hasClass("delete"))return t.delete_me(),!1;if(n.hasClass("edit"))return t.item.create_item_feed_object({j_item_feed:this.j_element.closest(".item_feed"),task_to_edit:t,j_task_to_edit:this.j_element}),!1;if(n.hasClass("task_due")){var i="#task_info_"+t.id;if(!$j(i).hasClass("disabled"))return t.update_due_date({target:e.target}),!1}if(n.hasClass("task_due_delete"))return t.update_due_date({target:e.target,clear_date:!0}),!1;if(n.hasClass("task_type_selector"))return Task_Type_Selector_Menu.get().show({target:n.closest(".task_type_selector"),task:t}),!1;if(n.hasClass("change_status"))return Task_Assignment_Status_Menu.get().show({target:$j(e.target).closest(".change_status"),task:t}),!1;if(n.hasClass("task_response_submit")){var i="#task_info_"+t.id;$j(i).disable();var s=t.get_assignment_for_current_user();if(s){var o=Task_Assignment_Status_Menu.get(),u=o.get_new_status();if(u=="decline")s.delete_me();else{var a=$j("#new_task_response_"+t.id);s.complete({new_status:u,feedback:$j.trim(a.find(".new_task_response_textarea").val()),message_mentioned:this.process_message_mentioned(a)}),r&&r.upload()}o.reset()}return!1}if(n.hasClass("expand_item_feed")){var f=n.closest(".expand_item_feed").data("expand_task_id");return t.item.get_task({task_id:f}),!1}return n.hasClass("task_upload_input")&&r?(n.hasClass("new_version_upload_cancel")?r.cancel():r.select_file(),!1):!0},render:function(e,t){var n=Task.find(e.task.id);if(!n)return;var r=Box.Application.getService("nav-state"),i="";r.isPreviewerOpen()&&(i=".gallery ");var s=n.id,o=$j(i+".task_"+s);$j(i+"#task_info_"+s).remove();for(var u in n.assignments)$j(i+"#task_assignment_"+n.assignments[u].id).remove(),$j(i+".collapsed_task_assignment_"+n.assignments[u].id).remove();$j(i+"#new_task_response_"+s).remove();var a=$j(e.task_html);t&&a.hide(),o.replaceWith(a),Task_Upload.attach(a),t&&a.slideDown();var f=r.isPreviewerOpen()?"task_response_textarea_previewer":"task_response_textarea_default",l=r.isPreviewerOpen()?"task_response_textarea_default":"task_response_textarea_previewer",c=$j(i+"#new_task_response_"+n.id+" .new_task_response_textarea").removeClass(l).addClass(f).placeholderize({extraMarginTop:"10px"}).autosize();if(!r.isPreviewerOpen()){var h=a.parents(".item_expansion").find(".medium_up_arrow_border");h.length&&h.children(".highlighted_arrow").addClass("medium_up_arrow").removeClass("highlighted_arrow sprite_24x24_yellow_arrow")}Box.Application.getService("at-mention").bind({inputElement:c,itemTypedID:n.item.folder.typed_id,initialMessage:n.comment_to_edit&&n.comment_to_edit.message_mentioned}),n.item.refresh()},process_message_mentioned:function(e){var t=e.find(".new_task_response_textarea"),n=Box.Application.getService("at-mention").getMessage(t);return n.messageMentioned}},{_subscribed_to_task_events:!1});Box.Timing.execution.push({name:"js/box_view_handler/user.js",time:(new Date).getTime()});var Box_View_Handler_User=Box_View_Handler.extend({event_click:function(e){var t=this.object,n=this.get_j_event_elements(e);if(n.hasClass("mail"))t.message();else if(n.hasClass("edit"))this.handle_edit(t);else if(n.hasClass("corporate_network")){if(window.CollaborateAction){var r={};r[t.user_id]={name:t.name,email:t.email},this.set_interval_id&&clearInterval(this.set_interval_id),CollaborateAction.create_invite_popup(r,"corporate_network_sidebar",{show_access_types:!0})}else if(!this.collaborate_action_requested){var i=new Item({type:"folder"});i.available_permissions=collab_permissions;var s=Box.Application.getService("openbox-service-actions");s.createAction(i,"collaborate"),this.collaborate_action_requested=!0;var o=this;this.set_interval_id=setInterval(function(){o.event_click(e)},50)}}else{if(Box_View_Handler.target_has_href(e.target))return!0;t.open_profile()}return!1},event_mouseover:function(e){var t=this.get_j_event_elements(e),n=this.object,r=t.closest(".user, .external_user"),i=t.closest("li, a");if(t.hasClass("user_menu")||i.hasClass("user_menu")||r.hasClass("user_menu")){var s=t.hasClass("profile_link")||i.hasClass("profile_link"),o=t.hasClass("this_folder_only");Box_Event_Tracker.get().set_category("Collaborator mouseover"),Box_Menus.get().user_menu.show({user:n,_target:r.hasClass("user_menu")?r:t,this_folder_only:o,profile_link:s,expiration:n.collab_in_current_folder&&n.collab_in_current_folder[0].expiration})}},event_mouseout:function(e){$(e.target).closest(".hover").removeClass("hover")}},{});Box.Timing.execution.push({name:"js/box_view_handler/task_assignment.js",time:(new Date).getTime()});var Box_View_Handler_Task_Assignment=Box_View_Handler.extend({event_click:function(e){var t=this.object,n=this.get_j_event_elements(e),r=this.j_element;return t.j_element=r,n.hasClass("delete")?(t.delete_me(),!1):n.hasClass("task_assignee")?(Task_Assignee_Menu&&Task_Assignee_Menu.get().show({task_assignment:t,target:t.j_element}),!1):n.hasClass("change_status")?(Task_Assignment_Status_Menu.get().show({target:$j(e.target).closest(".change_status"),task_assignment:t}),!1):n.hasClass("edit")?(t.add_feedback({j_task_assignment:$j(e.target).closest(".task_assignment")}),!1):n.hasClass("at_mention")?!0:!0}},{});Box.Timing.execution.push({name:"js/box_view_handler/item_feed.js",time:(new Date).getTime()});var Box_View_Handler_Item_Feed=Box_View_Handler.extend({event_click:function(e){var t=Box_Object.find_by_typed_id(this.item_typed_id),n=this.get_j_event_elements(e);if(n.hasClass("view_version_history"))return t.version_history(),!1;if(n.hasClass("task_type_selector"))return Task_Type_Selector_Menu.get().show({target:n.closest(".task_type_selector")}),!1;if(n.hasClass("expand_item_feed")){var r=n.closest(".expand_item_feed"),i=r.data("collapsed_ids");return i&&t.get_item_feed({j_feed_container:n.closest(".collapsed_count"),collapsed_ids:i,show_all:1,skip_create_item_feed_object:1}),!1}return n.hasClass("assign_task_button")?(t.create_item_feed_object({j_item_feed:this.j_element,create_new:!0,create_new_type:"task"}),!1):n.hasClass("comment_button")?(t.create_item_feed_object({j_item_feed:this.j_element,create_new:!0,create_new_type:"comment"}),!1):!0},event_mouseover:function(e){var t=Box_Object.find_by_typed_id(this.item_typed_id),n=this.get_j_event_elements(e),r=Box.Application.getService("nav-state");if(!r.isEmbedWidget()&&n.hasClass("item_feed_bar")&&$j.browser.mozilla){var i=$j(window).scrollTop(),s=$j("#player").hide();n.focus(),s.show(),$j(window).scrollTop(i)}return!0}},{});Box.Timing.execution.push({name:"js/box_view_handler/sidebar.js",time:(new Date).getTime()});var Box_View_Handler_Sidebar=Box_View_Handler.extend({event_click:function(e){var t=$j(e.target),n=t.parent(),r=t.parents(),i=t.attr("id"),s=box_sidebar.get_current_item();if(i=="sharing_sidebar_access_link"||n.attr("id")=="sharing_sidebar_access_link"){var o=Share_Access_Menu.get();return o.visible?o.hide():o.show({item:s,target:t,source:"sidebar"}),!1}return t.hasClass("arrow")||r.hasClass("toggle_cntr")&&t.parentsUntil(".toggle_cntr").add(t).is("h6")&&!r.hasClass("toggle_body")?!1:t.hasClass("tag_name")?(Canvas.get().tag_collection.apply_tags([i.substr(2)]),!1):t.hasClass("add_tag_button")?(s.tag(),!1):!0},event_mouseover:function(e){var t=$j(e.target).parents("li");if(t.length){var n=t.data("info");if(!n&&!t.hasClass("ps_expiration")&&!t.hasClass("task"))return!0}event.preventDefault()},event_mouseout:function(e){$(e.target).closest(".hover").removeClass("hover")}},{});Box.Timing.execution.push({name:"js/box_view_handler/select_element.js",time:(new Date).getTime()});var Box_View_Handler_Select_Element=Box_View_Handler.extend({event_click:function(e){var t=this._find_element_for_select_element(e);return(new Select_Element(t)).show(),!1},_find_element_for_select_element:function(e){return $j(e.target).closest("[data-view_id]")}},{});Box.Timing.execution.push({name:"js/box_view_handler/pagination.js",time:(new Date).getTime()});var Box_View_Handler_Pagination=Box_View_Handler.extend({event_click:function(e){if(!this.j_element.hasClass("disabled")){var t=this.j_element.data("page_num");t?Canvas.get().update_page(t):Box_Menus.get().paging_menu.show({target:e.target})}return!1}},{});Box.Timing.execution.push({name:"js/box_view_handler/in_place_shared_link.js",time:(new Date).getTime()});var Box_View_Handler_In_Place_Shared_Link=Box_View_Handler.extend({event_click:function(e){return box_sidebar.get_current_item().sharebar(),!1}},{});Box.Timing.execution.push({name:"js/box_view_handler/sidebar_file_info_link.js",time:(new Date).getTime()});var Box_View_Handler_Sidebar_File_Info_Link=Box_View_Handler.extend({event_click:function(e){return Previewer.get().current_item().edit_properties(),!1}},{});Box.Timing.execution.push({name:"js/box_view_handler/select_text_when_clicked.js",time:(new Date).getTime()});var Box_View_Handler_Select_Text_When_Clicked=Box_View_Handler.extend({event_click:function(e){var t=$j(e.target);return t.focus(),t.select(),!1}},{});Box.Timing.execution.push({name:"js/box_view_handler/upgrade_popup.js",time:(new Date).getTime()});var Box_View_Handler_Upgrade_Popup=Box_View_Handler.extend({event_click:function(e){var t=this.j_element.attr("data-upgrade-slide")||null,n=Box.Application.getService("v5popups");return t?n.showUpgradePopup(t):n.showUpgradeTourPopup(),!1}},{});Box.Timing.execution.push({name:"js/box_view_handler/filter_menu.js",time:(new Date).getTime()});var Box_View_Handler_Filter_Menu=Box_View_Handler.extend({event_click:function(e){return Box_Menus.get().file_filter_menu.show({target:e.target}),!1}},{});Box.Timing.execution.push({name:"js/box_view_handler/sort_menu.js",time:(new Date).getTime()});var Box_View_Handler_Sort_Menu=Box_View_Handler.extend({event_click:function(e){return $j(e.target).hasClass("show_enterprise_sort_menu")||$j(e.target).parent().hasClass("show_enterprise_sort_menu")?Box_Menus.get().sort_enterprise_menu.show({target:e.target,type:"sort"}):Box_Menus.get().file_sort_menu.show({target:e.target}),!1}},{});Box.Timing.execution.push({name:"js/box_view_handler/toggle_item_list_selection.js",time:(new Date).getTime()});var Box_View_Handler_Toggle_Item_List_Selection=Box_View_Handler.extend({event_click:function(e){return Canvas.get().selection.toggle_all(),!1}},{});Box.Timing.execution.push({name:"js/views/sidebar.js",time:(new Date).getTime()});var Box_Sidebar_View=Base.extend({sidebar_queue:[],display_order:["corporate_network_placeholder","sidebar_collaborators_placeholder","account_info_sidebar_module","resources_sidebar_module"],populate_html:function(e){$j("#content_sidebar").removeClass("hidden");if(e!=""){var t=Box.Application.getService("dom");t.setHTML($("#content_sidebar")[0],e)}},display_box_files_sidebar_in_order:function(e,t){var n=$j.inArray(e,this.display_order),r=this.sidebar_queue;r[n]={id:e,displayed:!1,content:t};var i=Box.Application.getService("imageloader"),s=Box.Application.getService("dom"),o=Box.Application.getService("nav-state");for(var u=0;u<r.length;u++){var a=r[u];if(typeof a!="undefined")a.content&&!a.displayed?(s.setHTML($("#"+a.id),a.content),a.displayed=!0):$j("#"+a.id).removeClass("hidden"),i.loadImages($j("#"+a.id)[0],!0);else if(!o.isGcm())break}},_show_html_in_sidebar_placeholder:function(e){this.display_box_files_sidebar_in_order("sidebar_collaborators_placeholder",e)},show_sidebar_collaborators_module:function(){var e=Canvas.get().current_folder;if(e.id==0||e.id==""||e.is_trash_folder){this._show_html_in_sidebar_placeholder("");return}var t=this,n={just_collab_section:!0,folder_id:e.id,number_of_collaborators_to_load:"default"},r="/index.php?rm=box_collaborate_get_sidebar",i=Box.Application.getService("dom");$.getJSON(r,$.box.formatQuery(n),function(e){if(Features.collab_redesign){var n=i.query(".sidebar-collab-spinner-container");n&&i.removeClass(n,"is-displayed",function(){t._show_html_in_sidebar_placeholder(e.sidebar_html)})}else t._show_html_in_sidebar_placeholder(e.sidebar_html)})},displaySidebarCollabOverlay:function(){var e=Box.Application.getService("dom"),t=e.query(".sidebar-collab-spinner-container");setTimeout(function(){e.addClass(t,"is-displayed")},50)},show_corporate_network_module:function(){var e=Canvas.get().current_folder;if(e.id!=0||e.id==""){this.display_box_files_sidebar_in_order("corporate_network_placeholder","");return}var t="/index.php?rm=module_controller_get_corporate_network_module",n=this;$j.getJSON(t,function(e){n.display_box_files_sidebar_in_order("corporate_network_placeholder",e.html)})}},{get:function(){return Box_Sidebar_View.__instance||(Box_Sidebar_View.__instance=new Box_Sidebar_View),Box_Sidebar_View.__instance}});Box.Timing.execution.push({name:"js/helpers/ie-hover.js",time:(new Date).getTime()}),Loader.t3Loaded.done(function(){"use strict";function r(r){if(!r.target)return;var i=r.target;if(typeof i.className!="string"||i.className.match(e))return;var s=!1;if(r.type==="mouseout"&&i.givesHover)s=!0;else if(r.type==="mouseover"&&i.doesntGiveHover)return;var o=[i],u=i;while(u){u.nodeName.match(t)&&(!s&&(u.className.match(n)||u.nodeName==="BUTTON")&&(s=!0),u!==i&&(u.className.indexOf("gets_hover")!==-1||u.nodeName==="LI"||u.nodeName==="BUTTON")&&!u.className.match(e)&&o.push(u)),u=u.parentNode;if(u&&u.nodeName==="BODY")break}if(!s){i.doesntGiveHover=!0;return}i.givesHover=!0,$(o).toggleClass("hover",r.type==="mouseover")}var e=/ignore_mouse(over|out)/,t=/div|ul|li|button/i,n=/(?:.* |^)(nav|admin_nav|list_ext|hover_list|needs_hover)(?:$| .*)/;$(document.body).on("mouseover",r).on("mouseout",r)}),Box.Timing.execution.push({name:"js/box_simple_body_blocker.js",time:(new Date).getTime()});var simpleBodyBlocker={on:!1,create:function(e){e=e||{},$j("#global_blocker").length||$j('<div id="global_blocker"></div>').appendTo(document.body);var t=$j("#global_blocker");e.opacity&&t.css("opacity",e.opacity),t.css({display:"block"}),simpleBodyBlocker.on=!0},destroy:function(){$j("#global_blocker").hide(),simpleBodyBlocker.on=!1}};Box.Timing.execution.push({name:"js/box_confirmation_message.js",time:(new Date).getTime()});var Box_Confirmation_Message=Base.extend({_j_confirmation_message:null,_j_confirmation_content:null,_j_confirmation_description:null,_j_confirmation_close:null,constructor:function(){this._j_confirmation_message=$j("#box_confirmation"),this._j_confirmation_content=$j("#box_confirmation_content"),this._j_confirmation_description=$j("#box_confirmation_description"),this._j_confirmation_close=$j("#box_confirmation_close"),this._bind_close_callback()},show_confirmation:function(e,t){this._show_message(e,t)},show_error:function(e,t){this._show_message(e,t)},hide:function(e){this._migrated_action_handler=null,e?(this._j_confirmation_message.hide(),this._cleanup_after_hide()):this._j_confirmation_message.slideUp("fast",$.proxy(this,"_cleanup_after_hide"))},get_confirmation_height:function(){return this._j_confirmation_message.outerHeight(!0)},is_confirmation_visible:function(){return this._j_confirmation_message.is(":visible")},_cleanup_after_hide:function(){if(this._j_confirmation_extra_classes){var e=this._j_confirmation_extra_classes.length;for(var t=0;t<e;t++)this._j_confirmation_message.removeClass(this._j_confirmation_extra_classes[t]);this._j_confirmation_extra_classes=null}$j.selectable("refresh"),$j.fast_draggable("refresh")},_show_message:function(e,t){t=t||{};var n=t.description,r=t.callback||null,i=t.disable_scroll||!1,s=t.extra_classes||null,o=$j('<div class="bd"/>');o.append(e),this._j_confirmation_content.empty().append($j('<div class="img" />')).append(o),this._bind_close_callback(r),this._bind_click_events(),this._set_confirmation_description(n),this._j_confirmation_extra_classes=s;if(this._j_confirmation_extra_classes){var u=this._j_confirmation_extra_classes.length;for(var a=0;a<u;a++)this._j_confirmation_message.addClass(this._j_confirmation_extra_classes[a])}this._j_confirmation_message.show(),this._refresh_global_state(),i||Canvas.get().scroll_up()},_set_confirmation_description:function(e){e?this._j_confirmation_description.empty().append(e).show():this._j_confirmation_description.hide()},_bind_close_callback:function(e){var t=this;this._j_confirmation_close.off("click.confirmation_message").on("click.confirmation_message",function(){return t.hide(!0),$j.isFunction(e)&&e(),!1})},_bind_click_events:function(){this._j_confirmation_message.off("click.message_actions").on("click.message_actions",this,this._confirmation_message_click_handler)},_confirmation_message_click_handler:function(e){var t=$j(e.target),n=null,r=e.data,i=Box.Application.getService("nav-state");if(t.attr("data-action_load_item"))i.setItemInFiles(t.attr("data-action_load_item")),Box.Application.navigate("");else if(t.attr("data-action_sharebar"))Box_Event_Tracker.get().set_category("Files - Just sent tip"),n=t.data("action_sharebar"),n.item_id&&Item.find(n.item_id).sharebar();else if(t.attr("data-action_collaborate_current_folder"))Box_Event_Tracker.get().set_category("Files - New folder tip"),Box.Application.getService("popups").open("collaborate",{data:{typed_id:Canvas.get().current_folder.typed_id}});else if(t.attr("data-action_auto_collab_message_link"))r._auto_collaboration_message_link_click_handler(t);else if(t.attr("data-action_master_invite_accept"))Box_Files.get().master_invite_answer(t,"accepted");else if(t.attr("data-action_master_invite_reject"))Box_Files.get().master_invite_answer(t,"rejected");else{if(!t.attr("data-migrated_action")||!e.data._migrated_action_handler)return!0;e.data._migrated_action_handler()}return!1},_auto_collaboration_message_link_click_handler:function(e){$j.post("/index.php?rm=box_collaborate_mark_invites");var t=e.data("action_auto_collab_message_link"),n=t.item_id,r=Box.Application.getService("nav-state");return t.is_webdoc?Item.open_webdoc(n):(r.setItemInFiles(n),Box.Application.navigate("")),!1},_refresh_global_state:function(){$j.selectable("refresh"),$j.fast_draggable("refresh"),this._set_loading_blocker_height()},_set_loading_blocker_height:function(){var e=Loading.get();e.blocker&&$j(e.blocker).css("height",e.blocker.offsetHeight+this._j_confirmation_message.get(0).offsetHeight)}},{_instance:null,get:function(){return Box_Confirmation_Message._instance||(Box_Confirmation_Message._instance=new Box_Confirmation_Message),Box_Confirmation_Message._instance}});Loader.t3Loaded.done(Box_Confirmation_Message.get),Box.Timing.execution.push({name:"js/box_confirmation_message_builder.js",time:(new Date).getTime()});var Box_Confirmation_Message_Builder=Base.extend({show_collaboration_invite_message:function(e,t){var n=Box_Confirmation_Message.get().is_confirmation_visible(),r=e.length,i=$j.isArray(e)&&r;if(!i||n)return!1;var s=this,o=$j("<div />"),u=0,a=0,f=0;$j.each(e,function(t){if(t===10)return!1;e[t].item_type=="file"&&e[t].item_name.substr(e[t].item_name.length-7)==".webdoc"?u++:e[t].item_type=="file"?a++:f++;var n=e[t],r=n.item_type=="file"?n.item_name.substr(n.item_name.length-7)==".webdoc"?"webdoc":"file":"folder",i=n.inviter_user_name?n.inviter_user_name:n.item_user_name,l=e[t].item_type=="file"?$t("File Info","collaborators_js_list_tooltip_file"):$t("Folder Info","js_collaborators_js_list_tooltip_folder"),c=l+"|"+(n.files_count?$t("Files: %1","collaborators_js_list_tooltip_files",n.files_count):"")+(n.files_count&&n.hide_collaborators!=1?"  ":"")+(n.hide_collaborators==1?"":$t("Collaborators: %1","collaborators_js_list_tooltip_collabs",n.collaborators_count)),h=$j('<div class="pending_collab_row media" />').append($j('<div class="img_ext collab_invite_links" />').append($t("%1 or %2","collaborators_js_accept_reject",$j('<a class="collab_invite_accept_link midlight" href="#" />').text($t("Accept","collaborators_js_accept")).attr("id","collab_invite_accept_link_"+n.item_id)[0].outerHTML,$j('<a class="collab_invite_reject_link midlight" href="#" />').text($t("Reject","collaborators_js_reject")).attr("id","collab_invite_reject_link_"+n.item_id)[0].outerHTML))).append($j('<span class="img sprite_32x32" />').addClass("sprite_32x32_incoming_collab_"+r)).append($j('<div class="bd" />').append($j('<ul class="basic_list" />').append($j("<li />").append($j("<b />").text(n.item_name)).append($j('<span class="img sprite_16x16_info confirmation_sprite_spacing" alt="" />').attr({"data-hover":"tooltip","aria-label":c}))).append($j("<li />").append($j('<span class="owner ellipsis ellipsis_150" style="float:none; clear:both;" />').text($t("By %1","collaborators_js_pending_by_2",i)))))).attr("id","inv"+t);h.find(".collab_invite_links a:eq(0)").click(s._get_accept_handler(n)),h.find(".collab_invite_links a:eq(1)").click(function(t){Box_Event_Tracker.get().set_category_by_rm("Confirmation message");var r=new Collab(n);return r.accept({}),!1}),t>0&&h.addClass("line"),o.prepend(h)});if(!f&&!u)return!1;var l=Box.Application.getService("nav-state"),c=l.get();if(c.id==root_folder_id.substr(2)&&$j("#confirmation_auto_accepted_folders").length&&!l.isPreviewerOpen()){var h=$j("#confirmation_auto_accepted_folders").clone().attr("id","").css("display","block");o.append(h)}if(!t){var p=$j('<a id="turn_on_auto_accept" href="#"></a>').text($t("Automatically accept all collaboration invites%1","automatic_collab_invite_accept"," ")),d=$t("If the folder owner requires collaborators to agree to a terms of service, you will stll need to accept the terms before accessing the folder.  All other folders will be accepted automatically.","change_auto_accept_desc");p.append($j('<span class="sprite_16x16_info list_img list_img_icon_16">&nbsp;</span>').attr({"data-hover":"tooltip","aria-label":d})),p.click(function(){var t=new Auto_Accept_Collab_Popup;return t.show(),!1}),o.append(p)}var v=this._get_pending_collab_message(f,u,a,r);return Box_Confirmation_Message.get().show_confirmation(v,{description:o,callback:function(){$j.post("/index.php?rm=box_collaborate_mark_invites",{})}}),!0},show_added_weblink_message:function(e){var t=$t("%1 has been added.","js_myfiles_js_has_been_successfully_weblink",e);Box.Application.getService("notifications").confirm(t)},show_sso_groups_exceeded_message:function(){var e=$t("Your group memberships on Box have not been updated. Please contact your enterprise administrator to update your group's access priviledge","sso_groups_exceeded");Box.Application
.getService("notifications").error(e)},show_grace_notification_message:function(){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_confirmation_message_builder.js:5562","2013-05-15","auto tombstoned");var e=$t("Due to an issue on our billing system, we were unable to validate your credit card info.","billing_cannot_validate_cc_info")+$t("You may be asked to input your information again.","may_be_asked_to_input_info_again");Box.Application.getService("notifications").error(e,{onhide:function(){$j.post("/index.php?rm=box_zuora_actions_hide_billing_failed_message")}})},show_email_blocked_message:function(e){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_confirmation_message_builder.js:5563","2013-05-15","auto tombstoned");var t=Box.Application.getService("notifications"),n=$t("Box is having trouble delivering emails to %1.","box_trouble_delivering_emails",e);t.error(n,{action:{text:$t("Check your settings","check_settings_link"),onclick:function(){Box.Application.getService("url").goToUrl("/settings/email_password")}},callback:function(){$j.post("/index.php?rm=box_email_service_hide_email_block_message")}})},show_temporary_access_message:function(e,t){var n=$t("You have been granted temporary access to this folder. You will be automatically removed from this folder on %1","initial_text_access",e);Box.Application.getService("notifications").confirm(n,{onhide:function(){$j.post("/index.php?rm=box_item_expirations_mark_as_seen",{collab_id:t})}})},show_collab_by_link_unsuccessful_message:function(){var e=$t("This invite link is no longer active. Please contact the person who provided you with this link.","collab_by_link_unsuccessful");Box.Application.getService("notifications").error(e)},show_gcm_move_file_message:function(e){Box.Application.getService("notifications").confirm($t("You have moved %3.","gcm_items_moved_confirmation","","",e.join(", ")))},show_master_invite_message:function(e){Box_Confirmation_Message.get().show_confirmation(e,{description:$t("%1Note: %2By accepting, you will be giving the enterprise access to your Box account. We recommend creating a personal account for any personal files you have stored on Box.","collab_master_invite_enterprise_recommendation_message","<strong>",'<span style="color: #888;">',"</span>")})},show_added_email_alias_message:function(e){Box.Application.getService("notifications").confirm($t("%1 has been added to your account.","added_to_users_account",e))},_get_single_item_notification_message:function(e,t){var n,r,i;if(t.success===1){i=!0;if(t.first_item.type=="folder"){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_confirmation_message_builder.js","2013-09-20","Possible dead logic (KW)"),n=$t("%1 has been created.","folder_created_successfully",t.first_item.name);var s=Item.find_or_create_just_uploaded_item(e[t.first_item.id]);r={text:$t("Go to folder","go_to_folder"),onclick:function(){s.click()}}}else t.first_item.type=="file"?n=$t("%1 has been uploaded.","file_uploaded_successfully",t.first_item.name):n=$t("%1 has been created.","item_uploaded_successfully",t.first_item.name)}else n=this._get_error_messages(t.errors)[0],i=!1;return{message:n,is_success:i,action:r}},_get_multiple_items_notification_error:function(e){var t,n;return e.has_unique_error?e.success===0?t=this._get_error_messages(e.errors)[0]:t=$t("%1 items uploaded, but %2 failed. %3","some_items_upload_failed_with_error_message",e.success,e.error,this._get_error_messages(e.errors)[0]):e.error>0&&(e.success===0?t=$t("Unable to create items.","items_upload_failed"):t=$t("%1 items created, but %2 failed.","some_items_upload_failed",e.success,e.error),n={text:$t("See Details","see_details_in_upload_error"),onclick:function(){Box.Application.getService("popups").alert(this._get_error_messages(e.errors).join("\n"))}}),{message:t,is_success:!1,action:n}},show_notification_for_new_items:function(e){var t=this._parse_new_items_data(e),n=Box.Application.getService("notifications"),r=!0,i=null,s=t.success+t.error,o=null,u;if(s===0)return;s===1?(u=this._get_single_item_notification_message(e,t),i=u.message,r=u.is_success,o=u.action):s>1&&(t.error>0?(u=this._get_multiple_items_notification_error(t),i=u.message,r=u.is_success,o=u.action):i=$t("%1 items have been uploaded.","items_uploaded_successfully",t.success)),r?n.confirm(i,{action:o}):n.error(i,{action:o})},_get_error_messages:function(e){var t=[],n,r,i;for(var s in e){r=e[s],i=r.join(", ");switch(s){case"no_upload_access":n=$t("%1 failed because you do not have permission to create folders.","failed_to_create_folders_due_to_permissions",i);break;case"name":n=$t("%1 failed because items with the same name already exist.","items_failed_to_create_due_to_name_conflict",i);break;case"folder_depth_limit_exceeded":n=$t("%1 cannot be created because the depth of folders is too deep.","failed_to_create_folders_due_to_deep_tree",i);break;case"folder_breadth_limit_exceeded":n=$t("%1 cannot be created because there are too many folders inside them.","failed_to_create_folders_due_to_large_amount_of_children",i);break;case"invalid_folder_name":n=$t("%1 cannot be created because their names are invalid.","failed_to_create_folders_due_to_invalid_name",i);break;case"folder_name_length_exceeded":n=$t("%1 cannot be created because their names are too long.","failed_to_create_folders_due_to_long_name",i);break;default:n=$t("%1 cannot be created due to an unexpected error.","failed_to_create_item_due_to_unknown_error",i)}t.push(n)}return t},_parse_new_items_data:function(e){var t=0,n=0,r=0,i={},s,o,u,a;for(var f in e){o=e[f],s||(s={id:f,name:o.name,type:o.type}),u=$.makeArray(o.errors);if(u&&u.length>0){n++;for(var l=0,c=u.length;l<c;l++)a=u[l],i[a]||(r++,i[a]=[]),i[a].push(o.name)}else t++}return{success:t,error:n,first_item:s,has_unique_error:r===1,errors:i}},get_successfully_uploaded_new_items:function(e){var t={};for(var n in e){var r=e[n];r.errors||(t[r.type]||(t[r.type]=[]),t[r.type].push(n))}return t},get_error_message_from_code:function(e,t){switch(t){case"no_upload_access":return $t("You do not have permission to create folders.","js_confirmation_no_permission_to_create_folders");case"name":return $t("Sorry, but an item named %1 already exists.","js_confirmation_item_already_exist",e.name);case"folder_depth_limit_exceeded":return $t("Folder cannot be created since the folder tree is too deep.","js_confirmation_folder_depth_limit_exceeded");case"folder_breadth_limit_exceeded":return $t("Folder cannot be created since the folder tree is too wide.","js_confirmation_folder_breadth_limit_exceeded");case"invalid_folder_name":return $t("Folder name is invalid.","js_confirmation_invalid_folder_name");case"folder_name_length_exceeded":return $t("Folder name has exceeded its limit.","js_confirmation_folder_name_length_exceeded");default:var n=ItemTypeTranslation.singular(e.type);return this.format_message_items_add_failed(n,e.name)}},format_message_items_add_failed:function(e,t){return $t('The %1 "%2" could not be created.',"js_item_could_not_be_created",e,t)},show_auto_collaboration_message:function(e,t,n,r){if(e==0&&t==0&&n==0)return;var i=this.get_item_number_string(e,t,n),s=$t("You joined %1 since your last login.","joined_items_since_login",i),o=$t("Change your auto-accept setting.","change_your_auto_accept_setting"),u=$t("If the folder owner requires collaborators to agree to a terms of service, you will stll need to accept the terms before accessing the folder.  All other folders will be accepted automatically.","change_auto_accept_desc"),a=s+" "+'<a href="/settings/collaboration">'+o+'</a><span class="sprite_16x16_info list_img" data-hover="tooltip" aria-label="'+u+'">&nbsp;</span>';Box_Confirmation_Message.get().show_confirmation(a,{description:$j(r),callback:function(){$j.post("/index.php?rm=box_collaborate_mark_invites")}})},_get_pending_collab_message:function(e,t,n,r){var i=this.get_item_number_string(e,t,n,r),s=$t("You have %1 collaboration invitations.","confirmation_message_num_invites",i)+" ";return i.indexOf("+")===-1?s+=$t("You can accept below:","confirmation_message_accept_collab_invites"):s+=$t("To see the rest of your invitations, you must act on some below:","confirmation_message_see_more"),s},get_item_number_string:function(e,t,n,r){var i=e+t+n;return r!==undefined&&i<r&&(i+="+"),""+i},_get_accept_handler:function(e){return function(){Box_Event_Tracker.get().set_category_by_rm("Confirmation message");var t=$(this).parent(),n=new Collab(e);return n.accept({accept_dialog:!0,callback:function(e){if($j.isFunction(box._accept_collab_callback)){var r=e.error?!1:!0;box._accept_collab_callback(t,n,r)}}}),!1}}},{_instance:null,get:function(){return Box_Confirmation_Message_Builder._instance||(Box_Confirmation_Message_Builder._instance=new Box_Confirmation_Message_Builder),Box_Confirmation_Message_Builder._instance}});Box.Timing.execution.push({name:"js/box_canvas.js",time:(new Date).getTime()});var Canvas=Base.extend({_scrolling:!1,collaborated:!1,collections:null,container:null,current_folder:null,upgrade_dropdown:null,element:null,expanded_list_view:!1,group_tags:null,in_account:!0,logged_in:!1,menu:null,on_load:null,path:null,permissions:null,selection:null,device_pinning_selection:null,shared_name:null,tag_collection:null,target_item:null,update_page_callback:null,use_dragdrop:!1,use_item_expansion:null,use_menu_shortcuts:!1,use_selectables:!1,user:null,devices:null,master_activity_tracker:null,users:null,view:null,precall:{},body_click_handlers:[],constructor:function(e){Canvas.__instance=this,OpenboxAction.load(window.openbox_actions),e=e||{},this.users=new UserCollection,this.devices=new Device_Pinning_Collection,typeof Group_Tag_Collection!="undefined"&&(this.group_tags=new Group_Tag_Collection),typeof Tag_Collection!="undefined"&&(this.tag_collection=new Tag_Collection),this.enterprises=new Enterprise_Collection,this._set_user(),this._set_enterprise(),this.collections=[],this.element=$j(document.body),this.expanded_list_view=e.expanded_list_view||!1,typeof e.in_account!="undefined"&&(this.in_account=e.in_account),this.logged_in=this.user.login!="",this.path=e.path||{},this.permissions=e.permissions||{},this.shared_name=e.shared_name||"",this.vanity_name=e.vanity_name||"",this.collab_invite_token=e.collab_invite_token||"",this.use_item_expansion={},this.view=e.view||"icon",this.menu_groups={},Box_Pub_Sub&&Canvas.implement(Box_Pub_Sub),typeof Master_Activity_Tracker!="undefined"&&(this.master_activity_tracker=new Master_Activity_Tracker),typeof Add_Group_Tag_Form!="undefined"&&(this.add_group_tag_form=new Add_Group_Tag_Form),typeof Add_User_Form!="undefined"&&(this.add_user_form=new Add_User_Form),typeof Bulk_Add_User_Form!="undefined"&&(this.bulk_add_user_form=new Bulk_Add_User_Form),typeof Bulk_Edit_User_Form!="undefined"&&(this.bulk_edit_user_form=new Bulk_Edit_User_Form),typeof Edit_External_User_Form!="undefined"&&(this.edit_external_user_form=new Edit_External_User_Form),typeof Edit_Group_Tag_Form!="undefined"&&(this.edit_group_tag_form=new Edit_Group_Tag_Form),typeof Edit_User_Form!="undefined"&&(this.edit_user_form=new Edit_User_Form),typeof Report_Security_Form!="undefined"&&(this.report_security_form=new Report_Security_Form),typeof Report_User_Statistics_Form!="undefined"&&(this.report_user_statistics_form=new Report_User_Statistics_Form),typeof Report_File_Statistics_Form!="undefined"&&(this.report_file_statistics_form=new Report_File_Statistics_Form),typeof Report_Usage_Logs_Form!="undefined"&&(this.report_usage_logs_form=new Report_Usage_Logs_Form),typeof Change_Password_Form!="undefined"&&(this.change_password_form=new Change_Password_Form),this.selection=new ItemSelection,this.device_pinning_selection=new Device_Pinning_Selection(this.devices),this._attach_item_events(),this._bind_actionbar_stalker();var t=Box.Application.getService("v5"),n=t.get("In_App_Message"),r=Box.Application.getService("nav-state");n&&!r.isEmbedWidget()&&n.get_in_app_message_to_show()},register_body_click_handler:function(e){$j.isFunction(e.body_click_handler)&&this.body_click_handlers.push(e)},_attach_item_events:function(){$j(document).bind("contextmenu",function(e){var t=$j(e.target);if(t.is("input[type=text], textarea, a.bookmarklet, .allow_right_click"))return!0;if(t.hasParent(".allow_right_click"))return!0;if(!simpleBodyBlocker.on)return!1}),$j(this.element).off("click.canvas").on("click.canvas",$j.proxy(this._canvas_click_handler,this)).off("mousedown.canvas").on("mousedown.canvas",$j.proxy(this._canvas_mousedown_handler,this)).off("mouseup.canvas").on("mouseup.canvas",$j.proxy(this._canvas_mouseup_handler,this)).off("mouseover.canvas").on("mouseover.canvas",$j.proxy(this._canvas_mouseover_handler,this)).off("mouseout.canvas").on("mouseout.canvas",$j.proxy(this._canvas_mouseout_handler,this))},_bind_actionbar_stalker:function(){if($("#actionbar-stalking-wrapper.actionbar_stalking").length)return;$("#actionbar-stalking-wrapper").stalker({offset:51,stalkerStyle:"actionbar_stalking"})},_canvas_mouseover_handler:function(e){if(window.isSelecting||window.isDragging)return;window.trigger_tooltip_timer&&clearTimeout(window.trigger_tooltip_timer),window.trigger_tooltip_timer=setTimeout(function(){Box.Application.getService("tooltips").triggerTooltips(e)},100);var t=Box_View_Handler.find_by_element(e.target);t&&t.event_mouseover&&t.event_mouseover(e);var n=Box_Behavior_Handler.find_by_element(e.target);return n&&(propagate_event=n.handle_event(e)),!0},_canvas_mouseout_handler:function(e){if(window.isSelecting||window.isDragging)return;window.trigger_tooltip_timer&&(clearTimeout(window.trigger_tooltip_timer),window.trigger_tooltip_timer=null);var t=Box_View_Handler.find_by_element(e.target);t&&t.event_mouseout&&t.event_mouseout(e);var n=Box_Behavior_Handler.find_by_element(e.target);return n&&(propagate_event=n.handle_event(e)),!0},_canvas_mouseup_handler:function(e){if(e.button!=Canvas.RIGHT_CLICK)return;if($j(e.target).is("input[type=text], textarea, .allow_right_click"))return;var t=Box_View_Handler.find_by_element(e.target);if(t)return t.handle_event(e)},_canvas_click_handler:function(e){if(e.button!=Canvas.LEFT_CLICK&&e.button!=Canvas.MIDDLE_CLICK)return!1;var t=$(e.target);if(t.hasClass("disabled")||t.hasClass("ignore_click"))return!1;if(t.hasClass("ignore_click_handler"))return!0;var n,r;for(n=0,r=this.body_click_handlers.length;n<r;n++)this.body_click_handlers[n].body_click_handler(e);Box.Application.getService("tooltips").hideTooltips();var i=Box_View_Handler.find_by_element(e.target);if(i){var s=i.handle_event(e);return!!s}var o=Box_Behavior_Handler.find_by_element(e.target);if(o){var s=o.handle_event(e);o=null;if(!s)return!1}},_canvas_mousedown_handler:function(e){var t=$(e.target);if(t.is(".ignore_mousedown"))return!1;if(!t.closest("[aria-haspopup]").length&&!t.closest(".overlay").length){var n=Box.Application.getService("overlay");n&&n.close()}var r=Box_View_Handler.find_by_element(e.target);if(r)return r.handle_event(e)},_set_user:function(){var e={},t=Box.Application.getGlobalConfig();e[t.userLogin]={id:t.userId,is_free_user:t.isFreeUser,login:t.userLogin,enterprise_id:t.enterpriseId,phone:t.userPhone,pic_urls:t.picUrls,features:t.features,public_name:t.publicName,name:t.publicName,email:t.userLogin,slave_status_id:t.slaveStatusId,company_name:t.companyName},typeof window.is_master!="undefined"&&(e[t.userLogin].is_master=window.is_master),this.users.set_params(e),this.user=this.users.find(t.userId)},_set_enterprise:function(){var e=0;if(typeof window.enterprise!="undefined"){var t={};e=window.enterprise.id||window.enterprise.enterprise_id,t[e]=window.enterprise,this.enterprises.set_params(t),this.enterprise=this.enterprises.find(Box.Application.getGlobalConfig("enterpriseId"))}},attach_events:function(){var e=this;if(this.view!="expanded"&&this.view!="icon")return;var t={},n=!0;for(var r in this.precall){var i=t[r];t[r]=!0,typeof i=="function"&&(t[r]=i()),t[r]||(n=!1)}if(!n)return!1;this.attach_selectable_events();var s,o=$(window).height(),u=$(window).width(),a=function(){var t=$(window).height(),n=$(window).width();if(t!=o||n!=u)o=t,u=n,e.fix_page_height(),e.fix_sidebar_height(),Box.Application.broadcast("pageresizecomplete")};$j(window).resize(function(){clearTimeout(s),s=setTimeout(a,200)}),$j(window).focus(function(){window.infocus=!0}),$j(window).blur(function(){window.infocus=!1})},attach_selectable_events:function(){if(!this.use_selectables)return;var e=this,t,n=[],r=Box.Application.getService("nav-state"),i=r.get();$j(this.collections[this.collections.length-1].items).each(function(t,r){r.element&&n.push($(r.element).get(0))}),n.length>0&&n[0]!=null?t=$j(n):t=$j("div.item",this.element),t.selectable({handle:this.view=="icon"?".thumb_large":null,ignore:".dnd, #j_popup, #folder_tree, #player, .checkbox_block, .item_expansion_comments, .item_expansion, .edit_description_text, .description_text, .sub_nav, .content_sidebar, .path_container",select:function(e){var t=e.id.split("_").pop(),n=Item.find(t);n&&n.select()},start:function(e){if(simpleBodyBlocker.on||$j.popup.get().length>0)return!1;if(i.isGallery)return!1},unselect:function(e,t){var n=e.id.split("_").pop(),r=Item.find(n);r&&r.unselect(t)}});if(this.use_dragdrop){var s=t;s.fast_draggable({clone:!0,ghost:!0,handle:this.view=="icon"?".thumb_large":null,ignore:".arrow, .item_expansion",revert:!0,scroll:!0,start:function(t){$j(t).removeClass("hover menu_open selected");var n=$j(".draggable_wrapper");n.length===0&&(n=$j('<div class="item_collection draggable_wrapper"></div>'));var r=e.view=="icon"?"icon_view":"list_view",i=e.view=="icon"?"list_view":"icon_view";n.removeClass(i).addClass(r).append(t).appendTo(document.body)}});var o=s;o.filter(function(){return $j(this).hasClass("folder")}).droppable({accept:".item",area:this.view=="icon"?".thumb_large":null,drop:function(t,n){e._handle_drop(t,n)},hoverClass:"receiving_drop"})}},_handle_drop:function(e,t){var n=e.id.split("_").pop(),r=Item.find(n),i=this.selection.collection.size()?this.selection.collection:this.target_item;i.move({target:r,autosubmit:!0,from:"Drag and Drop"})},change_view:function(e,t){t=t||{},e||(e=this.view=="expanded"?"icon":"expanded"),typeof t.expanded_list_view=="undefined"&&(t.expanded_list_view=this.expanded_list_view);var n=e=="icon"?"list":"icon",r=e=="icon"?"icon":"list";$j("#"+n+"_view_toggle").removeClass("sprite_16x16_"+n+"_view_selected").addClass("sprite_16x16_"+n+"_view"),$j("#"+r+"_view_toggle").removeClass("sprite_16x16_"+r+"_view").addClass("sprite_16x16_"+r+"_view_selected"),$j("#jquery_editable_input").length&&$j("#jquery_editable_input").blur();if(e!=this.view||this.expanded_list_view!=t.expanded_list_view){this.selection.unselect_all(),this.expanded_list_view=t.expanded_list_view,this.view=e;var i={expanded_list_view:this.expanded_list_view?1:0,view:this.view};$j.post("/index.php?rm=box_files_change_view",i);for(var s in this.collections)this.collections[s].change_view(this.view)}this.view=="icon"&&$j(".body").removeClass("disable_48x48_sprites"),this.fix_page_ui_issues(),this.attach_events(),Box.Application.broadcast("viewchange",{view:this.view})},fix_page_ui_issues:function(){this.fix_page_height(),this.fix_sidebar_height(),this.fix_ie_ellipsis()},fix_page_height:function(){var e=Box.Application.getService("nav-state");if(e.isEmbedWidget())return;var t=window.innerHeight||document.documentElement.clientHeight,n=$(".foot").outerHeight(),r=$(".head").outerHeight(),i,s=0;e.isGcm()?i=$(".sub_nav:visible").outerHeight():i=$(".subheader").outerHeight(),s=t-r-i-n,$(".body").css("min-height",s)},fix_sidebar_height:function(){var e=$(".body"),t=$(".right_col, .right_col_no_grid"),n=20;t.css("min-height",0);var r=t.height(),i=e.height(),s=i-n,o=s>r?s:r;t.css("min-height",o)},fix_ie_ellipsis:function(){var e=Box.Application.getService("browser");e.isMinBrowser("Explorer",8)&&setTimeout(function(){$(".ellipsis").filter("span, a").each(function(e,t){var n=$(this),r=n.css("max-width");r!=="none"&&n.outerWidth()>=parseInt(r.replace("px",""),10)&&(this.style.width=r)})},2500)},context:function(){var e={};if(this.shared_name||this.vanity_name)e.shared_item={shared_name:this.shared_name,vanity_name:this.vanity_name};return this.collab_invite_token&&(e.collab_preview_item={invite_token:this.collab_invite_token}),e},count_items:function(){var e=0;for(var t in this.collections)e+=this.collections[t].size();return e},reset:function(){this.selection.unselect_all(),this.collections=[]},construct_collection_classes:function(){var e=[],t=Box.Application.getService("nav-state"),n=t.get();return this.use_item_expansion.comments&&e.push("use_comments_expansion"),this.use_item_expansion.options&&e.push("use_options_expansion"),this.use_item_expansion.share&&e.push("use_share_expansion"),this.use_item_expansion.tasks&&e.push("use_tasks_expansion"),this.use_menu_shortcuts&&e.push("use_menu_shortcuts"),this.use_selectables&&e.push("use_selectables"),n.type!=="f"&&n.type!=="a"&&e.push("searching"),this.view!="icon"?e.push("list_view"):e.push("icon_view"),Canvas.get().expanded_list_view&&e.push("list_view_expanded"),e.join(" ")},page_count:null,page_size:null,current_page:null,init_pages:function(e,t){var n=$j("#top_pages"),r=$j("#mod-paging-bottom");if(typeof e=="undefined"||typeof e.current_page=="undefined"||typeof e.page_count=="undefined"){r.html(n.find("#paging_data").clone().attr("id","paging_data_bottom"));return}this.current_page=e.current_page,this.page_size=e.page_size,this.page_count=e.page_count,typeof e.paging_html!="undefined"&&(!e.reports_tab&&e.paging_html.indexOf("paging_menu")!=-1&&$j("#paging_menu").remove(),n.empty().html(e.paging_html)),r.html(n.find("#paging_data").clone().attr("id","paging_data_bottom")),r.find(".actionbar_pagination").attr("id","paging_label_bottom"),typeof t=="function"&&(this.update_page_callback=t)},update_page:function(e){if(!e||typeof this.update_page_callback!="function")return;Box_Menus.get().paging_menu&&(Box_Menus.get().paging_menu.current_page=e),this.update_page_callback(e),this.fix_page_ui_issues()},load:function(e){e=e||{};var t=Box.Application.getService("nav-state"),n=t.get(),r=e.background||!1;this.collaborated=e.collaborated||!1,this.current_page=e.current_page||0,this.use_dragdrop=e.use_dragdrop||!1,this.use_item_expansion=e.use_item_expansion||!1,this.use_menu_shortcuts=e.use_menu_shortcuts||!1,this.use_selectables=e.use_selectables||!1,e.path&&(this.path=e.path),e.permissions&&(this.permissions=e.permissions),e.view&&(this.view=e.view),n.type=="s"&&(this.expanded_list_view=!0);var i=e.container?$j(e.container).get(0):$j("#files"),s=$j(i).find(".item_collection"),o=e.items_html;if(this.view=="expanded"||this.view=="icon"){delete this.current_folder,e.folder&&(e.folder.type="folder",!e.folder.name&&e.folder.id==0&&(e.folder.name=$t("All Files","js_global_allfiles")),this.current_folder=Item.find_or_create(e.folder));var u=new ItemCollection({collaborated:this.collaborated,container:s,id:this.collections.length,maximum_items:e.maximum_items,nodes:e.nodes,permissions:this.permissions,removed_permissions:this.removed_permissions,shared_name:e.shared_name,update:e.update,view:this.view});e.folder&&(this.current_folder.children=u),this.collections.push(u);if(!r){!e.predisplay_items_html&&typeof o!="undefined"&&s.html(o);var a={file_view:e.file_view,page:e.page};e.skip_change_view?a.skip_change_view=!0:a.change_items_view_only=!0,u.render(a)}}this.attach_events(),$j.isFunction(this.on_load)&&this.on_load(),this.on_load=null},load_tags:function(e,t){var n="/index.php?rm=box_tag_get_tags",r=this,i=t&&t.partial?{partial:t.partial}:{};$j.getJSON(n,i,function(n){t&&t.partial=="my_tags"?r.tag_collection.my_tags=n.nodes||{}:r.tag_collection.tags=n.nodes||{},$j.isFunction(e)&&e(t)})},scroll_up:function(){if(this._scrolling)return;this._scrolling=!0;var e=$j(window).scrollTop(),t=this;$j("<div></div>").css("width",0).animate({width:100},{duration:250,step:function(t){$j(window).scrollTop(e-e*t/100)},complete:function(){t._scrolling=!1}})},openbox_unload:function(e){var t=e.service_name,n=e.confirmation_message,r=e.file_id,i=e.sha1,s=e.unlock,o=s?s.saves_back_file_upon_unlock:!1;box.after_load_callback=function(){var e=Item.find(r);n||e&&e.sha1!=i&&(t!="Web Documents"?n=$t('The %1 "%2" has been successfully modified by %3',"popup_openbox_service_successfully_modified_item",ItemTypeTranslation.singular(e.type),e.name,t):n=$t('The %1 "%2" has been successfully modified',"popup_openbox_webdoc_successfully_modified_item",ItemTypeTranslation.singular(e.type),e.name)),n&&Box.Application.getService("notifications").confirm(n);if(o){var s=Toaster.get();s.set_progress(100),s.hide();var u=e.j_element;u&&u.enable()}};if(s){if(o){var u=Item.find(r),a=u.j_element;a&&a.disable();var f=Toaster.get();f.toggle_cancel_link(!1),f.set_message($t("Saving %1 to Box...","popup_openbox_unload_saving_back",$.box.escapeHTML(u.name))),f.set_progress(10),f.set_fake_toaster(4e3),f.show({hide_cancel:!0})}var l,c=function(){$("html, body").hasClass("has_lightbox")?u&&typeof u.refresh=="function"?u.refresh(function(){Box.Application.broadcast("previewunlock")}):Box.Application.broadcast("previewunlock"):Box.Application.navigate("",{},{not_scroll:!0})};if(e.use_new_service_action_locking){l={lock_id:e.lock_id};var h=Box.Application.getService("ajax");h.post("box_api_file_action_lock_delete",l,{success:c,error:function(e){if(o){f.finish_fake_toaster(300);var t=$t("Sorry, we couldn't save that file back to Box. Please re-open it and try saving again.","popup_openbox_unload_saving_back_error",$.box.escapeHTML(u.name));Box.Application.getService("popups").alert(e.data||t)}}})}else l=s,$.ajax({type:"GET",url:"/api/1.0/rest",data:l,dataType:"xml",success:c})}else Box.Application.navigate("",{},{not_scroll:!0})}},{LEFT_CLICK:0,MIDDLE_CLICK:1,RIGHT_CLICK:2,get:function(){return Canvas.__instance||(Canvas.__instance=new Canvas),Canvas.__instance}});Box.Timing.execution.push({name:"js/box_action.js",time:(new Date).getTime()});var Action=Base.extend({constructor:function(e){e=e||{};if(!e.id)return!1;if(!e.object&&!e.collection)return!1;this.id=e.id,this.object=e.object,this[this.constructor.object_type]=this.object,this.collection=e.collection,this.options=e.options||{},this.name=this.id.toLowerCase().split("_").join(" "),this.name=="delete me"&&(this.name="delete");var t=Box.Application.getService("v5").get("current_rm");t=="box_files"?this.source="files":t=="box_v2_new_inbox"?this.source="updates":t=="box_shared_show_by_name"?this.source="shared_folder":t=="box_user_profile_view"?this.source="user_profile":t=="box_view_vanity_url"&&(this.source="vanity_url");if(!this.source||this.source=="unknown")this.source="shared_file";return!1},_invalid_items:{},collection:null,id:null,object:null,object_type:"",name:"",options:null,can_execute:function(){this._invalid_items={};var e=!1,t=this.constructor.required,n=this.object?[this.object]:this.collection?this.collection.objects:[];for(var r in n){var i=n[r];for(var s in t)for(var o in t[s]){var u=t[s][o];if(!u)continue;var a=typeof u!="boolean";if(a){if(u.apply(this))continue}else if(i[s]&&i[s][o])continue;this._invalid_items[s]||(this._invalid_items[s]=[],e=!0),this._invalid_items[s].push(i)}}return!e},cannot_execute_message:function(){Box.Application.getService("popups").alert($t("You cannot perform this action","js_cannot_perform_action"))}},{create:function(e,t,n,r){if((!r||r=={})&&t._actions&&t._actions[n])return t._actions[n];var i=Action.get_class_name(e,n);window[i]||Action.load_class(e,n);var s=new window[i]({id:n,object:t,options:r});if(!r||r=={})t._actions||(t._actions={}),t._actions[n]=s;return s},get_class_name:function(e,t){var n=e,r=t.split("_");for(var i in r)n+="_"+r[i].substr(0,1).toUpperCase()+r[i].substr(1).toLowerCase();return n},load_class:function(e,t){var n=e.toLowerCase(),r=Box.Application.getService("assets").getAssetURL(js_path,"actions/"+n+"/"+t+".js",!1);$j.ajax({async:!1,dataType:"script",url:r,cache:!0,no_context:!0});var i=Action.get_class_name(e,t),s=window[i];s.prototype.execute_without_test=s.prototype.execute,s.prototype.execute=function(){return this.can_execute()?(this.item&&!this.collection&&(Canvas.get().target_item=this.item),this.execute_without_test()):(this.cannot_execute_message(),null)},s.object_type=n,s.prototype[n]=null},register_actions:function(e,t){var n=window[e];for(var r in t){var i=t[r];Action.register_actions_helper(n,e,i)}n.prototype._actions=null},register_actions_helper:function(e,t,n){e.prototype[n]=function(e){var r=Action.create(t,this,n,e);return r.execute()},e.prototype["can_"+n]=function(e){var r=Action.create(t,this,n,e);return r.can_execute()}}});Box.Timing.execution.push({name:"js/box_task.js",time:(new Date).getTime()});var Task=Box_Object.extend({constructor:function(e){this.set_params(e)},set_params:function(e){this.base(e),this.process_permissions(e.permissions,Task.PERMISSION_CONSTANTS)},id:null,item:null,user_id:null,action:null,name:null,description:null,assign_to_new_collaborators:null,force_complete:null,due:null,completed:null,is_completed:null,is_completed_without_force:null,assignments:null,created:null,updated:null,user:null,can_assign_to_collaborators:null,can_assign_to_self:null,html:null,permissions:null,get_assignment_for_current_user:function(){for(var e in this.assignments)if(this.assignments[e].assignee.id==Canvas.get().user.id)return this.assignments[e];return null}},{PERMISSION_CONSTANTS:{view:"task_view",edit:"task_edit","delete":"task_delete",complete:"task_complete",rename:"task_rename",assign:"task_assign",create_mention:"create_mention",delete_mention:"delete_mention"},tasks:{},tasks_html:"",type:"task",DUE_DATE_DISPLAY_FORMAT:"M dd, yy",DUE_DATE_INCOMING_DB_FORMAT:"@",DUE_DATE_OUTGOING_DB_FORMAT:"mm/dd/yy"});Action.register_actions("Task",["delete_me","remind","update_due_date","change_action"]),Box.Timing.execution.push({name:"js/services/nav-state.js",time:(new Date).getTime()}),Box.Application.addService("nav-state",function(e){"use strict";function a(){var e=i.getCurrentWindowUrl(),t=i.getQueryParams(e);return $.extend({},n,t)}function f(e){var t;for(var r in e)n.hasOwnProperty(r)&&(n[r]=e[r],delete e[r]);$.isEmptyObject(e)||(t=i.createUrl(i.getCurrentWindowUrl(),e),History.pushState({navState:!0},document.title,t))}function l(e){return $(".body").attr("data-page-type")===e}function c(){var e=!1;try{e=s.top!==self}catch(t){e=!0}return e}var t={firstResultClick:!0,folderName:null,galleryId:null,gcmUserId:0,id:null,isGallery:!1,lastType:null,page:0,pinboardId:null,searchFilters:null,searchString:null,sort:null,sortDirection:null,subId:null,tags:null,trashFilter:null,type:"f",updateType:null,wasGallery:!1},n={application:null,fileVersionId:null,firstResultClick:!0,folderName:null,galleryId:null,gcmUserId:0,id:null,isGallery:!1,lastType:null,page:0,pinboardId:null,searchFilters:null,searchString:null,sort:null,sortDirection:null,subId:null,tags:null,trashFilter:null,type:"",updateType:null,wasGallery:!1},r=e.getService("v5"),i=e.getService("url"),s=r.get("window"),o=r.get("Item"),u=r.get("Previewer");return function(){if(c()&&typeof s.is_embed_widget=="undefined")try{var t={referer:document.referer||""},n=e.getService("logger");n.sendLog("navigation","NON_WIDGET_IFRAME",t)}catch(r){}}(),{galleryItem:function(){return typeof o!="undefined"?o.find(a().galleryId):null},getSearchFiltersFromString:function(e){var t,n,r=[],i,s,o;if(!e)return[];t=e.split("|");for(s=0,o=t.length;s<o;s++)n=t[s].split(":"),i=n.shift(),r.push({type:i,value:n.join(":")});return r},getSearchStringFromFilters:function(e){return $.isArray(e)?$.map(e,function(e){return e.type+":"+e.value}).join("|"):""},isShowingFiles:function(){return this.isFiles()||this.isSearch()||this.isTag()},isShowingSearchOrTag:function(){return this.isSearch()||this.isTag()},isRootFolder:function(){var e=a().id;return this.isFiles()?typeof o!="undefined"?e==o.ROOT_FOLDER_ID||e==s.root_folder_id:e==s.root_folder_id||e==0:!1},isTrash:function(){var e=a().id;return typeof o!="undefined"?e===o.TRASH_FOLDER_ID:e===1},isEmbedWidget:function(){return!!s.is_embed_widget},isSharedPage:function(){return typeof s.shared_folder!="undefined"&&typeof s.shared_name!="undefined"},isGcm:function(){return l("gcm")},isSharedFilePage:function(){return l("shared-file")},isSharedFolderPage:function(){return l("shared-folder")},isSharedPageOrEmbedWidget:function(){return this.isSharedFilePage()||this.isSharedFolderPage()||this.isEmbedWidget()},isProfile:function(){var e=r.get("box");return e?e.hist_name==="user_profile":!1},isFirstResultClick:function(){return a().firstResultClick},isMovingOutOfSearch:function(){return!this.isSearch()&&this.wasSearch()},isMovingIntoSearch:function(
){return this.isSearch()&&!this.wasSearch()},isMovingOutOfPreview:function(){var e=a();return e.wasGallery&&!e.isGallery},isPreviewerOpen:function(){return typeof u!="undefined"&&u.is_open},isSortedBy:function(e){return a().sort===e},getTypeSpecificId:function(e){var t=a();switch(e){case"s":return t.searchString;case"t":return t.tags;case"p":return t.pinboardId;default:return t.id}},setFirstResultClick:function(e){f({firstResultClick:e})},setCurrent:function(e){f({type:e,lastType:a().type})},setPrevious:function(){var e=a();f({lastType:e.type,wasGallery:e.isGallery})},setPage:function(e){f({page:e})},setNav:function(e){var t=a(),n={lastType:t.type,wasGallery:t.isGallery};n=$.extend({},n,e),f(n)},setSort:function(e,t){var n={sort:e};t&&(n.sortDirection=t),f(n)},resetSort:function(){f({sort:null,sortDirection:null})},setPreviewItem:function(e){f({isGallery:!0,galleryId:e,subId:e})},clearPreview:function(){f({isGallery:!1,galleryId:0,subId:0})},setItemInFiles:function(e,t,n){var r=a(),i={type:"f",lastType:r.type,isGallery:!1,page:n||0,id:e};t&&(i.folderName=t),f(i)},setPinboardNav:function(e,t){f({type:"p",lastType:a().type,pinboardId:e,id:e,page:t||0})},setTagsNav:function(e,t){e=i.decodePathComponent(e),f({type:"t",tags:e,id:e,page:t||0})},setSearchNav:function(e,t,n){f({page:t||0,id:e,searchString:e,searchFilters:n||""})},setSearchFilters:function(e){f({searchFilters:e})},setPreviewState:function(e){if(!e){this.clearPreview();return}parseInt(e,10)&&(e="f_"+e),this.setPreviewItem(e)},isUpdates:function(){return a().type==="a"},wasUpdates:function(){return a().lastType==="a"},setCurrentAsUpdates:function(){f({lastType:a().type,type:"a"})},isFiles:function(){return a().type==="f"},wasFiles:function(){return a().lastType==="f"},setCurrentAsFiles:function(){f({lastType:a().type,type:"f"})},isSearch:function(){return a().type==="s"},wasSearch:function(){return a().lastType==="s"},setCurrentAsSearch:function(){f({lastType:a().type,type:"s"})},isTag:function(){return a().type==="t"},wasTag:function(){return a().lastType==="t"},setCurrentAsTag:function(){f({lastType:a().type,type:"t"})},isGcmFiles:function(){return a().type==="gcm_files"},wasGcmFiles:function(){return a().lastType==="gcm_files"},setCurrentAsGcmFiles:function(){f({lastType:a().type,type:"gcm_files"})},isGcmSearch:function(){return a().type==="gcm_search"},wasGcmSearch:function(){return a().lastType==="gcm_search"},setCurrentAsGcmSearch:function(){f({lastType:a().type,type:"gcm_search"})},isGcmUsers:function(){return a().type==="gcm_users"},wasGcmUsers:function(){return a().lastType==="gcm_users"},setCurrentAsGcmUsers:function(){f({lastType:a().type,type:"gcm_users"})},isGcmQuarantine:function(){return a().type==="gcm_quarantine"},wasGcmQuarantine:function(){return a().lastType==="gcm_quarantine"},setCurrentAsGcmQuarantine:function(){f({lastType:a().type,type:"gcm_quarantine"})},isGcmQuarantinePreview:function(){return a().type==="gcm_quarantine_preview"},wasGcmQuarantinePreview:function(){return a().lastType==="gcm_quarantine_preview"},setCurrentAsGcmQuarantinePreview:function(){f({lastType:a().type,type:"gcm_quarantine_preview"})},isPinboard:function(){return a().type==="p"},wasPinboard:function(){return a().lastType==="p"},setCurrentAsPinboard:function(){f({lastType:a().type,type:"p"})},isAutomation:function(){return a().type==="admin_automation"},wasAutomation:function(){return a().lastType==="admin_automation"},setCurrentAsAutomation:function(){f({lastType:a().type,type:"admin_automation"})},isContacts:function(){return a().type==="contacts"},wasContacts:function(){return a().lastType==="contacts"},setCurrentAsContacts:function(){f({lastType:a().type,type:"contacts"})},isCorporateNetwork:function(){return a().type==="corporate_network"},wasCorporateNetwork:function(){return a().lastType==="corporate_network"},setCurrentAsCorporateNetwork:function(){f({lastType:a().type,type:"corporate_network"})},createNavObject:function(e){return $.extend({},t,e)},get:a,set:f}}),Box.Timing.execution.push({name:"js/services/nav-url.js",time:(new Date).getTime()}),Box.Application.addService("nav-url",function(e){"use strict";var t=e.getService("v5"),n=e.getService("url"),r=e.getService("nav-state");return{getSearchUrl:function(e,r,i){var s=n.encodePathComponent(e),o=i?"/"+n.encodePathComponent(i):"",u=t.get("path_prefix")||"";return r=r||0,"/"+u+"files/search/"+s+"/"+r+o},getSearchUrlForCollaboratorsPage:function(e,t){return"/contacts/search/"+t+"?search="+encodeURIComponent(e)},getFileUrl:function(e,n,i,s){var o=t.get("path_prefix")||"";return s||(s=r.get().type),"/"+o+"files/"+i+"/"+s+"/"+n+"/1/f_"+e},getUpdatesUrl:function(e,t){var n="/updates/"+t+"/a";return e&&(n+="/"+e),n},getProfileUrl:function(e,t){return"/profile/"+t+"/page/"+e},getFileUrlForUpdatesPage:function(e,t,n){return this.getUpdatesUrl(t,n)+"/1/"+e},getFileUrlForProfilePage:function(e,t,n){return this.getProfileUrl(t,n)+"/1/"+e},getFileUrlForSharedPage:function(e,n,r,i){var s=i.length===20?"s/":"shared/",o=t.get("path_prefix")||"";return"/"+o+s+i+"/"+r+"/"+n+"/"+e+"/1"},getFileUrlForVanityPage:function(e,t,n,r){return"/"+r+"/"+n+"/"+t+"/"+e+"/1"},getFolderUrl:function(e,t,r){return"/files/"+t+"/f/"+e+(r?"/"+n.encodePathComponent(r):"")},getSharedFolderUrl:function(e,t,n){var r=e.length===20?"s/":"shared/";return"/"+r+e+"/"+t+"/"+n},getVanityUrl:function(e,t,n){return"/"+e+"/"+t+"/"+n},getTagsUrl:function(e,t){return"/files/"+t+"/t/"+n.encodePathComponent(e)},getContactsUrl:function(e){return"/contacts/"+e},getCorporateNetworkUrl:function(e){return"/contacts/network/"+e},getFileUrlForPreview:function(n,i){var s=e.getService("v5").get("gallery_page"),o=r.get(),u=i||o.page,a=t.get("profile_user_id"),f=t.get("shared_name"),l=t.get("vanity_name");switch(s){case"files":return this.getFileUrl(n,r.getTypeSpecificId(o.type),u,o.type);case"inbox":return this.getFileUrlForUpdatesPage(n,o.updateType,u);case"profile":return this.getFileUrlForProfilePage(n,u,a);case"shared_folder":return this.getFileUrlForSharedPage(n,o.id,u,f);case"vanity_url":return this.getFileUrlForVanityPage(n,o.id,u,l);default:return!1}},getReturnUrlForPreview:function(){var n=e.getService("v5").get("gallery_page"),i=r.get(),s=i.type,o=i.page,u=i.searchFilters,a=i.id,f=t.get("profile_user_id"),l=t.get("shared_name"),c=t.get("vanity_name");switch(n){case"files":return i.type==="s"?this.getSearchUrl(r.getTypeSpecificId(s),o,u):this.getFolderUrl(r.getTypeSpecificId(s),o);case"inbox":return this.getUpdatesUrl(i.updateType,o);case"profile":return this.getProfileUrl(o,f);case"shared_folder":return this.getSharedFolderUrl(l,o,a);case"vanity_url":return this.getVanityUrl(c,o,a)}return r.isGcmQuarantinePreview()?this.getGcm(o,i.policyId,i.userId):r.isGcmSearch()?this.getGcmUrlForSearch(i.searchString,o,u):r.isGcm()?this.getGcmUrlForFiles(this.GcmUserId,a,o):!1},getGcmRootUrl:function(){return"/master/content"},getGcmUrlForFiles:function(e,t,n){return this.getGcmRootUrl()+"/"+e+"/"+t+"/"+n},getGcmUrlForPreview:function(e,t,n,r){return this.getGcmRootUrl()+"/"+e+"/"+t+"/"+n+"/"+r},getGcmUrlForQuarantine:function(e,t,n,r,i){var s,o=[];return t&&o.push("policy_id="+t),n&&o.push("user_id="+n),r&&o.push("before_id="+r),i&&o.push("after_id="+i),s=this.getGcmRootUrl()+"/quarantine/"+e,o.length&&(s+="/?"+o.join("&")),s},getGcmUrlForQuarantinePreview:function(e){return this.getGcmRootUrl()+"/quarantine/preview/"+e},getGcmUrlForSearch:function(e,t,r){var i=n.encodePathComponent(e),s=r?"/"+n.encodePathComponent(r):"";return t=t||0,this.getGcmRootUrl()+"/search/"+i+"/"+t+s},getGcmUrlForSearchPreview:function(e,t,r){var i=n.encodePathComponent(e);return t=t||0,this.getGcmRootUrl()+"/search/"+i+"/"+t+"/"+r}}}),Box.Timing.execution.push({name:"js/box_task_assignment.js",time:(new Date).getTime()});var Task_Assignment=Box_Object.extend({constructor:function(e){this.set_params(e)},set_params:function(e){this.base(e),this.process_permissions(e.permissions,Task_Assignment.PERMISSION_CONSTANTS)},id:null,email:null,task:null,assignee_user_id:null,assignee_invite_email:null,action:null,name:null,feedback:null,assign_to_new_collaborators:null,due:null,is_completed:null,completed:null,created:null,updated:null,permissions:null,assignee:null,j_element:null,user:null},{task_assignments:{},type:"task_assignment",PERMISSION_CONSTANTS:{view:"task_assignment_view",complete:"task_assignment_complete","delete":"task_assignment_delete",assign:"task_assignment_assign",create_mention:"create_mention",delete_mention:"delete_mention"}});Action.register_actions("Task_Assignment",["add_feedback","complete","delete_me","remind","change_status"]),Box.Timing.execution.push({name:"js/box_task_upload.js",time:(new Date).getTime()});var Task_Upload=Base.extend({j_input_container:null,upload_handler:null,task:null,constructor:function(e){this.j_input_container=e.j_input_container,this.task=e.task,this.init(this.task.id)},init:function(e){var t=$j('<ul class="inline_list ptm man img task_upload_input file_not_selected" />').attr("data-view_id","task_"+e).append($j('<li class="new_version_upload_cancel pan" style="display: none;"><span class="img icon sprite_12x12_delete"></span></li>')).append($j('<li class="new_version_upload_prompt" />').append($j('<span class="img icon sprite_14x14_upload" />')).append($j("<a />").text($t("Upload New Version","task_assignment_upload_new_version")))).append($j($j.parseHTML('<li><a class="new_version_name ellipsis ellipsis_300"></a></li>')));this.j_input_container.replaceWith(t),this.j_input_container=t},cancel:function(){delete this.upload_handler,this.j_input_container.find(".new_version_name").html(""),this.j_input_container.find(".new_version_upload_cancel").hide(),this.j_input_container.find(".new_version_upload_prompt").show()},select_file:function(){var e=this,t=Upload_Process.get().show_upload_new_version_popup({ok_text:$t("Attach to Task","js_popup_button_attach_to_task"),click_handler:function(){var n=Upload_Process.get(),r=n.get_selected_file(0);if(r){e.upload_handler=function(){t(null,null,r)};var i=n.get_file_name(r.file);e.j_input_container.find(".new_version_name").html(i),e.j_input_container.find(".new_version_upload_prompt").hide(),e.j_input_container.find(".new_version_upload_cancel").show()}$j.popup.close()}})},upload:function(){this.upload_handler&&(this.upload_handler(),delete this.upload_handler)}},{attach:function(e){e.find(".task_upload_input_placeholder").each(function(){var e=$(this),t=e.attr("data-task_id"),n=Task.find(t);if(!n)return;n.task_upload=new Task_Upload({j_input_container:e,task:n})})}});Box.Timing.execution.push({name:"js/box_collab.js",time:(new Date).getTime()});var Collab=Box_Object.extend({accepted:null,collaborators_count:null,collab_id:null,email:null,expiration:null,files_count:null,group_tag_id:null,invite_seen:null,item_id:null,item_name:null,item_permissions_id:null,item_type:null,item_user_name:null,name:null,permission:null,stat:null,user_id:null,tos_id:null,item_user_enterprise_id:null,tos_text:null},{type:"collab",MAX_NUMBER_OF_DOMAINS_TO_DISPLAY_IN_RESTRICT_COLLAB_WARNING_MESSAGE:3,direct_collab_on_item:function(e,t,n){if(!t)return;var r=t.id,i=null;for(var s in e)e[s].item_id==r&&(i?e[s].group_tag_id==0&&(i=e[s]):i=e[s]);return i},collab_form_submit:function(e){e=e||{};var t=e.emails||[],n=Loading_Buttons.get(),r=this,i=[],s,o,u=Item.DEFAULT_ROOT_FOLDER_ID,a=0,f,l;for(s in t){o=$j.trim(t[s]);if(!o)continue;if(!$j.box.isEmail(o))return alert($t("The email address is invalid.","invalid_email")),!1;i.push(o)}u.substr(0,2)=="d_"&&(u=u.substr(2));if(box.collab_item_id=="d_"+u)return Box.Application.getService("popups").alert($t("The root folder can not be selected for collaboration.","collaborators_js_alert_root_folder")),!1;if(!e.folder_typed_id&&!box.collab_item_id)return Box.Application.getService("popups").alert($t("Please select a folder to invite collaborators to.","collaborators_js_alert_select_folder")),!1;if(!i.length)return Box.Application.getService("popups").alert($t("Please enter at least one email","collaborators_js_alert_enter_atleast_one_email")),!1;for(s in collab_permissions)a++;l=$j("#collaborators_permissions").val(),f=l||e.permission;var c=e.message||"";Box_Event_Tracker.get().send(1);var h=Box.Application.getService("url"),p=h.getGcmCompatibleRmUrl("box_collaborate_invite"),d={email:i.join(","),email_message:c,node_id:e.folder_typed_id||box.collab_item_id,notify:1,permissions:f},v=$j.box.formatQuery(d);n.start({btn_ok:$j("#btn_collab_form_submit a"),btn_ok_txt:$j("#btn_collab_form_submit span.center")}),$j.postJSON(p,v,function(t){var n=Collab.get_confirmation_message(t),i=0,s=!1,o=!1,a={},f=Box.Application.getService("nav-state");t.invited_users&&(i=t.invited_users.length);if(!i&&t.error){$.popup.alert(n.title,n.message);return}t.not_within_owner_company&&t.not_within_owner_company.length&&$.popup.alert(n.title,n.message);if(!$j("#email_label").length&&!e.skip_reload)if(f.isPreviewerOpen()){var l=f.get();(l.id==""||l.id!="0"&&l.id!=u.substr(2))&&Box.Application.broadcast("x-collabchange")}else{o=!0,s=!0;if(!t.not_within_owner_company||!t.not_within_owner_company.length)r._show_notification(n),Collab._show_or_hide_expansion_based_on_message_success(n,t);e.location=="all-files"&&Item.find(d.node_id.substr(2)).expansion.toggle("Item_Feed"),f.isGcm()&&(a.hideElementsForGCM=!0),Box.Application.broadcast("x-collabchange",a)}o||r._show_notification(n),s||typeof e.callback=="function"&&e.callback()})},_show_or_hide_expansion_based_on_message_success:function(e,t){e.type!="error"&&t.collabs[0].item.expansion.hide()},_show_notification:function(e){var t=Box.Application.getService("notifications");e.type==="error"?t.error(e.title,{description:e.description}):t.confirm(e.title,{description:e.description})},merge_permissions:function(e){var t=!1,n=!1,r=!1,i=!1,s=!1,o=!1,u=!1;for(var a in e)if(e[a]=="Editor")t=!0;else if(e[a]=="Viewer")n=!0;else if(e[a]=="Previewer")r=!0;else if(e[a]=="Uploader")i=!0;else if(e[a]=="Co-owner")u=!0;else if(e[a]=="Previewer+Uploader"||e[a]=="Previewer Uploader")s=!0;else if(e[a]=="Viewer+Uploader"||e[a]=="Viewer Uploader")o=!0;if(u)return"Co-owner";if(t)return"Editor";if(o)return"Viewer+Uploader";if(n)return i||s?"Viewer+Uploader":"Viewer";if(s)return"Previewer+Uploader";if(i)return r?"Previewer+Uploader":"Uploader";if(r)return"Previewer"},get_translated_role_by_role_name:function(e){e=e.toLowerCase().replace(" ","_").replace("-","_");switch(e){case"owner":return $t("Owner","collab_role_owner");case"co_owner":return $t("Co-owner","collaborate_type_Co_owner");case"editor":return $t("Editor","collaborate_type_editor");case"previewer":return $t("Previewer","collaborate_type_previewer");case"previewer+uploader":return $t("Previewer Uploader","collaborate_type_previewer_uploader");case"uploader":return $t("Uploader","collaborate_type_uploader");case"viewer":return $t("Viewer","collaborate_type_viewer");case"viewer+uploader":return $t("Viewer Uploader","collaborate_type_viewer_uploader")}},_get_alert_popup_message:function(e){var t,n="";if(e.error)e.error=="Cannot invite self as a collaborator"?n=$t("Sorry, you can't collaborate with yourself.","collaborators_js_alert_yourself"):e.error=="User is already a collaborator"?n=$t("You're already collaborating with this person.","collaborators_js_alert_already_collaborated"):n=$t("We were unable to add the collaborators you specified.","collaborators_js_alert_default"),t=$t("Add Collaborator Alert","collaborators_js_alert_title");else{t=$t("Invitations Restricted","collaborators_js_alert_restricted_title");if(e.within_owner_company&&e.within_owner_company.length){var r=e.within_owner_company.join(", ");n+=['<div class="media">','<span class="img sprite_16x16_green_checkmark"></span>','<span class="bd">',$t("Invitations were successfully sent to:","collaborators_js_alert_within_company_invites"),"<br />",'<span class="standard">'+r+"</span>","<br /><br /></span>","</div>"].join("")}if(e.not_within_owner_company&&e.not_within_owner_company.length){var i=e.not_within_owner_company.join(", ");n+=['<div class="media">','<span class="img sprite_16x16_error"></span>','<span class="bd">',$t("Invitations could not be sent to:","collaborators_js_alert_not_within_company_invites"),"<br />",'<span class="standard">'+i+"</span>","<br /><br /></span>","</div>"].join(""),e.owner_enterprise_desc_domain?n+=$t("Collaboration invitations can only be sent to people with an email address at %1","collaborators_js_alert_restricted_invites_info_message",e.owner_enterprise_desc_domain):n+=$t("Collaboration invitations can only be sent to people within the item owners enterprise","collaborators_js_alert_restricted_invites_to_enterprise_info_message")}}return{title:t,message:n}},get_confirmation_message:function(e){var t="",n=Canvas.get().user.email;if(e.error||e.not_within_owner_company&&e.not_within_owner_company.length)return this._get_alert_popup_message(e);if(!e.invited_users.length&&e.deactivated_invitees.length)return{type:"error",title:$t("Sorry, you can not invite deactivated users to collaborate.","collaborators_js_alert_deactiavted_users")};if(!e.invited_users.length&&e.already_collaborated.length)return $.inArray(n,e.already_collaborated)!=-1?t=$t("Sorry, you can't collaborate with yourself.","collaborators_js_alert_forever_alone"):t=$t("You're already collaborating with this person.","collaborators_js_alert_already_collaborated"),{type:"error",title:t};if(e.invited_users.length>0){e.collab=e.collabs[0];var r=e.invited_users.length;r==1?t=$t("A collaborator was invited.","invite_one_collab_success"):t=$t("%1 collaborators were invited.","invite_multi_collab_success",r);var i="";return e.expires&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_collab.js:12161","2013-05-15","auto tombstoned"),i=e.invited_users.length>1?$t("These collaborators will be automatically removed on %1.","yellow_message_confirmation_collab_expiration_s",e.expires):$t("This collaborator will be automatically removed on %1","yellow_message_confirmation_collab_expiration_p",e.expires)),{type:"confirm",title:t,description:i}}},_should_use_js_load:function(){return window.box&&box.hist_name=="files"},getCollabWarningWhenCollabRestrictedForItemOwner:function(e){var t=$t("Collaboration invitations can only be sent to people within the item owners company","js_popup_collaborate_restrict_collab_default_warning");return e?$t("Collaboration invitations can only be sent to people within %1","js_popup_collaborate_restrict_collab_within_enterprise_warning",e):t},parseEnterpriseDomains:function(e){var t={firstThreeDomains:e,numberOfLeftoverDomains:0,leftoverDomains:null},n=$.box.escapeHTML(e).split(",");if(n.length>Collab.MAX_NUMBER_OF_DOMAINS_TO_DISPLAY_IN_RESTRICT_COLLAB_WARNING_MESSAGE){var r=n.slice(0,3).join(","),i=n.slice(3,n.length);t.firstThreeDomains=r,t.numberOfLeftoverDomains=i.length,t.leftoverDomains='<span class="sprite_16x16_info list_img list_img_inside_label" data-htmltooltip="'+i.join("<br>")+'"></span>'}return t},render_restricted_email_popup:function(e,t,n){var r="",i=!1,s,o=null;t&&t.user_id?(s=User.find(t.user_id),o=t.owner_enterprise_display_domain):s=Canvas.get().user,s&&(i=s.is_external_collab_restricted);var u="";if(i||t&&t.restrict_collab_to_company)u=Collab.getCollabWarningWhenCollabRestrictedForItemOwner(o);for(var a=0,f=e.length;a<f;a++)r+='<li class="folder_collab_user"><div class="media"><div class="bd">'+e[a]+"</div></div></li>";var l=$j("<div/>"),c="<strong>"+$t("Invitations could not be sent to","invitations_not_sent")+':</strong></div><ul class="list_ext cntr scrollable cntr_squared">'+r+"</ul><div>"+u;l.html(c),$j.popup.alert($t("Invitations Restricted","collab_popup_invitation_restricted_modal_title"),l,null,n)},invite_selected_collaborators:function(e,t){var n=e.get_restricted_and_unrestricted_collab_emails(),r=n.restricted_collab_emails,i=n.unrestricted_collab_emails,s=function(){i.length&&Collab.collab_form_submit({message:$t("I'd like to share my files with you on Box","collab_invite_default_share_message"),folder_typed_id:t.typed_id,folder_name:t.name,permission:"Editor",location:"all-files",emails:i})};r.length?Collab.render_restricted_email_popup(r,t,s):i.length?s():Box.Application.getService("popups").alert($t("Please enter at least one email","collaborators_js_alert_enter_atleast_one_email"))},render_restricted_collab_warning_flyout:function(e,t,n){var r='<div style="margin-left:-315px; margin-top:-25px;" class="cntr bubble bubble_sidebar pvs">	<span class="arrow" style="margin-top:-20px"></span>	<div class="media">		<div class="img icon sprite_48x48_collab_folder mlm"></div>		<div class="bd pvs phm"><p class="lh16 js_collab_warning"></p></div>	</div></div>',i=$j(r);i.attr("id",t),i.find(".js_collab_warning").text(n),e.prepend(i),e.mouseenter(function(){$j("#"+t).show()}),e.mouseleave(function(){$j("#"+t).hide()})}});Action.register_actions("Collab",["accept"]),Box.Timing.execution.push({name:"js/box_item.js",time:(new Date).getTime()});var Item=Box_Object.extend({_actions:null,_events_attached:!1,_index:null,all_collaborators_loaded:null,allow_invite_collaborators:!0,available_permissions:null,app_integration_info:null,can_change_share_expiration:!0,can_change_delete_expiration:!0,can_invite_collaborators:!0,children:null,clickable:null,collaborated:null,collaborations:null,collaborators_count:0,collection:null,comments_count:null,created:0,created_by:null,created_by_user_id:null,date:null,description:null,element:null,embed_hash:null,expansion:null,expirations:null,extension:null,files:null,files_count:0,file_content_excerpt:null,comments_excerpt:null,file_id_hash:null,flash:null,folder:null,has_pic_x:null,hostname:null,custom_shared_link_root:"",hide_collaborators:0,id:null,image:null,is_deleted:!1,is_trash_disabled:null,is_infinite:null,is_executable:!1,is_trash_folder:!1,is_quarantined:!1,index_by_search_engine:0,item_override:!1,is_synced_for_current_user:!1,item_feed_count:null,lock:null,notify_comments_folder:!1,notify_comments_user:!1,notify_download_folder:!1,notify_download_user:!1,notify_upload_folder:!1,notify_upload_user:!1,name:null,owner:null,owner_enterprise_display_domain:"",owner_enterprise_desc_domain:"",owner_id:0,owner_is_free:!0,owner_enterprise_id:null,owner_disabled_shared_download:!1,open_collab_invite_permission:null,params:null,parent:null,is_self_or_ancestor_collaborated:!1,parent_hide_collaborators:0,has_password:!1,path:null,permissions:null,pic_x:null,previous_versions:null,removed_permissions:null,restrict_collab_to_company:null,referencing_integration_pic:null,raw_size:0,restrict_invite_privelege_by_enterprise:0,selected:!1,sha1:null,shared:null,shared_access:null,shared_access_levels:null,shared_link:null,shared_name:null,shared_download_off:!0,shared_views:0,sharing_disabed:!1,sharing_disabled_on_user:!1,sharing_disabled_on_parent:!1,show_comments_disable_option:!1,tags:null,task_count:null,task_to_complete:null,tasks:null,tasks_html:null,thumb_class_x_small:null,trash_time:null,type:null,typed_id:null,uniq_name:null,update:null,url:null,url_for_page_link:"",user_is_collab:null,user_is_owner:null,vanity_name:null,version_count:null,upload_id:null,max_upload_size:null,free_space_amount:null,owner_enterprise_disable_open_custom_links:!1,constructor:function(e){e=e||{},this._index=e.index,this.all_collaborators_loaded=e.all_collaborators_loaded||!1,this.allow_invite_collaborators=e.allow_invite_collaborators,this.available_permissions=e.available_permissions||{},this.can_change_delete_expiration=e.can_change_delete_expiration,this.can_change_share_expiration=e.can_change_share_expiration,this.can_invite_collaborators=e.can_invite_collaborators,this.children=e.children;var t=e.granted_permissions?e.granted_permissions:e.permissions;this.process_permissions(t,Item.PERMISSION_CONSTANTS),this.clickable=(e.type!="file"||this.permissions.download||this.permissions.preview)&&(!this.permissions||!this.permissions.restore&&!this.permissions.delete_from_trash),this.collaborated=e.is_collab_mini||e.collaborated||!1,this.collaborations=e.collaborations||null,this.collaborators_count=parseInt(e.collaborators_count),this.collection=e.collection||new ItemCollection({view:Canvas.get().view}),this.comments_count=parseInt(e.comments_count)||0,this.created_by=e.created_by||e.owner,this.created_by_user_id=e.created_by_user_id||!1,this.created=e.created||!1,this.custom_link=e.custom_link||"",this.date=e.date||"",this.description=e.description||"",this.direct_shared_link=e.direct_shared_link||"",this.embed_hash=e.embed_hash||"",this.extension=e.extension||"",this.file_content_excerpt=e.file_content_excerpt||"",this.comments_excerpt=e.comments_excerpt||"",this.file_id_hash=e.file_id_hash||"",this.files=e.files||0,this.files_count=e.files_count||0,this.flash=e.flash||!1,this.folder=e.folder,this.folder_id=e.folder_id,this.hide_collaborators=e.hide_collaborators==1,this.hostname=e.hostname||"",this.custom_shared_link_root=e.custom_shared_link_root||"",this.image=e.image==1,this.index_by_search_engine=e.index_by_search_engine||0,this.is_app_folder=e.is_app_folder||!1,this.is_trash_disabled=e.is_trash_disabled,this.is_infinite=e.is_infinite,this.is_deleted=e.is_deleted||!1,this.is_quarantined=e.is_quarantined||!1,this.is_executable=e.is_executable,this.is_trash_folder=e.is_trash_folder||!1,this.is_synced_for_current_user=e.is_synced_for_current_user,this.last_updated_by=e.last_updated_by||e.owner,this.last_updated_by_user_id=e.last_updated_by_user_id||null,this.lock=e.lock,this.locked=e.locked,this.concurrently_locked=e.concurrently_locked,this.locked_key=e.locked_key,this.name=e.name||"",this.owner=e.owner||"",this.owner_enterprise_display_domain=e.owner_enterprise_display_domain||"",this.owner_enterprise_desc_domain=e.owner_enterprise_desc_domain||"",this.owner_id=e.owner_id||"",this.show_comments_disable_option=e.show_comments_disable_option,this.owner_is_free=typeof e.owner_is_free!="undefined"?e.owner_is_free:!0,this.owner_enterprise_id=e.owner_enterprise_id,this.owner_disabled_shared_download=e.owner_disabled_shared_download||!1,this.open_collab_invite_permission=e.open_collab_invite_permission||"",this.parent=e.parent,this.is_self_or_ancestor_collaborated=e.is_collab_mini||e.is_self_or_ancestor_collaborated||!1,this.parent_hide_collaborators=e.parent_hide_collaborators||!1,this.partner_tags=e.partner_tags||null,this.has_password=e.has_password||!1,this.path=e.path,this.previous_versions=e.previous_versions||null,this.removed_permissions=e.removed_permissions,this.referencing_integration_pic=e.referencing_integration_pic,this.raw_size=e.raw_size,this.restrict_collab_to_company=e.restrict_collab_to_company,this.restrict_invite_privilege_by_enterprise=e.restrict_invite_privilege_by_enterprise,this.sha1=e.sha1||"",this.shared=e.shared||!1,this.shared_access=typeof e.shared_access=="number"?e.shared_access:null,this.shared_access_levels=e.shared_access_levels||null,this.shared_link=e.shared_link||"",this.shared_name=e.shared_name||"",this.shared_download_count=parseInt(e.shared_download_count)||0,this.shared_preview_count=parseInt(e.shared_preview_count)||0,this.shared_download_off=e.shared_download_off||"",this.shared_views=e.shared_views||0,this.sharing_disabled=e.sharing_disabled||"",this.sharing_disabled_on_parent=e.sharing_disabled_on_parent||"",this.sharing_disabled_on_user=e.sharing_disabled_on_user||"",this.owner_enterprise_disable_open_custom_links=e.owner_enterprise_disable_open_custom_links||!1,this.size=e.size||"",this.tags=e.tags,this.task_count=parseInt(e.task_count)||0,this.thumb_class_x_small=e.thumb_class_x_small||"",this.thumb_class_small=e.thumb_class_small||"",this.thumb_class_large=e.thumb_class_large||"",this.has_task_to_complete=e.has_task_to_complete||!1,this.expirations=e.expirations||{},this.pic_x=e.pic_x,this.has_pic_x=e.has_pic_x,this.trash_time=e.trash_time,this.uniq_name=e.uniq_name,this.update=e.update,this.use_created=e.use_created||!1,this.user_id=e.user_id,this.user_is_collab=e.user_is_collab||!1,this.user_is_owner=e.user_is_owner||!1,this.url=e.url||"",this.url_for_page_link=e.url_for_page_link||"",this.vanity_name=e.vanity_name||"",this.version_count=e.version_count||0,this.upload_id=e.upload_id||"",this.element=e.element,this.max_upload_size=e.max_upload_size,this.free_space_amount=e.free_space_amount,this.small_thumb=e.small_thumb,this.is_hidden_external_collab=e.is_hidden_external_collab,this.service_id=e.service_id||0,this.service_name=e.service_name||"",this.item_feed_count=this.comments_count+this.task_count,this.id="id"in e?e.id:"",this.type=e.type||"file",this.typed_id="typed_id"in e?e.typed_id:"",!e.folder&&this.type!="folder"&&(this.folder=Item.find(this.parent)),this.typed_id==""&&this.id!=""&&(this.typed_id=Box_Object._get_typed_id(this,!0));if(this.id==""&&this.typed_id!=""){var n=Box_Object._get_type_and_id(this.typed_id);this.type=n.type,this.id=n.id}Canvas.get().use_item_expansion!={}&&(this.expansion=new ItemExpansion({item:this})),this.shared&&this.shared_link&&!this.shared_name&&(this.shared_name=this.shared_link.replace(/.*\//,"")),e.missing_thumbnails&&Item.add_to_items_with_missing_thumbnails(this),this.params=e.old_params||{},this.base()},set_params:function(e){e=e||{},this.base(e);var t=e.granted_permissions?e.granted_permissions:e.permissions;return this.process_permissions(t,Item.PERMISSION_CONSTANTS),this},update_params_and_render:function(e,t){var n=Box.Application.getService("nav-state"),r=n.get();if($.isEmptyObject(e))return;this.set_params(e),this.j_element&&this._update_view_list_or_icon(e,t),this.type=="folder"&&this==Canvas.get().current_folder&&this._update_view_current_folder(e,t),this.type==="file"&&r.galleryId===this.typed_id&&this._update_view_gallery(t),$j.selectable("refresh"),$j.fast_draggable("refresh")},_update_view_list_or_icon:function(e,t){var n=this,r=t.just_refreshed;if(!r){this.refresh(function(n){t.just_refreshed=!0,n.update_params_and_render(e,t)});return}if(!$.isEmptyObject(e)){var i=Box.Application.getService("dom");i.addClass(this.j_element[0],"is-highlighted"),window.setTimeout(function(){i.removeClass(n.j_element[0],"is-highlighted")},3e3)}},_update_view_current_folder:function(e,t){if(e.created_children){var n=$j.size(e.created_children)>0;for(var r in e.new_version_children){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_item.js:15337","2013-05-15","auto tombstoned");if(n)break;var i=Box_Object.find_by_typed_id(e.new_version_children[r]);n=!i.new_version}if(n){var s=e.created_children.concat(e.new_version_children),o=$j("<span></span>").html(t.message.replace(/<br\s?\/?>/," ")+". "),u=this,a=$j('<a href="#"></a>').text($t("Show","realtime_refresh_folder")).click(function(){return u.open({display_on_top_typed_ids:s,callback:function(){for(var e in s){var n=Box_Object.find_by_typed_id(s[e]);if(!n)continue;t.just_refreshed=!0,n.update_params_and_render({created_or_new_version:!0},t)}}}),!1});o.append(a),Box_Confirmation_Message.get().show_confirmation(o)}}},_update_view_gallery:function(e){var t;e&&e.just_refreshed&&(t=Box.Application.getService("notifications"),t.warn($t("A new version of this file is available. Would you like to refresh the page?","item_notification_new_version_refresh"),{containerNode:".preview-notification",action:{text:$t("Yes","js_Yes"),onclick:function(){t.hide(),Box.Application.navigate("")}}}))},_attach_events:function(){if(this._events_attached)return;this._events_attached=!0},_render_classes:function(){var e=$j(this.element),t=["item_mouseover_handler",this.type];e&&e.hasClass("mini_item")?t.push("mini_item"):t.push("item"),this.concurrently_locked?t.push("concurrently_locked"):this.locked_key?t.push("locked_key"):this.locked&&t.push("locked"),this.clickable||t.push("not_clickable"),this.comments_count>0&&t.push("has_comments"),this.task_count>0&&t.push("has_tasks"),(this.comments_count>0||typeof shared_folder=="undefined"&&this.task_count>0)&&t.push("has_item_feed"),this.description&&this.description.length>0&&t.push("has_description"),this.extension=="mp3"&&t.push("song"),(this.extension=="webdoc"||!this.permissions.download)&&t.push("not_downloadable"),this.is_deleted&&t.push("deleted"),this.flash&&t.push("play"),(this.image||this.flash)&&t.push("previewable"),this.permissions.share||t.push("not_shareable"),this.permissions.create_comment||t.push("not_commentable"),this.shared&&t.push("shared"),$.isEmptyObject(this.tags)||t.push("has_tags"),this.permissions.synchronize&&this.is_synced_for_current_user&&(t.push("is_synced"),this.is_synced_for_current_user==CONST.BOX_ITEM_SYNC_PARTIALLY_SYNCED?(t.push("partially_synced"),e.find(".sync").attr({"data-hover":"tooltip","aria-label":$t("Some Items Synced","item_tooltip_partially_synced"
)+"|"+$t("Box Sync is enabled for some items in this folder.","item_tooltip_is_partially_synced")})):e.find(".sync").attr({"data-hover":"tooltip","aria-label":$t("Synced","item_tooltip_desktop_sync")+"|"+$t("Box Sync is enabled for all items in this folder.","item_tooltip_is_synced")})),this.is_hidden_external_collab&&(t.push("disabled"),t.push("hidden_external_collab")),e.hasClass("has_comments")&&t.push("has_comments"),e.hasClass("has_item_feed")&&t.push("has_item_feed"),this._is_inbox_or_profile_gallery_page()&&t.push("inbox_item"),this.element&&(this.element.className=t.join(" ")),Canvas.get().view!="icon"&&(Canvas.get().expanded_list_view||this._is_inbox_or_profile_gallery_page())?(e.find(".tags")[this.tags?"show":"hide"](),e.find(".partner_tags")[this.partner_tags?"show":"hide"]()):e.find(".tag_container")[Canvas.get().expanded_list_view?"show":"hide"](),this.description?e.find(".old_description").show():e.find(".old_description").hide(),Canvas.get().view=="icon"?(e.find(".search_path").hide(),e.find(".select").hide()):(e.find(".search_path").show(),this._is_inbox_or_profile_gallery_page()||e.find(".select").show());var n=Box.Application.getService("v5").get("current_rm"),r=n=="box_shared_show"||n=="box_shared_show_by_name"||n=="box_view_vanity_url";r||this.render_share_indicator()},render_share_indicator:function(){var e=$j(".share_menu_indicator"+this.id);this.shared?(e.removeClass().addClass("share_menu_indicator"+this.id+" share_menu sprite_16x16_horizontal_grey_link"),e.show()):e.hide()},_render_init:function(e){var t=this.element&&$(this.element).parents("body").length;if(t)return;e||(this.element=document.getElementById(this.typed_id),t=this.element),t||(this.element=document.getElementById("c"+this.collection.id+"_"+this.typed_id));if(!this.element)return;this.j_element=$j(this.element),this.element.id.indexOf("c")!==0&&(this.element.id="c"+this.collection.id+"_"+this.typed_id)},render_tags:function(e){var t;e=e||{};if(e.force_render_tags||Canvas.get().view!="icon"&&Canvas.get().expanded_list_view){var n=e.container_elem?$j(e.container_elem):$j(this.element),r=n.find(".tags"),i=n.find(".partner_tags"),s,o=!1,u,a=0;r.empty(),i.empty(),n.find(".update-icon_separator").hide();if(!$.isEmptyObject(this.tags)){for(t in this.tags)s=this.tags[t];for(t in this.tags){var f=this.tags[t];u=$j('<span class="badge upgrade" />').append($j('<a href="#" class="tag_name" />').attr("id","t_"+f).text(f)),r.append(u),r.append(" "),a+=1}r.nextAll(".update-icon_separator:first").show(),r.parent().show(),r.show()}else r.hide();if(a>0||e.show_add_tags_button_for_zero_tags)if(this.permissions.create_tag){var l;a===0?l=$t("Add a tag to this %1","js_part_item_menu_add_tag_tooltip",ItemTypeTranslation.singular_from_item(this)):l=$t("Add or edit tags on this %1","js_part_item_menu_add_or_edit_tag_tooltip",ItemTypeTranslation.singular_from_item(this));var c=$j('<span class="tag_item" />').append($j('<a href="#" class="tag sprite_item_list_addtag add_tag_button" data-type="add-tag-btn" />').attr({"data-hover":"tooltip","aria-label":l}));r.append(c),r.show()}if(!$.isEmptyObject(this.partner_tags)){for(t in this.partner_tags)s=this.partner_tags[t];for(t in this.partner_tags){var h=this.partner_tags[t],p=h.partner_data.partner_name.toLowerCase().replace(/ /g,"_"),d=["ignore_click","tag_name","badge","partner_tag_name",p];h.partner_object_type=="Enterprise"&&d.push("public_partner_tag");var v=d.join(" "),m="/referencing/"+h.partner_data.partner_name+"/"+h.partner_object_type+"/"+h.partner_object_id,g="t_"+$.box.escapeHTML(h.tag_name),y=h.partner_data.pic_url,b=$j('<a target="_blank" />').attr({href:m,id:g,"class":v}).text(h.display_name+" ");y&&b.prepend("&nbsp;").prepend($j('<img class="partner_tag_icon" />').attr("src",y)),i.append(b),s!=h&&i.append(" ")}i.nextAll(".update-icon_separator:first").show(),i.parent().show(),i.show()}else o&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_item.js:15370","2013-05-15","auto tombstoned"),i.hide())}},_render_description_text:function(e){$j("#edit_description_text_"+this.id).html($.box.escapeHTML(e))},_render_metadata:function(){var e=$j(this.element);this.description?this._render_description_text(this.description):e.find(".old_description").length&&e.find(".old_description").remove();var t=this;this._is_inbox_or_profile_gallery_page()&&$j(".edit_description").each(function(){t._render_description_text(this.description)});var n=e.find(".share_link");n.html($t("Share","js_part_item_menu_main_share")),this.type=="web_link"&&$j("#web_link_url_"+this.id).attr({href:$.box.escapeHTML(this.url),title:$.box.escapeHTML(this.url)}).fastText(this.url)},_render_path:function(){var e=Box.Application.getService("nav-state"),t=e.get(),n=Box.Application.getService("nav-url");if(t.type==="f"&&(!Canvas.get().current_folder||!Canvas.get().current_folder.is_trash_folder)||t.type==="a")return;var r=$j(this.element),i=r.find("#path_"+this.id);i.empty();for(var s in this.path){var o=this.path[s],u=s.substr(2),a=$j("<li></li>");$j("<a></a>").attr({href:n.getFolderUrl(u,0,o.name),"data-type":"path-anchor"}).fastText(o.name).appendTo(a),o.last||a.append($j('<span class="delimiter" />').text(box_path_delimiter_char)),a&&a.appendTo(i)}},_render_expirations:function(){var e=$j(this.element),t=this.expirations.unshare,n=this.expirations["delete"],r=$j("#link_info_"+this.id);if(t){var i=$t("Link disables on %1","js_part_item_auto_unshare_on",t);this.can_change_share_expiration&&(i='<a href="#" class="alert">'+i+"</a>"),r.show().find(".js_enabled_text").html('<span class="expiration_unshare alert">'+i+"</span>").show()}else r.length&&r.find(".js_enabled_text").text("").hide();var s=$j("#expiration_delete_"+this.id);if(n){if(!s.length){var o=r.parent();s=$j("<li />").attr("id","expiration_delete_"+this.id).appendTo(o)}var u;this.type=="folder"?u=$t("Folder deletes on %1","js_part_item_folder_auto_delete_on",n):u=$t("File deletes on %1","js_part_item_auto_delete_on",n),this.can_change_delete_expiration&&(u='<a href="#" class="alert">'+u+"</a>"),s.html('<span class="expiration_delete">'+u+"</span>").show()}else s.length&&s.text("").hide();n?(s.length&&s.addClass("last-child"),r.length&&r.removeClass("last-child")):(r.length&&r.addClass("last-child"),s.length&&s.removeClass("last-child"));var a=e.find('[data-type="stats"]');if(a){var f=this._create_link_stats_tooltip();a.attr("data-htmltooltip",f)}},_create_link_stats_tooltip:function(){var e=this.shared?$t("Enabled","js_enabled_capitalized"):$t("Disabled","js_disabled_capitalized");return $t("Link Access Stats","js_link_access_stats")+"|"+$t("Previews","js_link_previews_label")+": "+this.shared_preview_count+"<br/>"+$t("Downloads","js_link_downloads_label")+": "+this.shared_download_count+"<br/>"+$t("Status","js_link_status_label")+": "+e},_render_tooltip:function(){var e="";if(!this.element)return;if(this.collection.view!="icon"){$(this.element).removeAttr("data-hover title aria-label");return}if(this.collaborated){e=this.name+", ";var t=ItemTypeTranslation.singular_from_item(this);this.user_is_owner?this.hide_collaborators==1?e+=$t("Your %1","item_tooltip_hide_collab_yours",t):e+=this.collaborators_count==1?$t("Your %1, 1 collaborator","item_tooltip_collab_yours_single",t):$t("Your %1, %2 collaborators","item_tooltip_collab_yours_multiple",t,this.collaborators_count):this.hide_collaborators==1?e+=$t("%1's %2","item_tolltip_hide_collab_not_yours",$.box.escapeHTML(this.owner),t):e+=this.collaborators_count==1?$t("%1's %2, 1 collaborator","item_tooltip_collab_not_yours_single",$.box.escapeHTML(this.owner),t):$t("%1's %2, %3 collaborators","item_tooltip_collab_not_yours_multiple",$.box.escapeHTML(this.owner),t,this.collaborators_count)}this.element.setAttribute("aria-label",e),this.element.setAttribute("data-hover","tooltip")},has_expiration:function(){return this.expirations&&(this.expirations.unshare||this.expirations["delete"])},can_execute_action:function(e,t){var n=!0,r=Box.Application.getService("openbox-service-actions"),i=r.createAction(this,e,t,n);return i.can_execute()},execute_action:function(e,t,n){var r=Box.Application.getService("openbox-service-actions"),i=r.createAction(this,e,t,n);return $j(window).one("popup.open",function(){simpleBodyBlocker.destroy(),$j(".box_new_popup").hide()}),i.execute()},change_view:function(){this.expansion.remove()},click:function(e){e=e||{};var t={},n=Box.Application.getService("openbox-service-actions"),r=n.getDefaultOpenboxAction(this),i=this.url_for_page_link,s=e.j_element||this.j_element,o;e||(e={}),Canvas.get().target_item=this,$j("#jquery_editable_input").blur();var u=Box.Application.getService("v5").get("current_rm");u=="box_v2_new_inbox"?o="Updates - Item Click":u=="box_user_profile_view"&&(o="Profile - Item Click"),o&&this.update&&Box_Event_Tracker.get().send_modular_event(o,Update.updateTypeText(this.update.update_type)+" Update",1),this.update&&(t.update=this.update),Canvas.get().selection.unselect_all();if(s){var a=s.find("a.item_link").attr("href");a&&(i=a)}if(r)r.execute();else if(!this.is_deleted)if(i&&this.is_weblink()){var f=Box.Application.getService("url");f.openWindow(i)}else i?Box.Application.navigate(i):this.can_open(t)?this.open(t):this.preview(e)},encoded_name:function(){var e=this.name;return this.extension&&(e=e.substr(0,e.length-this.extension.length-1)),e=e.replace(/[^A-Za-z0-9]/g,"_"),e},is_root_folder:function(){return this.type=="folder"&&this.id==Item.ROOT_FOLDER_ID},load_collabs:function(e){e=typeof e=="undefined"?!0:e;var t=this,n={folder_id:this.id},r=$j.box.formatQuery(n),i=Box.Application.getService("url"),s=i.getGcmCompatibleRmUrl("box_collaborate_get_collabs");$j.ajax({dataType:"json",url:s,data:r,success:function(e){t.update_collabs(e)},async:e})},update_collabs:function(e){e&&(this.collaborations=e.collabs,Canvas.get().current_folder&&this.id==Canvas.get().current_folder.id&&(Canvas.get().users.set_params(e.users),Canvas.get().group_tags.set_params(e.group_tags)))},build_url:function(){var e=Box.Application.getService("v5").get("current_rm"),t=e=="box_shared_show"||e=="box_shared_show_by_name"||e=="box_view_vanity_url",n,r=this.is_file()&&!this.is_webdoc()&&!this.is_boxnote(),i=Box.Application.getService("nav-state"),s=i.get();return r&&t?n="/shared/"+Canvas.get().shared_name+"/"+s.page+"/"+this.parent+"/"+this.id+"/1":r?n="/files/0/f/"+this.parent+"/1/"+this.typed_id:t?n="/shared/"+Canvas.get().shared_name+"/"+s.page+"/"+this.id:this.is_folder()&&(n="/files/0/f/"+this.id),n},open_in_new_window:function(){var e=this.build_url(),t=Box.Application.getService("url");t.openWindow(e)},preview:function(e){e=e||{};var t=Box.Application.getService("nav-state"),n=t.get(),r=Box.Application.getService("nav-url");if(!this.permissions.preview){var i="You do not have the required permissions to preview this file";return Box.Application.getService("popups").alert(i),!1}if(Item.find(this.id)&&this.has_valid_collection())if((Features.lightbox_preview||Features.lightbox_preview_enterprises)&&!t.isGcm())Box.Application.broadcast("showpreview",{itemTypedID:this.typed_id,allItems:this.collection.items});else{var s=r.getFileUrl(this.id,this.parent,n.page,"f");Box.Application.navigate(s)}else Item.open({folder_id:this.parent,sub_type:"1",sub_id:this.typed_id});return!1},render:function(e){return e=e||{},this._render_init(e.file_view||!1),this.element?(e.init||((e.force_render_tags||e.force_render_classes)&&this._render_classes(),this._render_metadata(),this.render_tags(e),this._render_expirations()),this.collection.view!="icon"&&this._render_path(),this._render_tooltip(),this._attach_events(),this.element):null},show_menu:function(e){var t=Box.Application.getService("v5"),n=t.get("Canvas");e=e||{},e.item=this,Box.Application.getGlobalConfig("useMinimal")==="use_minimal"&&n.in_account&&n.current_folder&&!n.current_folder.is_trash_folder?this.get_shared_info(function(){Box_Menus.get().menu.show(e)}):Box_Menus.get().menu.show(e)},show_menu_in_lightbox:function(e){e=e||{},e.item=this,Box_Menus.get().lightbox_item_menu.show(e)},can_select:function(e){return this.id==""?!1:this.is_hidden_external_collab?!1:e&&e.attr("data-type")=="quarantine-item"?!1:!0},can_edit_on_gallery_using:function(e){return e?e.extensions_editable_on_gallery&&e.extensions_editable_on_gallery.length&&$j.inArray(this.extension,e.extensions_editable_on_gallery)>-1:!1},can_view_on_gallery_using:function(e){return e?e.extensions_viewable_on_gallery&&e.extensions_viewable_on_gallery.length&&$j.inArray(this.extension,e.extensions_viewable_on_gallery)>-1:!1},select:function(e){var t=$j(this.element);if(this.selected||!this.can_select(t))return;this.selected=!0,t.addClass("selected"),this.collection.view!="icon"&&t.find(".action_list .select a").removeClass("unchecked_by_js").find("input").prop("checked",!0),Canvas.get().selection.add(this,e),t.selectableSelect()},unselect:function(e){if(!this.selected)return;this.selected=!1;var t=$j(this.element);t.removeClass("selected");var n=function(e){$j(e.target).removeClass("unchecked_by_js")};$j(this.element).find(".action_list .select a").addClass("unchecked_by_js").unbind("click mouseleave",n).bind("click mouseleave",this,n);if(this.collection.view!="icon"){var r=$j(this.element).find("input[type=checkbox]").get(0);r&&(r.checked=!1)}Canvas.get().selection.remove(this,e),$j(this.element).selectableUnselect()},is_box_created_document:function(){var e={webdoc:!0,gdoc:!0,gsheet:!0};return e[this.extension]},is_manually_lockable:function(){var e={gdoc:!0,gsheet:!0};return!e[this.extension]},is_item_type_taggable:function(){return this.is_file()||this.is_folder()},is_downloadable:function(){return this.permissions.download&&!this.is_boxnote()&&!this.is_webdoc()},can_view_download_stats:function(){return this.type!="file"?!1:Canvas.get().user.has_custom_feature("display_download_stats")?this.permissions.view_download_stats:!1},show_download_stats_upgrade_message:function(){var e=this;return e.type!="file"||e.is_webdoc()?!1:!Canvas.get().user.has_custom_feature("display_download_stats")&&e.user_id==Canvas.get().user.id},is_empty_folder:function(){return this.type!="folder"?!1:this.children.is_empty()},update_item_share_info_ui:function(){this.expansion&&this.expansion.update_shared_link(),this.display_in_place_share();var e=$j.popup.get();e.is(":visible")&&e.find(".sharebar_share_link").val(this.shared_link)},display_in_place_share:function(){var e=Box.Application.getService("nav-state");if(e.isPreviewerOpen()){if(e.galleryItem()!=this)return}else if(!Canvas.get().current_folder||Canvas.get().current_folder.id!=this.id)return;var t=$j("#sidebar_sharebar");t.show();var n=t.find(".sharing_off_container"),r=t.find(".sharing_on_container");box_sidebar.update_share_icons(this);if(!this.permissions.share||box.hist_name=="shared_folder")t.hide(),n.hide(),r.hide();else if(this.shared){if(this.vanity_name==""&&!e.isGcm()){var i=this;return this.get_shared_info(function(){t.show(),i.display_in_place_share()}),t.hide(),!1}$j(".in_place_share_url").val(this.shared_link),$j("#sharing_sidebar_access_level_icon").attr("class","icon sprite_16x16 "+Item.shared_access_to_icon(this.shared_access));var s=Item.shared_access_to_string(this.shared_access);$j("#sharing_sidebar_access_link").html(s+'<span class="arrow"></span>'),r.show(),n.hide()}else n.show(),r.hide()},refresh:function(e,t){var n=this;t=$.extend({async:!0},t);var r=t.skip_render,i=Box.Application.getService("url"),s=i.getGcmCompatibleRmUrl("box_get_items");Canvas.get().current_folder&&Canvas.get().current_folder.is_self_or_ancestor_collaborated&&(s+="&is_self_or_ancestor_collaborated=1");var o={};if(this.id)o.item_typed_ids=[this.typed_id];else{if(!t.upload_session_id)return;o.upload_session_ids=[t.upload_session_id]}$j.getJSON(s,$j.box.formatQuery(o),function(s){var o=Box.Application.getService("nav-state"),u=o.get();if(s.error){t.on_error_callback&&$j.isFunction(t.on_error_callback)&&t.on_error_callback(s.error);return}var a,f=!1;n.id?a=n.id:(a=s.items[0].id,f=!0);var l=Item.find(a);l&&f&&n.collection.add_node(l,n._index,n.update,n.upload_id),l&&(n.permissions=s.items[0].permissions);var c=$j(s.html),h=n.typed_id?c.attr("id"):n.upload_id;n.collection.id>0&&n.typed_id&&(h=h.replace("c0","c"+n.collection.id),c.attr("id",h));if(!r){var p=$("#"+h),d=p.hasClass("fake-item");p.replaceWith(c),l.render({init:!1,file_view:!0,force_render_tags:!0,force_render_classes:!0}),d&&c.addClass("newly-uploaded-item")}var v=Box.Application.getService("v5").get("Features");!v.lightbox_preview&&!v.lightbox_preview_enterprises&&l.typed_id==u.galleryId&&u.isGallery&&Previewer.get().open(),l.element=c,l.selected&&(l.selected=!1,l.select()),s.items[0].missing_thumbnails&&Item.add_to_items_with_missing_thumbnails(l),e&&e(l,s.html,r),Box.Application.broadcast("x-itemrefresh",{item:l})},{async:t.async})},open_shared_page:function(){var e=Box.Application.getService("url");e.openWindow(this.shared_link,"_blank")},is_encrypted_at_rest:function(){var e=Canvas.get().users.find(this.user_id);return e&&e.enterprise_id&&e.enterprise_id!="0"?!0:!1},shared_access_restricted_description:function(){if(!this.is_self_or_ancestor_collaborated)return this.type=="file"?this.folder.id==Item.ROOT_FOLDER_ID?$t("This file is only viewable by you. Move it to a Collaborated folder to share it with others.","shared_access_restricted_description_file_at_root"):$t("This file is in a private folder and only viewable by you. Invite collaborators to the folder to share.","shared_access_restricted_description_file_in_private_folder"):$t("This %1 is private and only viewable by you. Invite collaborators to the folder to share.","shared_access_restricted_description_private_folder",ItemTypeTranslation.singular_from_item(this));return $t("Only users collaborating in this folder can access this content.","shared_access_restricted_description_default")},shared_access_to_tooltip:function(e){var t=this.shared_access_restricted_description(),n=[$t("Link Access: Open | This content is open to anyone with the link. Viewers are not required to log in.","shared_link_tooltip_icon_open"),$t("Link Access: Your Company | Only users logged in with a %1 email or users collaborating in this folder can access this content.","shared_link_tooltip_icon_company",this.owner_enterprise_desc_domain),$t("Link Access: Collaborators Only | %1","shared_link_tooltip_icon_restricted",t),$t("Link Access: No Link | This %1 cannot be accessed from a shared link. Collaborators will still have access.","shared_link_tooltip_icon_disabled",ItemTypeTranslation.singular_from_item(this))];if(e<0||e>=n.length)return"";var r=n[e];return e==Item.SHARED_ACCESS_OPEN&&this.has_password&&(r+="<br/>"+$t("Password protected.","shared_link_tooltip_password_protected")),r},shared_access_option_text:function(e,t){if(!t)return $t("Option disabled for this %1.","shared_access_menu_disabled",ItemTypeTranslation.singular_from_item(this));var n=this.owner_enterprise_desc_domain.length<=50?this.owner_enterprise_desc_domain:this.owner_enterprise_display_domain,r=[$t("This content is open to anyone with the link. Viewers are not required to log in.","shared_access_menu_option_open"),$t("Only users logged in with a %1 email or users collaborating in this folder can access this content.","shared_access_menu_option_company",n),this.shared_access_restricted_description(),this.get_text_for_collab_only_shared_access()];return e<0||e>=r.length?"":r[e]},get_text_for_collab_only_shared_access:function(){return this.is_file()?$t("This file cannot be accessed from a shared link. Collaborators will still have access.","shared_access_menu_disabled_file"):this.is_folder()?$t("This folder cannot be accessed from a shared link. Collaborators will still have access.","shared_access_menu_disabled_folder"):this.is_weblink()?$t("This bookmark cannot be accessed from a shared link. Collaborators will still have access.","shared_access_menu_disabled_weblink"):(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_item.js:1946","2014-02-03","Not sure if a reachable case"),$t("This item cannot be accessed from a shared link. Collaborators will still have access.","shared_access_menu_disabled_item"))},get_unique_identifier:function(){return"c"+this.collection.id+"_"+this.typed_id},is_folder:function(){return this.type==="folder"},is_file:function(){return this.type==="file"},is_weblink:function(){return this.type==="web_link"},is_webdoc:function(){return this.extension==="webdoc"},is_boxnote:function(){return this.extension==="boxnote"},is_music:function(){return this.extension==="mp3"},can_generate_link:function(){return this.permissions.share&&(this.is_file()||this.is_folder()||this.is_weblink())},can_collab:function(){var e=Box.Application.getService("nav-state");return this.permissions.create_collab&&(this.is_folder()&&!this.is_root_folder()||this.is_webdoc())},can_send:function(){return Canvas.get().logged_in&&(!this.owner_id||this.user_is_owner||this.is_self_or_ancestor_collaborated)},can_assign_new_role_to_user:function(e,t){if(t=="Owner")return!1;var n={"Co-owner":["Editor","Previewer","Previewer+Uploader","Uploader","Viewer","Viewer+Uploader"],Editor:["Previewer","Previewer+Uploader","Uploader","Viewer","Viewer+Uploader"],"Previewer+Uploader":["Previewer","Uploader","Viewer","Viewer+Uploader"],Previewer:["Uploader","Viewer","Viewer+Uploader"],"Viewer+Uploader":["Viewer","Uploader"],Uploader:["Viewer"]};return $j.inArray(e,n[t])!=-1?!1:!0},generate_lock_info_html:function(){var e=this.lock,t=Box.Application.getService("datetime");if(e){var n,r;e.expiration!="0"?(r=t.getDisplayDate(new Date(e.expiration*1e3),{includeTime:!0,includeYear:!1}),n=$t("Locked this file until","js_locked_this_file_until")+"<div>"+r+"</div>"):(r=t.getDisplayDate(new Date(e.updated*1e3),{includeTime:!0,includeYear:!1}),n=$t("Locked this file","js_locked_this_file")+"<div>"+r+"</div>");var i='<ul class="tabular_nav">     <li>         <img class="mrm" src="'+e.user_pic_url+'" />'+"     </li>"+"     <li>"+'         <div class="midlight">'+e.user_display_name+"</div>"+n+"     </li>"+" </ul>"+' <div class="gapfix">&nbsp;</div>';return i}return""},_load_openbox_action_on_item_and_execute:function(e){var t=Box.Application.getService("openbox-service-actions");return t.loadOpenboxActionOnItemAndExecute(this,e)},get_shared_info:function(e,t){typeof t=="undefined"&&(t=!0);var n=Box.Application.getService("url"),r=n.getGcmCompatibleRmUrl("box_files_get_shared_info"),i={typed_id:this.typed_id};$j.getJSON(r,i,function(n){n.error?Box.Application.getService("popups").alert($t("The shared link has been deleted or is no longer available.","shared_link_not_available")):e(n)},{async:t})},_is_inbox_or_profile_gallery_page:function(){return typeof gallery_page!="undefined"&&(gallery_page=="inbox"||gallery_page=="profile")},has_valid_collection:function(){return this.collection.items.length>0},update_properties:function(e){$j.extend(!0,this,e)},update_all_references:function(e){this.update_properties(e);var t=Canvas.get().collections;for(var n in t){var r=t[n].items;for(var i in r){var s=r[i];s.id==this.id&&s.update_properties(e)}}}},{type:"item",_subtypes:["folder","file","web_link"],ROOT_FOLDER_ID:0,TRASH_FOLDER_ID:"1",actions:[{id:"change_owner"},{id:"collaborate"},{id:"collaboration_links"},{id:"create_item_feed_object"},{id:"delete_me"},{id:"delete_from_trash"},{id:"download",sync:$j.browser.msie},{id:"edit_collaborators"},{id:"update_item_info"},{id:"edit_properties"},{id:"collab_list"},{id:"embed_upload_widget"},{id:"get_item_feed"},{id:"get_task"},{id:"lock_file"},{id:"move"},{id:"new_document"},{id:"new_folder"},{id:"save_shared_link_as_web_link"},{id:"open"},{id:"remove_collab"},{id:"remove_star"},{id:"restore"},{id:"revoke_app_folder"},{id:"set_expirations"},{id:"sharebar"},{id:"synchronize"},{id:"tag"},{id:"unlock_file"},{id:"unshare"},{id:"version_history"},{id:"enable_folder_email"},{id:"report_abuse"},{id:"set_share_access"},{id:"new_pin"},{id:"remove_pin"},{id:"show_pins"},{id:"share"},{id:"quarantine_reinstate"},{id:"quarantine_false_positive"}],getting_thumbnails:!1,items_with_missing_thumbnails:{},DEFAULT_ROOT_FOLDER_ID:"d_0",SHARED_ACCESS_OPEN:0,SHARED_ACCESS_COMPANY:1,SHARED_ACCESS_RESTRICTED:2,SHARED_ACCESS_DISABLED:3,SHARED_ACCESS_STRINGS:[$t("Open Access","shared_link_access_label_open"),$t("Company Access","shared_link_access_label_company"),$t("Collaborators Only Access","shared_link_access_label_restricted"),$t("Disabled Access","shared_link_access_label_disabled")],SHARED_ACCESS_ICONS:["sprite_16x16_link_blue","sprite_16x16_company_blue","sprite_16x16_restricted_blue","sprite_14x14_close"],SHARED_ACCESS_CLASSES:["open","company","restricted"],shared_access_to_icon:function(e){return e<0||e>=Item.SHARED_ACCESS_ICONS.length?"":Item.SHARED_ACCESS_ICONS[e]},shared_access_to_string:function(e){return e<0||e>=Item.SHARED_ACCESS_STRINGS.length?"":Item.SHARED_ACCESS_STRINGS[e]},shared_access_to_class:function(e){return e<0||e>=Item.SHARED_ACCESS_CLASSES.length?"":Item.SHARED_ACCESS_CLASSES[e]},find:function(e){if(e==null||typeof e=="undefined")return null;e=e.toString();var t,n;if(Box_Object._is_typed_id(e))t=e.substring(2),n=Box_Object.find_by_typed_id(e);else{t=e;for(var r in this._subtypes){var i=this._subtypes[r];e=i+"_"+t,n=Box_Object.find_by_typed_id(e);if(n)break}}return n&&t==Item.ROOT_FOLDER_ID&&!n.name&&(n.name=$t("All Files","js_global_allfiles")),n},find_or_create:function(e){if(typeof e!="object"){var t=e;e=Box_Object._get_type_and_id(t)}var n=Box_Object.find_by_type_and_id(e);return n?n.set_params(e):new Item(e)},find_async:function(e){var t=Box_Object._get_type_and_id(e),n=$.Deferred(),r=Box_Object.find_by_type_and_id(t),i="/index.php?rm=unidb_get_items",s={type:t.type,id:t.id},o=$.box.formatQuery(s);return $.getJSON(i,o,function(e){var t=new Item(e.params);n.resolve(t)}),n.promise()},find_or_create_just_uploaded_item:function(e){var t=Canvas.get().current_folder;return Item.find(e.id)||new Item({type:e.type,id:e.id,name:e.name,user_is_owner:!0,granted_permissions:{share:t?t.permissions.share:!0,view:!0,create_collab:e.type=="folder",rename:!0,upload:!0,download:!0}})},PERMISSION_CONSTANTS:{restore:"item_restore",delete_from_trash:"item_delete_from_trash",create_tag:"item_create_tag",create_collab:"item_create_collab",create_comment:"item_create_comment",download:"item_download","delete":"item_delete",rename:"item_rename",options:"item_options",preview:"item_preview",remove:"item_remove",set_share_access:"item_set_share_access",share:"item_share",create_task:"item_create_task",upload:"item_upload",view:"item_view",synchronize:"item_synchronize",can_non_owners_invite_collab:"item_can_non_owners_invite_collab",create_instant_mode_authorization:"create_instant_mode_authorization",restore_from_quarantine:"restore_from_quarantine",delete_file_version:"delete_file_version",make_version_current:"make_version_current",view_file_version:"item_view_file_version",view_download_stats:"item_view_download_stats",create_view_path_collabs:"item_create_view_path_collab"},open:function(e){var t=Box.Application.getService("nav-state");e=e||{};if(typeof box!="undefined"&&box.hist_name=="files"&&e.type!="web_link")t.set({type:"f",subType:e.sub_type,isGallery:e.sub_type=="1"}),t.setPreviewState(e.sub_id),t.set({page:0,id:e.folder_id}),Box.Application.navigate("");else{var n=Box.Application.getService("url"),r="";if(e.type=="folder")r="/files/0/f/"+e.folder_id;else{if(e.type=="web_link"){r="/web_links/"+e.sub_id.substr(2),n.openWindow(r);return}r="/files/0/f/"+e.folder_id+"/1/"+e.sub_id}n.goToUrl(r)}},open_webdoc:function(e){var t=Item.find(e);t?t.click():(t=new Item({type:"file",id:e}),t.refresh(function(t){t.click()},{async:!1}))},add_to_items_with_missing_thumbnails:function(e){Item.items_with_missing_thumbnails[e.typed_id]=e,Item.getting_thumbnails||(Item.getting_thumbnails=!0,setTimeout(Item.get_thumbnails,1))},get_thumbnails:function(){var e=[],t=Item.items_with_missing_thumbnails;for(var n in t){if(!t.hasOwnProperty(n))continue;e.push(n)}var r={item_typed_ids:e},i=$j.box.formatQuery(r),s="/index.php?rm=box_get_thumbnails";$j.getJSON(s,i,Item.get_thumbnails_callback)},get_thumbnails_callback:function(e){for(var t in e){var n=Item.items_with_missing_thumbnails[t],r=e[t];if(r){var i=$j(n.element);r.pic_s&&i.find(".thumb_small").css("background-image","url("+r.pic_s+")"),r.pic_l&&i.find(".thumb_large").css("background-image","url("+r.pic_l+")"),r.pic_x&&(n.pic_x=r.pic_x),n.has_pic_x=r.has_pic_x;var s=r.pic_s&&r.pic_l&&r.pic_x;s&&delete Item.items_with_missing_thumbnails[t]}}Item.update_preview_tooltip&&Item.update_preview_tooltip(),$.isEmptyObject(Item.items_with_missing_thumbnails)?Item.getting_thumbnails=!1:Item.get_thumbnails()},current_folder:function(){return Canvas.get().current_folder},registerActions:function(){$j.each(Item.actions,function(e){var t=Item.actions[e];Item.prototype["can_"+t.id]=function(e){return this.can_execute_action(t.id,e)},Item.prototype[t.id]=function(e){return this.execute_action(t.id,e,t.sync)}})}});Item.registerActions(),Box.Timing.execution.push({name:"js/box_item_action_validator.js",time:(new Date).getTime()});var ItemActionValidator=Base.extend({invalid_items:[],valid_items:[],validate:function(e){this.invalid_items=[],this.valid_items=[];var t=this;return $.each(e,function(e,n){t._validate(n)?t.valid_items.push(n):t.invalid_items.push(n)}),this.invalid_items.length===0},_validate:function(e){return typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_item_action_validator.js:7113","2013-05-15","auto tombstoned"),!0},has_errors:function(){return this.invalid_items.length!==0}},{}),RequiredPermissionItemActionValidator=ItemActionValidator.extend({constructor:function(e,t,n){this.required_permissions=e.required_permissions||{},this.locking=e.locking,this.service_action_id=e.service_action_id,this.item_collaboration_permissions=n.item_permissions||{}},_validate:function(e){var t=!0,n=this;return $.each(this.required_permissions,function(r,i){return i?e.permissions[r]?!0:n.locking=="multiple"&&e.lock&&e.lock.service_action_id==this.service_action_id?(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_item_action_validator.js:7118","2013-05-15","auto tombstoned"),!0):n.item_collaboration_permissions[r]?!0:(t=!1,!1):!0}),t}},{}),RemovedPermissionItemActionValidator=ItemActionValidator.extend({constructor:function(e,t,n){this.required_permissions=e.required_permissions},_validate:function(e){for(var t in this.required_permissions){if(!this.required_permissions[t])continue;if(e.removed_permissions&&e.removed_permissions[t])return!1}return!0}},{}),InvalidExtensionItemActionValidator=ItemActionValidator.extend({constructor:function(e,t,n){this.allowed_extensions=e.allowed_extensions,this.other_extensions_disallowed=e.other_extensions_disallowed||!1},_validate:function(e){return this.allowed_extensions[e.extension]===!1?!1:this.allowed_extensions[e.extension]===!0?!0:this.allowed_extensions[e.extension]==undefined&&this.other_extensions_disallowed?!1:!0}},{}),InvalidTypeItemActionValidator=ItemActionValidator.extend({constructor:function(e,t,n){this.allowed_types=e.allowed_types},_validate:function(e){return this.allowed_types[e.type]}},{}),CustomItemActionValidator=ItemActionValidator.extend({constructor:function(e,t,n){this.custom_permissions=e.custom_permissions||[],this.action=t},_validate:function(e){for(var t=0,n=this.custom_permissions.length;t<n;t++){var r=this.custom_permissions[t].apply(this.action,[e,this.action]);if(!r)return!1}return!0}},{});Box.Timing.execution.push({name:"js/box_item_action.js",time:(new Date).getTime()});var ItemAction=Base.extend({validators:[],action:null,class_name:"",collection:null,description:"",executed_by_default:!1,favicon_url:"",id:null,item:null,menu_item_id:"",name:"",options:null,"static":!1,on_load_callbacks:null,sync:!1,constructor:function(e){e=e||{};if(!e.id)return!1;if(!e.item&&!e.collection)return!1;this.id=e.id,this.item=e.item,this.collection=e.collection,this.options=e.options||{},this.sync=e.sync,this.set_source(),this.set_class_name(),this.set_name(),this.menu_item_id="menu_item_"+this.id,this.on_load_callbacks=[],this.deferred=$.Deferred(),!window[this.class_name]&&OpenboxAction.exists(e.id)&&(window[this.class_name]=OpenboxAction.create(e.id)),window[this.class_name]&&this.set_action(),this.load_attempts=10,this.load()},set_source:function(){var e=Box.Application.getService("v5").get("current_rm");switch(e){case"box_files":case"box_files_search":case"box_files_tag":case"box_files_pin":case"box_master_content":case"box_master_quarantine":this.source="files";break;case"box_v2_new_inbox":this.source="updates";break;case"box_shared_show_by_name":this.source="shared_folder"
;break;case"box_user_profile_view":this.source="user_profile";break;case"box_view_vanity_url":this.source="vanity_url";break;case"box_collaborators_get_page":this.source="collaborators_get"}if(!this.source||this.source=="unknown")this.source="shared_file"},_initialize_validators:function(){this.validators={required_permission:new RequiredPermissionItemActionValidator(window[this.class_name],this.action,this.options),removed_permission:new RemovedPermissionItemActionValidator(window[this.class_name],this.action,this.options),extension:new InvalidExtensionItemActionValidator(window[this.class_name],this.action,this.options),type:new InvalidTypeItemActionValidator(window[this.class_name],this.action,this.options),custom:new CustomItemActionValidator(window[this.class_name],this.action,this.options)}},can_execute:function(){if(this.options.ignore_permissions)return!0;var e=this.item?[this.item]:this.collection?this.collection.items:[],t=!1;return this._initialize_validators(),$.each(this.validators,function(t,n){n.validate(e)}),Box.Application.getGlobalConfig("useMinimal")==="use_minimal"&&(t=this._filter_minfiles_action(e)),t||!this.validators.required_permission.has_errors()&&!this.validators.extension.has_errors()&&!this.validators.type.has_errors()&&!this.validators.custom.has_errors()},execute:function(e){if(!this.is_loaded()){var t=this;return this.add_on_load_callback(function(){t.execute()}),this.deferred.promise()}if(this.can_execute())return this.item&&!this.collection&&(Canvas.get().target_item=this.item),this.action.execute(e),this.deferred.promise();var n=this.create_validation_error();return $.popup.alert($t("Error","js_popup_title_error"),n),this.deferred.reject({reason:ItemAction.PERMISSION_DENIED_REASON,message:"Cannot execute"}),this.deferred.promise()},create_validation_error:function(){var e=this.validators.extension.has_errors()||this.validators.type.has_errors()?$t("You cannot perform the %1 action","error_notice_js_you_cannot_perform_action",this.name):$t("You do not have the required permissions to perform the %1 action","error_notice_js_you_donot_have_permissions",this.name);this.item&&(e+=' on "'+$.box.escapeHTML(this.item.name||$t("All Files","js_global_allfiles"))+'".');if(this.collection){e+=" on the following items:<br /><br />";var t=[];this.validators.extension.has_errors()?t=this.validators.extension.invalid_items:this.validators.type.has_errors()?t=this.validators.type.invalid_items:this.validators.required_permission.has_errors()?t=this.validators.required_permission.invalid_items:this.validators.custom.has_errors()&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_item_action.js:7476","2013-05-15","auto tombstoned"),t=this.validators.custom.invalid_items),e+=$j.map(t,function(e){return'"'+$.box.escapeHTML(e.name)+'"'}).join("<br />")}return e},load:function(){if(this.action)return;var e=Box.Application.getService("assets").getAssetURL(js_path,"actions/"+this.id+".js",!this.sync);if(this.sync)this.load_script(e),this.set_action();else{var t=this;this.load_script_async(e,function(){if(!window[t.class_name]){if(!t.load_attempts)return;t.load_attempts--,window.setTimeout(function(){t.load()},0);return}t.set_action();for(var e=0;e<t.on_load_callbacks.length;e++)t.on_load_callbacks[e]()})}},load_script:function(e){var t=document.createElement("script");$.ajax({type:"GET",url:e,dataType:"script",cache:!0,async:!1,no_context:!0,success:function(e){$j.browser.msie?t.text=e:t.appendChild(document.createTextNode(e))}}),document.body.appendChild(t)},load_script_async:function(e,t){var n=document.createElement("script");n.readyState?n.onreadystatechange=function(){/loaded|complete/.test(n.readyState)&&(n.onload=n.onreadystatechange=null,t())}:n.onload=function(){t()},n.type="text/javascript",n.src=e,document.body.appendChild(n)},set_action:function(){this.action=new window[this.class_name]({collection:this.collection,item:this.item,source:this.source,deferred:this.deferred},this.options),this.description=this.action.description,this.executed_by_default=this.action.extensions_executed_by_default&&this.item&&this.item.type=="file"&&$j.in_array(this.item.extension,this.action.extensions_executed_by_default),this.editable_on_gallery=this.item&&this.item.can_edit_on_gallery_using(this.action),this.favicon_url=this.action.favicon_url,this.action.name&&(this.name=this.action.name)},set_class_name:function(){var e="",t=this.id.split("_");for(var n in t)e+=t[n].substr(0,1).toUpperCase(),e+=t[n].substr(1).toLowerCase();e+="Action",this.class_name=e},set_name:function(){this.name=this.id.toLowerCase().split("_").join(" "),this.name=="delete me"&&(this.name="delete")},is_loaded:function(){return this.action},add_on_load_callback:function(e){this.on_load_callbacks.push(e)},_filter_minfiles_action:function(e){var t=0,n=e.length,r=Box.Application.getService("v5").get("Canvas");if(!r.in_account)switch(this.id){case"download":for(t=0;t<n;t++)if(e[t].type==="web_link"||e[t].extension==="boxnote"||e[t].extension==="webdoc")return!1;return!0;case"get_item_feed":case"create_item_feed_object":case"save_shared_link_as_web_link":return!0;default:return!1}if(r.current_folder&&r.current_folder.is_trash_folder)switch(this.id){case"delete_from_trash":case"restore":return!0;default:return!1}else switch(this.id){case"synchronize":for(t;t<n;t++)if(e[t].type==="file"||e[t].type==="web_link")return!1;return!0;case"sharebar":return this.item?!0:!1;case"download":for(t=0;t<n;t++)if(e[t].type==="web_link"||e[t].extension==="boxnote"||e[t].extension==="webdoc")return!1;return!0;case"tag":case"move":case"delete_me":case"share":case"version_history":case"set_share_access":case"new_folder":case"edit_collaborators":case"enable_folder_email":case"edit_properties":case"collaborate":case"collab_list":case"remove_collab":case"unshare":case"lock_file":case"unlock_file":case"get_item_feed":case"create_item_feed_object":return!0;case"openbox_service2693":case"openbox_service2133":if(n>1||e[0].extension!=="boxnote")return!1;return!0;default:return!1}}},{PERMISSION_DENIED_REASON:"permission_denied"});Box.Timing.execution.push({name:"js/box_item_collection.js",time:(new Date).getTime()});var ItemCollection=Base.extend({_items_by_id:null,collaborated:null,element:null,id:null,items:null,maximum_items:null,nodes:null,permissions:null,removed_permissions:null,shared_name:null,view:null,constructor:function(e){this._items_by_id={},this.items=[],e=e||{},this.collaborated=e.collaborated||!1,this.element=e.container,this.id=typeof e.id!="undefined"?e.id:null,this.maximum_items=e.maximum_items||null,this.nodes=e.nodes||{},this.permissions=e.permissions||{},this.removed_permissions=e.removed_permissions||{},this.shared_name=e.shared_name||null,this.view=e.view||"icon";var t=0;for(var n in this.nodes){var r=this.nodes[n];this.add_node(r,t,e.update),t++}},can_execute_action:function(e,t){if(this.size()===0)return;var n=!0,r=new ItemAction({id:e,collection:this,options:t,sync:n});return r.can_execute()},execute_action:function(e,t,n){if(this.size()===0)return;var r=new ItemAction({id:e,collection:this,options:t,sync:n});return $j(window).one("popup.open",function(){simpleBodyBlocker.destroy(),$j(".box_new_popup").hide()}),r.execute()},add:function(e,t){if(!(e instanceof Item))return;var n=this._insert_to_item_collection(e,t);n&&this.items.push(e)},prepend:function(e,t){if(!(e instanceof Item))return;var n=this._insert_to_item_collection(e,t);if(n){var r=0;for(var i=0,s=this.items.length;i<s;i++){if(!$(this.items[i].element).hasClass("fake-item"))break;r++}this.items.splice(r,0,e)}},_insert_to_item_collection:function(e,t){var n=t||e.id,r=e.id||e.upload_id;if(this._items_by_id[n]){for(var i=0;i<this.items.length;i++){var s=this.items[i].upload_id||this.items[i].id;if(n==s){this.items[i]=e;break}}return n!=r&&delete this._items_by_id[n],this._items_by_id[r]=e,!1}return this._items_by_id[r]=e,!0},add_node:function(e,t,n,r){e.permissions||(e.permissions=""),e.removed_permissions||(e.removed_permissions=[]),e.collection=this,e.folder=Item.find(e.parent)||new Item({type:"folder",id:e.parent}),n&&(e.update=n);var i=Item.find_or_create(e);return this.add(i,r),i},change_view:function(e,t){t=t||{},this.view=e;var n=t.change_items_view_only||!1,r=$j(this.element);n||(this.view!="icon"?r.removeClass("icon_view").addClass("list_view"):r.removeClass("list_view").addClass("icon_view"),Canvas.get().expanded_list_view?r.addClass("list_view_expanded"):r.removeClass("list_view_expanded"));for(var i in this.items)this.items[i].change_view(this.view),this.items[i]._render_tooltip(),this.items[i]._render_classes()},find:function(e){if(typeof e=="number"||typeof e=="string")return this._items_by_id[e];e=e||{};var t=new ItemCollection;for(var n=0;n<this.items.length;n++){var r=this.items[n];if(!this._param_applies(e.extension,r.extension))continue;if(e.image&&!r.image)continue;if(e.user_is_owner&&!r.user_is_owner)continue;if(e.permission){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_item_collection.js:20782","2013-05-15","auto tombstoned"),typeof e.permission=="string"&&(e.permission=[e.permission]);var i=!1;for(var s=0;s<e.permission.length;s++){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_item_collection.js:20783","2013-05-15","auto tombstoned");if(!r.permissions[e.permission[s]]){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_item_collection.js:20784","2013-05-15","auto tombstoned"),i=!0;break}}if(i)continue}if(!this._param_applies(e.type,r.type))continue;t.add(r)}return t},_param_applies:function(e,t){if(typeof e=="undefined")return!0;if(typeof e=="string")return e&&t!=e?!1:!0;if(typeof e=="object"){var n=!0;for(var r in e)if(e[r]&&t!=r||!e[r]&&t==r)n=!1;return n}},remove:function(e){if(!(e instanceof Item))return;delete this._items_by_id[e.id];for(var t=0;t<this.items.length;t++){if(this.items[t].id!=e.id)continue;this.items.splice(t,1);break}},render:function(e){e||(e={});var t=0;for(var n in this.items){var r=this.items[n];r.render({init:!0,file_view:e.file_view}),this.maximum_items&&t>=this.maximum_items&&$j(r.element).hide(),t++}return(!e.page||e.page!="inbox"&&e.page!="profile"&&!e.skip_change_view)&&this.change_view(this.view,e),this.element},select:function(e){for(var t in this.items)this.items[t].select(e)},selectable_count:function(){var e=0;for(var t=0;t<this.items.length;t++)this.items[t].can_select()&&e++;return e},size:function(){return this.items.length},raw_size:function(){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_item_collection.js:20800","2013-05-15","auto tombstoned");var e=0;for(var t in this.items)e+=parseInt(this.items[t].raw_size);return e},unselect:function(e){for(var t=this.items.length-1;t>=0;t--)this.items[t].unselect(e)},display_type:function(e){e||(e={});var t=e.capital,n={};$j.map(this.items,function(e){n[e.type]||(n[e.type]=0),n[e.type]++});var r=0,i;for(var s in n)r++,i=s;r!=1&&(i="item");var o;return this.size()==1?o=t?ItemTypeTranslation.singularCapital(i):ItemTypeTranslation.singular(i):o=t?ItemTypeTranslation.pluralCapital(i):ItemTypeTranslation.plural(i),o},is_empty:function(){return this.size()===0}},{actions:[{id:"delete_from_trash"},{id:"delete_me"},{id:"download",sync:$j.browser.msie},{id:"move"},{id:"restore"},{id:"sharebar"},{id:"share"},{id:"tag"},{id:"new_pin"},{id:"synchronize"}],registerActions:function(){$j.each(ItemCollection.actions,function(e){var t=ItemCollection.actions[e];ItemCollection.prototype["can_"+t.id]=function(e){return this.can_execute_action(t.id,e)},ItemCollection.prototype[t.id]=function(e){return this.execute_action(t.id,e,t.sync)}})}});ItemCollection.registerActions(),Box.Timing.execution.push({name:"js/box_item_expansion.js",time:(new Date).getTime()});var ItemExpansion=Base.extend({_active:!1,_openbox_actions:null,active_part:null,element:null,parts:null,item:null,target_part:null,constructor:function(e){return e=e||{},this.item=e.item,this.item?(this.parts={Share:{anchor_class:"share_menu",part_class:"item_expansion_share"},Item_Feed:{anchor_class:"item_feed_menu",part_class:"item_expansion_feed"}},!0):!1},_create_item_feed_part:function(e){$j("#jquery_editable_input").blur();var t=$j(this.element);t.find(".item_expansion_tip").hide(),t.find(".item_expansion_share").hide();var n=t.find(".item_expansion_feed"),r=this;this.item.get_item_feed({j_feed_container:n,show_all:0,hide_onload:1,default_field:e.default_field||"",callback:function(e){n.addClass("expansion"),r.show()}})},update_access:function(){var e=$j(this.element).children(".item_expansion_share").children(".expansion"),t=Item.shared_access_to_icon(this.item.shared_access),n=Item.shared_access_to_string(this.item.shared_access),r=e.find('[data-type="share-access-btn"]');r.find("span:first").removeClass().addClass("img mls mrs shared_link_options sprite_16x16 "+t),r.attr({"data-hover":"tooltip","aria-label":this.item.shared_access_to_tooltip(this.item.shared_access)});var i=$.popup.get().length;if(i){var s=$j("#popup_settings_launcher");s.find("span:first").removeClass().addClass("sprite_16x16 "+t+" list_img"),s.find("a").text(n),typeof SharebarAction!="undefined"&&SharebarAction.update_warnings(this.item)}},_create_share_part:function(){var e=this,t=Box.Application.getService("logger");$j("#jquery_editable_input").blur(),Box_Event_Tracker.get().set_category_by_rm(""),Box_Event_Tracker.get().set_action("Open share menu"),Box_Event_Tracker.get().send(1),Box_Event_Tracker.get().set_category("Files - Shared menu");var n=$j(this.item.element),r=n.find(".share_link"),i=$j(this.element).children(".item_expansion_share").children(".expansion"),s=i.find(".shared_link_section").parent(),o=s.find(".shared_link_input"),u=s.find('[data-type="share-access-btn"]'),a=s.find('[data-type="send-btn"]'),f=i.children(".item_expansion_tip"),l=0;this.item.permissions.share?(i.show(),i.find('[data-type="send-btn"]').show(),s.show(),l++,this.item.expirations.unshare?(l++,i.find(".expirations_status_icon").attr({"data-hover":"tooltip","aria-label":$t("This link will expire on %1","link_will_expire",this.item.expirations.unshare)}).show().siblings("input").addClass("has_expirations_status_icon"),s.show()):i.find(".expirations_status_icon").hide().siblings("input").removeClass("has_expirations_status_icon"),this.update_access(),l++):s.hide(),this.item.type=="folder"&&this.item.permissions.create_collab?f.show():f.hide();if(this.item.permissions.create_collab){var c="489px",h="-14px";$j.browser.msie&&parseInt($j.browser.version)<8?(c="479px",h="-5px"):$j.browser.mozilla&&(c="496px",h="-21px");var p=$j(".item_collaborators_input",f).css({width:c,"margin-right":h}),d=$j('<button class="collaborators_links img_ext mtn mrl" />').text($t("Invite Collaborators","invite_collabs_button")).off("click").on("click",function(){Collab.invite_selected_collaborators(e.contact_selector,e.item)}),v=$j('<div class="advanced_options img_ext"></div>').hide(),m=$j('<ul class="inline_list"></ul>'),g=$j("<li />").append($j('<a href="#" class="advanced_collab_options_link" />').text($t("Advanced options","advanced_options_link_label"))).click(function(){return e.item&&(Box.Application.getService("popups").open("collaborate",{data:{typed_id:e.item.typed_id,prepopulated_users:e.contact_selector.get_full_selected_options()}}),t.sendLog("sharing","INVITE_COLLABORATORS_ADVANCED_OPTIONS_CLICK",{location:"ITEM_EXPANSION"})),!1}),y=$t("How does this work?","js_contacts_how_work")+"|"+$t("Use 'Advanced options' to restrict access permissions or include a personal message.","js_contacts_how_work_text"),b=$j('<li class="mrm"/>').append($j('<div class="mts list_img sprite_16x16_info" />').attr({"data-hover":"tooltip","aria-label":y}));m.append(d),m.append(g),m.append(b),v.append(m);var w=function(){v.show()},E={j_component:p,item_typed_id:e.item.typed_id,no_results_label:$t("No matching contacts","no_results_label_contact_selector_invite_collabs"),show_dropdown_toggler:!1,include_network_contacts:!0,show_advanced_options:!0,hide_no_results_item:!0,ui_elements_to_append:[v],on_first_focus_callback:w};this.contact_selector=new Box_All_Contact_Selector(E)}if(!this.item.permissions.share&&this.item.hide_collaborators){var S=$t("You do not have permission to view sharing information.","popup_action_sharing_permission_error");Box.Application.getService("notifications").error(S,{legacy:{disable_scroll:!0}});return}var x=this.item.type=="folder"?$t("folder","part_item_js_type_folder"):$t("file","part_item_js_type_file");i.find(".share_node_type").text(x),!this.item.shared&&this.item.permissions.share?(r.text($t("Loading...","part_item_loading")),this.item.share({callback:function(){e.item.render({force_render_classes:!0}),i.find(".share_menu_a").attr("href",e.item.shared_link),o.val(e.item.shared_link).attr("id","shared_link_input_"+e.item.id),u.attr("id","shared_link_set_access_btn_"+e.item.id),a.attr("id","shared_link_send_btn_"+e.item.id),e.show();if(e.item.expirations.unshare){var t=e.element.find(".expirations_status_icon"),r=e.element.find(".shared_link_input"),s=r.data("num_icons_in_input_row");r.removeClass("num_of_icons_"+s).addClass("has_expirations_status_icon num_of_icons_"+(s+1)).data("num_icons_in_input_row",s+1),t.attr({"data-hover":"tooltip","aria-label":$t("This link will expire on %1","link_will_expire",e.item.expirations.unshare)}).show()}n.find(".item_info").addClass("item_expansion_margin"),e.item.display_in_place_share(),e.item.expansion.update_access()}})):(this.update_shared_link(),o.attr("id","shared_link_input_"+this.item.id),u.attr("id","shared_link_set_access_btn_"+this.item.id),a.attr("id","shared_link_send_btn_"+this.item.id),this.show()),o.data("num_icons_in_input_row",l),o.addClass("num_of_icons_"+l).select();if($j.browser.msie){var T=i.find("ul.multi_button");T.css({"font-size":"0","line-height":"0"}).find("input").css("font-size","12px")}},update_shared_link:function(){var e=$j(this.element).children(".item_expansion_share").children(".expansion"),t=e.find(".shared_link_input");t.val(this.item.shared_link)},_render_init:function(){return this.element||(this.element=$j("#tpl_item_expansion").clone().attr({"data-typed-id":this.item.typed_id,id:"item_expansion_"+this.item.get_unique_identifier()})),this.element?($j(this.item.element).after(this.element),!1):!1},_render_openbox_action:function(e){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_item_expansion.js:15233","2013-05-15","auto tombstoned");var t=this._openbox_actions[e];if(!t.can_execute())return;var n=$j(".menu_openbox_services",this.element),r=$j("<a></a>").attr("href","#").addClass(t.menu_item_id||t.ml_name).click(function(){return typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_item_expansion.js:15234","2013-05-15","auto tombstoned"),t.execute(),!1}).show();t.favicon_url&&$j("<span></span>").css({background:"url("+t.favicon_url+") center left no-repeat",paddingBottom:$j.browser.msie?0:1,paddingLeft:18,paddingRight:0,paddingTop:$j.browser.msie?2:1}).text(t.name).appendTo(r),t.executed_by_default&&n.prepend("<br />"),n[t.executed_by_default?"prepend":"append"](r),t.executed_by_default||n.append("<br />")},hide:function(){Box_Event_Tracker.get().category=="Files - Shared menu"&&(Box_Event_Tracker.get().category="");if(!this.element||!this.active_part)return;var e=this,t=$j(this.element),n=t.find("."+this.parts[this.active_part].part_class);this.active_part=null,$j(e.item.element).find(".medium_up_arrow_border").fadeOut("fast"),t.slideUp("fast",function(){if(e.active_part)return;n.hide(),$j.selectable("refresh"),$j.fast_draggable("refresh"),e.remove()}),this._set_tooltip_for_toggle_button_on_hide();var r=$j(this.item.element);r.removeClass("item_expanded item_comments_expanded item_feed_expanded item_share_expanded item_tasks_expanded")},_set_tooltip_for_toggle_button_on_hide:function(){var e=$j(this.item.element),t=e.find(".item_feed_menu"),n=Box.Application.getService("nav-state");if(Box.Application.getGlobalConfig("useMinimal")==="use_minimal"){t.attr({"data-hover":"tooltip","aria-label":$t("Add a comment or task.","item_feed_tooltip_add_general")});return}if(n.isSharedPage()){var r=parseInt(this.item.comments_count);r==1?t.attr({"data-hover":"tooltip","aria-label":$t("%1 comment. Click to view or add.","item_feed_tooltip_view_add_one_shared",r)}):r>1?t.attr({"data-hover":"tooltip","aria-label":$t("%1 comments. Click to view or add.","item_feed_tooltip_view_add_many_shared",r)}):t.attr({"data-hover":"tooltip","aria-label":$t("Add a comment.","item_feed_tooltip_add_general_shared")})}else{var r=parseInt(this.item.comments_count)+parseInt(this.item.task_count);r==1?t.attr({"data-hover":"tooltip","aria-label":$t("%1 comment or task. Click to view or add.","item_feed_tooltip_view_add_one",r)}):r>1?t.attr({"data-hover":"tooltip","aria-label":$t("%1 comments and tasks. Click to view or add.","item_feed_tooltip_view_add_many",r)}):t.attr({"data-hover":"tooltip","aria-label":$t("Add a comment or task.","item_feed_tooltip_add_general")})}},remove:function(){if(!this.element)return;$j(this.item.element).find(".medium_up_arrow_border").hide();var e=$j(this.item.element),t=e.find(".menu_links a");$j(this.element).remove(),this.element=null,this.active_part=null,this.target_part=null,e.add(t).removeClass("expanded")},render:function(){return Canvas.get().use_item_expansion?(this._render_init(),this.element):null},show:function(){this.element||(this.element=$j("#item_expansion"+this.item.get_unique_identifier())),this.element.length||this.render();var e=$j(this.item.element),t=$j(this.element),n=!1;if(!this.target_part||this.target_part==this.active_part)this.target_part=this.active_part,n=!0;var r=t.find("."+this.parts[this.target_part].part_class);e.find(".comment_data").addClass("expanded");var i=$j(this.element).find(".medium_up_arrow_border");i.length||(i=$j('<div class="medium_up_arrow_border"><div class="medium_up_arrow"></div></div>'),t.find(".item_feed").children("li").eq(0).hasClass("task_highlight")&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_item_expansion.js:15247","2013-05-15","auto tombstoned"),i.children(".medium_up_arrow").addClass("highlighted_arrow sprite_24x24_yellow_arrow").removeClass("medium_up_arrow")));var s,o,u;if(this.target_part=="Share"){var a=e.find(".action_share");o=a.position().left,s=27,i&&o&&(u=parseInt(o),isNaN(u)||i.css("left",u+s)),e.addClass("item_share_expanded")}else if(this.target_part=="Item_Feed"){var f=e.find(".feed_item");s=5;var l=f.position();l?o=l.left:o=0,i&&o&&(u=parseInt(o,10),isNaN(u)||i.css("left",u+s)),t.find(".comment").length&&t.find(".comment:eq(0)").css("padding-top",0),e.addClass("item_feed_expanded")}if(this.active_part){e.removeClass("item_comments_expanded item_feed_expanded item_share_expanded item_tasks_expanded");var c=t.children("."+this.parts[this.active_part].part_class),h=c.innerHeight();t.css("height",h);var p=r.innerHeight(),d=400;n||c.fadeOut(d/2,function(){r.fadeIn(d/2),c.hide()}),t.stop().animate({height:p},d,function(){t.css("height",""),$j.selectable("refresh"),$j.fast_draggable("refresh"),i&&i.prependTo(t)})}else r.slideDown(),t.css("height",""),t.css("display","block"),i&&i.prependTo(t);e=$j(this.item.element),e.addClass("item_expanded"),this.active_part=this.target_part,this.target_part=null},toggle:function(e,t){$j(".body").removeClass("disable_sprite_18x18");var n=$j(this.item.element),r=n.find(".hide_menu");if(Canvas.get().view=="icon")return!1;t=t||{},this.element||this.render();if(e==this.active_part)return n.find(".item_info").removeClass("item_expansion_margin"),$j("#jquery_editable_input").blur(),this.hide(),!1;if(!this.parts[e])return!1;this.target_part=e,Box_Menus.get().menu.hide(),n.find(".item_border").addClass("item_no_border"),(this.item.shared||this.target_part!="Share")&&n.find(".item_info").addClass("item_expansion_margin"),r.show();if(this.active_part){var i=n.find("a."+this.parts[this.active_part].anchor_class);n.add(i).removeClass("expanded")}if(!(this.target_part!="Item_Feed"||this.item.type=="folder"||!this.item.permissions.create_comment&&Box.Application.getGlobalConfig("useMinimal")!=="use_minimal"))return n.find(".item_expansion").removeClass("expanded"),this._create_item_feed_part(t),!1;if(this.target_part=="Share"){n.find(".item_expansion").addClass("expanded");if(this.item.shared_link==""){var s=$j(this.item.element).find(".share_link"),o=s.text();s.text($t("Loading...","part_item_loading"));var u=this;return this.item.get_shared_info(function(r){s.text(o),u.toggle(e,t)}),!1}return this._create_share_part(),!1}}},{});Box.Timing.execution.push({name:"js/box_item_selection.js",time:(new Date).getTime()});var ItemSelection=Base.extend({collection:null,constructor:function(e){e=e||{},this.collection=new ItemCollection},add:function(e,t){if(this.collection.find(e.id))return;this.collection=this.clone(this.collection),this.collection.add(e),t||Box_Menus.get().multi_options_menu.render(this.collection),this.check_select_all()},remove:function(e,t){if(!this.collection.find(e.id))return;this.collection=this.clone(this.collection),this.collection.remove(e),t||Box_Menus.get().multi_options_menu.render(this.collection),this.check_select_all()},check_select_all:function(){Canvas.get().count_items()==Canvas.get().selection.collection.size()?$(".select_all").children("a").removeClass("sprite_item_list_checkbox").addClass("sprite_item_list_checkbox_checked"):$(".select_all").children("a").removeClass("sprite_item_list_checkbox_checked").addClass("sprite_item_list_checkbox")},select_all:function(){for(var e in Canvas.get().collections)Canvas.get().collections[e].select(!0);$j("#select_all").removeClass("sprite_item_list_checkbox").addClass("sprite_item_list_checkbox_checked"),Box_Menus.get().multi_options_menu.render(this.collection)},toggle_all:function(){var e=0;for(var t=0;t<Canvas.get().collections.length;t++)e=Canvas.get().collections[t].selectable_count();this.collection.size()<e?this.select_all():this.unselect_all()},unselect_all:function(){this.collection=this.clone(this.collection),this.collection.unselect(!0),$j("#select_all").addClass("sprite_item_list_checkbox").removeClass("sprite_item_list_checkbox_checked"),typeof Box_Menus.get().multi_options_menu!="undefined"&&Box_Menus.get().multi_options_menu.render(this.collection)},clone:function(e,t){var n;if(typeof e=="object")if(!e)n=null;else if(e instanceof Base)if(typeof t!="undefined")n=e;else{var r=function(){};r.prototype=e.constructor.prototype,n=new r;for(var i in e){if(!e.hasOwnProperty(i))continue;n[i]=this.clone(e[i],"object["+i+"]")}}else if(e instanceof Array){n=[];for(var s=0;s<e.length;s++)n[s]=this.clone(e[s],t+"["+s+"]")}else{n={};for(var o in e)n[o]=this.clone(e[o],t+"["+o+"]")}else n=e;return n}},{});Box.Timing.execution.push({name:"js/box_item_type_translations.js",time:(new Date).getTime()});var ItemTypeTranslation=Base.extend({},{_translations:{file:{singular:$t("file","js_global_type_file"),singularCapital:$t("File","js_global_type_file_capital"),plural:$t("files","global_type_files"),pluralCapital:$t("Files","global_type_files_capital")},folder:{singular:$t("folder","js_global_type_folder"),singularCapital:$t("Folder","js_global_type_folder_capital"),plural:$t("folders","global_type_folders"),pluralCapital:$t("Folders","global_type_folders_capital")},item:{singular:$t("item","global_type_item"),singularCapital:$t("Item","global_type_item_capital"),plural:$t("items","global_type_items"),pluralCapital:$t("Items","global_type_items_capital")},web_link:{singular:$t("bookmark","global_type_web_link"),singularCapital:$t("Bookmark","global_type_web_link_capital"),plural:$t("bookmarks","global_type_web_links"),pluralCapital:$t("Bookmarks","global_type_web_links_capital")},webdoc:{singular:$t("webdoc","global_type_webdoc"),singularCapital:$t("Webdoc","global_type_webdoc_capital"),plural:$t("webdocs","global_type_webdocs"),pluralCapital:$t("Webdocs","global_type_webdocs_capital")}},_get:function(e){return ItemTypeTranslation._translations[e]||ItemTypeTranslation._translations.item},plural:function(e){return ItemTypeTranslation._get(e).plural},pluralCapital:function(e){return ItemTypeTranslation._get(e).pluralCapital},singular:function(e){return ItemTypeTranslation._get(e).singular},singularCapital:function(e){return ItemTypeTranslation._get(e).singularCapital},singular_from_item:function(e){return e.is_webdoc()?ItemTypeTranslation._get("webdoc").singular:ItemTypeTranslation._get(e.type).singular},translate:function(e,t,n){return t!=1?n?ItemTypeTranslation.pluralCapital(e):ItemTypeTranslation.plural(e):n?ItemTypeTranslation.singularCapital(e):ItemTypeTranslation.singular(e)}});Box.Timing.execution.push({name:"js/box_item_expiration.js",time:(new Date).getTime()});var Item_Expiration=Box_Object.extend({action:null,execute_at:null,id:null,item:null,need_notify:null,notify_at:null,constructor:function(e){this.set_params(e)}},{type:"item_expiration"});Action.register_actions("Item_Expiration",[]),Box.Timing.execution.push({name:"js/selections/box_abstract_selection.js",time:(new Date).getTime()});var Abstract_Selection=Base.extend({selected_item_collection:null,_all_loaded_items_collections:null,_select_all_element_id:"select_all",_on_select:null,_on_deselect:null,constructor:function(e){e=e||{},this._on_select=e.on_select,this._on_deselect=e.on_deselect,this._select_all_element_id=e.select_all_element_id||this._select_all_element_id},select:function(e,t){if(this.selected_item_collection.find(e.id))return;this.selected_item_collection.add(e),t||(this._handle_rendering_options_menu(),$j.isFunction(this._on_select)&&this._on_select(e)),this.check_select_all()},_handle_rendering_options_menu:function(){},unselect:function(e,t){if(!this.selected_item_collection.find(e.id))return;this.selected_item_collection.remove(e),t||(this._handle_rendering_options_menu(),$j.isFunction(this._on_deselect)&&this._on_deselect(e)),this.check_select_all()},check_select_all:function(){this._all_loaded_items_collections.size()==this.selected_item_collection.size()?$j("#"+this._select_all_element_id).removeClass("sprite_16x16_select").addClass("sprite_16x16_selected"):$j("#"+this._select_all_element_id).removeClass("sprite_16x16_selected").addClass("sprite_16x16_select")},select_all:function(){var e=this._all_loaded_items_collections.each(function(e){e.select(!0)});this.check_select_all(),this._handle_rendering_options_menu(),$j.isFunction(this._on_select)&&this._on_select(e)},toggle_all:function(){this.selected_item_collection.size()<this._all_loaded_items_collections.size()?this.select_all():this.unselect_all()},unselect_all:function(){var e=this._all_loaded_items_collections.each(function(e){e.unselect(!0)});this.check_select_all(),this._handle_rendering_options_menu(),$j.isFunction(this._on_deselect)&&this._on_deselect(e)},reset:function(){this.selected_item_collection&&this.selected_item_collection.reset(),this.selected_item_collection&&this._all_loaded_items_collections.reset()}},{});Box.Timing.execution.push({name:"js/selections/box_device_pinning_selection.js",time:(new Date).getTime()});var Device_Pinning_Selection=Abstract_Selection.extend({constructor:function(e,t,n){n=n||{},this.base(n),this.selected_item_collection=t?t:new Device_Pinning_Collection,this._all_loaded_items_collections=e?e:new Device_Pinning_Collection},_handle_rendering_options_menu:function(){},check_select_all:function(){this._all_loaded_items_collections.size()==this.selected_item_collection.size()?$j("#"+this._select_all_element_id).attr("checked","checked"):$j("#"+this._select_all_element_id).removeAttr("checked")}},{});Box.Timing.execution.push({name:"js/collections/box_abstract_collection.js",time:(new Date).getTime()});var Abstract_Collection=Base.extend({objects:null,_length:0,constructor:function(e){this.reset(),this.set_params(e)},reset:function(){this.objects={},this._length=0},set_params:$j.abstract_function,_is_correct_object_instance:$j.abstract_function,add:function(e,t){if(!this._is_correct_object_instance(e))return;this.objects[t]=e,this._length+=1},remove:function(e,t){if(!this._is_correct_object_instance(e))return;delete this.objects[t],this._length-=1},find:function(e){if(typeof e=="number"||typeof e=="string")return this.objects[e]},size:function(){return this._length},each:function(e){return $.map(this.objects,function(t,n){return e(t),t})}},{});Box.Timing.execution.push({name:"js/collections/box_device_pinning_collection.js",time:(new Date).getTime()});var Device_Pinning_Collection=Abstract_Collection.extend({set_params:function(e){e=e||{};var t=this;$j.each(e,function(e,n){var r=t.find(n.id);r?r.set_params(n):(r=new Device_Pinning(n),r.j_selected_element=$j("#"+n.typed_id).find("input[type=checkbox]"),t.add(r))})},add:function(e){this
.base(e,e.id)},remove:function(e){this.base(e,e.id)},_is_correct_object_instance:function(e){return e instanceof Device_Pinning}},{});Box.Timing.execution.push({name:"js/box_openbox_action.js",time:(new Date).getTime()});var OpenboxAction=Base.extend({_input_params:null,_open_in_window:!1,_openbox_action_id:null,_skip_popup:!1,_asct:null,description:"",favicon_url:null,id:0,item:null,name:"",source:"unknown",uniq_name:"",_call:function(e){e=e||{};var t="https:",n=t+"//"+window.location.host+"/services/";n+=this.uniq_name+"/"+this.id+"/"+this.item.id;if(this.item.file_id_hash||this._asct)n+="/"+(this.item.file_id_hash?this.item.file_id_hash:"")+(this._asct?"."+this._asct:"");this.item.name&&(n+="/"+this.item.encoded_name());if(this.source=="shared_folder"||this.source=="shared_file"||this.source=="vanity_url"||this.item.update&&(this.item.update.update_type==1||this.item.update.update_type==2))Canvas.get().collab_invite_token?(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_openbox_action.js:6873","2013-05-15","auto tombstoned"),n+="/collab_preview/"+Canvas.get().collab_invite_token):n+="/shared/"+(this.item.shared_name||window.shared_name||this.item.update.folder.shared_name);var r="";this.item.type!="file"&&(r+="&node_type="+this.item.type),$j.each(e,function(t){r+="&name[]="+encodeURIComponent(t),r+="&value[]="+encodeURIComponent(e[t])}),window.location.protocol=="https:"&&this._open_new_window&&(r+="&from_https=1");if(this._open_new_window){var i="openbox_"+this.id+"_"+this.item.typed_id,s="";this.extensions_executed_by_default.length||(this._new_window_opens_in_tab||(s="height="+this.height+", width="+this.width+", left=100, top=120, status=no,toolbar=no,menubar=no,location=no,scrollbars=yes,resizable=yes"),r+="&loading_page=1");var o=window.open("",i,s);try{if(o.is_openbox_service){o.focus(),o.alert($t("Here is the window that you have already opened for this %1","openbox_service_already_open_for_item",ItemTypeTranslation.singular(this.item.type))),this.extensions_executed_by_default.length||$j.popup.close();return}}catch(u){}r&&(r="?"+r.substr(1));var a=Box.Application.getService("url");o=a.openWindow(n+r,i,s),o&&o.focus(),this.extensions_executed_by_default.length||$j.popup.close();return}r+="&ajax_call=1",this._popup_loading(),r&&(r="?"+r.substr(1)),$j.getJSON(n+r,function(e){var t=Box.Application.getService("url"),n=e.message.match(/<a href="(mailto:.*)"\ /);n&&n[1]&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_openbox_action.js:125","2013-08-08","Checks to see if incoming action message has email"),t.goToUrl(n[1])),$j.popup.close(),(box||inbox).after_load_callback=function(){Box.Application.getService("notifications").confirm(e.message)},Box.Application.navigate("",{},{not_scroll:!0})})},_create_popup:function(){$j.popup.form($.box.escapeHTML(this.name),[{type:"text",data:$t("Loading...","js_loading")}],{favicon_url:this.favicon_url})},_get_input_params:function(){var e=this,t="/index.php?rm=",n=null;this.source=="files"||this.source=="updates"||this.source=="user_profile"?n="box_service_action_get_input_params":n="box_openbox_get_input_params_on_shared_node&shared_name="+(this.item.params.folder||this.item).shared_name,t+=n;var r={action_id:this._openbox_action_id,node_type:this.item.type,node_id:this.item.id};jQuery.ajax({type:"POST",url:t,data:r,dataType:"json",async:!1,success:function(t){e._skip_popup=t.skip_popup,e.description=t.message,e.oauth2_permission_message=t.oauth2_permission_message,e._asct=t.asct,e._skip_popup||(e._input_params=t.input_params,e._populate_popup())}}),this._skip_popup&&this._call()},_populate_popup:function(){var data_types={checkbox:"checkbox",drop_down:"dropdown","enum":"radio",password:"password",string:"input",text:"textarea"},section=null,controls=$j.map(this._input_params,function(data,i){data.section_break&&(section={type:"section",align:"left",collapsable:!0,collapsed:i!=0,label:data.section_break,contents:[]});var type=data_types[data.data_type];if(!type)return null;var item={type:type,data:data.value,items:data.enum_values?eval(data.enum_values):null,label:data.label,linebreak:!0,name:data.name,value:data.value};return section?(section.contents.push(item),data.section_break?section:null):item}),headline_text=this._open_new_window?$t("You will be taken to a third-party application","openbox_action_popup_third_party_app"):$t("This file will be sent to third-party application","openbox_action_send_file_to_third_party_app"),j_image_tag=$j('<img style="vertical-align: middle; margin-right: 3px;" />').attr("src",Box.Application.getService("assets").getAssetURL(images_path,"application_link.png")),j_security_message_title=$t("Notice","openbox_action_popup_tooltip_title")+"|"+$t("OpenBox lets you send your files to other applications and web services.","openbox_action_tooltip_text_short"),j_security_message=$j('<div class="block" id="security_message"/>').append(j_image_tag).append($.box.escapeHTML(headline_text)).append($j('<div class="list_img sprite_16x16_info mls"></div>').attr({"data-hover":"tooltip","aria-label":j_security_message_title})),me=this,popup_input=[];this.oauth2_permission_message&&(popup_input=popup_input.concat([{type:"html",data:$t("This third party application is requesting the ability to:","openbox_action_oauth2_request_access")},{type:"html",data:this.oauth2_permission_message}])),popup_input=popup_input.concat([{type:"html",data:this.description},{type:"section",align:"left",contents:controls},{type:"buttons",items:{okay:{value:$t("Okay","js_popup_button_okay"),click:function(e,t){me._call(e)}},cancel:{value:$t("Cancel","js_popup_button_cancel"),click:$j.popup.close}}},{type:"html",data:j_security_message}]),$j.popup.form($.box.escapeHTML(this.name),popup_input)},_popup_loading:function(){$j.popup.form($.box.escapeHTML(this.name),[{type:"text",data:$t("Please wait while your request is being processed...","openbox_action_popup_processed")}],{favicon_url:this.favicon_url})},execute:function(e){var t=e&&e.skip_popup||this._skip_popup,n=Box.Application.getService("nav-state"),r=n.isPreviewerOpen(),i=!1,s=!1;r&&(i=n.galleryItem().can_edit_on_gallery_using(this),s=n.galleryItem().can_view_on_gallery_using(this));if(!this.extensions_executed_by_default.length&&!t&&(!r||!i)&&(!r||!s)){this._create_popup(),this._get_input_params();return}this._call()}},{actions:[],data:{},create:function(e){e=e.substr("openbox_service".length);var t=OpenboxAction.data[e],n=function(n,r){n=n||{},this.item=n.item,this.source=n.source,r=r||{},this.ssl=t.ssl==1,this._open_new_window=t.open_new_window==1,this._new_window_opens_in_tab=t.new_window_opens_in_tab==1,this._openbox_action_id=e,this._skip_popup=n.skip_popup||t.skip_popup==1,this.description=t.message,this.extensions_executed_by_default=t.extensions_executed_by_default,this.extensions_editable_on_gallery=t.extensions_editable_on_gallery,this.extensions_viewable_on_gallery=t.extensions_viewable_on_gallery,this.favicon_url=t.favicon_url,this.id=e,this.name=t.name,this.uniq_name=t.service_uniq_name,this.width=t.width,this.height=t.height,this._asct=t.asct},r=t.allowed_extensions||[];n.allowed_extensions={};for(var i=0;i<r.length;i++)n.allowed_extensions[r[i].toLowerCase()]=!0;return $.isEmptyObject(n.allowed_extensions)||(n.other_extensions_disallowed=!0),n.allowed_types={file:t.node_type=="both"||t.node_type=="file",folder:t.node_type=="both"||t.node_type=="folder",web_link:t.node_type=="web_link"},n.required_permissions={create_tag:t.required_permissions.indexOf("g")!=-1,create_collab:t.required_permissions.indexOf("k")!=-1,create_comment:t.required_permissions.indexOf("c")!=-1,download:t.required_permissions.indexOf("d")!=-1&&e!=webdoc_action_id,"delete":t.required_permissions.indexOf("e")!=-1,rename:t.required_permissions.indexOf("n")!=-1,remove:t.required_permissions.indexOf("r")!=-1,options:t.required_permissions.indexOf("o")!=-1,preview:t.required_permissions.indexOf("p")!=-1,set_share_access:t.required_permissions.indexOf("h")!=-1,share:t.required_permissions.indexOf("s")!=-1,synchronize:t.required_permissions.indexOf("y")!=-1,upload:t.required_permissions.indexOf("u")!=-1,view:t.required_permissions.indexOf("v")!=-1},n.service_action_id=t.id,n.locking=t.locking,t.required_locking&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_openbox_action.js:6894","2013-05-15","auto tombstoned"),n.custom_permissions=[function(e){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_openbox_action.js:6895","2013-05-15","auto tombstoned");if(t.required_locking=="locked")return typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_openbox_action.js:6896","2013-05-15","auto tombstoned"),e.lock!=null;if(t.required_locking=="unlocked")return typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_openbox_action.js:6897","2013-05-15","auto tombstoned"),e.lock==null}]),n.prototype=OpenboxAction.prototype,n},exists:function(e){for(var t in OpenboxAction.actions)if(OpenboxAction.actions[t]==e)return!0;return!1},load:function(e){if(!e)return;var t={};OpenboxAction.actions=[];for(var n in e)OpenboxAction.actions.push("openbox_service"+e[n].id),t[e[n].id]=e[n];OpenboxAction.data=t},incrementalLoad:function(e){if(!e)return;var t=OpenboxAction.data;for(var n in e){var r="openbox_service"+e[n].id;$j.inArray(r,OpenboxAction.actions)==-1&&OpenboxAction.actions.push("openbox_service"+e[n].id),t[e[n].id]=e[n]}OpenboxAction.data=t}});Box.Timing.execution.push({name:"js/box_user.js",time:(new Date).getTime()});var User=Box_Object.extend({_actions:null,features:null,auto_accept_collab:!1,collab_in_current_folder:null,email:null,enterprise_id:null,hide_auto_accept_collab_dialog:!1,hide_upload_new_version_upgrade_dialog:!1,id:null,is_free_user:!1,is_master:null,is_submaster:null,is_sync_user:null,login:null,name:null,job_title:null,public_name:null,space_amount:null,see_other_slaves:null,uniq_id:null,_timeout_id:null,poc:"",pic_urls:{},max_upload_size:null,custom_properties:null,master_invite_status:null,slave_status_id:null,selected:!1,j_selected_element:null,constructor:function(e){this._actions={},this.set_params(e)},set_params:function(e){return e=e||{},this.base(e),this.id&&this.id!="0"?this.uniq_id=this.id:this.email?this.uniq_id=this.email:$j.not_implemented("user uniq_id"),this.process_permissions(e.granted_permissions,User.PERMISSION_CONSTANTS),this},update_params_and_render:function(e,t){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_user.js:11184","2013-05-15","auto tombstoned");if($j.isEmptyObject(e))return;this.set_params(e)},display_name:function(e){e||(e={}),typeof e.use_you=="undefined"&&(e.use_you=!0),typeof e.capitalize=="undefined"&&(e.capitalize=!0),typeof e.html=="undefined"&&(e.html=!0);var t=e.return_wrapper?e.return_wrapper:"<span></span>",n,r=!this.email&&this.login?this.login==Canvas.get().user.login:this.email==Canvas.get().user.login,i=e.use_self&&this.email==e.use_self.email;return r&&e.use_you?i?(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_user.js:11188","2013-05-15","auto tombstoned"),n=e.capitalize?n=$t("Yourself","yourself_capitalized"):$t("yourself","js_yourself")):n=e.capitalize?n=$t("You","js_you_capitalized"):$t("you","js_you"):i?n=e.capitalize?n=$t("Theirself","js_theirself_upper"):$t("theirself","js_theirself"):this.id==User.ANONYMOUS_USER_ID?n=e.capitalize?$t("Someone","js_someone_upper"):$t("someone","js_someone_lower"):n=$.box.escapeHTML(this.name),e.html?(e.profile_link&&this.id&&this.id!="0"&&this.id!="2"?n=this.profile_link(n):e.profile_link&&this.id==User.ANONYMOUS_USER_ID?n=this.profile_link("Someone"):e.profile_link&&this.id==0&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_user.js:11193","2013-05-15","auto tombstoned"),n=this.profile_link(this.email)),n=$j(t).append(n),n):n},open_profile:function(){var e=Box.Application.getService("url");return e.goToUrl("/profile/"+this.id),!1},enterprise:function(){return Canvas.get().enterprises.find(this.enterprise_id)},profile_link:function(e,t){if(this.id&&this.id!="0"&&this.id!="2"){var n="/profile/"+this.id;return t?n:$j('<a class="user" />').attr({id:this.id,href:n}).text(e)}return t?"":$j('<a class="user" href="#" />').text(e).click(function(){return typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_user.js:11197","2013-05-15","auto tombstoned"),!1})},mail_collaborators:function(e,t){t=t||{},Box_Event_Tracker.get().set_action("Message collaborator");var n=e.length==1,r=t.pre_filled_text||"",i={},s=1e3,o=[];for(var u in e){var a=e[u],f=a.id||s++;i[a.id||a.email]={email:a.email,name:a.name,id:f},o.push(a.email)}var l=t.popup_title?t.popup_title:n?$t("Message this collaborator","js_popup_mail_collaborator_message"):$t("Email Collaborators","popup_mail_collaborators_title"),c=$j.popup.renderControl("boxContactsSelector",{label:$t("Users to be messaged","popup_mail_collaborators_users")+":",linebreak:!0,name:"emails_list",rows:3,default_selections:i,include_pending_collabs:!0,item:Canvas.get().current_folder,value:o.join(", "),remove_only:1});$j.popup.form(l,[{type:"textarea",label:$t("Enter a message","js_popup_mail_collaborators_message")+":",linebreak:!0,name:"message",value:r,rows:6},n?{type:"hidden",name:"emails_list",value:o.join(", ")}:{type:"html",data:c},{type:"buttons",items:{okay:{value:$t("Okay","js_popup_button_okay"),click:function(r,i){var s=$j.trim(r.message);if(s=="")return alert("Please enter message before submit."),$j.popup.revert(),!1;var o=[],u=$j("#contacts_selector_list").data("contact_selector"),f=[];u&&(f=u.get_selected_options()),r.emails_list&&(f=f.concat(r.emails_list.split(",")));for(var l in f){var c=$j.trim(f[l]);if(!c)continue;if(!$j.box.isEmail(c))return alert($t("The email address is invalid.","invalid_email")),$j.popup.revert(),!1;o.push(c)}r.emails_list=o.join(",");if(r.emails_list=="")return alert("Please select at least one email before submit."),$j.popup.revert(),!1;Box_Event_Tracker.get().send(1);var h;Canvas.get().current_folder&&!t.personal?(h="/index.php?rm=box_collaborate_send_message",r.node_id=t.is_file?t.is_file:Canvas.get().current_folder.id):(h="/index.php?rm=box_collaborate_send_personal_message",r.user_id=typeof a.id!="undefined"?a.id:e.user_id),$j.post(h,r,function(e){var t=e==1?n?$t("Your message is on its way.","js_collaboration_group_email_confirm_success_single"):$t("Your message is on its way.","collaboration_group_email_confirm_success"):$t("Message will send only for collaborators","js_collaboration_group_email_confirm_only_collabs");Box.Application.getService("notifications").confirm(t),$j.popup.close()},"json")}},cancel:{value:$t("Cancel","js_popup_button_cancel"),click:function(){Box_Event_Tracker.get().send(0),$j.popup.close()}}}}],{favicon_class:"email",default_focus:"message"})},permission_on_folder:function(e,t,n){if(!e.collaborations&&e.id.length){var r=!1;e.load_collabs(r)}if(e.user_id==this.id)return"Owner";var i=Canvas.get();if(e.collaborations){var s=e.collaborations[this.email];n=n||{};var o=[],u;if(this.id!=i.user.id&&e&&e.permissions.rename)for(u in s)t?s[u].item_id==i.current_folder.id&&o.push(s[u].permission):(s[u].accepted!=0||n.ignore_accepted)&&s[u].item_id!=i.current_folder.id&&o.push(s[u].permission);if(o.length===0)for(u in s)(s[u].accepted!=0||n.ignore_accepted)&&o.push(s[u].permission);var a=Collab.merge_permissions(o);return a}return null},permission_on_current_folder:function(e,t){return this.permission_on_folder(Canvas.get().current_folder,e,t)},has_custom_feature:function(e){return $j.inArray(e,this.features)!=-1},trash_folder:function(){var e=Item.find(Item.TRASH_FOLDER_ID);return e},is_co_owner:function(){var e=Box.Application.getService("nav-state"),t=e.get();if(box&&t.type=="s")return!1;var n=!1;for(var r in this.collab_in_current_folder){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_user.js:11234","2013-05-15","auto tombstoned");var i=this.collab_in_current_folder[r];if(i.user_id==this.id&&i.permission=="Co-owner"){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_user.js:11235","2013-05-15","auto tombstoned"),n=!0;break}}return n}},{ANONYMOUS_USER_ID:2,type:"user",PERMISSION_CONSTANTS:{instant_login:"user_instant_login",view:"user_view",edit:"user_edit","delete":"user_delete",deactivate:"user_deactivate",activate:"user_activate",add_as_slave:"user_add_as_slave",edit_external_collaborator:"user_edit_external_collaborator",message:"user_message",promote_to_submaster:"user_promote_to_submaster",change_slave_status:"user_change_slave_status",change_master_user:"user_change_master_user",cancel:"user_cancel",create_admin_access_token:"user_create_admin_access_token",access_grant:"user_access_grant",can_create_reseller:"user_create_reseller",can_create_reseller_rep:"user_create_reseller_rep",reset_password:"user_reset_password",can_change_primary_email:"user_change_primary",edit_groups:"user_edit_group_tag",can_act_as_user:"user_api_act_as_userpi_act_as_user",can_act_on_behalf_of_user:"user_api_on_behalf_of_userpi_on_behalf_of_user",create_login_token:"user_create_login_token",disable:"disable"},find_item_owner_data_by_item_typed_id:function(e,t,n){var r=User.find(e);if(!r){var i=$j.box.formatQuery({item_typed_id:t});$j.getJSON("/index.php?rm=box_files_get_item_owner_info",i,function(e){e&&(Canvas.get().users.set_params(e),$j.isFunction(n)&&n())})}else $j.isFunction(n)&&n()},find_collab_data_by_email:function(e){var t=null,n=Canvas.get().current_folder;if(n&&n.collaborations){var r=n.collaborations[e];r&&(t=new User({name:r[0].name,email:r[0].email}),t.collab_in_current_folder=r)}return t}});Action.register_actions("User",["edit","delete_me","instant_login","add_as_slave","change_master_user","edit_external_collaborator","message","remove_invited_collaborator"]),Box.Timing.execution.push({name:"js/box_contact_info.js",time:(new Date).getTime()});var Box_Contact_Info=Box_Object.extend({_contact_info:null,constructor:function(){Box_Contact_Info.__instance=this,this._contact_info=box_contact_info||null},get_contact_info:function(e,t){try{return this._contact_info[e][t]||""}catch(n){return""}}},{type:"contact_info",get:function(){return Box_Contact_Info.__instance||(Box_Contact_Info.__instance=new Box_Contact_Info),Box_Contact_Info.__instance}});Box.Timing.execution.push({name:"js/box_friend.js",time:(new Date).getTime()});var Friend=Box_Object.extend({},{type:"friend"});Box.Timing.execution.push({name:"js/box_device_pinning.js",time:(new Date).getTime()});var Device_Pinning=Box_Object.extend({id:null,selected:!1,j_selected_element:null,constructor:function(e){this.base(e)},select:function(e){if(this.selected)return;this.selected=!0;var t=this.j_selected_element;t.attr("checked","checked"),Canvas.get().device_pinning_selection.select(this,e)},unselect:function(e){if(!this.selected)return;this.selected=!1;var t=this.j_selected_element;t.removeAttr("checked"),Canvas.get().device_pinning_selection.unselect(this,e)}},{type:"device_pinning"});Box.Timing.execution.push({name:"js/box_admin_permission_assignment.js",time:(new Date).getTime()});var Admin_Permission_Assignment=Box_Object.extend({id:null,constructor:function(e){this.base(e)},has_all_coadmin_permissions:function(e,t){var n=t?this.can_view_automations:!0,r=t?this.can_edit_automations:!0,i=t?this.can_view_policies:!0,s=t?this.can_edit_policies:!0;return this.can_manage_users&&this.can_manage_groups&&this._is_can_view_gcm_enabled(e,!0)&&this._is_can_edit_gcm_enabled(e,!0)&&this.can_instant_login&&this.can_view_enterprise_settings&&this.can_edit_enterprise_settings&&this.can_access_reports&&n&&r&&s&&i},has_some_coadmin_permissions:function(e,t){var n=t?this.can_view_automations:!1,r=t?this.can_edit_automations:!1,i=t?this.can_view_policies:!1,s=t?this.can_edit_policies:!1;return this.can_manage_users||this.can_manage_groups||this._is_can_view_gcm_enabled(e,!1)||this._is_can_edit_gcm_enabled(e,!1)||this.can_instant_login||this.can_view_enterprise_settings||this.can_edit_enterprise_settings||this.can_access_reports||n||r||i||s},_is_can_view_gcm_enabled:function(e,t){return e?this.can_view_global_content:t},_is_can_edit_gcm_enabled:function(e,t){return e?this.can_edit_global_content:t}},{type:"admin_permission_assignment"});Box.Timing.execution.push({name:"js/box_at_mention.js",time:(new Date).getTime()});var At_Mention=Box_Object.extend({seen:null,updated:null,mentionable_item:null,from_user:null,constructor:function(e){this.set_params(e)},mark_read:function(){this.seen=1;var e={at_mention_id:this.id},t=$j.box.formatQuery(e);$j.postJSON("/index.php?rm=box_pim_read_message",t,At_Mention.show_popup_on_error)},remove:function(){var e={at_mention_id:this.id},t=$j.box.formatQuery(e);$j.postJSON("/index.php?rm=box_pim_delete_message",t,At_Mention.show_popup_on_error)}},{type:"at_mention",show_popup_on_error:function(e){e&&e.error&&Box.Application.getService("popups").alert(e.message)}});Action.register_actions("At_Mention",[]),Box.Timing.execution.push({name:"js/box_user_collection.js",time:(new Date).getTime()});var UserCollection=Base.extend({_users:null,constructor:function(e){this._users={},this.set_params(e)},set_params:function(e){e=e||{};var t,n,r,i;for(var s in e)t=e[s],n=t.id||t.user_id,n&&n!="0"?r=n:t.email&&(r=t.email),i=this.find(r),i?i.set_params(t):(i=new User(t),this.add(i))},add:function(e){if(!(e instanceof User))return;this._users[e.uniq_id]=e},find:function(e){return this._users[e]}},{});Box.Timing.execution.push({name:"js/box_group_tag.js",time:(new Date).getTime()});var Group_Tag=Box_Object.extend({name:null,id:null,constructor:function(e){this.set_params(e)},set_params:function(e){e=e||{},this.name=e.display_name||e.group_tag_name||e.name,this.id=e.id||e.group_tag_id,this.base(e);var t=e.permissions?e.permissions:e.granted_permissions;this.process_permissions(t,Group_Tag.PERMISSION_CONSTANTS)},process_permissions:function(e,t){var n={};if($j.isArray(e)){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_group_tag.js:7405","2013-05-15","auto tombstoned");for(var r in e)typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_group_tag.js:7406","2013-05-15","auto tombstoned"),n[e[r]]=!0}else n=e;this.base(n,t)},display_name:function(){return typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_group_tag.js:7407","2013-05-15","auto tombstoned"),this.name}},{type:"group_tag",PERMISSION_CONSTANTS:{view:"group_tag_view",edit:"group_tag_edit","delete":"group_tag_delete",message:"group_tag_message"}});Action.register_actions("Group_Tag",["edit","message","delete_me"]),Box.Timing.execution.push({name:"js/box_group_tag_collection.js",time:(new Date).getTime()});var Group_Tag_Collection=Base.extend({_group_tags_by_id:null,group_tags:null,group_tag_params_array:null,constructor:function(e){this._group_tags_by_id={},this.group_tags=[],this.set_params(e)},set_params:function(e){this.group_tag_params_array=e||{};for(var t in this.group_tag_params_array){var n=this.group_tag_params_array[t],r=n.id||n.group_tag_id,i=r,s=this.find(i);s?s.set_params(n):(s=new Group_Tag(n),this.add(s))}},add:function(e){if(!(e instanceof Group_Tag))return;if(this._group_tags_by_id[e.id]){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_group_tag_collection.js:21056","2013-05-15","auto tombstoned");for(var t=0;t<this.group_tags.length;t++){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_group_tag_collection.js:21057","2013-05-15","auto tombstoned");if(this.group_tags[t].id!=e.id)continue;this.group_tags[t]=e;break}this._group_tags_by_id[e.id]=e;return}this.group_tags.push(e),this._group_tags_by_id[e.id]=e},find:function(e){if(typeof e=="number"||typeof e=="string")return this._group_tags_by_id[e];e=e||{};var t=new Group_Tag_Collection;for(var n=0;n<this.group_tags.length;n++){var r=this.group_tags[n],i=!1;for(var s in e){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_group_tag_collection.js:21060","2013-05-15","auto tombstoned");if(r[s]!=e[s]){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_group_tag_collection.js:21061","2013-05-15","auto tombstoned"),i=!0;break}}if(i)continue;t.add(r)}return t},remove:function(e){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_group_tag_collection.js:21062","2013-05-15","auto tombstoned");if(!(e instanceof Group_Tag))return;delete this._group_tags_by_id[e.id];for(var t=0;t<this.group_tags.length;t++){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_group_tag_collection.js:21063","2013-05-15","auto tombstoned");if(this.group_tags[t].id!=e.id)continue;this.group_tags.splice(t,1);break}}},{});Box.Timing.execution.push({name:"js/box_group_tag_user.js",time:(new Date).getTime()});var Group_Tag_User=Box_Object.extend({is_group_submaster:null,id:null,constructor:function(e){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_group_tag_user.js:745","2013-05-15","auto tombstoned"),this.set_params(e)},set_params:function(e){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_group_tag_user.js:746","2013-05-15","auto tombstoned"),e=e||{},this.base(e),this.id=e.id||e.group_tag_user_id,this.is_group_submaster=e.is_group_submaster||!1}},{type:"group_tag_user"});Box.Timing.execution.push({name:"js/box_enterprise.js",time:(new Date).getTime()});var Enterprise=Box_Object.extend({name:null,id:null,all_users_count:null,permissions:null,item_permissions:null,constructor:function(e){this.set_params(e)},set_params:function(e){e=e||{},this.base(e),this.name=e.display_name||e.name||this.name,this.id=e.id||e.enterprise_id||this.id,this.process_permissions(e.granted_permissions,Enterprise.PERMISSION_CONSTANTS)},display_name:function(){return this.display_name||this.name},show_action_menu:function(e){e=e?e:{},e.enterprise=this,Box_Menus.get().enterprise_action_menu.show(e)}},{type:"enterprise",PERMISSION_CONSTANTS:{view:"enterprise_view",edit:"enterprise_edit","delete":"enterprise_delete",deactivate:"enterprise_deactivate",activate:"enterprise_activate",add_user:"enterprise_add_user",add_group_tag:"enterprise_add_group_tag",bulk_add_users:"enterprise_bulk_add_users",bulk_edit_users:"enterprise_bulk_edit_users",view_all_group_tags:"enterprise_view_all_group_tags",view_all_users:"enterprise_view_all_users",view_logs:"enterprise_view_logs",view_home_tab:"enterprise_view_home_tab",view_users_tab:"enterprise_view_users_tab",view_external_users_tab:"enterprise_view_external_users_tab",view_groups_tab:"enterprise_view_groups_tab",view_reports_tab:"enterprise_view_reports_tab",view_admin_settings_tab:"enterprise_view_admin_settings_tab",view_app_use_management_tab:"enterprise_view_app_use_management_tab",view_policies_tab:"enterprise_view_policies_tab",view_automations_tab:"enterprise_view_automations_tab",manage_content:"enterprise_manage_content",manage_enterprise:"enterprise_manage_enterprise",view_gcm_tab:"enterprise_view_gcm_tab",can_change_tos:"enterprise_can_change_tos",cancel_billing:"enterprise_cancel_billing",edit_trial_length:"enterprise_edit_trial_length",create_content_workflow_policy:"create_content_workflow_policy",create_content_workflow_automation:"create_content_workflow_automation",enterprise_view_quarantines:"enterprise_view_quarantines",publish:"enterprise_publish",enterprise_view_client_setting_values:"enterprise_view_client_setting_values"}});Action.register_actions("Enterprise",["add_user","add_group_tag","bulk_add_users","bulk_edit_users","edit","instant_login"]),Box.Timing.execution.push({name:"js/box_enterprise_collection.js",time:(new Date).getTime()});var Enterprise_Collection=Base.extend({_enterprises_by_id:null,enterprises:null,enterprise_params_array:null,constructor:function(e){this._enterprises_by_id={},this.enterprises=[],this.set_params(e)},set_params:function(e){this.enterprise_params_array=e||{};for(var t in this.enterprise_params_array){var n=this.enterprise_params_array[t],r=n.id||n.enterprise_id,i=r,s=this.find(i);s?s.set_params(n):(s=new Enterprise(n),this.add(s))}},add:function(e){if(!(e instanceof Enterprise))return;if(this._enterprises_by_id[e.id]){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_enterprise_collection.js:20979","2013-05-15","auto tombstoned");for(var t=0;t<this.enterprises.length;t++){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_enterprise_collection.js:20980","2013-05-15","auto tombstoned");if(this.enterprises[t].id!=e.id)continue;this.enterprises[t]=e;break}this._enterprises_by_id[e.id]=e;return}this.enterprises.push(e),this._enterprises_by_id[e.id]=e},find:function(e){if(typeof e=="number"||typeof e=="string")return this._enterprises_by_id[e];e=e||{};var t=new Enterprise_Collection;for(var n=0;n<this.enterprises.length;n++){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_enterprise_collection.js:20982","2013-05-15","auto tombstoned");var r=this.enterprises[n],i=!1;for(var s in e){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_enterprise_collection.js:20983","2013-05-15","auto tombstoned");if(r[s]!=e[s]){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_enterprise_collection.js:20984","2013-05-15","auto tombstoned"),i=!0;break}}if(i)continue;t.add(r)}return t},remove:function(e){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_enterprise_collection.js:20985","2013-05-15","auto tombstoned");if(!(e instanceof Enterprise))return;delete this._enterprises_by_id[e.id];for(var t=0;t<this.enterprises.length;t++){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_enterprise_collection.js:20986","2013-05-15","auto tombstoned");if(this.enterprises[t].id!=e.id)continue;this.enterprises.splice(t,1);break}}},{});Box.Timing.execution.push({name:"js/box_event_tracker.js",time:(new Date).getTime()});var Box_Event_Tracker=Base.extend({info:"",category:"",action:"",category_remembered:0,tracker:null,constructor:function(e){this.category="",this.action="",this.tracker=e.tracker},set_category:function(e){this.category=e},set_category_by_rm:function(e){var t=Box.Application.getService("v5").get("current_rm");t==="box_files"?this.category=e!=""?"Files - "+e:"Files":t==="box_v2_new_inbox"?this.category=e!=""?"Updates - "+e:"Updates":t==="box_user_profile_view"?this.category=e!=""?"Profile - "+e:"Profile":t==="box_collaborators"&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_event_tracker.js:20755","2013-05-15","auto tombstoned"),this.category=e!=""?"Collaborators - "+e:"Collaborators")},set_action:function(e){this.action=e},reset:function(){this.category!="Files - Shared menu"&&this.action!="Link to file"&&this.action!="Link to folder"&&this.action!="Upgrade direct_link - Popup"&&this.action!="Upgrade password_protect - Popup"?(this.category="",this.category_remembered=0):this.category_remembered=1,this.action="",this.info=""},send_modular_event:function(e,t,n){try{event_tracking&&e!=""&&t!=""&&this.tracker.push(["_trackEvent",e,t,event_tracking_tariff,n])}catch(r){}},send:function(e){try{event_tracking&&this.category!=""&&this.action!=""&&this.tracker.push(["_trackEvent",this.category,this.action,event_tracking_tariff,e])}catch(t){}this.reset()}},{get:function(){return Box_Event_Tracker.__instance||(Box_Event_Tracker.__instance=new Box_Event_Tracker({tracker:_gaq})),Box_Event_Tracker.__instance}});Box.Timing.execution.push({name:"js/box_growl_notification.js",time:(new Date).getTime()});var Growl_Notification=Box_Base.extend({priority:null,icon:null,message:null,callback:null,_j_element:null,_display_in_web_app:function(){this._j_element=$j('<div class="growl_notification" style="display: none;" />').append($j('<div class="inner media" />').append($j('<span class="img icon sprite_32x32" />')).append($j('<div class="growl_text ellipsis ellipsis_190" />')));var e=this._j_element.find(".img"),t=this.icon.indexOf("/")!=-1;t?e.css("background-image",'url("'+this.icon+'")'):e.addClass(this.icon),this._j_element.find(".growl_text").html(this.message),this._j_element.appendTo(Growl_Notification._j_notification_container).animate({height:"show",opacity:"show"},"slow");var n=this;setTimeout(function(){n._remove_from_web_app()},Growl_Notification._display_time),this._j_element.click(this.callback)},_remove_from_web_app:function(e){var t=Growl_Notification._displayed_notifications[0]==this;Growl_Notification._remove_from_displayed_notifications(this),this._j_element.unbind("click");var n={opacity:"hide"};t||(n.height="hide");var r=this;window.infocus?this._j_element.animate(n,e?"fast":"slow",function(){r._j_element.remove()}):r._j_element.remove()},_display_on_desktop:function(){if(!window.webkitNotifications)return!1;window.webkitNotifications.checkPermission()>0&&window.webkitNotifications.requestPermission(Growl_Notification.prototype._display_on_desktop);var e=this.icon,t=Growl_Notification._prepare_display_title(this.message),n="";try{var r=window.webkitNotifications
.createNotification(e,t,n);r.show()}catch(i){return!1}return!0}},{_displayed_notifications:[],_waiting_notifications:[],_max_displayed_notifications:3,_max_waiting_notifications:3,_display_time:2e4,_j_notification_container:$j('<div class="growl_notification_container"></div>').appendTo("body"),display:function(e){var t=new Growl_Notification(e);if(!Growl_Notification._add_to_waiting_notifications(t))return!1;Growl_Notification._display_next_notification()},_prepare_display_title:function(e){e=e.replace("<br/>"," ");var t=$("<div/>");return t.html(e),t.text()},_add_to_waiting_notifications:function(e){if(Growl_Notification._waiting_notifications.length==Growl_Notification._max_waiting_notifications){var t=e.priority,n=-1;for(var r=Growl_Notification._waiting_notifications.length-1;r>=0;r--){var i=Growl_Notification._waiting_notifications[r];i.priority<t&&(t=i.priority,n=r)}if(n==-1)return!1;Growl_Notification._waiting_notifications.splice(n,1)}return Growl_Notification._waiting_notifications.push(e),!0},_display_next_notification:function(){if(Growl_Notification._displayed_notifications.length==Growl_Notification._max_displayed_notifications)return!1;var e=Growl_Notification._waiting_notifications.shift();if(!e)return!1;Growl_Notification._displayed_notifications.push(e),$j.log("display: "+e.priority+" "+e.message);var t=e._display_on_desktop();return t||e._display_in_web_app(),!0},_remove_from_displayed_notifications:function(e){var t=$j.inArray(e,Growl_Notification._displayed_notifications);return Growl_Notification._displayed_notifications.splice(t,1),Growl_Notification._display_next_notification()}});Box.Timing.execution.push({name:"js/box_in_app_message.js",time:(new Date).getTime()});var In_App_Message=Base.extend({_in_app_message_max_request_time:5e3,_in_app_message_id:0,get_in_app_message_to_show:function(){var e=this,t="/index.php?rm=box_in_app_message_get",n=window.location.pathname.replace(/^\//,""),r={page:typeof box!="undefined"&&box.hist_name?box.hist_name:n},i=(new Date).getTime();$j.post(t,r,function(n){if(n){var r=(new Date).getTime()-i;r<e._in_app_message_max_request_time&&(e._in_app_message_id=n.in_app_message_id,e.display_in_app_message(n),n.should_log_view&&e._log_in_app_message_view())}})},dismiss_in_app_message:function(){if(!this._in_app_message_id)return;var e="/index.php?rm=box_in_app_message_dismiss",t={in_app_message_id:this._in_app_message_id};$j.post(e,t)},display_in_app_message:function(e){if(e.name&&e.name.indexOf("SHOW_NET_PROMOTER_SURVEY")===0)Net_Promoter_Survey.get().execute();else if(e.render_type=="popup")this._show_popup(e.slides);else if(e.render_type=="banner"){var t={call_dismiss_action_on_close:e.duration>0,auto_rotate:!0};this._show_banner(e.slides,t)}},_log_in_app_message_view:function(){if(!this._in_app_message_id)return;var e="/index.php?rm=box_in_app_message_log_in_app_message_view",t={in_app_message_id:this._in_app_message_id};$j.post(e,t)},_show_banner:function(e,t){var n=new Banner_Message(e,t);n.show()},_show_popup:function(e){if(!e.length)return;var t=e.length==1?this._construct_single_slide_popup_content(e[0]):this._construct_multi_slide_popup_content(e);$j.popup.form("",t,{layout:"modal",hide_next_prev_buttons:!0,width:610,close_popup_on_click_outside:!1,title_classes:"center_contents"})},_construct_multi_slide_popup_content:function(e){var t=[];for(var n=0;n<e.length;n++){var r={type:"slide",id:"in_app_popup_slide"+n,label:"",contents:[]};r.contents.push({type:"html",data:e[n].html}),r.contents.push(this._construct_popup_slide_buttons()),t.push(r)}return t},_construct_single_slide_popup_content:function(e){var t=[];return t.push({type:"html",data:e.html}),t.push(this._construct_popup_slide_buttons()),t},_construct_popup_slide_buttons:function(){return{type:"buttons",items:{close:{value:$t("Close","popup_window_close_tooltip"),click:function(){return $j.popup.close(null,!0),!1}}}}}},{get:function(){return In_App_Message.__instance||(In_App_Message.__instance=new In_App_Message),In_App_Message.__instance}});Box.Timing.execution.push({name:"js/box_loading.js",time:(new Date).getTime()});var Loading=Base.extend({blocker_text:!1,enabled:!0,show:function(){return this.blocker_text||($j("#right_loading_message").get(0)?this.blocker_text=$j("#right_loading_message"):this.blocker_text=$j('<div id="right_loading_message" class="ur_corner badge update large_badge"></div>').text($t("Loading...","js_loading")).appendTo($j("body"))),this.enabled&&$j(this.blocker_text).show(),simpleBodyBlocker.create({opacity:.01}),this},hide:function(){return this.blocker_text==0&&$j("#right_loading_message")&&(this.blocker_text=$j("#right_loading_message")),simpleBodyBlocker.destroy(),$j(this.blocker_text).css("display","none"),this.blocker_text=null,this},disable:function(){this.hide(),this.enabled=!1},enable:function(){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_loading.js:2412","2013-05-15","auto tombstoned"),this.enabled=!0},create:function(){return this.show()},destroy:function(){return this.hide()}},{get:function(){return Loading.__instance||(Loading.__instance=new Loading),Loading.__instance},show:function(){return this.get().show()},hide:function(){this.get().hide()},disable:function(){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_loading.js:2419","2013-05-15","auto tombstoned"),this.get().disable()},enable:function(){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_loading.js:2420","2013-05-15","auto tombstoned"),this.get().enable()}});Box.Timing.execution.push({name:"js/box_validator.js",time:(new Date).getTime()});var Validator={file_name_regex:"^\\s*$",bookmark_name_regex:'^((COM\\d)|(LPT\\d)|(CON)|(PRN)|(AUX)|(NUL)|CLOCK\\$)$|[<>|/\\\\"]|\\.$',url_protocol_regex:"^(HTTP|FTP)S?://.*$",url_regex:"^(https?|ftp):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(\\#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$",file_name_special_chars:'(\\, /, ", :, <, >, |, *, ?)',file_name_special_char_replacement:"_",validate_login:function(e){return Validator.prototype.validate_email(e)},validate_empty_field:function(e){return e===""?!1:!0},validate_email:function(e){return $j.box.isEmail(e)},validate_password:function(e,t){return t=t||!1,t?Validator.validate_string(e,0,255):Validator.validate_string(e,1,255)},validate_confirm_password:function(e,t){return typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_validator.js:16332","2013-05-15","auto tombstoned"),e===t},validate_phone:function(e){var t=$j.trim(e);return Boolean(t.match(/^(\(?\+?[\d]*\)?)?[\d\-\.\s\(\)]+(\s*(x|ext\.?|extension)\s*\d+)?$/g)&&t.length<=100)},validate_string:function(e,t,n){return e.length!=undefined&&e.length>=t&&e.length<=n?!0:!1},validate_number:function(e){return!isNaN(parseFloat(e))},validate_nonnegative_float:function(e){if(typeof e!="number"){var t=/^[0-9\.]*$/;if(!t.test(e))return!1;e=parseFloat(e)}return e>=0},validate_positive_integer:function(e){if(typeof e!="number"){var t=/^[0-9]*$/;if(!t.test(e))return!1;e=parseInt(e)}return e>0},validate_nonnegative_integer:function(e){if(typeof e!="number"){var t=/^[0-9]*$/;if(!t.test(e))return!1;e=parseInt(e)}return e>=0},validate_public_name:function(e){return Validator.validate_name(e)},validate_name:function(e){return Validator.validate_string(e,1,255)},validate_company:function(e){return Validator.validate_string(e,1,255)},validate_cvv:function(e){var t=Validator.validate_nonnegative_integer(e),n=Validator.validate_string(e,3,4);return t&&n},validate_slave_count:function(e){return Validator.validate_positive_integer(e)},validate_space_amount:function(e){return Validator.validate_positive_integer(e)},validate_slave_space_amount:function(e){if(Validator.validate_nonnegative_float(e)){if(window.enterprise&&window.enterprise.space_amount){var t=Validator.convert_units(window.enterprise.space_amount,"bytes","gigabytes");return e>t?(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_validator.js:16343","2013-05-15","auto tombstoned"),!1):!0}return!0}return!1},validate_enterprise_type:function(e){return e=="business"?!0:e=="enterprise"?!0:!1},validate_deal_status:function(e){return e=="live_deal"?!0:e=="potential_deal"?!0:e=="trial"?!0:e=="trial_extension"?!0:!1},validate_subdomain:function(e){e=$j.trim(e).toLowerCase();var t=/^[a-zA-Z0-9]*(-[a-zA-Z0-9]+)*$/;return e.match(t)==null?!1:e.length<3?!1:!0},validate_group_tag_name:function(e){return e&&e.toLowerCase()=="none"?!1:Validator.validate_string(e,1,255)},validate_file_name:function(e){var t=null;t=new RegExp(Validator.file_name_regex);var n=e.toUpperCase();return t.exec(n)==null},validate_bookmark_name:function(e){var t=new RegExp(Validator.bookmark_name_regex),n=e.toUpperCase();return t.exec(n)==null},validate_url_protocol:function(e){var t=new RegExp(Validator.url_protocol_regex),n=e.toUpperCase();return n.indexOf("://")===-1&&(n="HTTP://"+n),t.exec(n)!=null},validate_url:function(e,t){t&&(e.match(/^(http|ftp)s?:\/\//i)||(e="http://"+e));var n=new RegExp(Validator.url_regex,"i");return n.test(e)},validate_partial_url:function(e){var t=/^[A-Za-z0-9-]+$/;return t.test(e)},fix_file_name:function(e){var t=new RegExp(Validator.file_name_regex,"g");return e=e.replace(t,Validator.file_name_special_char_replacement),e},convert_units:function(e,t,n){var r=0;if(t!="bytes")throw new Error('Unknown units type passed to "convert_units" function as the "from_units" parameter. The units might just not be implemented yet. from_units: "'+t+'"');if(n!="gigabytes")throw new Error('Unknown units type passed to "convert_units" function as the "to_units" parameter. The units might just not be implemented yet. to_units: "'+n+'"');return r=Math.round(e/Math.pow(2,30)),r}};Box.Timing.execution.push({name:"js/box_loading_buttons.js",time:(new Date).getTime()});var Loading_Buttons=Base.extend({constructor:function(e){},timer:null,count:0,btn_ok:null,btn_ok_txt:null,btn_val:null,block:!1,start:function(e){var t=this;t.btn_ok=e.btn_ok,t.btn_ok_txt=e.btn_ok_txt,t.btn_val=$j(e.btn_ok_txt).text(),t.count=1,t.block=!0,$j(t.btn_ok).addClass("box_new_popup_button_hover"),t.timer=window.setTimeout(function(){window.clearTimeout(t.timer),t.update(),$j(t.btn_ok_txt).css("text-align","left")},1e3)},update:function(){window.clearTimeout(this.timer);var e=" Loading.";this.count>1&&(e+=this.count==2?".":".."),$j(this.btn_ok_txt).text(e),this.count=this.count<3?this.count+1:1;var t=this;this.timer=window.setTimeout(function(){t.update()},400)},destroy:function(){window.clearTimeout(this.timer),this.block=!1,this.btn_ok&&($j(this.btn_ok).removeClass("box_new_popup_button_hover"),$j(this.btn_ok_txt).text(this.btn_val))}},{get:function(){return Loading_Buttons.__instance||(Loading_Buttons.__instance=new Loading_Buttons),Loading_Buttons.__instance}});Box.Timing.execution.push({name:"js/box_comment.js",time:(new Date).getTime()});var Comment=Box_Object.extend({constructor:function(e){this.base(e),this.process_permissions(e.permissions,Comment.PERMISSION_CONSTANTS)},set_params:function(e){this.base(e),this.process_permissions(e.permissions,Comment.PERMISSION_CONSTANTS)}},{type:"comment",PERMISSION_CONSTANTS:{edit:"comment_edit","delete":"comment_delete",reply:"comment_reply",create_mention:"create_mention",delete_mention:"delete_mention"}});Action.register_actions("Comment",["edit","delete_me","reply"]),Box.Timing.execution.push({name:"js/folder_tree/model.js",time:(new Date).getTime()});var Folder_Tree_Model=Base.extend({constructor:function(e){this.controller=e,this.clear()},clear:function(){this.items={}},get_item_by_id:function(e,t,n){if(typeof this.items[e]!="undefined")return n(this.items[e]),!1;var r=this,i={item_typed_ids:[e],unidb_format:"folder_selector"},s;return this.controller._canvas_obj_in_page&&t&&t!=Canvas.get().user.id?s="/index.php?rm=box_master_export_tree_get_unidb_formatted_items":s="/index.php?rm=box_export_tree_get_unidb_formatted_items",$j.getJSON(s,i,function(e){if(e.error||e.items&&e.items.length<1)return;var t=e.items[0],i=t.typed_id;r.items[i]=t,n(t)}),!1}},{});Box.Timing.execution.push({name:"js/folder_tree/view.js",time:(new Date).getTime()});var Folder_Tree_View=Base.extend({SMALL_WINDOW_HEIGHT_THRESHOLD:500,SMALL_FOLDER_TREE_HEIGHT:142,DEFAULT_FOLDER_TREE_HEIGHT:300,constructor:function(e){this.controller=e},render_folders_into_container:function(e,t,n){e.prev().find(".spinner").remove(),e.html(t).removeClass("container_loading").show(),n&&n.disable_root_folder&&this.disable_root_folder(e);if(n&&n.selected_item_id){var r=$j("#folder_tree_"+n.selected_item_id),i=e.height(),s=e.scrollTop(),o=s+i,u=r.position().top;(u>=o||u<s)&&e.scrollTop(u-i/2)}var a=e.children(".container").children(".container");a.prev().data("refresh_needed",!0)},disable_root_folder:function(e){var t=e.find(".folder"),n=t.filter('[data-typed_item_id="d_0"]');n.removeClass("selected").addClass("not_selectable");if(t.length==1){var r='<span class="disabled">'+$t("Create a folder to invite collaborators.","no_folder_in_account_text_folder_tree")+"</span>";e.html(r),this.controller.clear_current_cache();return}},display_loading_message_in_container:function(e){e.children().length||e.html("&nbsp;&nbsp;&nbsp;"+$t("Loading...","js_loading_capitalized_with_ellipsis")).addClass("container_loading").show()},_collapse_folder_or_user:function(e,t){e.removeClass("opened sprite_19x19_down_arrow").addClass("closed sprite_19x19_right_arrow"),t.hide();var n=e.closest(".link").find(".ft_folder_icon");if(n.length){var r;n.hasClass("sprite_19x19_collab_folder_open")?r="sprite_19x19_collab_folder_":n.hasClass("sprite_19x19_private_folder_open")&&(r="sprite_19x19_private_folder_"),n.removeClass(r+"open").addClass(r+"closed")}},_expand_folder_or_user:function(e,t){e.removeClass("closed sprite_19x19_right_arrow").addClass("opened sprite_19x19_down_arrow");var n=e.closest(".link").find(".ft_folder_icon"),r;if(n.length){var i;n.hasClass("sprite_19x19_collab_folder_closed")?i="sprite_19x19_collab_folder_":n.hasClass("sprite_19x19_private_folder_closed")&&(i="sprite_19x19_private_folder_"),n.removeClass(i+"closed").addClass(i+"open")}var r=!1;t.hasClass("container")&&t.prev().data("refresh_needed")&&(t.prev().data("refresh_needed",!1),t.remove(),r=!0);if(!t.hasClass("container")||r){e.append($j('<img class="spinner" style="background-color: #e8f1f8;margin-top:1px;margin-left:1px" />').attr("src",Box.Application.getService("assets").getAssetURL(images_box_path,"spinner.gif")));var s;t=$j('<div class="container no_break"></div>').hide().insertAfter(e.parent());if(e.parent().hasClass("person"))s=e.parent().data("user_id"),this.controller.load_folder_into_container(t,"d_0",s,e,{is_gcm:this instanceof GCM_Folder_Tree_View});else{var o=e.data("typed_item_id");s=e.data("user_id"),s?this.controller.load_folder_into_container(t,o,s,e):this.controller.load_folder_into_container(t,o,undefined,e)}}else t.show()},is_visible:function(){return $j("#folder_tree").is(":visible")},setup_container:function(e,t,n,r){r=r||{},$(window).height()<=this.SMALL_WINDOW_HEIGHT_THRESHOLD?r.height=this.SMALL_FOLDER_TREE_HEIGHT:r.height||(r.height=this.DEFAULT_FOLDER_TREE_HEIGHT);var i=this;t.unbind("click").bind("click",function(e){return i.event_click(e),!1}),this.controller.behavior=="dropdown"&&window.setTimeout(function(){$j(document.body).click(i._clicked_elsewhere)},10),typeof Previewer!="undefined"&&Previewer.get().set_player_active(!1),n=="auto"?t.width("auto"):n&&t.width(parseInt(n,10)+"px"),r.height&&t.height(parseInt(r.height,10)+"px");if(r.append)e.append(t);else{var s=e.offset();s&&t.css({position:"absolute",left:s.left,top:s.top+e.outerHeight()+1})}t.removeClass("container_loading")},append_to:function(e){$j("#folder_tree").appendTo(e)},hide:function(){typeof Previewer!="undefined"&&Previewer.get().set_player_active(!0),$j("#folder_tree").hide().empty().unbind("click"),$j(document.body).unbind("click",this._clicked_elsewhere)},event_click:function(e){var t=$j(e.target),n=Box.Application.getService("logger");if(t.hasClass("not_selectable")||t.parent().hasClass("not_selectable"))return!1;var r,i,s,o=t.hasClass("link");o?(i=t.find(".folder"),s=t.find(".person")):(i=t.closest(".folder"),s=t.closest(".person"));if(t.hasClass("expander")){var u=t,a=u.parent().next();u.hasClass("closed")?this._expand_folder_or_user(u,a):this._collapse_folder_or_user(u,a)}else if(i.length){var f=i.data("typed_item_id");if(!f)return!1;if(this.controller.behavior=="selector"){var l=$j("#folder_tree").find(".selected").removeClass("selected");i.parents(".link").addClass("selected")}r=i.data("user_id");var c=this;this.controller.model.get_item_by_id(f,r,function(t){t||n.sendLog("js_error","item_not_found",{item_typed_id:f});if(typeof Item!="undefined"){var s=Item.find(f);s||(s=new Item(t),s.set_params(t))}var o=c._is_root_folder(f),u=c._check_item_permission(t,c.controller.check_permission,o);if(u){var a=i.find(".folder_name").text();if(typeof gallery_page!="undefined"&&gallery_page=="files"){var h=Box.Application.getService("strings");a=h.getShortString(a,240,i[0])}r=i.data("user_id"),c.controller.call_click_callback(f,a,r,e,t),c.controller.behavior=="dropdown"&&c.controller.hide()}else c.controller.behavior=="selector"&&($j("#folder_tree").find(".selected").removeClass("selected"),l.parents(".link").addClass("selected"))})}else s.length&&(this.controller.behavior=="selector"&&($j("#folder_tree").find(".selected").removeClass("selected"),s.addClass("selected")),r=s.data("user_id"),this.controller.call_click_callback("d_0",undefined,r,e));return!1},_clicked_elsewhere:function(e){return $j(e.target).attr("id")!="folder_tree"&&folder_tree.hide(),!1},_check_item_permission:function(e,t,n){if(e.type=="folder"){if(t=="upload"&&e.upload_permission=="0")return alert($t("You do not have permission to upload, move, or edit any files to this folder.","folder_tree_no_upload_permission")),!1;if(t=="owner"&&!e.user_is_owner)return alert($t("You must be an owner to invite guests to this folder","folder_tree_must_own_to_invite_guests_message")),!1;if(t=="collaborate")if(e.name=="All Files"||e.can_invite_collaborators=="0"&&!e.user_is_owner)return n?alert($t("You cannot add collaborators to your root folder. Please select a folder you would like to add collaborators to.","folder_tree_select_non_root")):e.name=="Select a folder in your Box"?alert($t("Please select a folder you would like to add collaborators to.","folder_tree_select_folder_to_add_collaborators_to")):alert($t("Sorry, you cannot select a collaborated folder that doesn't belong to you; only the owner of this folder can add new collaborators to it. Please select a different folder.","folder_tree_cant_select_collab_folder_that_doesnt_belong_to_you")),!1}return!0},_is_root_folder:function(e){var t=Box.Application.getService("v5"),n="0",r=t.get("root_folder_id");typeof r!="undefined"&&(n=r.toString()),n=n.replace("d_","");var i=e.replace("d_","");return n==i}},{});Box.Timing.execution.push({name:"js/folder_tree/controller.js",time:(new Date).getTime()});var Folder_Tree_Controller=Base.extend({constructor:function(e){this.mode="folders",this.behavior="dropdown",this.click_callback=null,this.USER_RETURN_LIMIT=500,this.check_permission=null,this.model=new Folder_Tree_Model(this),this.view=new Folder_Tree_View(this),this._canvas_obj_in_page=typeof Canvas!="undefined"},clear:function(){this.model.clear(),this.clear_current_cache()},get_folder_by_id:function(e,t){return typeof Tombstone!="undefined"&&Tombstone.marker("./js/folder_tree/controller.js:6982","2013-05-15","auto tombstoned"),this.model.get_folder_by_id(e,t)},show:function(e,t,n,r,i){i=i||{};if(!i.force_open&&this.view.is_visible()){this.hide();return}var s=i.user_id||null;this.behavior=i.behavior||"dropdown",this.click_callback=t||null,this.hide_callback=i.hide_callback||null,this.check_permission=i.check_permission||null,this.show_all_item_types=i.show_all_item_types||!1;if(typeof root_folder_id=="undefined"||root_folder_id==0)root_folder_id="d_0";n||(n=root_folder_id);var o=$j(e),u=$j("#folder_tree"),a=this.find_cached_folder_tree(i.cache_identifier);u.length?(u.attr("style",""),a||u.empty()):u=$j('<div id="folder_tree" />').addClass(this.behavior=="dropdown"?" drop_down":"").appendTo(document.body).hide(),this.view.display_loading_message_in_container(u),this.view.setup_container(o,u,r,i),a?(u.html(a.html()).css("display","block"),i&&i.disable_root_folder&&this.view.disable_root_folder(u)):(i.selected_item_id=n,i.has_parents=!0,this.load_folder_into_container(u,n,s,null,i),u.show())},hide:function(){this.view.hide();if(typeof this.hide_callback=="function"){var e=this.hide_callback;this.hide_callback=null,e()}this.check_permission=null},is_visible:function(){return this.view.is_visible()},find_cached_folder_tree:function(e){if(!e)return!1;var t=!1,n=$j("#folder_tree_cache");return n.length&&(t=n.data("cache_identifier")==e,t||n.data("cache_identifier","")),t?n.clone().attr("style",""):!1},clear_current_cache:function(){$j("#folder_tree_cache").data("cache_identifier","").html("")},load_folder_into_container:function(e,t,n,r,i){var s=this;i=i||{},e=e||$j("#folder_tree"),n=n||null,!n&&this._canvas_obj_in_page&&(n=Canvas.get().user.id);var o=i.selected_item_id||!1,u={user_id:n,item_id:t||o,selected_item_id:o,is_gcm:i.is_gcm||!1,show_trash:i.show_trash||!1,has_parents:i.has_parents||!1,skip_no_invite_collab:i.skip_no_invite_collab||!1,enterprise_collab_folders_only:i.enterprise_collab_folders_only||!1,include_submaster_collab_folders:i.include_submaster_collab_folders||!1,show_all_item_types:this.show_all_item_types||!1,sort_direction:i.sort_direction||"desc"};u.ancestors_only=i.ancestors_only||!1;var a=$j.box.formatQuery(u),f=Box.Application.getService("nav-state"),l="";f.isGcm()||f.isAutomation()?l="/index.php?rm=box_master_export_user_folder_tree_html":l="/index.php?rm=box_export_tree_export_files_and_folders_html",$j.getJSON(l,a,function(t){s._load_folder_into_container_request_callback(t,e,i,r)})},_load_folder_into_container_request_callback:function(e,t,n,r){t&&t.find(".spinner").remove(),n=n||{};var i=e.html;if(e.error)i=$t("There was an error loading your folder tree. Please try again.","folder_tree_error_loading_tree");else if(n.cache_identifier){var s=$j("#folder_tree_cache");s.length||(s=$j('<div id="folder_tree_cache" style="display: none;"></div>').appendTo(document.body)),s.html(i).data("cache_identifier",n.cache_identifier)}this.view.is_visible()&&this.view.render_folders_into_container(t,i,n),i==""&&r&&r.css("opacity","0")},call_click_callback:function(e,t,n,r,i){this.click_callback&&this.click_callback(e,t,n,r,i)},appendTo:function(e){this.view.append_to(e)},get_selected_item_id:function(){return $j("#folder_tree").find(".selected .folder").data("typed_item_id")}},{}),folder_tree=new Folder_Tree_Controller;Box.Timing.execution.push({name:"js/previewer/abstract_previewer.js",time:(new Date).getTime()});var AbstractPreviewer=Base.extend({},{_get_player_width:function(){var e=Math.floor($j("#gallery").width());return e>Previewer.PLAYER.MAX_WIDTH?Previewer.PLAYER.DEFAULT_WIDTH:e},_get_player_height:function(){var e=350,t=460,n=Previewer.get().current_item().extension,r=this._get_player_width(),i=Previewer.get_extension_to_type_mapping();switch(i[n]){case"DOCUMENT":e=500,t=1.294*r;break;case"IMG":t=.75*r;break;case"PRESENTATION":t=.75*r;break;default:switch(n){case"flv":case"f4v":t=.56*r;break;case"swf":t=.75*r;break;case"":e=400}}var s=132,o=205,u=$j(window).height()-(gallery_page=="shared_file"?s:o);return t&&u>t&&(u=t),u<e&&(u=e),u}});Box.Timing.execution.push({name:"js/previewer/error_previewer.js",time:(new Date).getTime()});var ErrorPreviewer=AbstractPreviewer.extend({},{open:function(){$j("#gallery_error").show()},close:function(){$("#gallery_error").hide()},register:function(){},deregister:function(){},open_with_item:function(e){var t=e.Versions[0].Version,n=t.Error,r=$("#gallery_error");r.find(".title").text(t.title),r.find(".size").text(t.size),r.find("#bottom_bar_left").addClass("bottom_bar_left"),r.find("#bottom_bar_right").addClass("bottom_bar_right"),r.find("#bottom_bar_center").addClass("bottom_bar_center"),r.find("#gallery_pseudo_icon_container").addClass("gallery_pseudo_icon_container"),r.find(".gallery_pseudo_corner_disable").addClass("gallery_pseudo_corner"),r.find(".gallery_pseudo_icon").css({width:242,height:286}).attr("src",n.icon),r.find(".error_title").text(n.title),r.find(".error_content").html(n.description),this.open()}});Box.Timing.execution.push({name:"js/previewer/flash_previewer.js",time:(new Date).getTime()});var FlashPreviewer=AbstractPreviewer.extend({},{update_with_item:function(e){e=e||{};var t=e.load_on_left,n=e.load_on_right,r=e.clear_player_cache;typeof t=="undefined"&&(t=Previewer.PLAYER.PREVIOUS_PRELOAD_COUNT),typeof n=="undefined"&&(n=Previewer.PLAYER.NEXT_PRELOAD_COUNT);var i=Previewer.get().current_item().typed_id,s=Previewer.get().current_item_index-t,o=Previewer.get().current_item_index+n,u;s<0?(u=0-s,o+=u,s=0,o>=Previewer.get().item_collection.size()&&(o=Previewer.get().item_collection.size()-1)):o>=Previewer.get().item_collection.size()&&(u=o-(Previewer.get().item_collection.size()-1),s-=u,o=Previewer.get().item_collection.size()-1,s<0&&(s=0));var a=Previewer.get().item_collection.items.slice(s,o+1),f=[];for(var l=0;l<a.length;l++)f[l]=Previewer.get()._get_item_context(a[l]);Previewer.get().is_open&&Previewer.get().player&&typeof Previewer.get().player.updateFiles=="function"&&Previewer.get().player.updateFiles(f,i,r)},set_player_active:function(e,t){this.is_open&&this.player&&this.player.setIsActive&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/previewer/flash_previewer.js:7162","2013-05-15","auto tombstoned"),this.player.setIsActive(e,!t))},open:function(){var e=AbstractPreviewer._get_player_width(),t=AbstractPreviewer._get_player_height();$j("#player").css({width:e,height:t})},close:function(){$j("#player").css({width:1,height:1})},register:function(e){var t=e+".swf",n=AbstractPreviewer._get_player_height(),r=AbstractPreviewer._get_player_width(),i=Box.Application.getService("browser");if(!i.hasMinimumFlashVersion()){gallery_page=="shared_folder"||gallery_page=="vanity_url"||gallery_page=="collab_preview"?$j("#preview_settings_hint").hide():$j("#preview_settings_hint").show();var s=$j("#no_flash");s.show(),s.find("div.gallery_pseudo_icon").addClass("install_flash_background"),s.find("#install_flash_button").addClass("install_flash_button"),s.find("#bottom_bar_left").addClass("bottom_bar_left"),s.find("#bottom_bar_right").addClass("bottom_bar_right"),s.find("#bottom_bar_center").addClass("bottom_bar_center"),s.find("#gallery_pseudo_icon_container").addClass("gallery_pseudo_icon_container"),s.find(".gallery_pseudo_corner_disable").addClass("gallery_pseudo_corner"),Previewer.get().show_item();return}if(typeof swfobject!="undefined"){var o={backgroundColor:"#ffffff",conversion_on_realtime:Features.conversion_on_realtime},u={allowfullscreen:"true",allowscriptaccess:"always",wmode:"opaque"},a=Box.Application.getService("assets").getFlashAssetURL(),f=Box.Application.getService("assets").getAssetURL(a,t);swfobject.embedSWF(f,"player",r.toString(),n.toString(),i.getMinimumFlashVersion(),null,o,u);var l=$("#gallery").attr("data-max-previewer-height");l&&$("#player").addClass("ptm").css("max-height",parseInt(l))}swfmacmousewheel.registerObject("player")},deregister:function(){swfobject.removeSWF("player"),$j("#player").length||$j("#gallery").prepend($j('<div id="player"></div>'))}});Box.Timing.execution.push({name:"js/previewer/swf_previewer.js",time:(new Date).getTime()});var SWFPreviewer=AbstractPreviewer.extend({},{update_with_item:function(){var e=this._get_alternative_player_src(),t=AbstractPreviewer._get_player_width()-1,n=AbstractPreviewer._get_player_height(),r=$j("#alternative_player");r.find(".gallery_pseudo_content").height(n+10),r.children().show(),Previewer.get().current_item().is_webdoc()||(e+="/"+t+"/"+n);var i=$j("#gallery_content_frame");i.attr("src",e),i.css({width:t,height:n})},_get_alternative_player_src:function(){var e=Box.Application.getService("url"),t,n=Previewer.get().current_item().shared_name!=""?Previewer.get().current_item().shared_name:Canvas.get().shared_name,r="",i=Previewer.get().current_item();i.is_webdoc()?r="/index.php?rm=box_webdoc_view_in_gallery&file_id="+i.id:r="/flv_player/"+i.typed_id;switch(gallery_page){case"files":t=r;break;case"inbox":case"profile":t=r+(n?"/"+n:"")+(typeof params!="undefined"?"&"+params:"");break;case"shared_file":case"shared_folder":case"vanity_url":t=r+(n?"/"+n:"");break;case"collab_preview":t=r+"/"+collab_invite_token;break;default:}return e.addAdditionalContext(t)},open:function(){var e=$j("#alternative_player");e.show(),e.find("#bottom_bar_left").addClass("bottom_bar_left"),e.find("#bottom_bar_right").addClass("bottom_bar_right"),e.find("#bottom_bar_center").addClass("bottom_bar_center"),e.find("#gallery_pseudo_icon_container").addClass("gallery_pseudo_icon_container"),e.find(".gallery_pseudo_corner_disable").addClass("gallery_pseudo_corner")},close:function(){$j("#alternative_player").hide()},register:function(){var e=$j("#alternative_player");e.find(".gallery_pseudo_content").empty().append('<iframe id="gallery_content_frame" src="" name="frameName" frameborder="0"></iframe>')},deregister:function(){$j("#alternative_gallery").hide(),$j("#gallery_content_frame").remove(),$j("#gallery_content_no_flash").show()}});Box.Timing.execution.push({name:"js/box_previewer.js",time:(new Date).getTime()});var Previewer=Base.extend({is_open:!1,player:null,scroll_down_to_tasks:!1,scroll_down_to_view_id:null,item_collection:null,item_count:null,item_collection_start_index:0,current_item_index:0,saved_canvas_folder:null,first_load:!1,current_item_edit_action:null,current_item_view_action:null,TOP_DISABLED_EDIT_BUTTON_TIP:$t("You do not have permission to edit this file","files_page_edit_button_disabled_tip"),TOP_EDIT_BUTTON_UNEDITABLE_FILETYPE_TIP:$t("This file type cannot be edited","files_page_edit_button_uneditable_filetype_tip"),TOP_EDIT_BUTTON_PLUGIN_NOT_SUPPORTED_TIP:$t("Your current browser mode does not support Box Edit","files_page_edit_button_plugin_not_supported_tip"),TOP_ADMIN_DISABLED_EDIT_BUTTON_TIP:$t("The Edit App has been disabled by you or your administrator","files_page_edit_button_admin_disabled_tip"),TOP_DISABLED_DOWNLOAD_BUTTON_TIP:$t("You do not have permission to download this file","files_page_download_button_disabled_tip"),TOP_DISABLED_UPLOAD_BUTTON_TIP:$t("You do not have permission to upload to this folder","files_page_upload_button_disabled_tip"),TOP_DISABLED_BOX_NOTES_DOWNLOAD_BUTTON_TIP:$t("You cannot download a Box Note yet, but it will be coming soon.","box_notes_files_page_download_button_disabled_tip"),TOP_DISABLED_BOX_NOTES_UPLOAD_BUTTON_TIP:$t("You cannot upload a new version of Box Notes","box_notes_files_page_upload_button_disabled_tip"),ITEM_LIST_URL:"/index.php?rm=box_item_list",constructor:function(e){Previewer.__instance=this},open_by_id:function(e){var t=Item.find(e),n=this,r;return Canvas.get().target_item=t,$.popup.close(),this.is_open?this._in_collection(t)?($j.each(this.item_collection.items,function(e,r){if(t.typed_id===r.typed_id)return n.current_item_index=e,!1}),this.show_item(),r=$.Deferred().resolve().promise()):t.has_valid_collection()?(this.open(),r=$.Deferred().resolve().promise()):r=this._fetch_collection_by_file(t.typed_id).done(function(e){n._set_item_collection("init"),n.show_item(),n._get_previewer_details_needed({folder:!0
,path:!0,item_count:!0})}):t.has_valid_collection()?(this.open(),r=$.Deferred().resolve().promise()):r=this._fetch_collection_by_file(t.typed_id).done(function(e){n.open()}),r},open:function(e){e=e||{};var t=Box.Application.getService("nav-state");this.is_open&&$j.log("Gallery is already open and thus cannot be initialized again now."),this.is_open=!0,this.first_load=e.first_load,t.isGcm()&&(gallery_page="gcm"),this._hide_elements_not_in_gallery(),this._show_elements_in_gallery(),Canvas.get().scroll_up(),this._set_item_collection("init"),this._init_players("preview");var n=this.current_item();t.setPreviewState(n.typed_id),box_sidebar.hide_corporate_network_in_sidebar(),box_sidebar.init_sharebar_in_sidebar();var r={folder:!1,path:!0,item_count:!1};if(!this._is_sent_item_update_page()){var i=n.folder,s=Canvas.get().current_folder;i.id&&(!s||s.id!=i.id)&&(this.saved_canvas_folder=s,r.folder=!0)}if(this._is_shared_page()||this._is_sent_item_update_page()||box.path_html&&t.isSearch()&&!t.isEmbedWidget())r.path=!1;!this._collection_is_single_page()&&this._collection_has_same_parent_folder()&&(r.item_count=!0),Box.Application.broadcast("x-previeweropen",{id:n.id,name:n.name}),this._get_previewer_details_needed(r),this._register_previewer_open_in_nav()},_get_previewer_details_needed:function(e){var t=!1;for(var n in e)if(e[n]){t=!0;break}if(t){var r={item_id:this.current_item().folder.typed_id,previewer_page:gallery_page,previewer_details_needed:e},i="/index.php?rm=box_preview_get_previewer_details";e.item_count&&$j.extend(r,this._get_item_count_params()),$j.extend(r,this._get_item_context(null));var s=$j.box.formatQuery(r);$j.post(i,s,this._get_previewer_details_needed_callback,"json")}else this._get_previewer_details_needed_callback()},_get_previewer_details_needed_callback:function(e){var t=Previewer.get();e=e||{};var n=Box.Application.getService("nav-state");e.path?t._update_path(e.path.path_html):t._update_path(box.path_html);if(n.isPinboard()||e.item_count){if(!n.isPinboard()){var r=e.item_count;t.item_count=r.total_count,r.start_index!=undefined&&(t.item_collection_start_index=r.start_index)}t._display_item_count()}if(e.folder_info){var i=Item.find(e.folder_info.typed_id);Canvas.get().current_folder=i,i.name==""&&i.is_root_folder()&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_previewer.js:15956","2013-05-15","auto tombstoned"),i.name=$t("All Files","all_files"))}Box.Application.broadcast("x-previewerdetailsrefresh",{json:e})},close:function(e){e=e||{};var t=Box.Application.getService("nav-state");if(!this.is_open){$j.log("Gallery is not open and thus cannot be closed.");return}this.is_open=!1,FlashPreviewer.close(),ErrorPreviewer.close(),SWFPreviewer.close(),FlashPreviewer.deregister(),ErrorPreviewer.deregister(),SWFPreviewer.deregister();var n=Previewer.ELEMENTS_IN_GALLERY.concat(["#mod-sidebar-collaborators"]);$j(n.join(",")).filter(".displayed_for_gallery").removeClass("displayed_for_gallery").css("display","none"),$j(this._get_page_elements_not_in_gallery().join(",")).filter(".hidden_for_gallery").removeClass("hidden_for_gallery").show(),this.saved_canvas_folder&&(Canvas.get().current_folder=this.saved_canvas_folder,this.saved_canvas_folder=null),e.load_background&&this._load_background_page(),t.set({subId:null,isGallery:null}),Box.Application.broadcast("x-previewerclose")},_in_collection:function(e){return $.inArray(e,this.item_collection.items)!==-1},_set_item_collection:function(e){var t=this;if(!this._collection_has_same_parent_folder()){var n=new ItemCollection;n.add(Canvas.get().target_item),this.item_collection=n,this.item_collection_start_index=0,this.current_item_index=0,this.item_count=1;return}switch(e){case"init":this.item_collection=this._get_previewer_collection_from_target_item();var r=Canvas.get().target_item.typed_id;this.item_collection_start_index=0,this.item_count=this.item_collection.size(),$j.each(this.item_collection.items,function(e,n){if(r==n.typed_id)return t.current_item_index=e,!1});break;case"next":var i=this.item_collection.size();this.item_collection=this._get_previewer_collection_from_canvas(),this.item_collection_start_index+=i,this.current_item_index=0;break;case"prev":this.item_collection=this._get_previewer_collection_from_canvas(),this.item_collection_start_index-=this.item_collection.size(),this.current_item_index=this.item_collection.size()-1;break;default:}},slideshow:function(e,t){Box_Confirmation_Message.get().hide();var n=!1,r=Box.Application.getService("nav-state"),i=Box.Application.getService("nav-url");if(this.is_valid_state_change(e,t)){e=="index"?this.current_item_index=t-this.item_collection_start_index:e=="reload"?n=!0:this.current_item_index=this._get_relative_item_index_after_state_change(e);if(this._is_item_index_in_page_collection(this.current_item_index)){var s=this.current_item(),o=i.getFileUrlForPreview(s.id);o?Box.Application.navigate(o):(r.setPreviewState(s.typed_id),this.show_item({clear_player_cache:n}))}else this._load_page_for_state_change(e)}},_load_page_for_state_change:function(e){var t=this,n=Box.Application.getService("v5"),r=Box.Application.getService("shared-items"),i=Box.Application.getService("nav-url"),s=Box.Application.getService("nav-state"),o=s.get();this._disable_previous_and_next_links(!0),Box.Application.broadcast("x-previewerchangebefore");var u=o.page;e=="next"?u++:e=="prev"&&u--;switch(gallery_page){case"files":Loading.show(),this._fetch_collection_by_page(u).done(function(n){Loading.hide(),s.set({page:n.current_page-1}),o=s.get(),t._set_item_collection(e),Box.Application.navigate(i.getFileUrl(t.current_item().id,o.id,o.page))});break;case"shared_folder":case"vanity_url":Loading.show(),r.getItemsList({folderTypedId:"d_"+o.id,page:u,pageSize:Canvas.get().page_size,sharedName:n.get("shared_name"),sort:o.sort,sortDirection:o.sortDirection}).done(function(r){var u;s.set({page:r.current_page}),Loading.hide(),t._update_canvas_for_shared_page(r),t._set_item_collection(e),gallery_page==="shared_folder"?u=i.getFileUrlForSharedPage(t.current_item().id,o.id,o.page,n.get("shared_name")):gallery_page==="vanity_url"&&(u=i.getFileUrlForVanityPage(t.current_item().id,o.id,o.page,n.get("vanity_name"))),Box.Application.navigate(u)});break;default:}},is_valid_state_change:function(e,t){var n;return e=="index"?n=t:n=this._get_relative_item_index_after_state_change(e)+this.item_collection_start_index,this._is_item_index_in_previewer(n)},_init_players:function(e){FlashPreviewer.register(e),SWFPreviewer.register(),ErrorPreviewer.register(),Canvas.get().fix_page_ui_issues()},_fetch_collection_by_page:function(e){var t=Box.Application.getService("nav-state"),n=t.get(),r="/index.php?rm=box_item_list",i=$j.box.formatQuery({id:"d_"+n.id,sub_type:"1",page_num:e});return $.getJSON(r,i,this._update_canvas_for_files_page)},_fetch_collection_by_file:function(e){var t,n,r=this,i=Box.Application.getService("nav-state"),s=i.get();switch(gallery_page){case"files":t=$j.box.formatQuery({id:"d_"+s.id,sub_type:"1",sub_id:e}),n=$.getJSON(this.ITEM_LIST_URL,t,function(e){r._update_canvas_for_files_page(e),i.set({page:e.current_page-1})});break;default:n=$.Deferred().resolve().promise()}return n},_update_canvas_for_files_page:function(e){var t={background:!0,collaborated:e.folder_info?e.folder_info.collaborated:0,current_page:e.current_page,folder:e.folder_info,nodes:e.nodes,permissions:e.folder_info?e.folder_info.permissions:{},use_selectables:!0,use_dragdrop:!0};Canvas.get().reset(),Canvas.get().load(t)},_update_canvas_for_shared_page:function(e){var t={nodes:e.nodes,current_page:e.current_page,shared_name:window.shared_name,vanity_name:window.vanity_name,view:e.view,folder:e.shared_folder_info};Canvas.get().reset(),Canvas.get().load(t)},show_item:function(e){e=e||{};var t=e.clear_player_cache,n=e.load_on_left,r=e.load_on_right,i=Box.Application.getService("v5"),s=Box.Application.getService("browser"),o=i.get("AbstractPreviewer"),u=Box.Application.getService("nav-state");this._update_canvas_target_item(),u.setPreviewItem(this.current_item().typed_id);if(s.hasMinimumFlashVersion()){var a=this,f=this._get_item_context(this.current_item().typed_id),l="/preview/info/"+this.current_item().typed_id+".json";$j.getJSON(l,f,function(e){a._current_item_fits_gallery_criteria("alternative")?(SWFPreviewer.close(),ErrorPreviewer.close(),FlashPreviewer.close(),FlashPreviewer.update_with_item({clear_player_cache:t,load_on_left:n,load_on_right:r}),SWFPreviewer.open(),SWFPreviewer.update_with_item()):e.Document.Versions[0].Version.status=="error"?(SWFPreviewer.close(),FlashPreviewer.close(),ErrorPreviewer.open_with_item(e.Document)):(SWFPreviewer.close(),ErrorPreviewer.close(),FlashPreviewer.open(),FlashPreviewer.update_with_item({clear_player_cache:t,load_on_left:n,load_on_right:r}))},{no_context:!0})}var c=o._get_player_height();$j("#player").attr("height",c),gallery_page!="shared_file"&&(this._display_item_count(),this._disable_previous_and_next_links(),this._update_metadata(),this.process_gallery_sidebar(),this._update_buttons(),this.current_item().display_in_place_share(),document.title=this.current_item().name+" - Box"),u.isGcm()||this.update_item_feed_display(),Box.Application.broadcast("x-previewerchange")},subscribe_to_item_notifications:function(e){if(typeof Realtime_Notification!="undefined"&&e!=null&&!Previewer.get().is_subscribed){var t={};t.notification_url=e,t.item_typed_id=this.current_item().typed_id,Realtime_Notification.subscribe_to_item_notifications(t),Previwer.get().is_subscribed=!0}},_get_relative_item_index_after_state_change:function(e){switch(e){case"next":return this.current_item_index+1;case"prev":return this.current_item_index-1;case"first":return 0;case"last":return this.item_collection.size()-1;case"reload":return this.current_item_index;default:$j.log("Unknown state_change for box_previewer _get_relative_item_index_after_state_change: "+e)}return null},_is_shared_page:function(){return gallery_page=="shared_folder"||gallery_page=="vanity_url"||gallery_page=="collab_preview"},_is_sent_item_update_page:function(){return gallery_page=="inbox"&&(this.current_item().update.update_type==1||this.current_item().update.update_type==2)},process_gallery_sidebar:function(){if(!$j("#content_sidebar").length)return;var e=this,t=this.current_item(),n=this._is_shared_page(),r=this._is_sent_item_update_page();if(t.permissions.download&&!n&&gallery_page!="profile")if(!r){var i=Box.Application.getService("datetime"),s=i.translateDate(t.date),o=$t("Updated:","gallery_item_updated_label",s),u=$t("Click to see Version History","gallery_sidebar_click_to_see_versions"),a=parseInt(t.version_count),f="";!isNaN(a)&&a>0&&(f='<span class="badge upgrade mls">'+$t("Version %1","gallery_sidebar_version_number_info",a+1)+"</span>");var l=$j("#gallery_file_info_sidebar_versions_link").html(o+" "),c=$j('<a id="file_info_version" href="#"></a>').attr({"data-hover":"tooltip","aria-label":u}).append(s).append(f);Canvas.get().user.is_free_user&&t.owner_is_free?c.addClass("lowlight em").off("click").on("click",function(){var t=Box.Application.getService("v5popups");return t.showUpgradePopup("version_history"),!1}):c.off("click").on("click",function(){return Previewer.get().current_item().version_history(),!1}),l.append(c).show()}else $j("#gallery_file_info_sidebar_versions_link").hide();else $j("#gallery_file_info_sidebar_versions_link").hide();t.permissions.rename&&!n?$j("#file_info_properties").show():$j("#file_info_properties").hide();var h=Box.Application.getService("strings");$j("#gallery_file_info_sidebar_size").text($t("Size:","js_gallery_size")+" "+h.getHumanReadableSize(t.raw_size));var p=$j("#gallery_file_info_sidebar_tags");n?p.hide():t.render_tags({show_add_tags_button_for_zero_tags:!0,container_elem:p,force_render_tags:!0});if(t.can_view_download_stats()&&!n&&!r){var d=parseInt(t.shared_download_count)+parseInt(t.shared_preview_count);$j("#gallery_file_info_sidebar_downloads").text($t("Access count:","js_gallery_downloads")+" "+d)}else $j("#gallery_file_info_sidebar_downloads").empty();var v=Box.Application.getService("nav-state");if(gallery_page=="files"&&v.isFiles()||gallery_page=="inbox"&&v.isUpdates()||this._is_shared_page()){var m=$j("#files_in_folder_section"),g=m.find("#files_in_folder_list").hide(),y=g.find("#other_file_tpl");g.find(".added_for_file").remove();var b=Previewer.FILES_IN_FOLDER.PREVIOUS_DISPLAY_COUNT+Previewer.FILES_IN_FOLDER.NEXT_DISPLAY_COUNT,w=this.item_collection.items.length;w-1<b&&(b=w-1);if(b<1)m.hide();else{m.show();var E=this.current_item_index-Previewer.FILES_IN_FOLDER.PREVIOUS_DISPLAY_COUNT,S=this.current_item_index+Previewer.FILES_IN_FOLDER.NEXT_DISPLAY_COUNT,x=!1,T;$j("#view_more_files").hide();if(E<0)T=0-E,S+=T,E=0,S>=this.item_collection.size()&&(S=this.item_collection.size()-1),this._has_previous_page()&&(S-=1),x=!0;else if(S>=this.item_collection.size()){var N=this.item_collection.size();T=S-(N-1),E-=T,S=N-1,E<0&&(E=0),this._has_next_page()&&(E+=1),x=!0}var C,k=document.createDocumentFragment();for(var L=E;L<=S;L++){var A=this.item_collection_start_index+L,O=this.item_collection.items[L],M=y.clone();M.prop("id","other_file_"+O.id);var _=M.find(".bd"),D=_.find("h5"),P=_.find("p");L==this.current_item_index&&(C="other_file_"+O.id),M.addClass("added_for_file other_item"),M.data("item_index",A);if(O.has_pic_x){var H=O.pic_x;typeof shared_name!="undefined"&&(H=H+"&shared_name="+shared_name);var B='<img class="avatar_ext center" src="'+H+'">';M.find(".avatar_file_icon_cntr").html(B)}else M.find(".avatar_file_icon_cntr").addClass(O.thumb_class_large);D.text(O.name),O.last_updated_by!=null&&P.text("Updated by "+O.last_updated_by);var j=M.show().get(0);j&&k.appendChild(j)}g.prepend(k).show(),g.find(".other_item").on("click",function(){var t=$j(this).data("item_index");return e.slideshow("index",t),!1}),g.find("li").removeClass("selected"),C&&$j("#"+C).addClass("selected"),x&&this._update_files_sidebar_view_more_files_buttons(),g.find(".added_for_file").mouseenter(function(){$j(this).addClass("hover")}).mouseleave(function(){$j(this).removeClass("hover")})}}else $j("#files_in_folder_section").hide()},_update_files_sidebar_view_more_files_buttons:function(){if(gallery_page=="inbox")return;var e=$j("#view_more_files"),t=this;this._has_previous_page()&&this.current_item_index<=Previewer.FILES_IN_FOLDER.PREVIOUS_DISPLAY_COUNT-1?(e.remove(),e.off("click").on("click",function(){t.slideshow("prev")}),$j("#files_in_folder_list").prepend(e),$j(".body").removeClass("disable_sprite_46x46"),e.show()):this._has_next_page()&&this.current_item_index+Previewer.FILES_IN_FOLDER.NEXT_DISPLAY_COUNT>=this.item_collection.size()?(e.remove(),e.off("click").on("click",function(){t.slideshow("next")}),$j("#files_in_folder_list").append(e),$j(".body").removeClass("disable_sprite_46x46"),e.show()):e.hide()},_update_buttons:function(){var e=Box.Application.getService("nav-state");if(e.isGcm())return;var t=this,n=this.current_item(),r=$j("#gallery_edit_button"),i=$j("#gallery_upload_button"),s=$j("#gallery_lock_button"),o=$j(".gallery_download_button"),u=o.find("li:first"),a=o.find("li:last"),f=Box.Application.getService("box-edit");if(Box.Application.getGlobalConfig("useMinimal")==="use_minimal"){var l=!1;n.get_shared_info(function(e){n.permissions=e.permissions,n.lock=e.lock,n.locked=e.locked},l)}n.permissions.download?$j("#file_options_button").show():$j("#file_options_button").hide();var c=Box.Application.getService("openbox-service-actions"),h=c.getActions(n,{type:"openbox"});this._init_current_item_edit_and_view_actions(h);var p=this.current_item_edit_action,d=this.current_item_view_action,v=!1,m=!1,g="",y=!1;f&&(v=f.isBoxEditDisabledByAdmin(),m=f.isBoxEditInstalled(),y=f.canUserOpenFileOnDesktop(n),m&&(g=f.getNativeApplicationName(n.extension)));if(e.isEmbedWidget()&&!m)r.hide();else if(n.permissions.rename){var b=n.id,w=n.typed_id,E=Box.Application.getService("browser");r.enable().off("click").removeAttr("data-hover aria-label title"),p?r.on("click",function(){return p.execute(),!1}):v?this._disable_previewer_action_button(r,this.TOP_ADMIN_DISABLED_EDIT_BUTTON_TIP):E.isBrowserPluginsSupported()?m?g?this._enable_box_edit_btn_for_click({preview_obj:this,j_edit_btn:r,file_id:b,typed_id:w}):this._disable_previewer_action_button(r,this.TOP_EDIT_BUTTON_UNEDITABLE_FILETYPE_TIP):r.on("click",function(){return Box.Application.getService("popups").open("box_edit_download",{data:{action:"edit",typed_id:n.typed_id,extension:n.extension}}),!1}):this._disable_previewer_action_button(r,this.TOP_EDIT_BUTTON_PLUGIN_NOT_SUPPORTED_TIP)}else{var S=n.locked?n.generate_lock_info_html():this.TOP_DISABLED_EDIT_BUTTON_TIP;this._disable_previewer_action_button(r,S)}if(n.lock){var x=n.lock,T=n.generate_lock_info_html();x.can_unlock?this._show_and_get_gallery_button("unlock").attr("data-htmltooltip",T).off("click").on("click",function(){n.unlock_file()}):this._show_and_get_gallery_button("lock").off("click").on("click",function(){var e=Box.Application.getService("v5popups-postload");e.showUnlockRequestPopup(x)}).attr("data-htmltooltip",T)}else if(n.permissions.upload&&!n.is_boxnote())this._show_and_get_gallery_button("upload").enable().removeAttr("data-hover aria-label title").off("click").on("click",function(){return t._handle_upload_button_click(),!1});else{var N="";n.is_boxnote()?N=this.TOP_DISABLED_BOX_NOTES_UPLOAD_BUTTON_TIP:N=this.TOP_DISABLED_UPLOAD_BUTTON_TIP,this._show_and_get_gallery_button("upload").attr({"data-hover":"tooltip","aria-label":N}).disable().find("ul").show()}o.off("click"),u.attr("class","icon sprite_14x14_download"),a.text($t("Download","download_button_text"));if(d&&!n.is_webdoc()&&!n.is_boxnote())u.attr("class","icon sprite_14x14 sprite_16x16_preview"),a.text($t("View File","view_file_button_text")),o.enable().off("click").removeAttr("data-hover aria-label title"),o.on("click",function(){d.execute()});else if(n.is_downloadable())o.enable().removeAttr("data-hover aria-label title").off("click").on("click",function(){if(!$j(this).hasClass("disabled"))return Previewer.get().current_item().download({no_confirmation:!0}),!1});else{var C="";n.is_boxnote()?C=this.TOP_DISABLED_BOX_NOTES_DOWNLOAD_BUTTON_TIP:C=n.locked?n.generate_lock_info_html():this.TOP_DISABLED_DOWNLOAD_BUTTON_TIP,this._disable_previewer_action_button(o,C)}if(gallery_page=="shared_folder"||gallery_page=="vanity_url")r.hide(),i.hide(),s.hide(),o.parent().addClass("first");$j("#gallery_button").show()},_enable_box_edit_btn_for_click:function(e){var t=Box.Application.getService("box-edit"),n=e.j_edit_btn;n.enable().removeAttr("data-hover aria-label title").off("click").on("click",function(){return t&&(t.executeBoxEdit(e.file_id,e.typed_id),n.off("click"),setTimeout(function(){e.preview_obj._enable_box_edit_btn_for_click(e)},1e3)),!1})},_show_and_get_gallery_button:function(e){var t=$("#gallery_upload_button").hide(),n=$("#gallery_lock_button").hide(),r=$("#gallery_unlock_button").hide();if(e=="upload")return t.show();if(e=="lock")return n.show();if(e=="unlock")return r.show()},_handle_upload_button_click:function(){Upload_Process.get().show_upload_new_version_popup()},_disable_previewer_action_button:function(e,t){e.off("click").addClass("disabled"),e.attr("data-htmltooltip",t)},update_item_feed_display:function(){var e=(gallery_page=="shared_folder"||gallery_page=="vanity_url"||gallery_page=="collab_preview")&&!commenting_on_shared_pages_enabled,t=this.current_item().permissions&&this.current_item().permissions.create_comment;e||gallery_page=="shared_file"||!t?$j("#gallery_item_feed_part").hide():this.show_item_feed()},show_item_feed:function(){var e=this,t=this.current_item(),n=Box.Application.getService("nav-state");return t.get_item_feed({show_all:!0,j_feed_container:$j("#gallery_item_feed_block"),callback:function(){e.scroll_down_to_view_id_callback(),n.isEmbedWidget()||$(".item_feed_bar").stalker({direction:"up",stalkerStyle:{"border-top":"#999","box-shadow":"rgba(0, 0, 0, 0.2) 0px -3px 6px 0px",margin:0,opacity:.88}})}}),$j("#gallery_item_feed_part").show(),!1},scroll_down_to_view_id_callback:function(){var e=Previewer.get();if(e.scroll_down_to_view_id){var t=$j(".item_feed > li[data-view_id='"+e.scroll_down_to_view_id+"']"),n=t.find("ul, li, .pill").add(t);if(t){var r=$(".header").height()+5,i=t.offset().top-r;$j("html, body").animate({scrollTop:i},400),setTimeout(function(){t.addClass("scroll_to_glow_border"),n.addClass("scroll_to_glow_background"),t.addClass("scroll_to_glow_transition"),n.addClass("scroll_to_glow_transition"),setTimeout(function(){t.removeClass("scroll_to_glow_border"),n.removeClass("scroll_to_glow_background"),e.scroll_down_to_view_id=null},1600)},200)}}},_update_metadata:function(){var e=this,t=this.current_item(),n=Number(t.version_count)+1,r=t.name.length>18?t.name:"",i={},s={"data-tooltip":r},o=Box.Application.getService("datetime"),u=o.translateDate(this.current_item().date),a=o.translateDate(this.current_item().created),f=$j("#gallery_page_title");if((!$j.browser.msie||parseInt($j.browser.version)>=9)&&t.permissions&&t.permissions.rename){var l="filename not_empty";s=$.extend({"data-behavior":"edit_in_place"},s),i={url:"/index.php?rm=box_files_update_item_info",field:"name",item_id:t.id,item_type:t.type,editable_icon_move_right:-15,width:350,update_tooltip_after_edit:!0,make_overflow_hidden_element_visible:"gallery_page_title",validate:l},f.addClass("edit_in_place edit_in_place_inline").data("callback",function(t){e.process_gallery_sidebar()})}f.text(t.name).data(i).attr(s).clone(!0).replaceAll("#gallery_page_title");var c=$.box.escapeHTML(t.created_by),h='<span class="badge upgrade version mrs">'+$t("V%1","version_badge_txt_v2",n)+"</span>";Canvas.get().user.login!=""&&t.created_by_user_id>2&&(c='<a href="/profile/'+t.created_by_user_id+'" class="lowlight">'+c+"</a>"),t.version_count>0?$j("#gallery_created_by").html(h+$t("Updated %1 by %2%3%4","gallery_updated_by_text",u,'<span class="ellipsis ellipsis_200">',c,"</span>")):$j("#gallery_created_by").html($t("Created %1 by %2%3%4","gallery_created_by_text",a,'<span class="ellipsis ellipsis_200">',c,"</span>"))},is_user_entering_text:function(){var e=$j("textarea, input[type=text]").filter(function(){return $j(this).is(":visible")&&$j(this).offset().left>=0&&!$j(this).prop("readonly")&&!$j(this).hasClass("search_field")&&$j(this).val()});return!!e.length},initialize_item_collection:function(e){this.backup_collection=this.item_collection,this.backup_item_index=this.current_item_index,this.item_collection=new ItemCollection,this.item_collection.items[0]=e,this.current_item_index=0},reset_collection:function(){this.item_collection=new ItemCollection,this.current_item_index=0},open_shared_file_preview:function(){this.is_open=!0,this._init_players("share")},_init_current_item_edit_and_view_actions:function(e){this.current_item_edit_action=null,this.current_item_view_action=null;var t=this.current_item();if(t.type=="file")for(var n in e){if(!this.current_item_edit_action&&t.permissions.rename&&t.can_edit_on_gallery_using(e[n].action)){this.current_item_edit_action=e[n];continue}if(!this.current_item_view_action&&t.permissions.download&&t.can_view_on_gallery_using(e[n].action)){this.current_item_view_action=e[n];continue}}},_update_path:function(e){var t=this,n=$j("#gallery_path");n.empty().hide();var r=this._get_gallery_path_text(),i=$j('<a href="#" id="gallery_path_return_to_link" />').append($j("<strong/>").text(r)),s,o=Box.Application.getService("nav-state");if(e&&!o.isPinboard())if(r)n.removeClass("breadcrumb").removeClass("mbn").addClass("mts").addClass("inline_list_ext"),$j('<li class="sup"></li>').append(i).appendTo(n),$j('<li class="last-child sup"><ul id="gallery_path_built" class="breadcrumb mvn"></ul></li>').appendTo(n),$j("#gallery_path_built").html(e).find(".breadcrumb_image").remove();else{n.html(e),n.addClass("breadcrumb").addClass("mbn").removeClass("mts").removeClass("inline_list_ext");var u=n.find("#jump_to_folder_link");u.length&&u.replaceWith('<a id="p_0" class="path" href="#/files/0/f/0">'+$t("All files and folders","all_files_and_folders")+"</a>"),s=n.find("li:last"),s.find(".delimiter").length===0&&s.append($j('<span class="delimiter" />').text(box_path_delimiter_char))}else if(this._is_shared_folder()||(gallery_page=="files"?o.isFiles()&&!Canvas.get().current_folder.is_root_folder():$j("#main_path").is(":has(li)"))){var a=$j("#main_path").children();if(this._is_shared_folder()&&!a.length){var f=$j("#page_title").text();$j($j.parseHTML("<li/>")).append($j($j.parseHTML('<a class="path" href="#" />')).text(f)).appendTo(n)}else a.each(function(){$j(this).clone(!0).appendTo(n)});n.removeClass("mts inline_list_ext").addClass("breadcrumb mbn"),s=n.find("li:last"),s.find(".delimiter").length===0&&s.append($j('<span class="delimiter" />').html(box_path_delimiter_char)),s.find("a").off("click").on("click",function(){return t.close({load_background:!0}),!1})}else $j("<li></li>").append(i).appendTo(n);n.show(),i.click(function(){return t.close({load_background:!0}),!1})},_get_previewer_collection_from_target_item:function(){return Canvas.get().target_item.collection.find(Previewer.GALLERY_CRITERIA)},_get_previewer_collection_from_canvas:function(){return Canvas.get().collections[0].find(Previewer.GALLERY_CRITERIA)},_collection_is_single_page:function(){var e=this._collection_is_filtered_files_view();return gallery_page=="profile"||gallery_page=="inbox"||Canvas.get().page_count==1&&!e},_collection_has_same_parent_folder:function(){var e=this._collection_is_filtered_files_view();return!e},_collection_is_filtered_files_view:function(){var e=Box.Application.getService("nav-state");return gallery_page=="files"&&e.isShowingSearchOrTag()},_get_item_count_params:function(){var e=Box.Application.getService("nav-state"),t=e.get();return{type:Previewer.GALLERY_CRITERIA.type,extension:Previewer.GALLERY_CRITERIA.extension,first_set_id:this.item_collection.items[0].id,sort_direction:t.sortDirection||"DESC",sort_type:t.sort}},preview_on_click:function(e,t){var n=Previewer.get_extension_to_type_mapping();return e=="file"&&n[t]},current_item_overlay_message:function(){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_previewer.js:16079","2013-05-15","auto tombstoned");var e=this.current_item();return this.current_item_edit_action?e.permissions.rename?(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_previewer.js:16080","2013-05-15","auto tombstoned"),$t("You are viewing a preview of this file. Click <em>Edit File</em> to edit the original.","gallery_overlay_openbox_edit")):$t("You are viewing a preview of this file.","gallery_overlay_openbox_nopermission"):""},can_share:function(){return this.current_item().permissions.share||gallery_page=="shared_folder"||gallery_page=="vanity_url"},set_player_active:function(e,t){FlashPreviewer.set_player_active(e,t)},current_item:function(){return this.item_collection.items[this.current_item_index]},current_item_display_index:function(){return this.item_collection_start_index+this.current_item_index+1},_get_page_elements_not_in_gallery:function(){var e=gallery_page;switch(e){case"shared_folder":case"vanity_url":case"collab_preview":e="shared";break;default:}return e=="profile"?Previewer.ELEMENTS_NOT_IN_GALLERY.inbox.concat(Previewer.ELEMENTS_NOT_IN_GALLERY.profile):Previewer.ELEMENTS_NOT_IN_GALLERY[e]||[]},_hide_elements_not_in_gallery:function(){var e=$j("#files"),t=Box.Application.getService("nav-state");$j.browser.msie&&parseInt($j.browser.version,10)==7&&e.length?($j(this._get_page_elements_not_in_gallery().join(",")).not(e).hide().addClass("hidden_for_gallery"),e.detach().hide().addClass("hidden_for_gallery"),e.insertBefore("#gallery")):t.isGcm()?$j(this._get_page_elements_not_in_gallery().join(",")).hide().addClass("hidden_for_gallery"):$j(this._get_page_elements_not_in_gallery().join(",")).filter(":visible").hide().addClass("hidden_for_gallery"),typeof folder_tree!="undefined"&&folder_tree.is_visible()&&folder_tree.hide(),$j("#thumbnail").hide(),Canvas.get().selection.unselect_all()},_show_elements_in_gallery:function(){$j(Previewer.ELEMENTS_IN_GALLERY.join(",")).addClass("displayed_for_gallery").show()},set_player:function(e){this.player=e},_has_next_page:function(){var e=Box.Application.getService("nav-state"),t=e.get();return t.page<Canvas.get().page_count-1},_has_previous_page:function(){return this.item_collection_start_index>0},_is_item_index_in_page_collection:function(e){return e>=0&&e<this.item_collection.size()},_is_item_index_in_previewer:function(e){return e>=0&&e<(this.item_count||1)},_get_item_context:function(e){var t=e?e.typed_id:null,n,r,i;switch(gallery_page){case"files":break;case"inbox":case"profile":if(!e||!e.update||e.update.update_type!=1&&e.update.update_type!=2)break;if(e&&typeof e.shared_name!="undefined"){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_previewer.js:16095","2013-05-15","auto tombstoned"),n=e.shared_name;break}typeof this.current_item().shared_name!="undefined"&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_previewer.js:16096","2013-05-15","auto tombstoned"),n=this.current_item().shared_name);break;case"shared_folder":n=Canvas.get().shared_name;break;case"vanity_url":r=typeof vanity_name!="undefined"?vanity_name:null;break;case"collab_preview":i=typeof collab_invite_token!="undefined"?collab_invite_token:null;break;case"shared_file":n=this.current_item().shared_name;break;default:}var s={identifier:t,shared_name:n,vanity_name:r,collab_invite_token:i};return window.Features&&window.additional_context&&(s.additional_context=window.additional_context),s},_current_item_fits_gallery_criteria:function(e){if(e=="alternative")return Previewer.ALTERNATIVE_GALLERY_CRITERIA.extension[this.current_item().extension]},_update_canvas_target_item:function(){Canvas.get().target_item=this.current_item()},_get_gallery_path_text:function(){var e=Box.Application.getService("nav-state"),t=e.get();switch(gallery_page){case"files":switch(t.type){case"t":return $t("Return to Tag Results","js_box_gallery_return_to_tag");case"item":return $t("Return to File","js_box_gallery_return_to_file");case"l":return $t("Return to Filter Results","js_box_gallery_return_to_filter");case"s":return $t("Back to Search Results","js_box_gallery_return_to_search");case"p":return $t("Back to Collection","js_box_gallery_return_to_pinboard");default:}return!1;case"inbox":return $t("Back to Updates","js_box_gallery_return_to_updates");case"profile":return $t("Return to Profile","js_box_gallery_return_to_profile");default:return $t("Return to Previous","js_box_gallery_return_to_previous")}},_is_shared_folder:function(){return typeof shared_folder!="undefined"},_load_background_page:function(){var e=Box.Application.getService("nav-state");e.set({isGallery:!1}),Box.Application.navigate("")},_display_item_count:function(){$j("#total_items").text(this.item_count),$j("#item_number").text(this.current_item_display_index()),this._disable_previous_and_next_links()},_disable_previous_and_next_links:function(e){var t=$j("#gallery_page_nav"),n=e||!this.is_valid_state_change("prev"),r=e||!this.is_valid_state_change("next");t.find("#prev_file_link").toggleClass("disabled",n),t.find("#next_file_link").toggleClass("disabled",r)},_register_previewer_open_in_nav:function(){var e=Box.Application.getService("nav-state");switch(gallery_page){case"files":e.set({wasGallery:!0});break;case"inbox":e.set({isGallery:!0});break;case"profile":e.setPreviewState(this.current_item().typed_id);break;default:}}},{GALLERY_CRITERIA:{type:{folder:!1,web_link:!1}},ALTERNATIVE_GALLERY_CRITERIA:{extension:{swf:!0,webdoc:!0}},FILES_IN_FOLDER:{PREVIOUS_DISPLAY_COUNT:1,NEXT_DISPLAY_COUNT:3},PLAYER:{PREVIOUS_PRELOAD_COUNT:2,NEXT_PRELOAD_COUNT:2,DEFAULT_WIDTH:713,MAX_WIDTH:976},_EXTENSIONS_BY_TYPE:{DOCUMENT:["as","as3","asm","bat","c","cc","cmake","cpp","cs","css","csv","cxx","diff","doc","docx","erb","gdoc","groovy","gsheet","h","haml","hh","htm","html","java","js","less","m","make","ml","mm","mpp","msg","ods","odt","pdf","php","pl","plist","properties","py","rb","rtf","sass","scala","scm","script","sh","sml","sql","tsv","txt","vi","vim","wpd","xls","xlsm","xlsx","xml","xsd","xsl","xslt","yaml"],FLASH:["flv","f4v","swf"],IMG:["ai","bmp","eps","gif","ind","jpeg","jpg","png","ps","psd","tif","tiff"],MEDIA:["3g2","3gp","avi","m2v","m2ts","mts","m4v","mkv","mov","mp3","mp4","mpeg","mpg","qt","ra","ram","wmv"],PRESENTATION:["odp","ppt","pptx"]},get_extension_to_type_mapping:function(){var e,t;if(!Previewer._EXTENSION_TO_TYPE){Previewer._EXTENSION_TO_TYPE={};for(e in Previewer._EXTENSIONS_BY_TYPE)for(t=0;t<Previewer._EXTENSIONS_BY_TYPE[e].length;t++)Previewer._EXTENSION_TO_TYPE[Previewer._EXTENSIONS_BY_TYPE[e][t]]=e}return Previewer
._EXTENSION_TO_TYPE},ELEMENTS_IN_GALLERY:["#main_preview","#mod-subheader-preview","#mod-subheader-preview-embed-widget","#gallery",".gallery_sidebar"],ELEMENTS_NOT_IN_GALLERY:{files:["#box_confirmation","#mod-viral-promo","#search_upsell","#files","#mod-paging-bottom",".files_sidebar",".paging","#sidebar_resources_section"],gcm:["#gcm_sidebar_container",".gcm_content_body"],inbox:["#subtabs","#box_confirmation","#new_updates_message","#mod-item-list-updates","#inbox-header",".inbox_sidebar",".paging","#sidebar_resources_section"],profile:["#user_profile_header","div.notification","#profile_header",".profile_sidebar","#profile"],shared:["#header_browse","#subheader","#files",".box_thumbnail_tip",".shared_folder_sidebar",".paging","#sidebar_folder_info"]},get:function(){return Previewer.__instance||(Previewer.__instance=new Previewer),Previewer.__instance}});Box.Timing.execution.push({name:"js/box_sidebar.js",time:(new Date).getTime()});var box_sidebar={show_sidebar:function(e){var t=Box.Application.getService("nav-state"),n=t.get();e=e||box_sidebar.get_current_folder();if(e&&e.collaborated){if(n.type=="t"){var r=Box.Application.getService("url");$j("#sidebar_files_know .sidebar_text").html($t("You can add your own tags by clicking the tag icon to the right of the file or folder. %1Learn more%2","tags_tip_text_in_js",'<a href="https://product.'+r.getHostDomain()+'/help/149" target="_blank">',"</a>"))}$j("#sidebar_files_know")[n.id==0||n.type==="item"?"show":"hide"]()}this.init_sharebar_in_sidebar(),Features.corporate_network&&this.init_corporate_network_in_sidebar()},populate_canvas_collabs:function(){var e=box_sidebar.get_current_folder(),t=Box.Application.getGlobalConfig("userLogin"),n=Box.Application.getService("nav-state"),r=n.get();if(!(!window.box||r.type!="s"&&r.type!="l"&&r.type!="collab"&&r.type!="t"))return;if(e&&e.collaborations){Canvas.get().user.collab_in_current_folder=e.collaborations[t];for(var i in e.collaborations)for(var s in e.collaborations[i]){if(typeof e.collaborations[i]=="undefined"||e.collaborations[i]==null)continue;if(typeof e.collaborations[i][s]=="undefined"||e.collaborations[i][s]==null)continue;if(typeof e.collaborations[i][s].user_id=="undefined"||e.collaborations[i][s].user_id==null)continue;var o=e.collaborations[i][s].user_id!="0"?e.collaborations[i][s].user_id:e.collaborations[i][s].email;if(o){var u=Canvas.get().users.find(o);typeof u!="undefined"&&(u.collab_in_current_folder=e.collaborations[i])}}}},get_current_folder:function(){var e=Box.Application.getService("v5"),t=e.get("Canvas"),n=Box.Application.getService("nav-state");return t.current_folder?t.current_folder:n.isPreviewerOpen()&&n.galleryItem()?(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_sidebar.js:14886","2013-05-15","auto tombstoned"),n.galleryItem().folder):t.target_item&&n.isGcm()?t.target_item.folder:null},get_current_item:function(){var e=Box.Application.getService("v5"),t=e.get("Canvas"),n=Box.Application.getService("nav-state");return n.isPreviewerOpen()&&n.galleryItem()?n.galleryItem():t.target_item&&n.isGcm()?t.target_item:t.current_folder},init_sharebar_in_sidebar:function(){var e=$j("#sidebar_sharebar"),t=box_sidebar.get_current_item(),n=Box.Application.getService("nav-state"),r=n.get();if(t){var i=t.id==1;t.is_root_folder()||i?e.addClass("hidden"):r.type=="s"&&t.type=="folder"?e.addClass("hidden"):e.removeClass("hidden")}t&&t.display_in_place_share()},init_corporate_network_in_sidebar:function(){var e=$j(".corporate_network_sidebar_module"),t=Box.Application.getService("logger");if(e.length===0)return;e.show(),t.sendLog("collab","CORPORATE_NETWORK_SIDEBAR_VIEW");var n=$j(".corporate_network_sidebar_module .show_more_link");n.off("mouseover").on("mouseover",function(e){Box_Menus.get().corporate_network_menu.show({target:n})}).off("mouseout").on("mouseout",function(e){$j(e.currentTarget).hasClass("ignore_mouseout")||Box_Menus.get().corporate_network_menu.hide()})},hide_corporate_network_in_sidebar:function(){$j(".corporate_network_sidebar_module").hide()},hide_sidebar_collaborator:function(){$j("#mod-sidebar-collaborators").hide()},update_share_icons:function(e){var t=box_sidebar.get_current_item(),n=Item.shared_access_to_icon(e.shared_access),r=e.shared_access_to_tooltip(e.shared_access);if(e==t){var i=$j("#sharing_sidebar_access_level_icon");i.removeClass().addClass("icon sprite_16x16 "+n+" list_img"),i.attr({"data-hover":"tooltip","aria-label":r})}var s=$j("#popup_settings_launcher span:first");s.removeClass().addClass("sprite_16x16 "+n+" list_img"),s.attr({"data-hover":"tooltip","aria-label":r}),typeof SharebarAction!="undefined"&&SharebarAction.update_warnings(e)}};Box.Timing.execution.push({name:"js/box_option_dropdown.js",time:(new Date).getTime()});var Box_Option_Dropdown=Box_Base.extend({_j_dropdown:null,_j_dropdown_container:null,_j_dropdown_items:{},_j_no_results_item:null,_on_select_callback:null,_option_keys:[],_option_indices:{},_highlighted_option_index:null,_option_is_selectable:{},max_dropdown_height:null,no_results_label:$t("No results","option_selector_no_results_label"),default_item_text:"",default_item_sprite_class:"",default_item_callback:null,hide_no_results_item:!1,allow_not_selectable_items:!1,no_results_label_timeout_duration:0,constructor:function(e){this._j_dropdown_items={},this._option_is_selectable={},e&&e.no_results_label&&(this.no_results_label=e.no_results_label,e.no_results_label_timeout_duration&&(this.no_results_label_timeout_duration=e.no_results_label_timeout_duration)),this.base(e),this._init_ui_component()},get_ui_component:function(){return this._j_dropdown_container},show:function(){this._is_empty()||this._j_dropdown_container.show()},hide:function(){this._j_dropdown_container.hide()},position:function(e,t){this._j_dropdown_container.css({position:"absolute",top:e+"px",left:0,width:t-1})},highlight_and_populate:function(e,t,n,r){typeof task_field_fixed=="object"&&!this._j_dropdown_container.parents(task_field_fixed).length&&(task_field_fixed.restoreZIndex(),task_field_fixed=null);if(!n){var i=this._highlight(e,t);this._available_options=i,this._populate(i)}else this._is_empty()&&this._populate();this._is_empty()&&this.hide_no_results_item?this._j_dropdown_container.hide():(!r||!r.hide_no_results)&&this._j_dropdown_container.show()},get_key_from_index:function(e){return e===null||e<0||e>=this._option_keys.length?(e==this._option_keys.length&&typeof this.default_item_callback=="function"&&this.default_item_callback(),null):this._option_keys[e]},set_on_select_callback:function(e){this._on_select_callback=e},delete_index:function(e){var t=this._option_keys;this._option_keys=[];for(var n in t)t[n]!=e&&this._option_keys.push(t[n]);delete this._option_indices[e];var r=0;for(var i in this._option_indices)this._option_indices[i]=r,++r},remove:function(e){var t=this;this._j_dropdown_items[e]&&(this._j_dropdown_items[e].slideUp("fast",function(){$(this).remove(),t.highlight_first_option()}),this.delete_index(e))},highlight_first_option:function(){this._highlighted_option_index===null&&this.highlight_next_option()},highlight_next_option:function(e){var t=!1;while(!t)this._highlighted_option_index===null?t=this.highlight_option_by_index(0,e):t=this.highlight_option_by_index(this._highlighted_option_index+1,e)},highlight_previous_option:function(e){var t=!1;while(!t)this._highlighted_option_index===null?t=this.highlight_option_by_index(this._j_dropdown.children().length-1,e):t=this.highlight_option_by_index(this._highlighted_option_index-1,e)},reset_highlight_index:function(){this._highlighted_option_index!=null&&this._j_dropdown.children().eq(this._highlighted_option_index).removeClass("selected"),this._highlighted_option_index=null},highlight_option_by_index:function(e,t){var n=this._j_dropdown.children().length;if(n>0){var r=this._highlighted_option_index;e=Math.max(0,Math.min(e,n-1));if(r!=e){this._highlighted_option_index=e;var i=this._j_dropdown.children();i.eq(r).removeClass("selected");var s=i.eq(e).addClass("selected");t&&$(this._j_dropdown).scrollTo(s);var o=this._option_keys[e];return this._option_is_selectable[o]}}return!0},get_highlighted_option_index:function(){return this._highlighted_option_index},_init_ui_component:function(){this._j_dropdown_container=$('<div class="drop_down_container mtn"></div>'),this._j_dropdown=$('<ul class="list_ext drop_down_inner list_ext_no_bottom_border box_options_drop_down scrollable"></ul>'),this._j_dropdown_container.hide().append(this._j_dropdown),this.max_dropdown_height&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_option_dropdown.js:6723","2013-05-15","auto tombstoned"),this._j_dropdown.css({"max-height":this.max_dropdown_height+"px"}))},_populate:function(e){var t=this,n=!1,r;this._j_dropdown.empty(),this._highlighted_option_index=null,this._option_keys=[],this._option_indices={};for(r in e)this._add_dropdown_item(r,e[r])&&(n=!0,window.clearTimeout(this.no_results_label_timeout));n?this.highlight_first_option():this.hide_no_results_item||(this.no_results_label_timeout=window.setTimeout(function(){t._add_no_results_item()},this.no_results_label_timeout_duration)),this._add_default_item()},_add_default_item:function(){if(this.default_item_text){this._j_default_item||(this._j_default_item=$('<li class="option_dropdown_default_item"/>').append($j('<a href="#" />').text(this.default_item_text)).mouseenter(function(e){$(this).addClass("selected")}).mouseleave(function(e){$(this).removeClass("selected")}),this.default_item_sprite_class&&this._j_default_item.prepend($j('<span class="icon img" />').addClass(this.default_item_sprite_class)));if(this.default_item_callback){var e=this;this._j_default_item.off("click").on("click",function(){return e.default_item_callback(),!1})}this._j_default_item.appendTo(this._j_dropdown)}},_highlight:function(e,t){var n={};for(var r in t)this._option_is_selectable[r]=!this.allow_not_selectable_items||!t[r].not_selectable,n[r]=this._highlight_label_callback(e,r,t[r]);return n},_is_empty:function(){return this._option_keys.length===0},_add_dropdown_item:function(e,t){var n=this;return this._option_keys.length===0&&this._j_dropdown.empty(),this._create_dropdown_item(e),this._j_dropdown_items[e].click(function(t){var r=$j(t.target);return n._on_select_callback(e,r),!1}).mouseenter(function(t){n.highlight_option_by_index(n._option_indices[e])}).mouseleave(function(e){n.reset_highlight_index()}).removeClass("selected hover").toggleClass("not_selectable",!this._option_is_selectable[e]).html(t),this._j_dropdown_items[e].show().appendTo(this._j_dropdown),this._option_indices[e]=this._option_keys.length,this._option_keys.push(e),!0},_create_dropdown_item:function(e){this._j_dropdown_items[e]||(this._j_dropdown_items[e]=$("<li></li>"))},_add_no_results_item:function(){this._j_no_results_item||(this._j_no_results_item=$('<li class="not_selectable"/>').append($j("<strong />").text(this.no_results_label)).mouseenter(function(e){$(this).addClass("selected")}).mouseleave(function(e){$(this).removeClass("selected")})),this._j_dropdown.children().length===0&&this._j_no_results_item.prependTo(this._j_dropdown)},_has_match:function(e,t){return $.isFunction(this._match_callback)&&this._match_callback(e,t)},_match_callback:function(e,t){return e!=""&&t.toLowerCase().indexOf(e.toLowerCase())===0},_highlight_label_callback:function(e,t,n){return this._highlight_string_callback(e,n)},_highlight_string_callback:function(e,t){return this._has_match(e,t)?this._highlight_match_callback($.box.escapeHTML(t.substr(0,e.length)))+$.box.escapeHTML(t.substr(e.length,t.length)):$.box.escapeHTML(t)},_highlight_match_callback:function(e){return"<b>"+e+"</b>"}},{});Box.Timing.execution.push({name:"js/box_contact_dropdown.js",time:(new Date).getTime()});var Box_Contact_Dropdown=Box_Option_Dropdown.extend({_highlight_label_callback:function(e,t,n){return this._highlight_string_callback(e,n.name)+" ("+this._highlight_string_callback(e,n.email)+")"}},{});Box.Timing.execution.push({name:"js/box_folder_tree_search_dropdown.js",time:(new Date).getTime()});var Box_Folder_Tree_Search_Dropdown=Box_Option_Dropdown.extend({constructor:function(e){this.base(e),this._j_dropdown.addClass("man")},_add_no_results_item:function(){this._j_no_results_item||(this._j_no_results_item=$j('<li class="strong pam pbn"></li>'),this._j_no_results_item.text(this.no_results_label)),this._j_no_results_item.prependTo(this._j_dropdown)},_highlight_string_callback:function(e,t){return t},position:function(){},_create_dropdown_item:function(e){this._j_dropdown_items[e]||(this._j_dropdown_items[e]=$('<li class="ban pan txt_m"></li>'))},get_folder_name:function(e){var t=this._j_dropdown_items[e];return t?t.find(".fts_result").attr("data-item_name"):null},hide:function(e){this._j_dropdown_container.hide(),e&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_folder_tree_search_dropdown.js:7426","2013-05-15","auto tombstoned"),this._j_dropdown_container.empty())},show_loading:function(){if($j("#ft_dropdown_loading").length===0){this._j_dropdown.hide();var e=this.get_ui_component(),t=$t("Loading your results...","qs_loading_text"),n='<ul id="ft_dropdown_loading" class="inline_list inline_list_icon_aligned lh16 pam pbn mtn">	<li>		<img src="'+Box.Application.getService("assets").getAssetURL(images_box_path,"spinner.gif")+'"/>'+"  </li>"+'  <li class="strong">'+t+" </li>"+"</ul>";e.append(n).show()}},hide_loading:function(){$j("#ft_dropdown_loading").remove(),this._j_dropdown.show()}},{});Box.Timing.execution.push({name:"js/box_item_contact_dropdown.js",time:(new Date).getTime()});var Box_Item_Contact_Dropdown=Box_Contact_Dropdown.extend({_highlight_label_callback:function(e,t,n){var r=this.base(e,t,n);return!this._option_is_selectable[t]&&this.allow_not_selectable_items&&(n.is_uploader?r=r+' <span data-hover="tooltip" aria-label="'+$t("This user does not have permission to add comments or respond to tasks.","item_contact_selector_uploader_permission")+'" class="badge role">'+$t("UPLOADER","item_contact_dropdown_uploader_badge")+"</span>":n.is_edit_disabled_in_enterprise&&(r=r+' <span data-hover="tooltip" aria-label="'+$t("This user has editing disabled in the enterprise and does not have permission to add comments or respond to tasks.","item_contact_selector_edit_disabled_in_enterprise_permission")+'" class="badge role">'+$t("DISABLED","item_contact_dropdown_disabled_badge")+"</span>")),r}},{});Box.Timing.execution.push({name:"js/box_state_machine.js",time:(new Date).getTime()});var Box_State_Machine=Box_Base.extend({_current_state_id:null,_transitions:{},_callbacks:{},constructor:function(e){this._current_state_id=e,this._callbacks={},this._transitions={}},is_in_state:function(e){return this._current_state_id==e},set_state:function(e){return this._current_state_id=e,e},_get_transition:function(e){var t=this._transitions[e];if(t){var n=this._current_state_id;if(typeof t[n]!="undefined"){var r=t[n];return{from:n,to:r}}}return null},add_state:function(e){var t=e.id,n=e.transitions,r=e.callbacks;for(var i in n)this.add_transition(i,t,n[i]);r&&(r[Box_State_Machine.CALLBACK_TYPES.ON_ENTER]&&this._add_callback(Box_State_Machine.CALLBACK_TYPES.ON_ENTER,t,r[Box_State_Machine.CALLBACK_TYPES.ON_ENTER]),r[Box_State_Machine.CALLBACK_TYPES.ON_EXIT]&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_state_machine.js:15088","2013-05-15","auto tombstoned"),this._add_callback(Box_State_Machine.CALLBACK_TYPES.ON_EXIT,t,r[Box_State_Machine.CALLBACK_TYPES.ON_EXIT])))},add_transition:function(e,t,n){this._transitions[e]||(this._transitions[e]={}),this._transitions[e][t]=n},on_transition:function(e,t){var n=Box_State_Machine.CALLBACK_TYPES.ON_TRANSITION;this._callbacks[n]||(this._callbacks[n]={}),this._callbacks[n][e]=t},_add_callback:function(e,t,n){this._callbacks[e]||(this._callbacks[e]={}),this._callbacks[e][t]=n},_apply_on_transition:function(e,t){var n;this._callbacks[Box_State_Machine.CALLBACK_TYPES.ON_TRANSITION]&&(n=this._callbacks[Box_State_Machine.CALLBACK_TYPES.ON_TRANSITION][e]),n&&n(t[0],t[1])},_apply_callback:function(e,t,n){var r=this._callbacks[e];r&&r[t]&&r[t].apply(null,[n])},dispatch:function(e){var t=this._get_transition(e);return t?(this._apply_callback(Box_State_Machine.CALLBACK_TYPES.ON_EXIT,t.from,e),this.set_state(t.to),this._apply_on_transition(e,Array.prototype.slice.call(arguments,1)),this._apply_callback(Box_State_Machine.CALLBACK_TYPES.ON_ENTER,t.to,e),!0):!1}},{CALLBACK_TYPES:{ON_ENTER:"ON_ENTER",ON_EXIT:"ON_EXIT",ON_TRANSITION:"ON_TRANSITION"}});Box.Timing.execution.push({name:"js/box_toaster.js",time:(new Date).getTime()});var Toaster=Base.extend({constructor:function(){this.j_toaster=$j("#toaster"),this.j_toaster.length||(this.j_toaster=$j('<div id="toaster" class="toaster" style="display: none;"><div class="cntr_progress" id="toaster_progress"><div class="progress_bar" style="width: 0;"><div class="barber_pole"/></div></div><div class="media"><div class="img_ext"><a href="#" id="toaster_hide">'+$t("Hide","box_toaster_hide")+"</a>"+'<span id="toaster_separator">&nbsp;|&nbsp;</span>'+'<a href="#" id="toaster_cancel">'+$t("Cancel","box_cancel")+"</a>"+"</div>"+'<div id="toaster_message" class="bd">&nbsp;</div>'+"</div>"+"</div>").appendTo($j("body")),this.j_toaster.find("#toaster_hide").on("click",function(){return Toaster.get().hide(),!1}),this.j_toaster.find("#toaster_cancel").on("click",function(){return Toaster.get().cancel(),!1}))},j_toaster:null,on_cancel_callback:null,progress:null,intv_id:null,show:function(e){e=e||{},this.on_cancel_callback=e.on_cancel_callback,e.hide_progress?this.j_toaster.find("#toaster_progress, #toaster_separator").hide():(this.j_toaster.find("#toaster_progress").show(),e.hide_cancel?this.j_toaster.find("#toaster_cancel, #toaster_separator").hide():this.j_toaster.find("#toaster_cancel, #toaster_separator").show()),this.visible=!0,this.j_toaster.show().animate({bottom:"0"})},_hide:function(){var e=this;this.visible=!1,this.j_toaster.animate({bottom:"-50px"},1e3,function(){e.j_toaster.hide()})},hide:function(e){var t=this;e&&typeof e=="number"?window.setTimeout(function(){t._hide()},e):this._hide()},set_progress:function(e){this.progress=e,e<0&&(e=0),e>100&&(e=100),this.j_toaster.find(".progress_bar").css("width",e+"%")},set_message:function(e){this.j_toaster.find("#toaster_message").html(e)},set_fake_toaster:function(e){var t=this;return this.intv_id=setInterval(function(){t.progress<98?t.set_progress(++t.progress):(clearInterval(t.intv_id),t.set_progress(100),t.hide(200))},e/(98-t.progress)),this},finish_fake_toaster:function(e){clearInterval(this.intv_id),this.set_progress(100),this.hide(e?e:0)},toggle_progress_toaster:function(e){this.show({hide_cancel:!0}),e?(this.set_progress(100),this.hide(1e3)):this.set_progress(60)},toggle_cancel_link:function(e){e?$j("#toaster_cancel, #toaster_separator").show():$j("#toaster_cancel, #toaster_separator").hide()},cancel:function(){this.on_cancel_callback&&typeof this.on_cancel_callback=="function"&&this.on_cancel_callback()},is_visible:function(){return this.j_toaster&&this.visible}},{get:function(){return Toaster.__instance||(Toaster.__instance=new Toaster),Toaster.__instance}});Box.Timing.execution.push({name:"js/box_tag_collection.js",time:(new Date).getTime()});var Tag_Collection=Base.extend({constructor:function(e){e=e||{},this.tags=e.tags||{},this.my_tags=e.my_tags||{},Tag_Collection.__instance=this},apply_tags:function(e){var t=Box.Application.getService("url"),n=Box.Application.getService("nav-state"),r=Box.Application.getService("nav-url");if(e.length>0){var i=e.join(",");box.hist_name!="files"||n.isPreviewerOpen()?t.goToUrl("/files/0/t/"+i):Box.Application.navigate(r.getTagsUrl(i,0)),box_sidebar.hide_sidebar_collaborator()}else box.hist_name=="files"&&(n.setItemInFiles(root_folder_id.substr(2)),Box.Application.navigate(""))},delete_tag:function(e,t){var n=this,r=Box.Application.getService("popups");r.confirm($t("Are you sure you would like to delete this tag from all your files?","js_confirm_delete_tag"),{onconfirm:function(){var s=t.find("a").text(),o={tag_id:e},u=$.box.formatQuery(o),a="/index.php?rm=box_tag_item_delete_tag",f=Box.Application;$.postJSON(a,u,function(o){o.result&&o.result=="no_access"?r.alert($t("You do not have permission to delete tags.","popup_myfiles_tag_delete_js_error")):(t.remove(),delete n.tags[e],delete n.my_tags[e],box.after_load_callback=function(){f.getService("notifications").confirm($t('Tag "%1" was deleted.',"js_tag_deleted_confirmation_message",s))},f.navigate(""),r.close())})},isBlocking:!0})},remove:function(e){var t=$t("All Files","js_global_allfiles"),n=Box.Application.getService("nav-url"),r=Box.Application.getService("nav-state"),i=r.get();if(!e)return Box.Application.navigate(n.getFolderUrl(0,0,t)),!1;var s=[];if(i.type=="t"){var o=i.tags.split(",");for(var u in o){if(o[u]==e)continue;s.push(o[u])}return s.length===0?Box.Application.navigate(n.getFolderUrl(0,0,t)):Box.Application.navigate(n.getTagsUrl(s.join(","),0)),!1}}},{get:function(){return Tag_Collection.__instance}});Box.Timing.execution.push({name:"js/box_realtime_notification.js",time:(new Date).getTime()});var Realtime_Notification=Box_Base.extend({display:$j.abstract_function},{_realtime_url:window.realtime_url,_qsn:window.qsn,subscriber_id:window.realtime_subscriber_id,ACTION_KEEP_ALIVE:"keepalive",action_log_ids:{},create:function(e){var t=Box.Application.getService("strings"),n=e.action;if(n==Realtime_Notification.ACTION_KEEP_ALIVE)return null;var r="Realtime_Notification_";n=="progress"?(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_realtime_notification.js:19786","2013-05-15","auto tombstoned"),r+="Progress"):n=="representation"?r+="Representation":r+="Update_"+t.capitalize(n);var i=window[r];if(typeof i!="function")return $j.not_implemented("class "+r),null;var s=new i(e);return s},is_enabled:function(){return Boolean(this._realtime_url)},_delay_after_error:0,_retry_count:0,_max_retries:window.realtime_max_retries,subscribe_to_notifications:function(e){if(!this.is_enabled())return;var t=this._retry_count+2;if(this._retry_count>this._max_retries||1<<t===0)return;e||(e={});var n=e.use_delay_after_error,r=e.delay;delete e.use_delay_after_error,delete e.delay,n&&(this._delay_after_error=Math.random()*(1<<t)*1e3,r=this._delay_after_error);if(r){setTimeout(function(){Realtime_Notification.subscribe_to_notifications(e)},r);return}$j.getCrossDomain(this._realtime_url+"&caching_hash="+Math.random(),{},function(t){if(t.message=="new_change"){var n="/index.php?rm=box_realtime_get_latest_events",r={qsn:Realtime_Notification._qsn},i=$j.box.formatQuery(r);$j.getJSON(n,i,function(t){t.status=="get_latest_events_ok"?(Realtime_Notification._qsn=t.qsn,Realtime_Notification.display_notifications(t.events),Realtime_Notification._delay_after_error=0,Realtime_Notification._retry_count=0,Realtime_Notification.subscribe_to_notifications(e)):(e.use_delay_after_error=!0,Realtime_Notification._retry_count+=1,Realtime_Notification.subscribe_to_notifications(e))},{error:function(){e.use_delay_after_error=!0,Realtime_Notification._retry_count+=1,Realtime_Notification.subscribe_to_notifications(e)}})}else t.message=="reconnect"?(Realtime_Notification._delay_after_error=0,Realtime_Notification._retry_count=0,Realtime_Notification.subscribe_to_notifications(e)):(e.use_delay_after_error=!0,Realtime_Notification._retry_count+=1,Realtime_Notification.subscribe_to_notifications(e))},{error:function(){e.use_delay_after_error=!0,Realtime_Notification._retry_count+=1,Realtime_Notification.subscribe_to_notifications(e)}})},display_notifications:function(e){$j.each(e,function(e,t){var n=Box.Application.getService("unidb"),r=Realtime_Notification.create(n.decode(t));if(!r||r.action_log_id in Realtime_Notification.action_log_ids)return;Realtime_Notification.action_log_ids[r.action_log_id]=!0,r.display()})},display_item_notifications:function(e){var t=Realtime_Notification.create(e);if(!t)return;t.display()},subscribe_to_item_notifications:function(e){var t=this._retry_count+2;if(this._retry_count>this._max_retries||1<<t===0)return;e||(e={});var n=e.use_delay_after_error,r=e.delay,i=e.notification_url;delete e.use_delay_after_error,delete e.delay;if(!Boolean(i))return;n&&(this._delay_after_error=Math.random()*(1<<t)*1e3,r=this._delay_after_error);if(r){setTimeout(function(){Realtime_Notification.subscribe_to_item_notifications(e)},r);return}$j.getCrossDomain(i+"&caching_hash="+Math.random(),{},function(t){if(t.message=="reconnect"){Realtime_Notification._delay_after_error=0,Realtime_Notification._retry_count=0,Realtime_Notification.subscribe_to_item_notifications(e);return}try{var n=$j.parseJSON(t.message);if(e.callback&&n.action==="representation")e.callback(n);else{if(n.action!=="representation")throw new Error("Bad response received from Conversion-Realtime system");Realtime_Notification.display_item_notifications(n)}}catch(r){e.use_delay_after_error=!0,Realtime_Notification._retry_count+=1,Realtime_Notification.subscribe_to_item_notifications(e)}},{error:function(){e.use_delay_after_error=!0,Realtime_Notification._retry_count+=1,Realtime_Notification.subscribe_to_item_notifications(e)}}),e.callback||Realtime_Notification.display_item_notifications({action:"representation",content:{message:"reload"}})}});$j(window).load(function(){setTimeout(function(){var e=1e3;Realtime_Notification.subscribe_to_notifications({delay:e})},0)}),Box.Timing.execution.push({name:"js/box_realtime_notification_update.js",time:(new Date).getTime()});var Realtime_Notification_Update=Realtime_Notification.extend({display:function(){this._update_new_updates_count();if(this.realtime_subscriber_id==Realtime_Notification.subscriber_id){$j.log("self-notification ignored");return}if(this.target&&this.target.type=="file"&&this.target.is_webdoc()&&this.from_user.id==Canvas.get().user.id){$j.log("self-notification ignored");return}this.target&&this.target.type=="file"&&!this.target.parent&&this.target_parent&&(this.target.folder=this.target.parent=this.target_parent),this.from_user.id!=Canvas.get().user.id&&this._display_growl_notification(),this._update_objects()},_display_growl_notification:function(){var e=this.message();if(!e)return;var t=this.priority();if(t<Realtime_Notification_Update.realtime_notification_priority_threshold_value){$j.log("Notification priority too low: "+t+" < "+Realtime_Notification_Update.realtime_notification_priority_threshold_value);return}Growl_Notification.display({priority:t,icon:this.icon(),message:e,callback:this.callback()})},priority:function(){return $j.isFunction(this._priority)?this._priority():this._priority},icon:function(){return this.target.small_thumb},message:function(){var e=$j.isFunction(this._message)?this._message():this._message;return e?this.from_user.display_name({html:!1,capitalize:!0})+" "+e:null},callback:function(){var e=this;return function(){Box_Object.load_params(e.target,"complete",function(){e._callback()})}},_update_new_updates_count:function(){if(!this.update)return;Update.addNewUpdate(this.update)},_priority:$j.abstract_function,_message:$j.abstract_function,_callback:function(){this.target.click()},_update_objects:$j.abstract_function},{realtime_notification_priority_threshold_value:window.realtime_notification_priority_threshold_value}),Realtime_Notification_Update_Created=Realtime_Notification_Update.extend({_priority:function(){var e=!1;return e?65:75},_message:function(){var e=this.target.type=="file"&&this.new_version,t;return e?(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_realtime_notification_update.js:2948","2013-05-15","auto tombstoned"),t=$t("updated","js_update_updated")):this.target.type=="file"&&!this.target.is_webdoc()?t=$t("uploaded","js_update_uploaded"):t=$t("created","update_created"),t+"<br/>"+$.box.escapeHTML(this.target.name)},_update_objects:function(){var e={message:this.message(),from_user:this.from_user};this.target.update_params_and_render({new_version:this.new_version},e);var t=this._get_new_version_children();for(var n in t){var r=Box_Object.find_by_typed_id(n);r.update_params_and_render({new_version:!0},e)}this.target_parent.update_params_and_render({created_children:this._get_created_children(),new_version_children:t},e)},_get_created_children:function(){return this.target.type=="file"&&this.new_version?(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_realtime_notification_update.js:2952","2013-05-15","auto tombstoned"),[]):[this.target.typed_id]},_get_new_version_children:function(){return this.target.type=="file"&&this.new_version?(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_realtime_notification_update.js:2953","2013-05-15","auto tombstoned"),[this.target.typed_id]):[]}}),Realtime_Notification_Update_Uploaded=Realtime_Notification_Update_Created,Realtime_Notification_Update_Previewed=Realtime_Notification_Update.extend({_priority:25,_message:function(){return $t("previewed","js_update_previewed")+"<br/>"+this.target.name},_update_objects:function(){}}),Realtime_Notification_Update_Downloaded=Realtime_Notification_Update.extend({_priority:function(){return this.as_shared_item?50:25},_message:function(){return"method"in this&&this.method=="WEBDOC_VIEW"?$t("viewed","js_update_viewed")+"<br/>"+this.target.name:$t("downloaded","js_update_downloaded")+"<br/>"+this.target.name},_update_objects:function(){}}),Realtime_Notification_Update_Invited_Collaborator=Realtime_Notification_Update.extend({callback:function(){var e=this;return function(){var t="/index.php?rm=box_get_pending_collab",n={collab_id:e.collab_id};$.getJSON(t,$j.box.formatQuery(n),function(e){var t=e.collab,n=new Collab(t);n.accept({required_accept_options:!0})})}},_priority:function(){return this._is_for_current_user()?100:10},_message:function(){return"auto_accept"in this&&this.auto_accept==1?null:this._is_for_current_user()?$t("invited you to","update_invited_you")+"<br/>"+this.target.name:"collab_user_name"in this?$t("invited %1 to","update_invited_one_collaborator",this.collab_user_name)+"<br/>"+this.target.name:$t("invited %1 to","update_invited_one_collaborator",this.collab_user_email)+"<br/>"+this.target.name},_update_objects:function(){},_is_for_current_user:function(){return Canvas.get().user.email==this.collab_user_email}}),Realtime_Notification_Update_Added_Collaborator=Realtime_Notification_Update.extend({_priority:function(){return this._is_for_current_user()?100:10},_message:function(){return"auto_accept"in this&&this.auto_accept==1?this._is_for_current_user()?$t("added you to","update_added_you")+"<br/>"+this.target.name:"collab_user_name"in this?$t("added %1 to","update_added_one_collaborator",this.collab_user_name)+"<br/>"+this.target.name:$t("added %1 to","update_added_one_collaborator",this.collab_user_email)+"<br/>"+this.target.name:null},_update_objects:function(){},_is_for_current_user:function(){return Canvas.get().user.email==this.collab_user_email}}),Realtime_Notification_Update_Joined=Realtime_Notification_Update.extend({_priority:function(){return 50},_message:function(){return $t("joined","update_joined")+"<br/>"+this.target.name},_update_objects:function(){this.target.update_params_and_render({created_collabs:[this.collab]},{message:this.message()})}}),Realtime_Notification_Update_Shared=Realtime_Notification_Update.extend({_priority:10,_message:function(){return $t("activated a link for","update_shared")+"<br/>"+this.target.name},_update_objects:function(){this.target.update_params_and_render({shared:this.shared,shared_name:this.shared_name,shared_link:this.shared_link},{message:this.message()})}}),Realtime_Notification_Update_Sent=Realtime_Notification_Update.extend({_priority:100,_message:function(){return $t("sent you","update_sent")+"<br/>"+this.target.name},_callback:function(){this.target.open_shared_page()},_update_objects:function(){this.target.update_params_and_render({shared:this.shared,shared_name:this.shared_name,shared_link:this.shared_link},{message:this.message()})},_is_for_current_user:function(){return typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_realtime_notification_update.js:2979","2013-05-15","auto tombstoned"),!0}}),Realtime_Notification_Update_Unshared=Realtime_Notification_Update.extend({_priority:50,_message:function(){return $t("deactivated a link for","update_unshared")+"<br/>"+this.target.name},_update_objects:function(){this.target.update_params_and_render({shared:this.shared,shared_name:this.shared_name,shared_link:this.shared_link},{message:this.message()})}}),Realtime_Notification_Update_Renamed=Realtime_Notification_Update.extend({_priority:50,_message:function(){return"old_name"in this?$t("renamed %1%2 to %3","update_renamed","<br/>",this.old_name,this.target
.name):"old_description"in this?this.old_description==""?$t("added a description to","update_added_description")+"<br/>"+this.target.name:this.description==""?$t("deleted the description of","update_deleted_description")+"<br/>"+this.target.name:$t("updated the description of","update_updated_description")+"<br/>"+this.target.name:($j.not_implemented("web_link url"),null)},_update_objects:function(){var e={};"name"in this&&(e.name=this.name),"description"in this&&(e.description=this.description),this.target.update_params_and_render(e,{message:this.message()})}}),Realtime_Notification_Update_Added_Tag=Realtime_Notification_Update.extend({_priority:10,_message:function(){return $t("added a tag to","update_added_tag")+"<br/>"+this.target.name},_update_objects:function(){this.target.update_params_and_render({created_tags:!0},{message:this.message()})}}),Realtime_Notification_Update_Commented=Realtime_Notification_Update.extend({_priority:75,_message:function(){return $t("commented on ","js_update_commented")+"<br/>"+this.target.name},_callback:function(){var e=this.target;this.target.click({show_comments_callback:function(){if(e.type!="file")return;setTimeout(function(){var t=$j("#cmttxt_"+e.typed_id+"_0");if(!t.length)return;var n=t.parents(".comment_list").find(".comment").last(),r=1e3;$j.scrollTo(t,r),setTimeout(function(){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_realtime_notification_update.js:2989","2013-05-15","auto tombstoned");var e=n[0],t=Box.Application.getService("dom");t.addClass(e,"is-highlighted"),window.setTimeout(function(){t.removeClass(e,"is-highlighted")},3e3);var r=n.find(".message"),i=$j("<span></span>").html(r.html()).addClass("new");r.html(i)},r)},2e3)}})},_update_objects:function(){this.target.update_params_and_render({created_comments:!0},{message:this.message()})}}),Realtime_Notification_Update_Task_Assignment=Realtime_Notification_Update.extend({_priority:function(){return 100},_message:function(){return $t("%1 has assigned you a new task","js_assign_new_task","<br/>")},_update_objects:function(){}}),Realtime_Notification_Update_Updated_Settings=Realtime_Notification_Update.extend({_priority:75,_message:function(){return typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_realtime_notification_update.js:2994","2013-05-15","auto tombstoned"),this.old_name?$t("is the new name of","update_updated_settings_name")+"<br/>"+this.old_name:null},_update_objects:function(){this.target.update_params_and_render({name:this.target.name},{message:this.message()})}}),Realtime_Notification_Update_Viewed_Updates=Realtime_Notification_Update.extend({_priority:0,_message:null,_update_objects:function(){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_realtime_notification_update.js:2995","2013-05-15","auto tombstoned"),Update.resetNewUpdates()}});Box.Timing.execution.push({name:"js/box_pub_sub.js",time:(new Date).getTime()});var Box_Pub_Sub=Base.extend({subscribe:function(e,t,n){$(this).on(e,t,n)},publish:function(e,t){$(this).trigger(e,t)}},{});Box.Timing.execution.push({name:"js/box_pin_board.js",time:(new Date).getTime()});var Pin_Board=Box_Object.extend({id:null,constructor:function(e){this.set_params(e)},set_params:function(e){this.base(e),this.process_permissions(e.permissions,Pin_Board.PERMISSION_CONSTANTS)}},{type:"pin_board",PERMISSION_CONSTANTS:{view:"view",edit:"edit","delete":"delete",add_item:"add_item"}});Box.Timing.execution.push({name:"js/menus/box_min_collab_roles_menu.js",time:(new Date).getTime()});var Min_Collab_Roles_Menu=Abstract_Menu.extend({constructor:function(e){e=e||{},this._target=e.target,this._user=e.user,this._this_folder_only=e.this_folder_only,this._target_folder=e.target_folder,this._available_roles=this._target_folder.available_permissions||{},this._target_collab=e.target_collab,this._j_access_level=this._target.find(".access_level"),this._on_change_role_callback=e.on_change_role_callback,this._on_remove_collab_callback=e.on_remove_collab_callback,this._current_role_selector=null,this._new_role=null,this._e_menu=$("#user_menu_roles").get(0)},init:function(){this._display_collab_info_for_target_folder()},_display_collab_info_for_target_folder:function(){var e=this._target.find(".access").find("a");this._disable_permission_link_on_element(e),this._has_permission("change")?(this._enable_collab_permission_change(e),this._disable_editor_to_change_co_owner_permission()):this._has_permission("remove")&&this._enable_current_user_permission_link()},_enable_collab_permission_change:function(e){var t=this;e.removeClass("disabled").addClass("drop_link"),e.off().on("click",function(e){return t._click_role_handler(this)})},_disable_editor_to_change_co_owner_permission:function(){var e=this._user.permission_on_folder(this._target_folder,this._this_folder_only,{ignored_accepted:!0});if(e=="Editor"){var t=$j(".folder_collab_user .Co-owner").find("a");this._disable_permission_link_on_element(t)}},_update_permission_link_on_permission_change:function(e){typeof Tombstone!="undefined"&&Tombstone.marker("./js/menus/box_min_collab_roles_menu.js:5891","2013-05-15","auto tombstoned"),this._has_permission("change")?this._disable_editor_to_change_co_owner_permission():(typeof Tombstone!="undefined"&&Tombstone.marker("./js/menus/box_min_collab_roles_menu.js:5892","2013-05-15","auto tombstoned"),this._disable_permission_link_on_element(e),this._enable_current_user_permission_link())},_disable_permission_link_on_element:function(e){e.removeClass("drop_link").addClass("disabled"),e.off("click")},_enable_current_user_permission_link:function(){var e=this,t=$j(".access").find(".is_you");t.removeClass("disabled").addClass("drop_link"),t.off().on("click",function(){return e._click_role_handler(this),!1})},_click_role_handler:function(e){var t=$j(e);return this._current_role_selector=t.find(".access_level"),this.show({target:e}),!1},show:function(e){return e=e||{},this._j_target_element=$j(e.target),this.base()},_render:function(){var e=this,t=this._target_folder,n=$j("#user_menu_roles").find("ul").empty();if(t&&t.user_is_owner&&t.collaborated&&this._target_collab.user){var r=$j("<li />").append($j('<a id="access_level_owner" href="#" />').text($t("Folder Owner","js_user_menu_make_owner")));r.find("a").click(function(){return t.change_owner({user:e._target_collab.user}),!1}),n.append(r)}if(this._has_permission("change")){var i=this._user.id==t.user_id||t.permissions.rename,s=Box.Application.getService("nav-state"),o=s.isGcm();if(i||o){var u=this._available_roles,a,f,l,c={"Co-owner":$t("Same permissions as an owner except co-owners are unable to change the access level of an owner.","js_collaborate_coowner_description"),Editor:$t("Upload, download, preview, share, edit, delete files.","collaborate_editor_description"),Previewer:$t("Preview files only.","js_collaborate_previewer_description"),"Previewer Uploader":$t("Upload and preview files only.","js_collaborate_previewer_uploader_description"),Uploader:$t("Upload files only.","js_collaborate_uploader_description"),Viewer:$t("Download, preview, and share files.","collaborate_viewer_description"),"Viewer Uploader":$t("Upload, download, preview, and share files.","js_collaborate_viewer_uploader_description")},h=this._target_collab.role;for(var p in u){l=Collaborator_Roles_Menu.get_translation_name_for_collab_role(p);if(!t.permissions.options&&{"Co-owner":1,"co-owner":1,owner:1,Owner:1}[p])continue;a=$j('<li class="available_role" />').attr({"data-hover":"tooltip","aria-label":c[p]}).append($j('<a href="#" />').attr("id","access_level_"+p).text(l)),f=a.children("a"),p.toLowerCase()==h?(typeof Tombstone!="undefined"&&Tombstone.marker("./js/menus/box_min_collab_roles_menu.js:5904","2013-05-15","auto tombstoned"),f.add(a).addClass("disabled").off("click")):f.click(e._change_role_for_target_collab(e,p)),n.append(a)}}}var d=this._target_collab.user;d&&d.id!=this._target_folder.user_id&&this._add_remove_option(n)},_change_role_for_target_collab:function(e,t){var n=e;return function(){return n._new_role=t,n._j_access_level.text(Collaborator_Roles_Menu.get_translation_name_for_collab_role(t)),$("#user_menu_roles").hide(),$j.isFunction(n._on_change_role_callback)&&n._on_change_role_callback(t),!1}},_add_remove_option:function(e){var t=this,n=this._is_self(this._target_collab.user),r=$j("<li />").append($j('<a href="#" />').text($t("Remove","popup_action_remove_button")));n?r.find("a").click(function(){return t._target_folder.remove_collab(),!1}):r.find("a").click(function(){return $j.isFunction(t._on_remove_collab_callback)&&t._on_remove_collab_callback(t._target_collab),$j(t._e_menu).hide(),!1}),r.appendTo(e)},_is_self:function(e){return e.id==this._user.id},_has_permission:function(e){var t=this._target_folder.user_id==this._user.id;if(t&&this._target_folder.permissions.options)return!0;if(e=="change"){if(!this._target_folder.permissions.options&&!this._target_folder.allow_invite_collaborators)return!1;if(!this._target_folder.permissions.rename)return!1}var n=t&&e=="remove",r=this._target_folder.user_id!=this._user.id&&this._target_folder.permissions.rename;return n||r}},{get_translation_name_for_collab_role:function(e){var t=e;e=e.toLowerCase().replace(" ","_").replace("-","_");var n="";switch(e){case"owner":n="collab_role_owner";break;case"co_owner":n="collaborate_type_Co_owner";break;default:n="collaborate_type_"+e}return $t(t,n)}});Box.Timing.execution.push({name:"js/filters/box_group_contact_filter.js",time:(new Date).getTime()});var Box_Group_Contact_Filter=Box_Abstract_Contact_Filter.extend({rm:"box_master_group_contact_list",constructor:function(e){this.base(e)},_create_params_callback:function(e){return{search_string:e}},_process_results_callback:function(e){var t={},n=e.enterprise_users_list;for(var r in n){var i=n[r];t[i.id]={name:i.name,email:i.email}}return t}},{});Box.Timing.execution.push({name:"js/selectors/box_group_contact_selector.js",time:(new Date).getTime()});var Box_Group_Contact_Selector=Box_Contact_Selector.extend({constructor:function(e){e.filter=new Box_Group_Contact_Filter,this.base(e)}},{});Box.Timing.execution.push({name:"js/selectors/box_master_user_selector.js",time:(new Date).getTime()});var Box_Master_User_Selector=Box_Contact_Selector.extend({constructor:function(e){e.placeholder_text=$t("Enter name or email address","contact_selector_placeholder_text_singular"),e.filter=new Box_GCM_Filter,this.base(e)}},{});Box.Timing.execution.push({name:"js/box_service_item.js",time:(new Date).getTime()});var Service_Item=Box_Object.extend({item_id:null,item_name:null,item_type:null},{type:"service_item"});Action.register_actions("Service_Item",["accept"]),Box.Timing.execution.push({name:"js/net_promoter_survey.js",time:(new Date).getTime()});var Net_Promoter_Survey=Base.extend({can_execute:function(){typeof Tombstone!="undefined"&&Tombstone.marker("./js/net_promoter_survey.js:6905","2013-05-15","auto tombstoned");var e=Box.Application.getService("nav-state");return e.isFiles()},execute:function(){this._create_popup(),this._log_open_survey()},submit:function(e,t){var n=typeof e.recommend_box_score!="undefined"&&parseInt(e.recommend_box_score,10)>=9,r=Box.Application,i=r.getService("logger");$j("#net_promoter_improvement_area_error").hide(),$j("#net_promoter_feedback_required_for_other").hide();if(!n&&e.improvement_area==""){$j("#net_promoter_improvement_area_error").show(),$j.popup.revert();return}if(e.improvement_area=="Other"&&e.feedback==""){$j("#net_promoter_feedback_required_for_other").show(),$j("#popup_textarea_feedback").focus(),$j.popup.revert();return}$j.popup.close(),r.getService("notifications").confirm(Net_Promoter_Survey.THANK_YOU_MESSAGE),i.sendLog("net_promoter_survey","NET_PROMOTER_SURVEY_POPUP_SUBMIT",e)},cancel:function(){$.popup.close(),this._log_cancel_survey()},_create_popup:function(){var e=this;$j.popup.form($t("How are we doing?","net_promoter_popup_title_how_are_we_doing"),[{type:"html",data:['<div class="mts pbs">',"	<strong>"+$t("How likely are you to recommend Box to a colleague or friend?","net_promoter_recommend_label")+"</strong>","</div>",'<table class="mvm" style="width:100%;">',"	<tr>",'		<td colspan="5" class="txt_l pbm">','			<label for="nps_radio0">'+$t("Not at all likely","net_promoter_not_likely")+"</label>","		</td>",'		<td colspan="6" class="txt_r pbm">','			<label for="nps_radio10">'+$t("Extremely likely","net_promoter_extremely_likely")+"</label>","		</td>","	</tr>",'	<tr class="recommend_radio center_contents">',this._build_radio_button_html(),"	</tr>",'	<tr class="center_contents">','		<td><label for="nps_radio0" class="legal">0</label></td>','		<td colspan="4"></td>','		<td><label for="nps_radio5" class="legal">5</label></td>','		<td colspan="4"></td>','		<td><label for="nps_radio10" class="legal">10</label></td>',"	</tr>","</table>",'<hr class="divider_medium mbm"/>'].join("")},{type:"dropdown",name:"improvement_area",label:['<div class="mbm">',$t("Is there a particular area where we can improve?","net_promoter_improve_recommend_label"),"</div>",'<div id="net_promoter_improvement_area_error" class="error mbm" style="display:none;">',$t("Please choose an area where we can improve","net_promoter_improve_error_msg"),"</div>"].join(""),items:[{value:"",label:$t("Select one...","net_promotoer_select_option_option")},{value:"Sync",label:$t("Sync (Windows, Mac)","net_promotoer_sync_windows_mac_options")},{value:"Performance",label:$t("Speed (website, upload/download)","net_promotoer_speed_options")},{value:"Mobile Apps",label:$t("Mobile Apps (iOS, Android)","net_promotoer_mobile_apps_option")},{value:"User Interface",label:$t("Site Features (navigation, search, previewing, etc)","net_promoter_user_interface_option")},{value:"Storage",label:$t("Storage (space amount, upload size limit)","net_promotoer_storage_option")},{value:"Email Communication",label:$t("Email Communication","net_promoter_email_communication_option")},{value:"Security",label:$t("Security Features","net_promoter_security_options")},{value:"Cost",label:$t("Cost","net_promotoer_cost_option")},{value:"Training",label:$t("Training","net_promotoer_training_option")},{value:"Support / Services",label:$t("Customer Support","net_promoter_customer_support_option")},{value:"Other",label:$t("Other","other")}]},{type:"html",data:['<div id="net_promoter_feedback_required_for_other" class="error strong plt mbm" style="position:relative;top:10px;display:none;">',$t('Please explain why you chose "Other" as an improvement area.',"net_promoter_feedback_required_for_other_improvements"),"</div>"].join("")},{type:"textarea","class":"scrollable",name:"feedback",instructions:$t("Please provide any additional feedback you think would help us improve Box.","net_promoter_feedback_label"),value:""},{type:"buttons",items:[{value:$t("Submit","popup_button_submit"),click:function(t,n){e.submit(t,n)}},{value:$t("Cancel","js_popup_button_cancel"),click:function(t,n){e.cancel()}}]}],{favicon_class:"sprite_24x24_discussion",cancel_popup_callback:function(){e._log_cancel_survey()}},function(){})},_build_radio_button_html:function(){var e="";for(var t=0;t<=10;t++)e+='<td class="size1of11"><input id="nps_radio'+t+'" class="radio_button" style="float:none;" type="radio" name="recommend_box_score" value="'+t+'"/></td>';return e},_log_open_survey:function(){var e=Box.Application.getService("logger");e.sendLog("net_promoter_survey","NET_PROMOTER_SURVEY_POPUP_OPEN",{})},_log_cancel_survey:function(){var e=Box.Application.getService("logger");e.sendLog("net_promoter_survey","NET_PROMOTER_SURVEY_POPUP_CANCEL",{})}},{THANK_YOU_MESSAGE:$t("Thank you for taking our survey! Your feedback is important to us.","net_promoter_thanks_confirmation"),get:function(){return Net_Promoter_Survey.__instance||(Net_Promoter_Survey.__instance=new Net_Promoter_Survey),Net_Promoter_Survey.__instance}});Box.Timing.execution.push({name:"js/box_partial_user.js",time:(new Date).getTime()});var Contact_User=Box_Object.extend({id:null,login:null,constructor:function(e){this.set_params(e)}},{type:"contact_user"});Box.Timing.execution.push({name:"js/popups/auto_accept_collab_popup.js",time:(new Date).getTime()});var Auto_Accept_Collab_Popup=Base.extend({item_id:null,item_name:null,item_type:null,callback:null,set_params:function(e){typeof Tombstone!="undefined"&&Tombstone.marker("./js/popups/auto_accept_collab_popup.js:12298","2013-05-15","auto tombstoned"),this.callback=e.callback},show:function(){var e=this,t=Canvas.get().user;$j.popup.form("Automatically Accept Invites?",[{type:"html",data:$t("You can automatically accept all incoming collaboration invites.%1Do you want to automatically accept incoming collaboration invites?","automatically_accept_invites","<br><br>")},{type:"buttons",items:{accept:{value:$t("Auto Accept Invites","popup_auto_accept_collab_button_yes"),click:function(n,r){return e.set_auto_accept_collab(t.id,!0,n.show_auto_accept_collab_dialog),!1}},cancel:{value:$t("Cancel","popup_auto_accept_collab_button_no"),click:function(e,t){return $j.popup.close(null,!0),!1}}}}]),$j.isFunction(this.callback)&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/popups/auto_accept_collab_popup.js:12301","2013-05-15","auto tombstoned"),this.callback(this.item_name))},set_auto_accept_collab:function(e,t,n){if(!e)return;var r=this,i="/index.php?rm=box_collaborate_set_auto_accept",s={user_id:e,auto_accept_collab:t,hide_auto_accept_collab_dialog:n},o=$j.box.formatQuery(s);$j.postJSON(i,o,function(e){return $j.popup.close(null,!0),Box.Application.getService("notifications").hide(),Box.Application.navigate(""),$j.isFunction(r.callback)&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/popups/auto_accept_collab_popup.js:12303","2013-05-15","auto tombstoned"),r.callback(r.item_name)),!1})}},{});Box.Timing.execution.push({name:"js/box_update.js",time:(new Date).getTime()});var Update=Box_Object.extend({},{type:"update",_init:function(){var e=Box.Application.getService("v5"),t=e.get("Realtime_Notification");t.is_enabled()||this._initPing(),this.ping()},_newUpdates:{},resetNewUpdates:function(){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_update.js:2","2013-05-15","auto tombstoned"),this._newUpdates={},this._displayNewUpdatesCount()},addNewUpdate:function(e){typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_update.js:3","2013-05-15","auto tombstoned"),this._newUpdates[e.id]=e,this._displayNewUpdatesCount()},_addNewUpdates:function(e){var t,n,r;if(!e||typeof e.ids=="undefined")return;n=e.ids,r=n.length;for(t=0;t<r;t++)this._newUpdates[n[t]]=!0;this._displayNewUpdatesCount(e.count)},ping:function(){var e=$("#new_updates_count");if(!e.length)return;$.getJSON("/index.php?rm=box_get_updates_count",function(e){Update._addNewUpdates(e)})},_initPing:function(){var e=this,t=$("#new_updates_count");if(!t.length)return;setInterval(function(){e.ping()},6e5)},_displayNewUpdatesCount:function(e){var t=$("#new_updates_count"),n=Box.Application.getService("v5"),r=Box.Application.getService("nav-state");if(!t.length)return;e==null&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/box_update.js:13","2013-05-15","auto tombstoned"),e=$.size(this._newUpdates));var i=parseInt(t.text());if(e==i){$.log("Update already counted in newUpdatesCount");return}t.text(e),e==0?($.log("Reset updates"),t.hide()):($.log("New update"),t.show(),$("#quick_updates_arrow").hide());var s=n.get("current_rm");if(s=="box_v2_new_inbox"&&!r.isPreviewerOpen()){var o=$("#new_updates_message");if(e==0)o.hide();else{var u=$t("%1 new update%2 in your Box since you last refreshed.","update_message_text",e,e!=1?"s":"")+'&nbsp;<a href="#" id="view_latest_updates_link">'+$t("View Latest Updates","update_message_latest_updates_link")+"</a>";o.html(u).show(),o.find("#view_latest_updates_link").on("click",function(){return Box.Application.navigate(""),!1})}}},applyJSToUpdates:function(e,t){var n=Box.Application.getService("v5"),r=n.get("Canvas"),i,s=e.length;for(i=0;i<s;i++){var o=e[i].files;r.load({items_html:e[i].html,maximum_items:7,nodes:o,page:t,use_item_expansion:{comments:"1"==e[i].update.update_type||"2"==e[i].update.update_type?null:"right_position",tasks:!0},update:e[i].update,view:"expanded"});var u=r.collections[r.collections.length-1];for(var a=0,f=u.items.length;a<f;a++){var l=u.items[a];l._render_tooltip(),l._render_classes()}}},BOX_UPDATE_COMMENT:6,BOX_UPDATE_TASK_ASSIGNMENT:9,updateTypeText:function(e){switch(e){case"1":return"Sent File";case"2":return"Sent Folder";case"3":return"Collaborate";case"5":return"Upload";case"6":return"Comment";case"7":return"Download";case"8":return"Move";case"9":return"Task Assignment";case"10":return"Task Response";case"11":return"Lock";case"12":return"Unlock";case"13":return"Copy";case"14":return"Preview";case"15":return"Download_Preview";case"16":return"Delete";case"18":return"Joined";case"19":return"OpenBox Action"}return e}});Loader.t3Loaded.done(function(){typeof sinon=="undefined"&&Update._init()}),Box.Timing.execution.push({name:"js/box_generic_click_tracking.js",time:(new Date).getTime()});var Box_Generic_Click_Tracking=Base.extend({constructor:function(){if(Features.webapp_generic_click_tracking){var e=this;jQuery.event.special.click={preDispatch:function(t){typeof t.timeStamp=="undefined"&&(typeof t.originalEvent.timeStamp=="undefined"&&(t.originalEvent.timeStamp=(new Date).getTime()),t.timeStamp=t.originalEvent.timeStamp),t.timeStamp!=e._last_event_timestamp&&(setTimeout(function(){e.body_click_handler(t)},0),e._last_event_timestamp=t.timeStamp)}}}},body_click_handler:function(e){var t=$j(e.target),n=this._get_full_path_string(t),r=n=="BODY"?"BODY":this._get_element_string(t),i=this._get_t3_module_name(t),s={dom_path:n,t3_module:i,target_elem:r,mouse_button:e.button,alt_key:e.altKey,ctrl_key:e.ctrlKey,shift_key:e.shiftKey,page_x:e.pageX,page_y:e.pageY,browser_timestamp:e.timeStamp},o=Box.Application.getService("logger");o.sendLog("web_clicks","CLICK",s)},_get_full_path_string:function(e){var t=e.parentsUntil(document.body),n=[];n.push(this._get_element_string(e));for(var r=0,i=t.length;r<i;r++){var e=$j(t[r]),s=this._get_element_string(e);n.unshift(s)}return n.unshift("BODY"),n.join(" ")},_get_t3_module_name:function(e){var t=e.closest("[data-module]");return t.length?t.attr("data-module"):null},_get_element_string:function(e){var t=e.attr("id"),n=[],r=e.attr("class");if(r){var i=e.attr("class").split(/\s+/);for(var s=0,o=i.length;s<o;s++){var u=i[s];u&&n.push(u)}}var a=e.prop("tagName"),f=e.index(),l="["+f+"]"+a.toUpperCase();return t&&(l+="#"+t),n&&n.length&&(l+="."+n.sort().join(".")),l}},{get:function(){return Box_Generic_Click_Tracking.__instance||(Box_Generic_Click_Tracking.__instance=new Box_Generic_Click_Tracking),Box_Generic_Click_Tracking.__instance}});Loader.t3Loaded.done(Box_Generic_Click_Tracking.get),Box.Timing.execution.push({name:"js/box_banner_message.js",time:(new Date).getTime()});var Banner_Message=Base.extend({params:null,_num_slides:0,_is_transitioning:!1,_j_banner_message_anchor:null,_j_banner_message_slides_container:null,_j_nav_dots_container:null,_visible_slide_idx:-1,_auto_rotate_interval:null,_auto_rotate_resume_timeout:null,_auto_rotate_delay_ms:9e3,_auto_rotate_resume_delay_ms:15e3,_animation_time_for_auto_rotate:1200,_animation_time_for_manual_click:1200,constructor:function(e,t){this.params=t||{},this._j_banner_message_anchor=$j("#banner_message_anchor"),this._num_slides=e.length,this._j_banner_message_container=this._create_container(),this._j_banner_message_container.append(this._create_slides(e)),this._num_slides>1&&this._j_banner_message_container.append(this._create_nav_dots())},show:function(){if(!this._j_banner_message_anchor.length||!this._j_banner_message_anchor.is(":empty"))return!1;this.params.auto_rotate&&this._num_slides>1&&this._set_interval_for_auto_rotate(),this._j_banner_message_anchor.append(this._j_banner_message_container).hide().slideDown()},_create_container:function(){var e=this,t=$j("<div/>",{"class":"cntr pam banner_container"}),n=$j("<a/>",{id:"banner_message_close_btn","class":"img_ext sprite_14x14_close",href:"#",click:function(){return e._close(),!1}});return t.append(n),t},_create_slides:function(e){this._visible_slide_idx=0,this._j_banner_message_slides_container=$j("<div/>",{"class":"mrl",css:{position:"relative",overflow:"hidden"}});for(var t=0;t<e.length;t++){var n=$j("<div>",{css:t>0?{display:"none"}:"",html:e[t].html,data:{slide_idx:t}});this._j_banner_message_slides_container.append(n)}return this._j_banner_message_slides_container},_create_nav_dots:function(){var e=this;this._j_nav_dots_container=$j("<ul/>",{"class":"nav_dots_container center_contents inline_list"});for(var t=0;t<this._num_slides;t++){var n=$j("<li/>",{"class":"phs"}),r=$j('<a href="#" />').addClass("nav_dot "+(t===0?"active":"")).data("slide_index",t);n.append(r),this._j_nav_dots_container.append(n)}return this._j_nav_dots_container.on("click",".nav_dot",function(){var t=$j(this).data("slide_index");return e._select_slide(t),!1}),this._j_nav_dots_container},_select_slide:function(e){var t=this;this.params.auto_rotate&&(this._clear_auto_rotate_timers(),this._auto_rotate_resume_timeout=setTimeout(function(){t._set_interval_for_auto_rotate()},this._auto_rotate_resume_delay_ms)),this._transition(t._visible_slide_idx,e,!1)},_clear_auto_rotate_timers:function(){this._auto_rotate_interval&&(clearInterval(this._auto_rotate_interval),this._auto_rotate_interval=null),this._auto_rotate_resume_timeout&&(clearTimeout(this._auto_rotate_resume_timeout),this._auto_rotate_resume_timeout=null)},_transition:function(e,t,n){if(e==t||this._is_transitioning)return;this._is_transitioning=!0;var r=this._j_banner_message_slides_container.children(),i=e>t?!0:!1,s=n?this._animation_time_for_auto_rotate:this._animation_time_for_manual_click;this._j_banner_message_slides_container.height(this._j_banner_message_slides_container.height());var o=r.eq(e),u=r.eq(t);this._animate_slide_out(o,s,i),this._j_banner_message_slides_container.animate({height:u.height()},"fast"),this._animate_slide_in(u,s,i)},_animate_slide_out:function(e,t,n){e.css({position:"absolute"}).animate({left:n?"100%":"-100%",opacity:0},t,function(){$j(this).css({position:"",left:0,display:"none"})});var r=e.data("slide_idx");this._j_nav_dots_container.find("a").eq(r).removeClass("active")},_animate_slide_in:function(e,t,n){var r=this,i=e.width();e.css({position:"absolute",left:n?"-100%":"100%",display:"block",opacity:0,width:i+"px"}).animate({left:"0%",opacity:1},t,function(){$j(this).css({position:"",left:0,width:"auto"}),r._is_transitioning=!1});var s=e.data("slide_idx");this._j_nav_dots_container.find("a").eq(s).addClass("active"),this._visible_slide_idx=s},_set_interval_for_auto_rotate:function(){var e=this;this._auto_rotate_interval=setInterval(function(){var n=(e._visible_slide_idx+1)%e._num_slides;e._transition(e._visible_slide_idx,n,!0)},this._auto_rotate_delay_ms)},_close:function(){var e=this;this._j_banner_message_anchor.slideUp(function(){e._j_banner_message_anchor.empty()}),this.params.call_dismiss_action_on_close&&In_App_Message.get().dismiss_in_app_message(),this._clear_auto_rotate_timers()}});Box.Timing.execution.push({name:"js/menus/abstract_simple_menu.js",time:(new Date).getTime()});var Abstract_Simple_Menu=Abstract_Menu.extend({_menu_id:"",_menu_data:{},_structure:function(e){e=e||{};if(!this._e_menu){var t=$j('<ul class="list_menu hover_list" />');for(var n in this._menu_data){var r=this._menu_data[n],i=$j('<a href="#" />').attr("id",r.id).text(r.text);r.attributes&&i.attr(r.attributes),t.append($j("<li/>").append(i))}this._e_menu=$j('<div class="cntr drop_down_ext handle_menu_events"/>').attr("id",this._menu_id).append(t).appendTo(document.body).get(0)}}},{});Box.Timing.execution.push({name:"js/menus/filters/box_create_filter_user_menu.js",time:(new Date).getTime()});var Create_Filter_User_Menu=Abstract_Filter_Menu.extend({filter_value:null,_filter_type:"users",_default_text:$t("All Users","user_button_text_v2"),menu_initialized:!1,user_added_timestamp:0,constructor:function(e){e=e||{},this.base(e),this.selected_users=e.selected_users,this._j_input=this.j_dd_menu.find("input"),this._j_done_button=this.j_dd_menu.find(".done_button")},show:function(e){this.base(e);var t=this;if(this.menu_initialized)this._j_input.trigger("change");else{var n={show_dropdown_toggler:!1,hide_no_results_item:!0,search_in_enterprise:!0,bind_contact_selector:!0,default_selections:this.selected_users,callbacks:{_on_option_added:function(e){t._on_option_added(e)}}};this.populate_contact_selector(n),this.bind_event_handlers(),this.menu_initialized=!0}this._j_input.focus()},bind_event_handlers:function(){var e=this;this.update_input_reference(),this.j_dd_menu.on("keypress",function(t){if(t.keyCode===13&&!e.j_dd_menu.find(".drop_down_container").is(":visible")){var n=(new Date).getTime();n-e.user_added_timestamp>300&&(e.validate_and_submit_filter(),e.hide_menu(),e.user_added_timestamp=0)}}),this._j_done_button.off().on("click",function(t){return e.hide_menu(),e.validate_and_submit_filter(),!1})},update_input_reference:function(){this._j_input=this.j_dd_menu.find("input")},_on_option_added:function(e){this.user_added_timestamp=(new Date).getTime()},populate_contact_selector:function(e){var t=$j.popup.renderControl("boxContactsSelector",e);this.contact_selector=e.contact_selector,$j(t).find("#dropdown_toggler").hide(),this.j_dd_menu.find(".contact_selector_wrapper").html(t)},validate_and_submit_filter:function(){var e=this.selected_users,t=this.filter_value||[],n=this.get_encoded_value();this.contact_selector&&(this.selected_users=this.contact_selector.get_full_selected_options(),this._set_value(this._get_object_keys(this.selected_users))),this.filter_value&&$.arrayDiff(t,this.filter_value)?this._update_and_show_filter():!$j.isEmptyObject(e)&&$j.isEmptyObject(this.selected_users)&&(typeof Tombstone!="undefined"&&Tombstone.marker("./js/menus/filters/box_create_filter_user_menu.js:6231","2013-05-15","auto tombstoned"),this.reset_filter()),this.broadcast_filter_change(n)},reset_filter:function(){this.menu_initialized=!1,this.selected_users=null,this.j_dd_menu.off("keypress"),this.j_dd_menu.find(".placeholderize-wrapper-noname").off("mousedown"),this.contact_selector&&this.contact_selector.remove_all_badges(),this.base()},_update_and_show_filter:function(){var e,t=this.filter_value.length;t===1?e=" "+$t("%1 User Selected","user_button_name_user_selected_v2",t):t===0?e=this._default_text:e=" "+$t("%1 Users Selected","user_button_name_users_selected_v2",t),this.base(e)},_set_value:function(e){this.filter_value=e?$j.makeArray(e):null}},{});Box.Timing.execution.push({name:"js/menus/box_upload_menu.js",time:(new Date).getTime()});var Upload_Menu=Abstract_Menu.extend({_timeout_duration:500,upload_widgets:[],constructor:function(e){e=e||{},this._e_menu=$j("#dd_menu_upload").get(0)},show:function(e){e=e||{},this._j_target_element=$j(e.target),this._callback=e.callback,this.base()},delete_upload_widgets:function(){for(var e=0;e<this.upload_widgets.length;e++)this.upload_widgets[e]&&this.upload_widgets[e].destroy();this.upload_widgets=[]},_get_offsets:function(e){return{x:0,y:11}},_render:function(){this._init_upload()},_init_upload:function(){if(typeof Upload_Process=="undefined")return;this.delete_upload_widgets(),this.upload_widgets.push(this.add_file_picker()),this.upload_widgets.push(this.add_folder_picker()),Upload_Process.get().get_type()=="flash"&&(this._elements_that_keep_menu_open=Upload_Process.get().container)},add_file_picker:function(){var e=$j("#upload_menu_upload_files");return this._add_upload_trigger(e)},add_folder_picker:function(){var e,t=!0;if(Box.Application.getService("browser").canFolderUpload())return e=$j("#upload_menu_bulk_upload"),this._add_upload_trigger(e,t)},_add_upload_trigger:function(e,t){var n=this;if(!e.length)return;var r=Upload_Process.get();return r.add_trigger({element:e,folder:n.item,directory_upload:t,over_callback:function(){e.addClass("hover"),n._hover_on()},out_callback:function(){e.removeClass("hover"),n._hover_off()},handle_change:function(e,t){n.hide(),r.handle_change(e,t)}})}},{});Box.Timing.execution.push({name:"js/menus/pim_sort_menu.js",time:(new Date).getTime()});var PIM_Sort_Menu=Abstract_Menu.extend({sort_method:"",sort_direction:"",tab:"",constructor:function(e){e=e||{},this.base(e),this._e_menu=$j("#pim_sort_menu").get(0),$(this._e_menu).on("mousedown",function(e){e.stopPropagation()})},_get_offsets:function(){return{x:0,y:13}},show:function(e){this._j_target_element=$j(e.target),this.sort_method=e.sort_method,this.sort_direction=e.sortdirection,this.tab=e.tab,this.base()},_render:function(){var e=$j(this._e_menu);e.children().children("li").hide(),e.find(".sort_option"
).removeClass("selected").show(),e.find(".arrow").attr("class","arrow"),this._filter_menu_options();var t=this._get_current_option_link();this._mark_option_selected(t,this.sort_direction)},event_click:function(e){var t=$j(e.target),n=t.closest("li");n.hasClass("sort_option")?n.hasClass("selected")?this._toggle_sort_direction(n):this._change_sort_type(n):n.hasClass("mark_all_as_read")&&Box.Application.broadcast("mentionsread")},_filter_menu_options:function(){var e=$j(this._e_menu),t=e.find(".actions_menu_section"),n=PIM_Sort_Menu.ACTION_OPTIONS_SELECTORS[this.tab];n?(t.show(),t.find(n).show()):t.hide()},_mark_option_selected:function(e,t){e.addClass("selected");var n=e.find(".arrow"),r=t=="ASC"?"sprite_5x5_menu_arrow_up":"sprite_5x5_menu_arrow";n.attr("class","arrow sprite_5x5 "+r)},_toggle_sort_direction:function(e){var t,n=e.find(".arrow");this.sort_direction=="ASC"?(n.removeClass("sprite_5x5_menu_arrow_up").addClass("sprite_5x5_menu_arrow"),t="DESC"):(n.removeClass("sprite_5x5_menu_arrow").addClass("sprite_5x5_menu_arrow_up"),t="ASC");var r=this._get_type_from_clicked_element(e);this._set_sort(r,t)},_change_sort_type:function(e){var t=$j(this._e_menu),n=t.find("li");n.removeClass("selected");var r=n.find(".arrow");r.removeClass("sprite_5x5").removeClass("sprite_5x5_menu_arrow").removeClass("sprite_5x5_menu_arrow_up"),e.addClass("selected");var i=e.find(".arrow");i.addClass("sprite_5x5");var s=this._get_type_from_clicked_element(e),o=this._get_default_sort_dir(s);o=="ASC"?i.addClass("sprite_5x5_menu_arrow_up"):i.addClass("sprite_5x5_menu_arrow"),this._set_sort(s,o)},_get_current_option_link:function(){return $(this._e_menu).find('.sort_option[data-sort_type="'+this.sort_method+'"]')},_get_type_from_clicked_element:function(e){return e.data("sort_type")},_get_default_sort_dir:function(e){return PIM_Sort_Menu.DEFAULT_SORT_DIR[e]},_set_sort:function(e,t){this.sort_method=e,this.sort_direction=t,Box.Application.broadcast("pimsortchanged",{method:e,direction:t})}},{DEFAULT_SORT_DIR:{date:"DESC",collaborator:"ASC",name:"ASC"},ACTION_OPTIONS_SELECTORS:{tasks:null,messages:".mark_all_as_read",sent:null}});Box.Timing.execution.push({name:"js/box_import_contacts.js",time:(new Date).getTime()});var Import_Contacts=Base.extend({tab:null,constructor:function(e){e=e||{},this.tab="gmail"},show:function(e){e=e||{},this.tab=e.tab;var t=this,n='<div class="media center" style="width: 260px;"><span class="img sprite_16x16_lock"></span><div class="bd legal">'+$t("Your login information will not be stored by Box","import_contacts_data_will_not_be_stored")+"</div>"+"</div>",r=[{type:"tab",label:$t("Gmail","popup_gmail_tab"),selected:this.tab=="gmail",contents:[{type:"html",data:"<p><strong>"+$t("Login to your Gmail.com email account","import_contacts_login_to_your_email")+"</strong></p><p>"+$t("Import contacts that can be used to collaborate with on Box","import_contacts_used_to_collaborate")+"</p>"},{type:"input",label:$t("Username:","import_contacts_field_user_name"),linebreak:!0,name:"import_username"},{type:"password",label:$t("Password:","import_contacts_field_password"),linebreak:!0,name:"import_password"},{type:"html",data:n},{type:"hidden",value:"gmail",name:"type"}]},{type:"tab",label:$t("Yahoo","popup_yahoo_tab"),selected:this.tab=="yahoo",contents:[{type:"html",data:"<p><strong>"+$t("Login to your Yahoo.com email account","import_contacts_login_to_your_email_y")+"</strong></p><p>"+$t("Import contacts that can be used to collaborate with on Box","import_contacts_used_to_collaborate")+"</p>"},{type:"input",label:$t("Username:","import_contacts_field_user_name"),linebreak:!0,name:"import_username"},{type:"password",label:$t("Password:","import_contacts_field_password"),linebreak:!0,name:"import_password"},{type:"html",data:n},{type:"hidden",value:"yahoo",name:"type"}]},{type:"tab",label:$t("Outlook","popup_outlook_tab"),selected:this.tab=="outlook",contents:[{type:"html",data:"<p><strong>"+$t("Import from Outlook .CSV file","import_contacts_from_outlook_csv")+"</strong></p><p>"+$t("Import contacts that can be used to collaborate with on Box","import_contacts_used_to_collaborate")+"</p>"},{type:"file",label:$t("CSV file:","import_contacts_field_csv_file"),linebreak:!0,name:"outlook_file",id:"outlook"},{type:"hidden",value:"outlook",name:"type"}]},{type:"buttons",items:[{value:$t("Submit","popup_button_submit"),click:function(e,n){var r=!0;return e.type=="outlook"?r=t.get_list_csv(e):(r=t.get_list(e),r||$j.popup.revert()),!1}},{value:$t("Cancel","js_popup_button_cancel"),click:$j.popup.close}]}];$j.popup.form($t("Import Contacts","import_contacts_title"),r)},import_contacts:function(e){var t=e.find(".import_contact_checkbox:checked");if(!t.length){alert($t("Please, select contacts to import","js_import_contacts_pls_select_contacts_import")),$j.popup.revert();return}var n=[];t.each(function(){n.push($j(this).attr("data-email"))});var r={emails:n.join(",")},i=$j.box.formatQuery(r);$j.postJSON("/index.php?rm=box_invite_friends_ajax",i,function(e){var t=n.length,r=t>1?$t("%1 contacts have been successfully added to your contact list.  You can now invite them to any collaboration folder, or send them a link to any stored file or folder.  Once you are collaborating with these contacts, they will appear in the list below.","js_import_contacts_have_successfully_added",t):$t("%1 contact has been successfully added to your contact list.  You can now invite them to any collaboration folder, or send them a link to any stored file or folder.  Once you are collaborating with these contacts, they will appear in the list below.","js_import_contact_has_successfully_added",t);$j("#box_confirmation_content").text(r),$j("#box_confirmation").show(),$j.popup.close()})},get_list_csv:function(e){var t=this,n=e.outlook_file;if($.trim(n)=="")return Box.Application.getService("popups").alert($t("Please select a file to upload","js_import_contacts_error_select_file_to_upload"),{onclose:function(){t.show({tab:"outlook"})}}),!1;if(n.substring(n.length-3,n.length).toLowerCase()!="csv")return Box.Application.getService("popups").alert($t("Sorry, you can upload only .csv file","js_import_contacts_eror_you_can_upload_only_csv"),{onclose:function(){t.show({tab:"outlook"})}}),!1;var t=this,r="/index.php?rm=get_webmail_contacts_list_ajax&type=outlook",i=$j("#outlook"),s=i.parent(),o=$j('<form method="POST" enctype="multipart/form-data" />').attr("action",r).appendTo(document.body);o.append(i.detach()),$j.box.appendRequestToken(o),o.ajaxSubmit({dataType:"json",success:function(e){var n=e.result;if(n=="success")return t.show_contacts(e.html),o.remove(),!0;var r=[$t("Error parsing .csv file","js_import_contacts_error_parsing_csv"),$t("No contacts found or unknown error","js_import_contacts_error_no_contacts_found")];s.append(i),alert(r[n-1]),$j.popup.revert()}})},get_list:function(e){var t=this,n=e.import_username,r=e.import_password,i=e.type;if(!n||!r)return alert($t("Please type your username and password","js_import_contacts_type_user_name_password")),!1;var s={username:n,password:r,type:i},o=$j.box.formatQuery(s);return $j.post("/index.php?rm=get_webmail_contacts_list_ajax",o,function(e){var n=e.result;if(n=="success")t.show_contacts(e.html);else{var r=i=="gmail"?"Gmail":"Yahoo",s=[$t("Bad user name or password","js_import_contacts_error_bad_user_name"),$t("Server error","js_import_contacts_error_server_error"),$t("No contacts found or unknown error","js_import_contacts_error_no_contacts_found"),$t("You have exceeded the maximum number of log in attempts allowed by %1. Please try again later.","js_import_contacts_error_attempts_limit",r)];alert(s[n-1]),$j.popup.revert()}},"json"),!0},show_contacts:function(e){var t=this,n=[{type:"html",data:'<div class="line mbs"><div class="unit size1of2"><strong>'+$t("Select contacts below to import:","import_contacts_select_bellow_to_import")+'</strong></div><div class="unit size1of2 last_unit txt_r prl">'+$t("Selected contacts","import_contacts_selected_contacts")+' (<span id="popup_import_contacts-selected-count">0</span>)</div></div>'},{type:"html",data:e},{type:"buttons",items:[{value:$t("Import","popup_button_import"),click:function(e,n){t.import_contacts(n)}},{value:$t("Cancel","js_popup_button_cancel"),click:$j.popup.close}]}];$j.popup.form($t("Import Contacts","import_contacts_title"),n),$j("#j_popup_form").find(".import_contact_checkbox").click(function(){var e=$j("#j_popup_form").find(".import_contact_checkbox:checked");$j("#popup_import_contacts-selected-count").text(e.length)})}},{instance:null,get:function(){return Import_Contacts.instance||(Import_Contacts.instance=new Import_Contacts),Import_Contacts.instance}});Box.Timing.execution.push({name:"js/plugins/t3/error-bindings.js",time:(new Date).getTime()}),function(){function e(e){return{name:e.name,message:e.message,stack:e.stack}}if(window.Box&&Box.Application){var t=Box.Application,n=t.getService("v5"),r=n&&n.get("Features"),i=n&&n.get("live_site");if(r&&r.log_t3_errors){t.on("error",function(n){try{var r=t.getService("logger");r&&r.sendError("t3",{message:n.data.message,exception:e(n.data.exception)})}catch(i){}});if(i){var s=window.onerror;window.onerror=function(n,r,i,o,u){var a=!1;s&&(a=s());try{if(a!==!0){var f=t.getService("logger");return f&&f.sendError("non-t3",{message:n,exception:e(u||{}),url:r,line:i}),!0}}catch(l){}return a}}}}}(),Box.Timing.execution.push({name:"done",time:(new Date).getTime()});